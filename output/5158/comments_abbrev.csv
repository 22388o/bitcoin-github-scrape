gavinandresen,2014-10-28T19:17:41Z,How did you test this?\n,https://github.com/bitcoin/bitcoin/pull/5158#issuecomment-60814787,60814787,
rdponticelli,2014-10-28T19:59:04Z,"I tested this by running it over a derivative of #4701 on syncing, reindexing and up-to-date nodes. Those cases were broken before this patch, and work well after.\n\nThe dependence on local time is ugly, but that was there before, anyway...\n",https://github.com/bitcoin/bitcoin/pull/5158#issuecomment-60821107,60821107,
gmaxwell,2014-10-28T23:06:16Z,"This gets rid of the nLastUpdate static, I'm happy about that. This seems reasonable to me. utACK.\n",https://github.com/bitcoin/bitcoin/pull/5158#issuecomment-60847400,60847400,
sipa,2014-11-04T12:55:26Z,"In what ways is IsInitialBlockDownload broken now? Not a criticism, just trying to understand :)\n",https://github.com/bitcoin/bitcoin/pull/5158#issuecomment-61635359,61635359,
rdponticelli,2014-11-04T15:00:59Z,It randomly returns true or false during all the  IBD.\n,https://github.com/bitcoin/bitcoin/pull/5158#issuecomment-61652023,61652023,
rdponticelli,2014-11-06T13:08:16Z,Added a commit implementing @laanwj suggestion to deal with @gmaxwell's concern.\n,https://github.com/bitcoin/bitcoin/pull/5158#issuecomment-61975939,61975939,
sipa,2014-11-06T13:13:57Z,"A single boolean would suffice, no?\n",https://github.com/bitcoin/bitcoin/pull/5158#issuecomment-61976576,61976576,
rdponticelli,2014-11-06T14:32:29Z,Simplified to use a single boolean.\n,https://github.com/bitcoin/bitcoin/pull/5158#issuecomment-61986638,61986638,
gmaxwell,2014-11-06T17:48:02Z,utACK.\n,https://github.com/bitcoin/bitcoin/pull/5158#issuecomment-62020492,62020492,
TheBlueMatt,2014-11-06T23:56:58Z,utACK: http://bitcoin.ninja/TheBlueMatt-5158.txt\n,https://github.com/bitcoin/bitcoin/pull/5158#issuecomment-62073900,62073900,
gmaxwell,2014-11-07T20:21:58Z,still ACK  (though only tested pretty lightly)\n,https://github.com/bitcoin/bitcoin/pull/5158#issuecomment-62206048,62206048,
sipa,2014-11-17T16:22:02Z,Note that #5241 reduces the number of conditionals that are based on IsInitialBlockdownload().\n,https://github.com/bitcoin/bitcoin/pull/5158#issuecomment-63330057,63330057,
sipa,2014-11-17T16:23:07Z,utACK\n,https://github.com/bitcoin/bitcoin/pull/5158#issuecomment-63330258,63330258,
TheBlueMatt,2014-11-20T05:07:37Z,utACK only commithashes 9ec75c5ef4182a38e261beaafdc94325785cc7c5 + a2d0fc658a7b21d2d41ef2a6c657d24114b6c49e: http://bitcoin.ninja/TheBlueMatt-5158.txt\n,https://github.com/bitcoin/bitcoin/pull/5158#issuecomment-63761943,63761943,
TheBlueMatt,2014-10-30T05:15:06Z,"Shouldnt you just check if the best header index has received the block contents? Nodes could be mean and not relay contents, but that means either they're running an incredibly expensive annoyance or you're behind a strange sybil.\n",https://github.com/bitcoin/bitcoin/pull/5158#discussion_r19588127,19588127,src/main.cpp
gmaxwell,2014-10-30T05:18:36Z,"I don't think we want to eroniously think we're caught up when the best tip is far behind the local time (e.g. because we're broken for some reason).\n\nOTOH, there is a ... somewhat corner case that might be wort worring about:  With this proposed code, if the network goes 24 hours without a block (uh what?) everyone running this will stop mining. :P\n",https://github.com/bitcoin/bitcoin/pull/5158#discussion_r19588188,19588188,src/main.cpp
TheBlueMatt,2014-10-30T05:21:18Z,"Sorry, I meant just like walk pindexBestHeader back N blocks, if we still havent received the data for that block, consider us to be in IBD.\n",https://github.com/bitcoin/bitcoin/pull/5158#discussion_r19588225,19588225,src/main.cpp
gmaxwell,2014-10-30T06:22:43Z,"I'm not sure what behavior we want here. If the best header is still a day back, then we know we're not in sync.\n",https://github.com/bitcoin/bitcoin/pull/5158#discussion_r19589282,19589282,src/main.cpp
TheBlueMatt,2014-10-30T06:38:06Z,I wasnt suggesting it exclusively...sorry if that was unclear.\n,https://github.com/bitcoin/bitcoin/pull/5158#discussion_r19589525,19589525,src/main.cpp
laanwj,2014-11-03T10:03:53Z,"> With this proposed code, if the network goes 24 hours without a block (uh what?) everyone running this will stop mining. :P\n\nArguably, we should never stop mining whatever happens. During a run of Bitcoin Core we should never go from `!IsInitialBlockDownload()` to `IsInitialBlockDownload()`. That just doesn't make sense, so we can add a check to prevent it.\n",https://github.com/bitcoin/bitcoin/pull/5158#discussion_r19724980,19724980,src/main.cpp
rdponticelli,2014-11-05T19:49:58Z,Wouldn't a deep reorg caused by the reconnection of some long split nodes cause a possible valid case of !IsInitialBlockDownload() to IsInitialBlockDownload()?\n,https://github.com/bitcoin/bitcoin/pull/5158#discussion_r19899942,19899942,src/main.cpp
gmaxwell,2014-11-05T20:03:56Z,By definition in that case you'll be on a longer chain than what already got you past the initial download check; so I think it shouldn't.   \n,https://github.com/bitcoin/bitcoin/pull/5158#discussion_r19901072,19901072,src/main.cpp
rdponticelli,2014-11-05T20:13:12Z,"But it would be valid for the nodes going from the shortest chain to the longest one, right?\n",https://github.com/bitcoin/bitcoin/pull/5158#discussion_r19901759,19901759,src/main.cpp
gmaxwell,2014-11-05T20:34:21Z,"I think what we're trying to approximate here is ""are you caught up to at least the point that you should have been at when you got the software"", without having to insert a block height or total work into every download as it ships. And it's okay if it sometimes falsely returns false too early. It's not really okay if it returns true too late.\n\nEsp since right now it'll make you stop mining, me",https://github.com/bitcoin/bitcoin/pull/5158#discussion_r19903330,19903330,src/main.cpp
Diapolo,2014-11-06T18:57:39Z,Nit: Can you make this lockIbdState or perhaps even lockIBDState to be readable? What do the others think.\n,https://github.com/bitcoin/bitcoin/pull/5158#discussion_r19965703,19965703,src/main.cpp
laanwj,2014-11-07T10:32:41Z,"I don't mind how it's called (scope is just local anyhow), although I'd like an explicit\n\n```\nstatic bool lockibdstate = false;\n```\n\n...for readability\n",https://github.com/bitcoin/bitcoin/pull/5158#discussion_r20003550,20003550,src/main.cpp
rdponticelli,2014-11-07T18:57:48Z,Added.\n,https://github.com/bitcoin/bitcoin/pull/5158#discussion_r20029224,20029224,src/main.cpp
