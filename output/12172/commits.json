[
  {
    "sha": "cb1e319fe9e198c9c5cf5236fe9af5a3d748b9e8",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjYjFlMzE5ZmU5ZTE5OGM5YzVjZjUyMzZmZTlhZjVhM2Q3NDhiOWU4",
    "commit": {
      "author": {
        "name": "Jorge Tim\u00f3n",
        "email": "jtimon@jtimon.cc",
        "date": "2018-01-12T20:38:48Z"
      },
      "committer": {
        "name": "Jorge Tim\u00f3n",
        "email": "jtimon@jtimon.cc",
        "date": "2018-03-29T04:24:30Z"
      },
      "message": "Bugfix: RPC: savemempool: Don't save until LoadMempool() is finished",
      "tree": {
        "sha": "8838739229d115b134824dcb04c2494ac87b8379",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8838739229d115b134824dcb04c2494ac87b8379"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/cb1e319fe9e198c9c5cf5236fe9af5a3d748b9e8",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v2\n\niQIcBAABCAAGBQJavGp+AAoJEIhmwY6hyUSi+D0P/3zSjwQ297jg6G1qf+mJ70w3\ni04BLxTntIML+Uiz80jz8gVxsGMneW+TxwfBRg6jTWeS9CDgQl3KiYGkPihF1dct\n7FTP+rV6vIR453CuFJ9KO+X9NUwU8nFbSd46W18AO78DKNy7QWVXwVZ6ygfabCxr\nGT1DzWyyukzfPrSuTWIrHTg383Pmo3SIMm7gNwxSkFA5/1yx3iG8TJpuMKJVZJ7y\nJjK1zMGq3AWx1H8XKQhQT83iGYXSgEGFTW0R5esslQgcGj3OqKGqNGGFmM0NT3eg\ntCT9Y3z6/cjUpVKN6MGkPGoClnt8pLdtMGSZSLpSiLCNbUlsMxrPTWHB5/DFlbAG\nCAfsc4xtVlGvfqmWcTFxiyHmLCodxqw2WBvgAzfhIoGUZ8QVQj4u6hzMKcXEsXhI\nuHCGuCnJBzPTY1kJOdZ2rNxIF3vhsTu++GmcHBiNdvY26JAKtBnB1ypiXqjoPhuC\n7JbwDjYq3Fkpfak6j8jbYHTalA98yqepnLPjJRtCmSyjZuI/XdZWCv61g7MX+Sf3\neeOamPJjSjDPZ7pdINFBFjuxwqZ2Ni8NwQEVQbKU4qZQ227wHbvnQpu9ArQzh6kv\nMphSxcjO5HUdMjl3q7T1qwhjsELRcKQ+B6Mtz8WPtm0+003BdIxf8UOtYYc4lexm\nOwxkmKCyUId1pKvGZP89\n=770w\n-----END PGP SIGNATURE-----",
        "payload": "tree 8838739229d115b134824dcb04c2494ac87b8379\nparent 624bee96597c1d59018e58131b8285c0b332700d\nauthor Jorge Tim\u00f3n <jtimon@jtimon.cc> 1515789528 +0100\ncommitter Jorge Tim\u00f3n <jtimon@jtimon.cc> 1522297470 +0200\n\nBugfix: RPC: savemempool: Don't save until LoadMempool() is finished\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cb1e319fe9e198c9c5cf5236fe9af5a3d748b9e8",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/cb1e319fe9e198c9c5cf5236fe9af5a3d748b9e8",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/cb1e319fe9e198c9c5cf5236fe9af5a3d748b9e8/comments",
    "author": {
      "login": "jtimon",
      "id": 1008458,
      "node_id": "MDQ6VXNlcjEwMDg0NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1008458?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtimon",
      "html_url": "https://github.com/jtimon",
      "followers_url": "https://api.github.com/users/jtimon/followers",
      "following_url": "https://api.github.com/users/jtimon/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtimon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtimon/subscriptions",
      "organizations_url": "https://api.github.com/users/jtimon/orgs",
      "repos_url": "https://api.github.com/users/jtimon/repos",
      "events_url": "https://api.github.com/users/jtimon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtimon/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jtimon",
      "id": 1008458,
      "node_id": "MDQ6VXNlcjEwMDg0NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1008458?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtimon",
      "html_url": "https://github.com/jtimon",
      "followers_url": "https://api.github.com/users/jtimon/followers",
      "following_url": "https://api.github.com/users/jtimon/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtimon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtimon/subscriptions",
      "organizations_url": "https://api.github.com/users/jtimon/orgs",
      "repos_url": "https://api.github.com/users/jtimon/repos",
      "events_url": "https://api.github.com/users/jtimon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtimon/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "624bee96597c1d59018e58131b8285c0b332700d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/624bee96597c1d59018e58131b8285c0b332700d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/624bee96597c1d59018e58131b8285c0b332700d"
      }
    ],
    "stats": {
      "total": 13,
      "additions": 9,
      "deletions": 4
    },
    "files": [
      {
        "sha": "348af4b13bc5e8faa7b410e37f7db9910c853437",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 3,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cb1e319fe9e198c9c5cf5236fe9af5a3d748b9e8/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cb1e319fe9e198c9c5cf5236fe9af5a3d748b9e8/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=cb1e319fe9e198c9c5cf5236fe9af5a3d748b9e8",
        "patch": "@@ -116,7 +116,6 @@ static const char* FEE_ESTIMATES_FILENAME=\"fee_estimates.dat\";\n //\n \n std::atomic<bool> fRequestShutdown(false);\n-std::atomic<bool> fDumpMempoolLater(false);\n \n void StartShutdown()\n {\n@@ -208,7 +207,7 @@ void Shutdown()\n     threadGroup.interrupt_all();\n     threadGroup.join_all();\n \n-    if (fDumpMempoolLater && gArgs.GetArg(\"-persistmempool\", DEFAULT_PERSIST_MEMPOOL)) {\n+    if (g_is_mempool_loaded && gArgs.GetArg(\"-persistmempool\", DEFAULT_PERSIST_MEMPOOL)) {\n         DumpMempool();\n     }\n \n@@ -692,8 +691,8 @@ void ThreadImport(std::vector<fs::path> vImportFiles)\n     } // End scope of CImportingNow\n     if (gArgs.GetArg(\"-persistmempool\", DEFAULT_PERSIST_MEMPOOL)) {\n         LoadMempool();\n-        fDumpMempoolLater = !fRequestShutdown;\n     }\n+    g_is_mempool_loaded = !fRequestShutdown;\n }\n \n /** Sanity checks"
      },
      {
        "sha": "31cbec4c8664f5938b48ab7753b2a0a02094b84a",
        "filename": "src/rpc/blockchain.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 1,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cb1e319fe9e198c9c5cf5236fe9af5a3d748b9e8/src/rpc/blockchain.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cb1e319fe9e198c9c5cf5236fe9af5a3d748b9e8/src/rpc/blockchain.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/blockchain.cpp?ref=cb1e319fe9e198c9c5cf5236fe9af5a3d748b9e8",
        "patch": "@@ -1607,13 +1607,17 @@ UniValue savemempool(const JSONRPCRequest& request)\n     if (request.fHelp || request.params.size() != 0) {\n         throw std::runtime_error(\n             \"savemempool\\n\"\n-            \"\\nDumps the mempool to disk.\\n\"\n+            \"\\nDumps the mempool to disk. It will fail until the previous dump is fully loaded.\\n\"\n             \"\\nExamples:\\n\"\n             + HelpExampleCli(\"savemempool\", \"\")\n             + HelpExampleRpc(\"savemempool\", \"\")\n         );\n     }\n \n+    if (!g_is_mempool_loaded) {\n+        throw JSONRPCError(RPC_MISC_ERROR, \"The mempool was not loaded yet\");\n+    }\n+\n     if (!DumpMempool()) {\n         throw JSONRPCError(RPC_MISC_ERROR, \"Unable to dump mempool to disk\");\n     }"
      },
      {
        "sha": "d6848a3aca172370eadf99a62c425762856d26c4",
        "filename": "src/validation.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cb1e319fe9e198c9c5cf5236fe9af5a3d748b9e8/src/validation.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cb1e319fe9e198c9c5cf5236fe9af5a3d748b9e8/src/validation.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/validation.cpp?ref=cb1e319fe9e198c9c5cf5236fe9af5a3d748b9e8",
        "patch": "@@ -227,6 +227,7 @@ CAmount maxTxFee = DEFAULT_TRANSACTION_MAXFEE;\n \n CBlockPolicyEstimator feeEstimator;\n CTxMemPool mempool(&feeEstimator);\n+std::atomic_bool g_is_mempool_loaded{false};\n \n /** Constant stuff for coinbase transactions we create: */\n CScript COINBASE_FLAGS;"
      },
      {
        "sha": "4031989f006a0521c72d045f129758f1bfdaf274",
        "filename": "src/validation.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/cb1e319fe9e198c9c5cf5236fe9af5a3d748b9e8/src/validation.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/cb1e319fe9e198c9c5cf5236fe9af5a3d748b9e8/src/validation.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/validation.h?ref=cb1e319fe9e198c9c5cf5236fe9af5a3d748b9e8",
        "patch": "@@ -158,6 +158,7 @@ extern CScript COINBASE_FLAGS;\n extern CCriticalSection cs_main;\n extern CBlockPolicyEstimator feeEstimator;\n extern CTxMemPool mempool;\n+extern std::atomic_bool g_is_mempool_loaded;\n typedef std::unordered_map<uint256, CBlockIndex*, BlockHasher> BlockMap;\n extern BlockMap& mapBlockIndex;\n extern uint64_t nLastBlockTx;"
      }
    ]
  }
]