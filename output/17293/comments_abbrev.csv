sipa,2019-10-29 00:11:10,"In the short term, asserting is probably best. The function is simply not intended to be called with argument 0.\n\nPerhaps longer term it would make sense to (also?) have a function that takes a `max` (and optionally a `min`?) argument, and returns something in that range, inclusive. The advantage is that  it can be used for any range, including up to the limit.",https://github.com/bitcoin/bitcoin/pull/17293#issuecomment-547199890,547199890,
practicalswift,2019-10-29 09:38:31,"Concept ACK\n\nNice find!\n\n@JeremyRubin Have you checked the call sites for the possibility of any of them calling `randrange` with argument `0`?",https://github.com/bitcoin/bitcoin/pull/17293#issuecomment-547335660,547335660,
practicalswift,2019-10-29 10:49:41,"https://github.com/bitcoin/bitcoin/blob/badca85e2c0bf1720fca8a516adbf4b3f1d7e4d9/src/net_processing.cpp#L946-L953\n\n`g_orphan_list.size() == 0` is impossible here?",https://github.com/bitcoin/bitcoin/pull/17293#issuecomment-547362569,547362569,
practicalswift,2019-10-29 11:05:31,"@JeremyRubin After taking a quick look at the various direct and indirect users of `randrange` I'm not certain that there are no code paths where `randrange(0)` could be called.\n\nNote that `GetRand`, `GetRandInt` and `Shuffle` all use `randrange` under the hood.\n\nThis can be used to analyse the call sites:\n\n```\n$ git grep -E '(randrange|GetRand|GetRandInt|Shuffle)\(' -- ""*.cpp"" ""*.h""",https://github.com/bitcoin/bitcoin/pull/17293#issuecomment-547368314,547368314,
instagibbs,2019-10-29 16:13:01,"Seems reasonable for now, ACK https://github.com/bitcoin/bitcoin/pull/17293/commits/a35b6824f3a0bdb68c5aef599c0f17562689970e",https://github.com/bitcoin/bitcoin/pull/17293#issuecomment-547503033,547503033,
JeremyRubin,2019-10-29 16:48:15,"@practicalswift I did in fact check. The issue came up while I was testing #17292, I accidentally put in randrange(vec.size()) somewhere, and it had the nice effect of crashing my computer :)\n\nThis lead me to check the rest of the codebase, including that example in net_processing. I did think it was a bug at first, but I think the loops pre-conditions (mapOrphanTransactions.size() > 0 && for ",https://github.com/bitcoin/bitcoin/pull/17293#issuecomment-547520500,547520500,
practicalswift,2019-10-29 18:07:13,"> I think you are incorrect that assert in randrange is dangerous. It's the other way around: returning a too-big number is dangerous, as it can lead to entire system crashes (as in on my system) as opposed to graceful panics or it can lead to random memory probing and leaking secrets.\n\nI think it depends on the call site. You're correct in that for some of the call sites an assertion failure ",https://github.com/bitcoin/bitcoin/pull/17293#issuecomment-547556964,547556964,
laanwj,2019-10-30 15:29:11,"I think this is a good place for an assertion. Returning anything else is unsafe.\nACK a35b6824f3a0bdb68c5aef599c0f17562689970e",https://github.com/bitcoin/bitcoin/pull/17293#issuecomment-547964796,547964796,
promag,2019-11-02 00:33:30,ACK a35b6824f3a0bdb68c5aef599c0f17562689970e.,https://github.com/bitcoin/bitcoin/pull/17293#issuecomment-548992193,548992193,
