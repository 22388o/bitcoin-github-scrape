[
  {
    "sha": "05e0b740252277f5e4ca75daaa79751d59998339",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowNWUwYjc0MDI1MjI3N2Y1ZTRjYTc1ZGFhYTc5NzUxZDU5OTk4MzM5",
    "commit": {
      "author": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2016-09-12T09:02:07Z"
      },
      "committer": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2016-10-20T13:18:34Z"
      },
      "message": "Log height of block messages, if known, when received",
      "tree": {
        "sha": "afcb592a1c260480a660f8013a3dcdb85c1a77e0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/afcb592a1c260480a660f8013a3dcdb85c1a77e0"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/05e0b740252277f5e4ca75daaa79751d59998339",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/05e0b740252277f5e4ca75daaa79751d59998339",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/05e0b740252277f5e4ca75daaa79751d59998339",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/05e0b740252277f5e4ca75daaa79751d59998339/comments",
    "author": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f2d705629b510e2a5b25c8ecac1898fed13a16a2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f2d705629b510e2a5b25c8ecac1898fed13a16a2",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f2d705629b510e2a5b25c8ecac1898fed13a16a2"
      }
    ],
    "stats": {
      "total": 12,
      "additions": 7,
      "deletions": 5
    },
    "files": [
      {
        "sha": "cc369f8915b31b1f5a2c6e21c682b5104ba57439",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 5,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/05e0b740252277f5e4ca75daaa79751d59998339/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/05e0b740252277f5e4ca75daaa79751d59998339/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=05e0b740252277f5e4ca75daaa79751d59998339",
        "patch": "@@ -3753,9 +3753,13 @@ bool ProcessNewBlock(CValidationState& state, const CChainParams& chainparams, C\n         CBlockIndex *pindex = NULL;\n         bool fNewBlock = false;\n         bool ret = AcceptBlock(*pblock, state, chainparams, &pindex, fRequested, dbp, &fNewBlock);\n-        if (pindex && pfrom) {\n-            mapBlockSource[pindex->GetBlockHash()] = pfrom->GetId();\n-            if (fNewBlock) pfrom->nLastBlockTime = GetTime();\n+        if (pfrom) {\n+            if (pindex) {\n+                LogPrint(\"block\", \"recv block %s (%d) peer=%d\\n\", pblock->GetHash().ToString(), pindex->nHeight, pfrom->id);\n+                mapBlockSource[pindex->GetBlockHash()] = pfrom->GetId();\n+                if (fNewBlock) pfrom->nLastBlockTime = GetTime();\n+            } else\n+                LogPrint(\"block\", \"recv block %s peer=%d\\n\", pblock->GetHash().ToString(), pfrom->id);\n         }\n         CheckBlockIndex(chainparams.GetConsensus());\n         if (!ret)\n@@ -6021,8 +6025,6 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n         CBlock block;\n         vRecv >> block;\n \n-        LogPrint(\"net\", \"received block %s peer=%d\\n\", block.GetHash().ToString(), pfrom->id);\n-\n         CValidationState state;\n         // Process all blocks from whitelisted peers, even if not requested,\n         // unless we're still syncing with the network."
      }
    ]
  },
  {
    "sha": "b475a41368a6d7e3ce3f2c3af7ad5c6a00e06b91",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiNDc1YTQxMzY4YTZkN2UzY2UzZjJjM2FmN2FkNWM2YTAwZTA2Yjkx",
    "commit": {
      "author": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2016-10-20T07:36:22Z"
      },
      "committer": {
        "name": "R E Broadley",
        "email": "rebroad+github@gmail.com",
        "date": "2016-10-20T13:26:03Z"
      },
      "message": "Log size of blocks received",
      "tree": {
        "sha": "95b7cef5c6eb7daf714b5652aefcdc3986ca6981",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/95b7cef5c6eb7daf714b5652aefcdc3986ca6981"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b475a41368a6d7e3ce3f2c3af7ad5c6a00e06b91",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b475a41368a6d7e3ce3f2c3af7ad5c6a00e06b91",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/b475a41368a6d7e3ce3f2c3af7ad5c6a00e06b91",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b475a41368a6d7e3ce3f2c3af7ad5c6a00e06b91/comments",
    "author": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "rebroad",
      "id": 1530283,
      "node_id": "MDQ6VXNlcjE1MzAyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1530283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rebroad",
      "html_url": "https://github.com/rebroad",
      "followers_url": "https://api.github.com/users/rebroad/followers",
      "following_url": "https://api.github.com/users/rebroad/following{/other_user}",
      "gists_url": "https://api.github.com/users/rebroad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rebroad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rebroad/subscriptions",
      "organizations_url": "https://api.github.com/users/rebroad/orgs",
      "repos_url": "https://api.github.com/users/rebroad/repos",
      "events_url": "https://api.github.com/users/rebroad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rebroad/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "05e0b740252277f5e4ca75daaa79751d59998339",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/05e0b740252277f5e4ca75daaa79751d59998339",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/05e0b740252277f5e4ca75daaa79751d59998339"
      }
    ],
    "stats": {
      "total": 8,
      "additions": 6,
      "deletions": 2
    },
    "files": [
      {
        "sha": "d5162ef4a2ae6235f4aa68029c7b96879509f877",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 2,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b475a41368a6d7e3ce3f2c3af7ad5c6a00e06b91/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b475a41368a6d7e3ce3f2c3af7ad5c6a00e06b91/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=b475a41368a6d7e3ce3f2c3af7ad5c6a00e06b91",
        "patch": "@@ -3755,11 +3755,12 @@ bool ProcessNewBlock(CValidationState& state, const CChainParams& chainparams, C\n         bool ret = AcceptBlock(*pblock, state, chainparams, &pindex, fRequested, dbp, &fNewBlock);\n         if (pfrom) {\n             if (pindex) {\n-                LogPrint(\"block\", \"recv block %s (%d) peer=%d\\n\", pblock->GetHash().ToString(), pindex->nHeight, pfrom->id);\n+                LogPrint(\"block\", \"recv block %s (%d) size=%d peer=%d\\n\", pblock->GetHash().ToString(), pindex->nHeight,\n+                    pfrom->nBlockSize, pfrom->id);\n                 mapBlockSource[pindex->GetBlockHash()] = pfrom->GetId();\n                 if (fNewBlock) pfrom->nLastBlockTime = GetTime();\n             } else\n-                LogPrint(\"block\", \"recv block %s peer=%d\\n\", pblock->GetHash().ToString(), pfrom->id);\n+                LogPrint(\"block\", \"recv block %s size=%d peer=%d\\n\", pblock->GetHash().ToString(), pfrom->nBlockSize, pfrom->id);\n         }\n         CheckBlockIndex(chainparams.GetConsensus());\n         if (!ret)\n@@ -6023,6 +6024,7 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n     else if (strCommand == NetMsgType::BLOCK && !fImporting && !fReindex) // Ignore blocks received while importing\n     {\n         CBlock block;\n+        pfrom->nBlockSize = vRecv.size(); // Used by ProcessNewBlock() debug\n         vRecv >> block;\n \n         CValidationState state;"
      },
      {
        "sha": "6147f48d2566ebbe1e05050912e6a060a63e27da",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b475a41368a6d7e3ce3f2c3af7ad5c6a00e06b91/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b475a41368a6d7e3ce3f2c3af7ad5c6a00e06b91/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=b475a41368a6d7e3ce3f2c3af7ad5c6a00e06b91",
        "patch": "@@ -2533,6 +2533,7 @@ CNode::CNode(NodeId idIn, ServiceFlags nLocalServicesIn, int nMyStartingHeightIn\n     fOneShot = false;\n     fClient = false; // set by version message\n     fFeeler = false;\n+    nBlockSize = 0;\n     fInbound = fInboundIn;\n     fNetworkNode = false;\n     fSuccessfullyConnected = false;"
      },
      {
        "sha": "de04e11124fa93f2e3f717c990d02f7a2ba83cb3",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b475a41368a6d7e3ce3f2c3af7ad5c6a00e06b91/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b475a41368a6d7e3ce3f2c3af7ad5c6a00e06b91/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=b475a41368a6d7e3ce3f2c3af7ad5c6a00e06b91",
        "patch": "@@ -587,6 +587,7 @@ class CNode\n     std::string strSubVer, cleanSubVer;\n     bool fWhitelisted; // This peer can bypass DoS banning.\n     bool fFeeler; // If true this node is being used as a short lived feeler.\n+    unsigned int nBlockSize; // Used by ProcessNewBlock() for debug message.\n     bool fOneShot;\n     bool fClient;\n     bool fInbound;"
      }
    ]
  }
]