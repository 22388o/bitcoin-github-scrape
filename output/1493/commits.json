[
  {
    "sha": "0e1d3551da570655d141d4b6d0b1bdbc0e931dbb",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowZTFkMzU1MWRhNTcwNjU1ZDE0MWQ0YjZkMGIxYmRiYzBlOTMxZGJi",
    "commit": {
      "author": {
        "name": "Jeff Garzik",
        "email": "jgarzik@exmulti.com",
        "date": "2012-08-21T16:03:52Z"
      },
      "committer": {
        "name": "Jeff Garzik",
        "email": "jgarzik@redhat.com",
        "date": "2012-08-21T16:03:52Z"
      },
      "message": "RPC: add facility to enable RPCs to run outside cs_main, wallet locks\n\nUse with 'stop' and 'help' RPCs.\n\nThis provides a facility to individually evaluate the locking for an RPC, and\npotentially make it more parallel.",
      "tree": {
        "sha": "524b528c35dea69018fb3bacad093bb39f769e67",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/524b528c35dea69018fb3bacad093bb39f769e67"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0e1d3551da570655d141d4b6d0b1bdbc0e931dbb",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0e1d3551da570655d141d4b6d0b1bdbc0e931dbb",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/0e1d3551da570655d141d4b6d0b1bdbc0e931dbb",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0e1d3551da570655d141d4b6d0b1bdbc0e931dbb/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "5f2b41d54d2adbbbb951291cf8fdcef8a77a543d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5f2b41d54d2adbbbb951291cf8fdcef8a77a543d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5f2b41d54d2adbbbb951291cf8fdcef8a77a543d"
      }
    ],
    "stats": {
      "total": 121,
      "additions": 63,
      "deletions": 58
    },
    "files": [
      {
        "sha": "5537eb4815fdeee730ae381dcb49d17de51c5660",
        "filename": "src/bitcoinrpc.cpp",
        "status": "modified",
        "additions": 62,
        "deletions": 58,
        "changes": 120,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0e1d3551da570655d141d4b6d0b1bdbc0e931dbb/src/bitcoinrpc.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0e1d3551da570655d141d4b6d0b1bdbc0e931dbb/src/bitcoinrpc.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoinrpc.cpp?ref=0e1d3551da570655d141d4b6d0b1bdbc0e931dbb",
        "patch": "@@ -191,62 +191,62 @@ Value stop(const Array& params, bool fHelp)\n \n \n static const CRPCCommand vRPCCommands[] =\n-{ //  name                      function                 safe mode?\n-  //  ------------------------  -----------------------  ----------\n-    { \"help\",                   &help,                   true },\n-    { \"stop\",                   &stop,                   true },\n-    { \"getblockcount\",          &getblockcount,          true },\n-    { \"getconnectioncount\",     &getconnectioncount,     true },\n-    { \"getpeerinfo\",            &getpeerinfo,            true },\n-    { \"getdifficulty\",          &getdifficulty,          true },\n-    { \"getgenerate\",            &getgenerate,            true },\n-    { \"setgenerate\",            &setgenerate,            true },\n-    { \"gethashespersec\",        &gethashespersec,        true },\n-    { \"getinfo\",                &getinfo,                true },\n-    { \"getmininginfo\",          &getmininginfo,          true },\n-    { \"getnewaddress\",          &getnewaddress,          true },\n-    { \"getaccountaddress\",      &getaccountaddress,      true },\n-    { \"setaccount\",             &setaccount,             true },\n-    { \"getaccount\",             &getaccount,             false },\n-    { \"getaddressesbyaccount\",  &getaddressesbyaccount,  true },\n-    { \"sendtoaddress\",          &sendtoaddress,          false },\n-    { \"getreceivedbyaddress\",   &getreceivedbyaddress,   false },\n-    { \"getreceivedbyaccount\",   &getreceivedbyaccount,   false },\n-    { \"listreceivedbyaddress\",  &listreceivedbyaddress,  false },\n-    { \"listreceivedbyaccount\",  &listreceivedbyaccount,  false },\n-    { \"backupwallet\",           &backupwallet,           true },\n-    { \"keypoolrefill\",          &keypoolrefill,          true },\n-    { \"walletpassphrase\",       &walletpassphrase,       true },\n-    { \"walletpassphrasechange\", &walletpassphrasechange, false },\n-    { \"walletlock\",             &walletlock,             true },\n-    { \"encryptwallet\",          &encryptwallet,          false },\n-    { \"validateaddress\",        &validateaddress,        true },\n-    { \"getbalance\",             &getbalance,             false },\n-    { \"move\",                   &movecmd,                false },\n-    { \"sendfrom\",               &sendfrom,               false },\n-    { \"sendmany\",               &sendmany,               false },\n-    { \"addmultisigaddress\",     &addmultisigaddress,     false },\n-    { \"getrawmempool\",          &getrawmempool,          true },\n-    { \"getblock\",               &getblock,               false },\n-    { \"getblockhash\",           &getblockhash,           false },\n-    { \"gettransaction\",         &gettransaction,         false },\n-    { \"listtransactions\",       &listtransactions,       false },\n-    { \"signmessage\",            &signmessage,            false },\n-    { \"verifymessage\",          &verifymessage,          false },\n-    { \"getwork\",                &getwork,                true },\n-    { \"listaccounts\",           &listaccounts,           false },\n-    { \"settxfee\",               &settxfee,               false },\n-    { \"getblocktemplate\",       &getblocktemplate,       true },\n-    { \"submitblock\",            &submitblock,            false },\n-    { \"listsinceblock\",         &listsinceblock,         false },\n-    { \"dumpprivkey\",            &dumpprivkey,            false },\n-    { \"importprivkey\",          &importprivkey,          false },\n-    { \"listunspent\",            &listunspent,            false },\n-    { \"getrawtransaction\",      &getrawtransaction,      false },\n-    { \"createrawtransaction\",   &createrawtransaction,   false },\n-    { \"decoderawtransaction\",   &decoderawtransaction,   false },\n-    { \"signrawtransaction\",     &signrawtransaction,     false },\n-    { \"sendrawtransaction\",     &sendrawtransaction,     false },\n+{ //  name                      function                 safemd  unlocked\n+  //  ------------------------  -----------------------  ------  --------\n+    { \"help\",                   &help,                   true,   true },\n+    { \"stop\",                   &stop,                   true,   true },\n+    { \"getblockcount\",          &getblockcount,          true,   false },\n+    { \"getconnectioncount\",     &getconnectioncount,     true,   false },\n+    { \"getpeerinfo\",            &getpeerinfo,            true,   false },\n+    { \"getdifficulty\",          &getdifficulty,          true,   false },\n+    { \"getgenerate\",            &getgenerate,            true,   false },\n+    { \"setgenerate\",            &setgenerate,            true,   false },\n+    { \"gethashespersec\",        &gethashespersec,        true,   false },\n+    { \"getinfo\",                &getinfo,                true,   false },\n+    { \"getmininginfo\",          &getmininginfo,          true,   false },\n+    { \"getnewaddress\",          &getnewaddress,          true,   false },\n+    { \"getaccountaddress\",      &getaccountaddress,      true,   false },\n+    { \"setaccount\",             &setaccount,             true,   false },\n+    { \"getaccount\",             &getaccount,             false,  false },\n+    { \"getaddressesbyaccount\",  &getaddressesbyaccount,  true,   false },\n+    { \"sendtoaddress\",          &sendtoaddress,          false,  false },\n+    { \"getreceivedbyaddress\",   &getreceivedbyaddress,   false,  false },\n+    { \"getreceivedbyaccount\",   &getreceivedbyaccount,   false,  false },\n+    { \"listreceivedbyaddress\",  &listreceivedbyaddress,  false,  false },\n+    { \"listreceivedbyaccount\",  &listreceivedbyaccount,  false,  false },\n+    { \"backupwallet\",           &backupwallet,           true,   false },\n+    { \"keypoolrefill\",          &keypoolrefill,          true,   false },\n+    { \"walletpassphrase\",       &walletpassphrase,       true,   false },\n+    { \"walletpassphrasechange\", &walletpassphrasechange, false,  false },\n+    { \"walletlock\",             &walletlock,             true,   false },\n+    { \"encryptwallet\",          &encryptwallet,          false,  false },\n+    { \"validateaddress\",        &validateaddress,        true,   false },\n+    { \"getbalance\",             &getbalance,             false,  false },\n+    { \"move\",                   &movecmd,                false,  false },\n+    { \"sendfrom\",               &sendfrom,               false,  false },\n+    { \"sendmany\",               &sendmany,               false,  false },\n+    { \"addmultisigaddress\",     &addmultisigaddress,     false,  false },\n+    { \"getrawmempool\",          &getrawmempool,          true,   false },\n+    { \"getblock\",               &getblock,               false,  false },\n+    { \"getblockhash\",           &getblockhash,           false,  false },\n+    { \"gettransaction\",         &gettransaction,         false,  false },\n+    { \"listtransactions\",       &listtransactions,       false,  false },\n+    { \"signmessage\",            &signmessage,            false,  false },\n+    { \"verifymessage\",          &verifymessage,          false,  false },\n+    { \"getwork\",                &getwork,                true,   false },\n+    { \"listaccounts\",           &listaccounts,           false,  false },\n+    { \"settxfee\",               &settxfee,               false,  false },\n+    { \"getblocktemplate\",       &getblocktemplate,       true,   false },\n+    { \"submitblock\",            &submitblock,            false,  false },\n+    { \"listsinceblock\",         &listsinceblock,         false,  false },\n+    { \"dumpprivkey\",            &dumpprivkey,            false,  false },\n+    { \"importprivkey\",          &importprivkey,          false,  false },\n+    { \"listunspent\",            &listunspent,            false,  false },\n+    { \"getrawtransaction\",      &getrawtransaction,      false,  false },\n+    { \"createrawtransaction\",   &createrawtransaction,   false,  false },\n+    { \"decoderawtransaction\",   &decoderawtransaction,   false,  false },\n+    { \"signrawtransaction\",     &signrawtransaction,     false,  false },\n+    { \"sendrawtransaction\",     &sendrawtransaction,     false,  false },\n };\n \n CRPCTable::CRPCTable()\n@@ -1008,8 +1008,12 @@ json_spirit::Value CRPCTable::execute(const std::string &strMethod, const json_s\n         // Execute\n         Value result;\n         {\n-            LOCK2(cs_main, pwalletMain->cs_wallet);\n-            result = pcmd->actor(params, false);\n+            if (pcmd->unlocked)\n+                result = pcmd->actor(params, false);\n+            else {\n+                LOCK2(cs_main, pwalletMain->cs_wallet);\n+                result = pcmd->actor(params, false);\n+            }\n         }\n         return result;\n     }"
      },
      {
        "sha": "f70216392d44399a8a5eb083d3b826959bdb4e32",
        "filename": "src/bitcoinrpc.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0e1d3551da570655d141d4b6d0b1bdbc0e931dbb/src/bitcoinrpc.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0e1d3551da570655d141d4b6d0b1bdbc0e931dbb/src/bitcoinrpc.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoinrpc.h?ref=0e1d3551da570655d141d4b6d0b1bdbc0e931dbb",
        "patch": "@@ -46,6 +46,7 @@ class CRPCCommand\n     std::string name;\n     rpcfn_type actor;\n     bool okSafeMode;\n+    bool unlocked;\n };\n \n /**"
      }
    ]
  }
]