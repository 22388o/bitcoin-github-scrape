[
  {
    "sha": "d052e3847c84fc89f3a3ec6ddef15bbe836d755d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkMDUyZTM4NDdjODRmYzg5ZjNhM2VjNmRkZWYxNWJiZTgzNmQ3NTVk",
    "commit": {
      "author": {
        "name": "CryptAxe",
        "email": "cryptaxe@gmail.com",
        "date": "2017-08-20T05:04:56Z"
      },
      "committer": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2017-09-13T00:24:07Z"
      },
      "message": "[qt] Add use available balance in send coins dialog",
      "tree": {
        "sha": "4afc8b1a28d19a2533d4f90e935f051797878bb7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4afc8b1a28d19a2533d4f90e935f051797878bb7"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d052e3847c84fc89f3a3ec6ddef15bbe836d755d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d052e3847c84fc89f3a3ec6ddef15bbe836d755d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/d052e3847c84fc89f3a3ec6ddef15bbe836d755d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d052e3847c84fc89f3a3ec6ddef15bbe836d755d/comments",
    "author": {
      "login": "CryptAxe",
      "id": 8107318,
      "node_id": "MDQ6VXNlcjgxMDczMTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8107318?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/CryptAxe",
      "html_url": "https://github.com/CryptAxe",
      "followers_url": "https://api.github.com/users/CryptAxe/followers",
      "following_url": "https://api.github.com/users/CryptAxe/following{/other_user}",
      "gists_url": "https://api.github.com/users/CryptAxe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/CryptAxe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/CryptAxe/subscriptions",
      "organizations_url": "https://api.github.com/users/CryptAxe/orgs",
      "repos_url": "https://api.github.com/users/CryptAxe/repos",
      "events_url": "https://api.github.com/users/CryptAxe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/CryptAxe/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "96ac26e56627f0c24213fcd3a1cce9fc95f1f661",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/96ac26e56627f0c24213fcd3a1cce9fc95f1f661",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/96ac26e56627f0c24213fcd3a1cce9fc95f1f661"
      }
    ],
    "stats": {
      "total": 56,
      "additions": 55,
      "deletions": 1
    },
    "files": [
      {
        "sha": "d0748c2edb8ca7cf3497d9fc6cfdfdd3527a8b3e",
        "filename": "src/qt/forms/sendcoinsentry.ui",
        "status": "modified",
        "additions": 8,
        "deletions": 1,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d052e3847c84fc89f3a3ec6ddef15bbe836d755d/src/qt/forms/sendcoinsentry.ui",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d052e3847c84fc89f3a3ec6ddef15bbe836d755d/src/qt/forms/sendcoinsentry.ui",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/forms/sendcoinsentry.ui?ref=d052e3847c84fc89f3a3ec6ddef15bbe836d755d",
        "patch": "@@ -163,7 +163,7 @@\n      </widget>\n     </item>\n     <item row=\"2\" column=\"1\">\n-     <layout class=\"QHBoxLayout\" name=\"horizontalLayoutAmount\" stretch=\"0,1\">\n+     <layout class=\"QHBoxLayout\" name=\"horizontalLayoutAmount\" stretch=\"0,1,0\">\n       <item>\n        <widget class=\"BitcoinAmountField\" name=\"payAmount\"/>\n       </item>\n@@ -177,6 +177,13 @@\n         </property>\n        </widget>\n       </item>\n+      <item>\n+       <widget class=\"QPushButton\" name=\"useAvailableBalanceButton\">\n+        <property name=\"text\">\n+         <string>Use available balance</string>\n+        </property>\n+       </widget>\n+      </item>\n      </layout>\n     </item>\n     <item row=\"3\" column=\"0\">"
      },
      {
        "sha": "ce88c305eef873560458c428b278a9087e7901ed",
        "filename": "src/qt/sendcoinsdialog.cpp",
        "status": "modified",
        "additions": 26,
        "deletions": 0,
        "changes": 26,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d052e3847c84fc89f3a3ec6ddef15bbe836d755d/src/qt/sendcoinsdialog.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d052e3847c84fc89f3a3ec6ddef15bbe836d755d/src/qt/sendcoinsdialog.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/sendcoinsdialog.cpp?ref=d052e3847c84fc89f3a3ec6ddef15bbe836d755d",
        "patch": "@@ -410,6 +410,7 @@ SendCoinsEntry *SendCoinsDialog::addEntry()\n     entry->setModel(model);\n     ui->entries->addWidget(entry);\n     connect(entry, SIGNAL(removeEntry(SendCoinsEntry*)), this, SLOT(removeEntry(SendCoinsEntry*)));\n+    connect(entry, SIGNAL(useAvailableBalance(SendCoinsEntry*)), this, SLOT(useAvailableBalance(SendCoinsEntry*)));\n     connect(entry, SIGNAL(payAmountChanged()), this, SLOT(coinControlUpdateLabels()));\n     connect(entry, SIGNAL(subtractFeeFromAmountChanged()), this, SLOT(coinControlUpdateLabels()));\n \n@@ -607,6 +608,31 @@ void SendCoinsDialog::on_buttonMinimizeFee_clicked()\n     minimizeFeeSection(true);\n }\n \n+void SendCoinsDialog::useAvailableBalance(SendCoinsEntry* entry)\n+{\n+    // Get CCoinControl instance if CoinControl is enabled or create a new one.\n+    CCoinControl coin_control;\n+    if (model->getOptionsModel()->getCoinControlFeatures()) {\n+        coin_control = *CoinControlDialog::coinControl;\n+    }\n+\n+    // Calculate available amount to send.\n+    CAmount amount = model->getBalance(&coin_control);\n+    for (int i = 0; i < ui->entries->count(); ++i) {\n+        SendCoinsEntry* e = qobject_cast<SendCoinsEntry*>(ui->entries->itemAt(i)->widget());\n+        if (e && !e->isHidden() && e != entry) {\n+            amount -= e->getValue().amount;\n+        }\n+    }\n+\n+    if (amount > 0) {\n+      entry->checkSubtractFeeFromAmount();\n+      entry->setAmount(amount);\n+    } else {\n+      entry->setAmount(0);\n+    }\n+}\n+\n void SendCoinsDialog::setMinimumFee()\n {\n     ui->radioCustomPerKilobyte->setChecked(true);"
      },
      {
        "sha": "2ae6ccfa648be62a65ab93236807f757a9e796dd",
        "filename": "src/qt/sendcoinsdialog.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d052e3847c84fc89f3a3ec6ddef15bbe836d755d/src/qt/sendcoinsdialog.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d052e3847c84fc89f3a3ec6ddef15bbe836d755d/src/qt/sendcoinsdialog.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/sendcoinsdialog.h?ref=d052e3847c84fc89f3a3ec6ddef15bbe836d755d",
        "patch": "@@ -76,6 +76,7 @@ private Q_SLOTS:\n     void on_buttonChooseFee_clicked();\n     void on_buttonMinimizeFee_clicked();\n     void removeEntry(SendCoinsEntry* entry);\n+    void useAvailableBalance(SendCoinsEntry* entry);\n     void updateDisplayUnit();\n     void coinControlFeatureChanged(bool);\n     void coinControlButtonClicked();"
      },
      {
        "sha": "8cf8db803022573889c35e3fd2a63b486d1486c9",
        "filename": "src/qt/sendcoinsentry.cpp",
        "status": "modified",
        "additions": 16,
        "deletions": 0,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d052e3847c84fc89f3a3ec6ddef15bbe836d755d/src/qt/sendcoinsentry.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d052e3847c84fc89f3a3ec6ddef15bbe836d755d/src/qt/sendcoinsentry.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/sendcoinsentry.cpp?ref=d052e3847c84fc89f3a3ec6ddef15bbe836d755d",
        "patch": "@@ -48,6 +48,7 @@ SendCoinsEntry::SendCoinsEntry(const PlatformStyle *_platformStyle, QWidget *par\n     connect(ui->deleteButton, SIGNAL(clicked()), this, SLOT(deleteClicked()));\n     connect(ui->deleteButton_is, SIGNAL(clicked()), this, SLOT(deleteClicked()));\n     connect(ui->deleteButton_s, SIGNAL(clicked()), this, SLOT(deleteClicked()));\n+    connect(ui->useAvailableBalanceButton, SIGNAL(clicked()), this, SLOT(useAvailableBalanceClicked()));\n }\n \n SendCoinsEntry::~SendCoinsEntry()\n@@ -112,11 +113,21 @@ void SendCoinsEntry::clear()\n     updateDisplayUnit();\n }\n \n+void SendCoinsEntry::checkSubtractFeeFromAmount()\n+{\n+    ui->checkboxSubtractFeeFromAmount->setChecked(true);\n+}\n+\n void SendCoinsEntry::deleteClicked()\n {\n     Q_EMIT removeEntry(this);\n }\n \n+void SendCoinsEntry::useAvailableBalanceClicked()\n+{\n+    Q_EMIT useAvailableBalance(this);\n+}\n+\n bool SendCoinsEntry::validate()\n {\n     if (!model)\n@@ -228,6 +239,11 @@ void SendCoinsEntry::setAddress(const QString &address)\n     ui->payAmount->setFocus();\n }\n \n+void SendCoinsEntry::setAmount(const CAmount &amount)\n+{\n+    ui->payAmount->setValue(amount);\n+}\n+\n bool SendCoinsEntry::isClear()\n {\n     return ui->payTo->text().isEmpty() && ui->payTo_is->text().isEmpty() && ui->payTo_s->text().isEmpty();"
      },
      {
        "sha": "557fea4e5476047ce8f5233bd5f9704f1cd44a7d",
        "filename": "src/qt/sendcoinsentry.h",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d052e3847c84fc89f3a3ec6ddef15bbe836d755d/src/qt/sendcoinsentry.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d052e3847c84fc89f3a3ec6ddef15bbe836d755d/src/qt/sendcoinsentry.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/sendcoinsentry.h?ref=d052e3847c84fc89f3a3ec6ddef15bbe836d755d",
        "patch": "@@ -38,6 +38,7 @@ class SendCoinsEntry : public QStackedWidget\n \n     void setValue(const SendCoinsRecipient &value);\n     void setAddress(const QString &address);\n+    void setAmount(const CAmount &amount);\n \n     /** Set up the tab chain manually, as Qt messes up the tab chain by default in some cases\n      *  (issue https://bugreports.qt-project.org/browse/QTBUG-10907).\n@@ -48,14 +49,17 @@ class SendCoinsEntry : public QStackedWidget\n \n public Q_SLOTS:\n     void clear();\n+    void checkSubtractFeeFromAmount();\n \n Q_SIGNALS:\n     void removeEntry(SendCoinsEntry *entry);\n+    void useAvailableBalance(SendCoinsEntry* entry);\n     void payAmountChanged();\n     void subtractFeeFromAmountChanged();\n \n private Q_SLOTS:\n     void deleteClicked();\n+    void useAvailableBalanceClicked();\n     void on_payTo_textChanged(const QString &address);\n     void on_addressBookButton_clicked();\n     void on_pasteButton_clicked();"
      }
    ]
  }
]