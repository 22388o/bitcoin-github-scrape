laanwj,2021-02-08 12:09:05,"Changes look good to me, didn't test or review in detail yet. Concept ACK.",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-775100294,775100294,
laanwj,2021-02-11 15:11:23,"Trying to run the guix build on a bare ubuntu server image (with guix installed through `guix-install.sh` from the guix website) i get the following errors:\n```\nuser@guix:~/bitcoin$ ./contrib/guix/guix-build.sh     \n/bin/sh: 1: gcc: not found     \n/bin/sh: 1: gcc: not found                                                                                \n/bin/sh: 1: g++: not found         ",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-777562303,777562303,
dongcarl,2021-02-11 17:32:26,"> Is it necessary to install `gcc` and `g++` outside of guix?\n\nNo I don't think so.\n\nI'm almost certain this is caused by the `depends` download triggering some ""immediate"" variables in our depends `Makefile` from evaluating... Shouldn't harm anything, but lemme dig and see where this is.\n\n**Update**: Ah! This is because we now call `build_CC` and `host_CC` when determining our `id_str",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-777663492,777663492,
laanwj,2021-02-11 22:01:51,"Buld success (commit f4ae44c76feeb6a4400c374cb7641caf89f3b8ae):\n```\n0c3355d662c9828be853c774fac9e9ae38538dfae0e86193b9c427d4f6652940  output/bitcoin-f4ae44c76fee-powerpc64-linux-gnu-debug.tar.gz\nd56c3b095f63bd00466c1765dd83c21a886ef9ce3695745fed55a176f7b2e3aa  output/bitcoin-f4ae44c76fee-powerpc64-linux-gnu.tar.gz\n3209447188534bb2135030c2abaad9e2e5b4a69130720a5ad667bc746c7ae4de  output/bit",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-777821612,777821612,
DrahtBot,2021-02-12 03:12:51,<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.,https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-777941739,777941739,
fanquake,2021-02-12 05:05:17,"Builds at 62cc2180afc1f2e2465eefb9b589a3b3a23d6376:\n```bash\nd29bb491a712da73a146ba7cf7935e1cf2ee491fbbc92ac8bd59e3a41126ed5d  output/bitcoin-62cc2180afc1-powerpc64-linux-gnu-debug.tar.gz\nd5065882b91b004f68cedb48b6704081fdf7368a2c2854c240bba6533adb0e97  output/bitcoin-62cc2180afc1-powerpc64-linux-gnu.tar.gz\n4ffa90656e515b9aa714eaa062f8172df467c3bc585210356c05d40f2341dd4f  output/bitcoin-62c",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-777974133,777974133,
laanwj,2021-02-12 16:21:42,"Can reproduce @fanquake's results :tada: \n```\nd29bb491a712da73a146ba7cf7935e1cf2ee491fbbc92ac8bd59e3a41126ed5d  output/bitcoin-62cc2180afc1-powerpc64-linux-gnu-debug.tar.gz\nd5065882b91b004f68cedb48b6704081fdf7368a2c2854c240bba6533adb0e97  output/bitcoin-62cc2180afc1-powerpc64-linux-gnu.tar.gz\n4ffa90656e515b9aa714eaa062f8172df467c3bc585210356c05d40f2341dd4f  output/bitcoin-62cc2180afc1-powe",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-778293385,778293385,
MarcoFalke,2021-02-12 20:55:56,"```\nsha256sum output/{,src/}bitcoin*\ne95c04f190722a5577b2a3f78463d01f13f87f748ec63d1df325db68a578e677  output/bitcoin-62cc2180afc1-powerpc64-linux-gnu-debug.tar.gz\ncd6b14920197c0fcdae0609908359a1c2e3af8bb45590abc079f1d4bff5e9d0a  output/bitcoin-62cc2180afc1-powerpc64-linux-gnu.tar.gz\ne4a05d6a09d824c10a3d6157a294b65e1053125a98c9a51f1f6d5b2d8c44e3ba  output/src/bitcoin-62cc2180afc1.tar.gz\n",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-778450212,778450212,
laanwj,2021-02-13 09:56:31,"@MarcoFalke i'd say it is allowed i'll want to do my future builds on RV64.\n\nWould be good to investigate what is different in your results (and whether they differ for other target architectures than POWER too).\n\nThat said, i don't think ""determinism when building on other architectures"" is a blocker for this PR, might want to open a new issue for that.",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-778592844,778592844,
laanwj,2021-02-13 16:15:02,"I did another build for this on the GUIX distribution (x86_64) instead of installing it on top of another. After setting up a VM starting from the QEMU image, and setting up ssh access for `guest` (which wasn't that complicated but had to re-learn a bit of LISP in the process) it was completely straightforward:\n\n```bash\n# (copy in Xcode-11.3.1-11C505-extracted-SDK-with-libcxx-headers.tar.gz ",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-778639698,778639698,
laanwj,2021-02-14 08:48:44,"Drahtbot build issue is due to disk space:\n```\n/gnu/store/25s9l7cgwz01qq3crbh1dpfw69gvvna4-profile/bin/install: error writing '/distsrc-base/distsrc-a6b382150bcc-powerpc64le-linux-gnu/installed/bitcoin-a6b382150bcc//bin/test_bitcoin': No space left on device\nmake[3]: *** [Makefile:4521: install-binPROGRAMS] Error 1\n```",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-778747315,778747315,
MarcoFalke,2021-02-14 09:09:14,"Yeah, I am confused about that. I have ~30GB of free disk space, which seems like enough?\n\n```\n$ df -h ./\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/root       146G  117G   29G  81% /\n",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-778749570,778749570,
laanwj,2021-02-14 09:51:21,"i don't know ? gitiian deletes the intermediate build files between builds for each architecture, i don't know if the GUIX build currently does; fwiw my GUIX VM after the build:\n```\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/vda1        79G   61G   15G  81% /\n```",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-778754017,778754017,
MarcoFalke,2021-02-14 10:19:24,"Maybe the docs should be updated here to clarify that 60 GB [1] are now needed? https://github.com/bitcoin/bitcoin/blob/fa051c23860bcdcc871db5ad6b51b8d9ca88da35/contrib/guix/README.md#requirements\n\nEdit: DrahtBot's gnu store is `11G`, but probably including some now-unused packages.\n\n[1] 10 GB + 5 GB per distsrc host",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-778757034,778757034,
MarcoFalke,2021-02-16 11:27:05,"> might want to open a new issue for that.\n\nDone in #21194",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-779775244,779775244,
dongcarl,2021-02-16 17:35:34,"Pushed 62cc2180afc1f2e2465eefb9b589a3b3a23d6376 -> 4dd3c2ffe283ed6ff30d1ca1eaf2a50c1c643fff\n- Rebase on master for merge of #20629\n- Updated conservative size estimates following laanwj and MarcoFalke's conversations above\n\n-----\n\nThanks MarcoFalke for opening #21194, would be great to get it reproducible across architectures as a stretch goal!\n\nUsability notes:\n1. Find a way to ",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-780000058,780000058,
dongcarl,2021-02-18 19:33:55,"Pushed 4dd3c2ffe283ed6ff30d1ca1eaf2a50c1c643fff -> 857d98daa5dd778c6fdf7d58c65653c569e5a35d\n- Rebase for merge of base PR #21087",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-781584931,781584931,
dongcarl,2021-02-19 16:32:02,"Pushed 857d98daa5dd778c6fdf7d58c65653c569e5a35d -> 95990b9f3278360b63e79d6975af4ab5009c66ba\n- Rebase for merge of base PR #21088\n\n```\n$ find output/ -type f -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\n89d8a12bba6c455b673bd6c8cc4ce7b4f9def7df7259ae514757344083293523  output/bitcoin-95990b9f3278-aarch64-linux-gnu-debug.tar.gz\n4c885962e3c3b5b79c9ab04a93e717cebb67130b0e74bb3514cec",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-782186800,782186800,
fanquake,2021-02-20 05:29:45,"I'm seeing a mismatch with `bitcoin-95990b9f3278-win64.zip` and `bitcoin-95990b9f3278-win64-debug.zip`:\n```bash\nbash-5.1# find output/ -type f -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\n89d8a12bba6c455b673bd6c8cc4ce7b4f9def7df7259ae514757344083293523  output/bitcoin-95990b9f3278-aarch64-linux-gnu-debug.tar.gz\n4c885962e3c3b5b79c9ab04a93e717cebb67130b0e74bb3514cec1d40de8cc0b  outpu",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-782564244,782564244,
MarcoFalke,2021-02-20 18:07:19,"https://github.com/MarcoFalke/drahtbox/releases/tag/bitcoin-95990b9f3278\n\n```\n89d8a12bba6c455b673bd6c8cc4ce7b4f9def7df7259ae514757344083293523  output/bitcoin-95990b9f3278-aarch64-linux-gnu-debug.tar.gz\n4c885962e3c3b5b79c9ab04a93e717cebb67130b0e74bb3514cec1d40de8cc0b  output/bitcoin-95990b9f3278-aarch64-linux-gnu.tar.gz\na1bb294d91bf53e0e40df7b259503182a77c515fc8fbbbb7d5437e3560c8d1ce  ou",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-782725255,782725255,
MarcoFalke,2021-02-20 18:07:31,(seems to be matching fanquake),https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-782725277,782725277,
laanwj,2021-02-20 23:38:29,My output matches @fanquake's and @MarcoFalke's exactly,https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-782766009,782766009,
dongcarl,2021-02-22 17:44:08,"Investigated a bit, seems like a difference in `umask`? (Thank goodness it's this simple)\n\nHere's my `umask` on the machine where I ran this build:\n```sh\n$ umask\n0002\n```\n\nI see that on other machines `umask` is 0022.\n\nShall we set the `umask` to 0022 at the beginning of our `guix-build.sh` script?\n\n```sh\n$ diffoscope focal-virt/bitcoin-95990b9f3278-win64-debug.zip fanqua",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-783549633,783549633,
laanwj,2021-02-22 17:58:31,"> Shall we set the umask to 0022 at the beginning of our guix-build.sh script?\n\nMaybe. I'm a bit disappointed that Guix doesn't handle this itself! It seems like one of the first things you'd want to be robust against (apart from time, environment, username) when doing deterministic builds.\n\nThat said sure we can do it as a workaround. Could also do it in`contrib/guix/libexec/build.sh`.",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-783558511,783558511,
dongcarl,2021-02-22 19:00:16,"> I'm a bit disappointed that Guix doesn't handle this itself! It seems like one of the first things you'd want to be robust against (apart from time, environment, username) when doing deterministic builds.\n\nTo be clear, when `guix-daemon` is building a package in its isolated container (for us, that is all the packages in our `manifest.scm`), `umask` _is_ set. I think `guix environment` doesn",https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-783598901,783598901,
dongcarl,2021-02-22 21:41:41,I opened #21271 to fix the non-reproducibility separately. I think this PR is ready for merge.,https://github.com/bitcoin/bitcoin/pull/21089#issuecomment-783693730,783693730,
