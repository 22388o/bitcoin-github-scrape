[
  {
    "sha": "d4e0694feb4c0ee2f7eb9db6b3f56efbc5a5bffc",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkNGUwNjk0ZmViNGMwZWUyZjdlYjlkYjZiM2Y1NmVmYmM1YTViZmZj",
    "commit": {
      "author": {
        "name": "Carl Dong",
        "email": "contact@carldong.me",
        "date": "2019-07-23T21:36:45Z"
      },
      "committer": {
        "name": "Carl Dong",
        "email": "contact@carldong.me",
        "date": "2019-08-01T16:56:32Z"
      },
      "message": "guix: Change manifest to use channels and inferiors\n\nThis change pins the packages that make up our Guix environment, making\nthem reproducible regardless of the current version of Guix that the\nuser is running. It should eliminate the `guix pull' step of the Guix\nbuild process.",
      "tree": {
        "sha": "4e6985bcad9919840b3ac5899075da1cd771fc3d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4e6985bcad9919840b3ac5899075da1cd771fc3d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d4e0694feb4c0ee2f7eb9db6b3f56efbc5a5bffc",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEECc3SW1JEo3Z49u6oDMUhUxl5kaUFAl1DGcIACgkQDMUhUxl5\nkaW3wg//QNNolgfggaQ7x9dFYNy894h73XQMJQwWhm0tZ9ErWX6oFqPZXTOSn58Z\n69R3tHcSWMnhk9pPYXSoUY9sLEsFPvygY4BFOG0FBTRdI0+Q9kSTTB+0wYOMQdMG\nQNuGnGHt0LRXLMiIQ4v3LQGAKyRZ9ycXRTArzvG2bXN831StFKmIM3Jx81IdTRyI\nVzYW+AIz9Vo0bNyrdwZbAfhdSSAbcgSYA0VNUcODwX4YZWZGCZyD3kMxDeCUO0vP\nzXn3pLlqJyPAPDz1v8PmSNZ3wKay0zDVqcb90k2ogQ1hSlI5K4aQn2w/4kzOmoCP\nKCImWSkZYKPyd8/1osDJKuo7Z08aiv4CYrt2sqnx1D8t/mK1QuL61o81u8KYiZ9A\nCWu1XyVLh4hvpTqF4OzvDseXavFXLJ3hI4VRyqwKogdolp2Omj6upYfAK3qmkiDi\ni8PW6rBuvAcLUgGXJVJF0Q13PCPOLj7UsufmiYJR0o6xVmvlWzv0PVmExri4T+fi\nzzcx3y6VSsD86UPNk90NAtv2kilVk8Xt0NbPvIb0NG0eeuQPgXvSyqkpBXiTpWF2\n09c4It/WSVIbTcnXX56x5lvf1akTzJsB/vLdvxqOSiGdmG4hFH68Hu1UZt3sBYAP\nDkeEZ1XE90CK51/45eUrkdizPCuxpu6ypN3IDbJQdUQvfRhWSyY=\n=Zj7V\n-----END PGP SIGNATURE-----",
        "payload": "tree 4e6985bcad9919840b3ac5899075da1cd771fc3d\nparent e6e99d4f757f2e5052f0cc68951c75e91e4753e3\nauthor Carl Dong <contact@carldong.me> 1563917805 -0400\ncommitter Carl Dong <contact@carldong.me> 1564678592 -0400\n\nguix: Change manifest to use channels and inferiors\n\nThis change pins the packages that make up our Guix environment, making\nthem reproducible regardless of the current version of Guix that the\nuser is running. It should eliminate the `guix pull' step of the Guix\nbuild process.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d4e0694feb4c0ee2f7eb9db6b3f56efbc5a5bffc",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/d4e0694feb4c0ee2f7eb9db6b3f56efbc5a5bffc",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d4e0694feb4c0ee2f7eb9db6b3f56efbc5a5bffc/comments",
    "author": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e6e99d4f757f2e5052f0cc68951c75e91e4753e3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e6e99d4f757f2e5052f0cc68951c75e91e4753e3",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e6e99d4f757f2e5052f0cc68951c75e91e4753e3"
      }
    ],
    "stats": {
      "total": 205,
      "additions": 50,
      "deletions": 155
    },
    "files": [
      {
        "sha": "fdd10e69fdcc93eb46e7a82cbbd8774962732047",
        "filename": "contrib/guix/manifest.scm",
        "status": "modified",
        "additions": 50,
        "deletions": 155,
        "changes": 205,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d4e0694feb4c0ee2f7eb9db6b3f56efbc5a5bffc/contrib/guix/manifest.scm",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d4e0694feb4c0ee2f7eb9db6b3f56efbc5a5bffc/contrib/guix/manifest.scm",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/guix/manifest.scm?ref=d4e0694feb4c0ee2f7eb9db6b3f56efbc5a5bffc",
        "patch": "@@ -1,158 +1,53 @@\n-(use-modules (gnu)\n-             (gnu packages)\n-             (gnu packages autotools)\n-             (gnu packages base)\n-             (gnu packages bash)\n-             (gnu packages check)\n-             (gnu packages commencement)\n-             (gnu packages compression)\n-             (gnu packages cross-base)\n-             (gnu packages file)\n-             (gnu packages gawk)\n-             (gnu packages gcc)\n-             (gnu packages linux)\n-             (gnu packages perl)\n-             (gnu packages pkg-config)\n-             (gnu packages python)\n-             (gnu packages shells)\n-             (guix build-system trivial)\n-             (guix gexp)\n-             (guix packages)\n-             (guix profiles)\n-             (guix utils))\n+(use-modules (guix inferior) (guix channels)\n+             (srfi srfi-1))   ;for 'first'\n+(define channels\n+  (list (channel\n+         (name 'bitcoin-guix)\n+         (url \"https://github.com/dongcarl/bitcoin-guix.git\")\n+         (commit\n+          \"9b221d425b000975b2e0d1632658f1558b9d2e05\"))))\n \n-(define (make-ssp-fixed-gcc xgcc)\n-  \"Given a XGCC package, return a modified package that uses the SSP function\n-from glibc instead of from libssp.so. Taken from:\n-http://www.linuxfromscratch.org/hlfs/view/development/chapter05/gcc-pass1.html\"\n-  (package\n-   (inherit xgcc)\n-   (arguments\n-    (substitute-keyword-arguments (package-arguments xgcc)\n-      ((#:make-flags flags)\n-       `(cons \"gcc_cv_libc_provides_ssp=yes\" ,flags))))))\n-\n-(define (make-gcc-rpath-link xgcc)\n-  \"Given a XGCC package, return a modified package that replace each instance of\n--rpath in the default system spec that's inserted by Guix with -rpath-link\"\n-  (package\n-   (inherit xgcc)\n-   (arguments\n-    (substitute-keyword-arguments (package-arguments xgcc)\n-      ((#:phases phases)\n-       `(modify-phases ,phases\n-          (add-after 'pre-configure 'replace-rpath-with-rpath-link\n-            (lambda _\n-              (substitute* (cons \"gcc/config/rs6000/sysv4.h\"\n-                                 (find-files \"gcc/config\"\n-                                             \"^gnu-user.*\\\\.h$\"))\n-                ((\"-rpath=\") \"-rpath-link=\"))\n-              #t))))))))\n-\n-(define (make-cross-toolchain target\n-                              base-gcc-for-libc\n-                              base-kernel-headers\n-                              base-libc\n-                              base-gcc)\n-  \"Create a cross-compilation toolchain package for TARGET\"\n-  (let* ((xbinutils (cross-binutils target))\n-         ;; 1. Build a cross-compiling gcc without targeting any libc, derived\n-         ;; from BASE-GCC-FOR-LIBC\n-         (xgcc-sans-libc (cross-gcc target\n-                                    #:xgcc base-gcc-for-libc\n-                                    #:xbinutils xbinutils))\n-         ;; 2. Build cross-compiled kernel headers with XGCC-SANS-LIBC, derived\n-         ;; from BASE-KERNEL-HEADERS\n-         (xkernel (cross-kernel-headers target\n-                                        base-kernel-headers\n-                                        xgcc-sans-libc\n-                                        xbinutils))\n-         ;; 3. Build a cross-compiled libc with XGCC-SANS-LIBC and XKERNEL,\n-         ;; derived from BASE-LIBC\n-         (xlibc (cross-libc target\n-                            base-libc\n-                            xgcc-sans-libc\n-                            xbinutils\n-                            xkernel))\n-         ;; 4. Build a cross-compiling gcc targeting XLIBC, derived from\n-         ;; BASE-GCC\n-         (xgcc (cross-gcc target\n-                          #:xgcc base-gcc\n-                          #:xbinutils xbinutils\n-                          #:libc xlibc)))\n-    ;; Define a meta-package that propagates the resulting XBINUTILS, XLIBC, and\n-    ;; XGCC\n-    (package\n-      (name (string-append target \"-toolchain\"))\n-      (version (package-version xgcc))\n-      (source #f)\n-      (build-system trivial-build-system)\n-      (arguments '(#:builder (begin (mkdir %output) #t)))\n-      (propagated-inputs\n-       `((\"binutils\" ,xbinutils)\n-         (\"libc\" ,xlibc)\n-         (\"libc:static\" ,xlibc \"static\")\n-         (\"gcc\" ,xgcc)))\n-      (synopsis (string-append \"Complete GCC tool chain for \" target))\n-      (description (string-append \"This package provides a complete GCC tool\n-chain for \" target \" development.\"))\n-      (home-page (package-home-page xgcc))\n-      (license (package-license xgcc)))))\n-\n-(define* (make-bitcoin-cross-toolchain target\n-                                  #:key\n-                                  (base-gcc-for-libc gcc-5)\n-                                  (base-kernel-headers linux-libre-headers-4.19)\n-                                  (base-libc glibc-2.27)\n-                                  (base-gcc (make-gcc-rpath-link\n-                                             (make-ssp-fixed-gcc gcc-9))))\n-  \"Convienience wrapper around MAKE-CROSS-TOOLCHAIN with default values\n-desirable for building Bitcoin Core release binaries.\"\n-  (make-cross-toolchain target\n-                   base-gcc-for-libc\n-                   base-kernel-headers\n-                   base-libc\n-                   base-gcc))\n+(define inferior\n+  ;; An inferior representing the above revision.\n+  (inferior-for-channels channels))\n \n (packages->manifest\n- (list ;; The Basics\n-       bash-minimal\n-       which\n-       coreutils\n-       util-linux\n-       ;; File(system) inspection\n-       file\n-       grep\n-       diffutils\n-       findutils\n-       ;; File transformation\n-       patch\n-       gawk\n-       sed\n-       ;; Compression and archiving\n-       tar\n-       bzip2\n-       gzip\n-       xz\n-       zlib\n-       ;; Build tools\n-       gnu-make\n-       libtool\n-       autoconf\n-       automake\n-       pkg-config\n-       ;; Scripting\n-       perl\n-       python-3.7\n-       ;; Native gcc 9 toolchain targeting glibc 2.27\n-       (make-gcc-toolchain gcc-9 glibc-2.27)\n-       ;; Cross gcc 9 toolchains targeting glibc 2.27\n-       (make-bitcoin-cross-toolchain \"i686-linux-gnu\")\n-       (make-bitcoin-cross-toolchain \"x86_64-linux-gnu\")\n-       (make-bitcoin-cross-toolchain \"aarch64-linux-gnu\")\n-       (make-bitcoin-cross-toolchain \"arm-linux-gnueabihf\")\n-       ;; The glibc 2.27 for riscv64 needs gcc 7 to successfully build (see:\n-       ;; https://www.gnu.org/software/gcc/gcc-7/changes.html#riscv). The final\n-       ;; toolchain is still a gcc 9 toolchain targeting glibc 2.27.\n-       (make-bitcoin-cross-toolchain \"riscv64-linux-gnu\"\n-                                     #:base-gcc-for-libc gcc-7)))\n+ (map (lambda (package-name)\n+        (first (lookup-inferior-packages inferior package-name)))\n+      '(;; The Basics\n+        \"bash-minimal\" ;; useful for debugging, can do with -minimal\n+        \"coreutils\"\n+        \"which\"\n+        \"util-linux\"\n+        ;; File(system) inspection\n+        \"file\"\n+        \"grep\"\n+        \"diffutils\"\n+        \"findutils\"\n+        ;; File transformation\n+        \"patch\"\n+        \"gawk\"\n+        \"sed\"\n+        ;; Compression and archiving\n+        \"tar\"\n+        \"bzip2\"\n+        \"gzip\"\n+        \"xz\"\n+        \"zlib\"\n+        ;; Build tools\n+        \"make\"\n+        \"libtool\"\n+        \"autoconf\"\n+        \"automake\"\n+        \"pkg-config\"\n+        ;; Scripting\n+        \"perl\"\n+        \"python\"\n+        ;; Native gcc 9 toolchain targeting glibc 2.27\n+        \"gcc-glibc-2.27-toolchain\"\n+        ;; Cross gcc 9 toolchains targeting glibc 2.27\n+        \"i686-linux-gnu-toolchain\"\n+        \"x86_64-linux-gnu-toolchain\"\n+        \"aarch64-linux-gnu-toolchain\"\n+        \"arm-linux-gnueabihf-toolchain\"\n+        \"riscv64-linux-gnu-toolchain\")))"
      }
    ]
  }
]