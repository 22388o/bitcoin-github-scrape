[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/569474624",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#issuecomment-569474624",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17824",
    "id": 569474624,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2OTQ3NDYyNA==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-29T04:48:56Z",
    "updated_at": "2020-04-14T23:06:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18418 (wallet: Increase OUTPUT_GROUP_MAX_ENTRIES to 100 by fjahr)\n* #17355 (gui: grey out used address in address book by za-kk)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/569474624/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/569858933",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#issuecomment-569858933",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17824",
    "id": 569858933,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2OTg1ODkzMw==",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?u=8aa4d0fd79dff5cf64a98205c78bc1c96b0bf4b6&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-31T03:55:36Z",
    "updated_at": "2019-12-31T03:55:36Z",
    "author_association": "MEMBER",
    "body": "The reported issue seems like things are not working as they should for sure, but I don't see how this code fixes it. Ultimately, if I want to send 10.5 bitcoin to you, and I have 500 UTXO:s of  1 BTC each all sending to A, the grouping part should result in 50 groups of 10 random UTXO:s each (each group worth 10 BTC), and two of these should be selected when sending, and ALL of the outputs should be marked as used afterwards.\r\n\r\nYour code seems to change this behavior to only result in one 10 BTC group per destination, which means the above send will result in \"insufficient funds\".",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/569858933/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/569867447",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#issuecomment-569867447",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17824",
    "id": 569867447,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2OTg2NzQ0Nw==",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?u=8aa4d0fd79dff5cf64a98205c78bc1c96b0bf4b6&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-31T05:34:41Z",
    "updated_at": "2019-12-31T05:34:41Z",
    "author_association": "MEMBER",
    "body": "I investigated this further. See https://github.com/bitcoin/bitcoin/issues/17603#issuecomment-569867141",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/569867447/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/569928051",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#issuecomment-569928051",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17824",
    "id": 569928051,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2OTkyODA1MQ==",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?u=348c27f90b6fff8fd72fa27232272651436a2ff0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-31T13:23:05Z",
    "updated_at": "2019-12-31T13:23:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I investigated this further. See [#17603 (comment)](https://github.com/bitcoin/bitcoin/issues/17603#issuecomment-569867141)\r\n\r\nThanks, that's what I found as well, I should have described it in greater detail.\r\n\r\n> The reported issue seems like things are not working as they should for sure, but I don't see how this code fixes it. Ultimately, if I want to send 10.5 bitcoin to you, and I have 500 UTXO:s of 1 BTC each all sending to A, the grouping part should result in 50 groups of 10 random UTXO:s each (each group worth 10 BTC), and two of these should be selected when sending, and ALL of the outputs should be marked as used afterwards.\r\n> \r\n> Your code seems to change this behavior to only result in one 10 BTC group per destination, which means the above send will result in \"insufficient funds\".\r\n\r\nMy code does handle this case correctly. You describe the behavior that would occur if I had implemented it as @achow101 suggests. The \"full groups\" (10 outputs) are already pushed into `groups` [earlier](https://github.com/bitcoin/bitcoin/pull/17824/files#diff-b2bb174788c7409b671c46ccc86034bdR3992) and only the \"incomplete\" group of <10 outputs would be added [later](https://github.com/bitcoin/bitcoin/pull/17824/files#diff-b2bb174788c7409b671c46ccc86034bdR4006). So we are collecting all the full groups but skip the last one if it is not full.\r\n\r\nHowever, your comment made me realize another shortcoming of the current code: If there are 11 outputs of 1 BTC and we want to send 10.5 BTC then we see the insufficient funds error because we are \"forgetting\" the incomplete group. To fix this I would suggest implementing the following: the last, incomplete group, is pushed into one of the full groups, resulting in one of the groups being up to 19 outputs large. \"Worst case\" scenario that I see: we want to send a very small amount from the destination and we have exactly 19 outputs, then we would use all the 19 outputs. I think this should be ok? I will wait for your feedback before pushing the code for it.\r\n\r\nSee adapted tests I ran with the current code for the examples discussed above: https://gist.github.com/fjahr/d56b68e58b4275ef52cd5f4eb50b1d4e",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/569928051/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/570545787",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#issuecomment-570545787",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17824",
    "id": 570545787,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MDU0NTc4Nw==",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?u=8aa4d0fd79dff5cf64a98205c78bc1c96b0bf4b6&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-03T11:21:17Z",
    "updated_at": "2020-01-03T11:22:53Z",
    "author_association": "MEMBER",
    "body": "I'm not sure this is the right approach here. It seems like marking the output groups as 'partial' when there are >10 outputs would address this. A simple approach would be to explicitly think of <max groups for multi-group destinations as \"0-conf\". The current code would then actively try to avoid using it except as a last resort.\r\n\r\nEdit: I didn't test, but I assume your example with \"not working\" above is for your patch, not the current master.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/570545787/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/570548151",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#issuecomment-570548151",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17824",
    "id": 570548151,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MDU0ODE1MQ==",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?u=8aa4d0fd79dff5cf64a98205c78bc1c96b0bf4b6&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-03T11:31:56Z",
    "updated_at": "2020-01-03T11:45:29Z",
    "author_association": "MEMBER",
    "body": "I would do something like this\r\n```diff\r\ndiff --git a/src/wallet/wallet.cpp b/src/wallet/wallet.cpp\r\nindex 3954f6626..3c88ff9c0 100644\r\n--- a/src/wallet/wallet.cpp\r\n+++ b/src/wallet/wallet.cpp\r\n@@ -3976,6 +3976,7 @@ bool CWalletTx::IsImmatureCoinBase() const\r\n std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outputs, bool single_coin) const {\r\n     std::vector<OutputGroup> groups;\r\n     std::map<CTxDestination, OutputGroup> gmap;\r\n+    std::set<CTxDestination> gfull;\r\n     CTxDestination dst;\r\n     for (const auto& output : outputs) {\r\n         if (output.fSpendable) {\r\n@@ -3990,6 +3991,7 @@ std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outpu\r\n                 if (gmap[dst].m_outputs.size() >= OUTPUT_GROUP_MAX_ENTRIES) {\r\n                     groups.push_back(gmap[dst]);\r\n                     gmap.erase(dst);\r\n+                    gfull.insert(dst);\r\n                 }\r\n                 gmap[dst].Insert(input_coin, output.nDepth, output.tx->IsFromMe(ISMINE_ALL), ancestors, descendants);\r\n             } else {\r\n@@ -3998,7 +4000,16 @@ std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outpu\r\n         }\r\n     }\r\n     if (!single_coin) {\r\n-        for (const auto& it : gmap) groups.push_back(it.second);\r\n+        for (auto& it : gmap) {\r\n+            auto& group = it.second;\r\n+            if (gfull.count(it.first) > 0 && group.m_outputs.size() < OUTPUT_GROUP_MAX_ENTRIES) {\r\n+                // make this unattractive as we want coin selection to avoid it if possible\r\n+                group.m_depth = 0;\r\n+                group.m_from_me = false;\r\n+                group.m_ancestors = 9999;\r\n+            }\r\n+            groups.push_back(group);\r\n+        }\r\n     }\r\n     return groups;\r\n }\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/570548151/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571911050",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#issuecomment-571911050",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17824",
    "id": 571911050,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MTkxMTA1MA==",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?u=8aa4d0fd79dff5cf64a98205c78bc1c96b0bf4b6&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-08T06:33:31Z",
    "updated_at": "2020-01-08T06:33:31Z",
    "author_association": "MEMBER",
    "body": "You're probably right that it would not end up using the final group even if it could. I think that's okay, in this case. As for the `-walletrejectlongchains` issue, you would replace `9999` with `max_ancestors-1` where `max_ancestors` is defined as in the coin selection code.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/571911050/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/572275147",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#issuecomment-572275147",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17824",
    "id": 572275147,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MjI3NTE0Nw==",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?u=348c27f90b6fff8fd72fa27232272651436a2ff0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-08T21:54:17Z",
    "updated_at": "2020-01-08T21:54:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased and implemented using `max_ancestors - 1` base on feedback.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/572275147/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/575321924",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#issuecomment-575321924",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17824",
    "id": 575321924,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3NTMyMTkyNA==",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?u=348c27f90b6fff8fd72fa27232272651436a2ff0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-16T20:03:11Z",
    "updated_at": "2020-01-16T20:03:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased and gave test a less generic name.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/575321924/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/598332375",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#issuecomment-598332375",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17824",
    "id": 598332375,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5ODMzMjM3NQ==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-12T17:48:10Z",
    "updated_at": "2020-03-12T17:48:10Z",
    "author_association": "MEMBER",
    "body": "Concept ACK. Can this PR have a `review club` tag to help people know there is a resource?\r\n\r\nReviewers, review club notes and meeting logs of both sessions are here: https://bitcoincore.reviews/17824\r\n\r\nSome of the suggestions from the sessions:\r\n- the PR title could use an improvement\r\n- the commit message could be a bit more elaborate\r\n- the changes could be better documented\r\n \r\n(Also, there seemed to be some agreement in the sessions to consider raising `OUTPUT_GROUP_MAX_ENTRIES`.)\r\n\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/598332375/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/603183830",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#issuecomment-603183830",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17824",
    "id": 603183830,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMzE4MzgzMA==",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?u=348c27f90b6fff8fd72fa27232272651436a2ff0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-24T11:25:35Z",
    "updated_at": "2020-03-24T11:25:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for all the feedback! I should have addressed all the points here and also what was discussed in the review club. Also I tried to improve the naming of this PR/commit and expanded the commit message.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/603183830/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/607859726",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#issuecomment-607859726",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17824",
    "id": 607859726,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNzg1OTcyNg==",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?u=348c27f90b6fff8fd72fa27232272651436a2ff0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-02T13:51:28Z",
    "updated_at": "2020-04-02T13:51:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "@jonatack Thanks for your comments! For now, I am saving the ACKs and included these cleanups in my followup PR #18418 ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/607859726/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/613430117",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#issuecomment-613430117",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17824",
    "id": 613430117,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMzQzMDExNw==",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?u=348c27f90b6fff8fd72fa27232272651436a2ff0&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-14T13:04:31Z",
    "updated_at": "2020-04-14T13:04:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased, no code changes.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/613430117/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/614549189",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#issuecomment-614549189",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17824",
    "id": 614549189,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxNDU0OTE4OQ==",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?u=3f68150a5f30acd541d1ed279376cd20b78046b1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-16T10:04:25Z",
    "updated_at": "2020-04-16T10:04:25Z",
    "author_association": "MEMBER",
    "body": "Re-ACK a2324e4",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/614549189/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/614880934",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#issuecomment-614880934",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/17824",
    "id": 614880934,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxNDg4MDkzNA==",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-16T20:35:38Z",
    "updated_at": "2020-04-16T20:35:38Z",
    "author_association": "MEMBER",
    "body": "ACK a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/614880934/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362013208",
    "pull_request_review_id": 337139160,
    "id": 362013208,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjAxMzIwOA==",
    "diff_hunk": "@@ -240,5 +242,26 @@ def test_fund_send_fund_send(self):\n         assert_approx(self.nodes[1].getbalance(), 1, 0.001)\n         assert_approx(self.nodes[1].getbalance(avoid_reuse=False), 11, 0.001)\n \n+    def test_destination_groupings(self):\n+        '''\n+        If a destination has more than 10 outputs, exactly 10 outputs should",
    "path": "test/functional/wallet_avoidreuse.py",
    "position": null,
    "original_position": 15,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "6004cce8747629b91dd71b43949e01342e4ff334",
    "user": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "what assumptions does this test have?\r\n\r\nSeems like it assumes the wallet has no more than 10*21 BTC? In other words, those sends completely drain the wallet of other UTXO addresses. This should be asserted and/or programmatically done.",
    "created_at": "2019-12-30T15:18:40Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r362013208",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362013208"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r362013208"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362013208/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 247,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362064719",
    "pull_request_review_id": 337201270,
    "id": 362064719,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjA2NDcxOQ==",
    "diff_hunk": "@@ -3977,6 +3977,7 @@ std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outpu\n     std::vector<OutputGroup> groups;\n     std::map<CTxDestination, OutputGroup> gmap;\n     CTxDestination dst;\n+    std::set<CTxDestination> full_groups;",
    "path": "src/wallet/wallet.cpp",
    "position": 39,
    "original_position": 4,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "6004cce8747629b91dd71b43949e01342e4ff334",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "ISTM a cleaner approach would be to move `groups` down before the return and just keep everything in the map. When there are more than 10 outputs in a group, just stop adding to the group. This would also handle the case of 20 outputs.\r\n\r\nUnless our goal is to have multiple groups when more than 10 outputs for a destination?\r\n\r\ncc @kallewoof ",
    "created_at": "2019-12-30T18:43:26Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r362064719",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362064719"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r362064719"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362064719/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4190,
    "original_line": 4190,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362143748",
    "pull_request_review_id": 337291810,
    "id": 362143748,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjE0Mzc0OA==",
    "diff_hunk": "@@ -3977,6 +3977,7 @@ std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outpu\n     std::vector<OutputGroup> groups;\n     std::map<CTxDestination, OutputGroup> gmap;\n     CTxDestination dst;\n+    std::set<CTxDestination> full_groups;",
    "path": "src/wallet/wallet.cpp",
    "position": 39,
    "original_position": 4,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "6004cce8747629b91dd71b43949e01342e4ff334",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "The intention was that if there were a ton of spends to the same address, these would be chunked into randomized 10 UTXO chunks, to avoid creating too large transactions. So yeah, the intention was to have multiple groups for the same destination in cases where there were 11+ UTXOs for it.",
    "created_at": "2019-12-31T03:49:54Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r362143748",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362143748"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r362143748"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362143748/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4190,
    "original_line": 4190,
    "side": "RIGHT",
    "in_reply_to_id": 362064719
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362783629",
    "pull_request_review_id": 338047462,
    "id": 362783629,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjc4MzYyOQ==",
    "diff_hunk": "@@ -240,5 +242,26 @@ def test_fund_send_fund_send(self):\n         assert_approx(self.nodes[1].getbalance(), 1, 0.001)\n         assert_approx(self.nodes[1].getbalance(avoid_reuse=False), 11, 0.001)\n \n+    def test_destination_groupings(self):\n+        '''\n+        If a destination has more than 10 outputs, exactly 10 outputs should",
    "path": "test/functional/wallet_avoidreuse.py",
    "position": null,
    "original_position": 15,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "6004cce8747629b91dd71b43949e01342e4ff334",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "It took me awhile to realize what is being stated here.\r\n\r\nIf a destination has more than 10 outputs, the 10-output groups should always be picked before the <10-output group, if any such exists.\r\n\r\nI.e. if a destination has 19 outputs, it will result in one 10-output group and one 9-output group. The second should never ever be used unless the former has already been used (in the same or a previous transaction).\r\n\r\nIf it has 21 outputs, it will result in two 10-output groups and one 1-output group. The third should be left alone unless the first two were used.\r\n",
    "created_at": "2020-01-03T11:47:35Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r362783629",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362783629"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r362783629"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/362783629/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 247,
    "side": "RIGHT",
    "in_reply_to_id": 362013208
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/363131187",
    "pull_request_review_id": 338435578,
    "id": 363131187,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEzMTE4Nw==",
    "diff_hunk": "@@ -240,5 +242,26 @@ def test_fund_send_fund_send(self):\n         assert_approx(self.nodes[1].getbalance(), 1, 0.001)\n         assert_approx(self.nodes[1].getbalance(avoid_reuse=False), 11, 0.001)\n \n+    def test_destination_groupings(self):\n+        '''\n+        If a destination has more than 10 outputs, exactly 10 outputs should",
    "path": "test/functional/wallet_avoidreuse.py",
    "position": null,
    "original_position": 15,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "6004cce8747629b91dd71b43949e01342e4ff334",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I have expanded the test and the comments and hope it's more clear now.",
    "created_at": "2020-01-06T01:04:59Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r363131187",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/363131187"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r363131187"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/363131187/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 247,
    "side": "RIGHT",
    "in_reply_to_id": 362013208
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391146536",
    "pull_request_review_id": 372981037,
    "id": 391146536,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE0NjUzNg==",
    "diff_hunk": "@@ -805,7 +805,7 @@ class CWallet final : public WalletStorage, private interfaces::Chain::Notificat\n     bool IsUsedDestination(const uint256& hash, unsigned int n) const EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n     void SetUsedDestinationState(WalletBatch& batch, const uint256& hash, unsigned int n, bool used, std::set<CTxDestination>& tx_destinations) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n \n-    std::vector<OutputGroup> GroupOutputs(const std::vector<COutput>& outputs, bool single_coin) const;\n+    std::vector<OutputGroup> GroupOutputs(const std::vector<COutput>& outputs, bool single_coin, const size_t max_ancestors = 10000) const;",
    "path": "src/wallet/wallet.h",
    "position": null,
    "original_position": 5,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Where does the value of `10000` come from? Could it be documented and maybe hoisted to a static constant?",
    "created_at": "2020-03-11T17:36:39Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r391146536",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391146536"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r391146536"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391146536/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 808,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391148769",
    "pull_request_review_id": 372983676,
    "id": 391148769,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE0ODc2OQ==",
    "diff_hunk": "@@ -288,5 +290,36 @@ def test_getbalances_used(self):\n         assert_unspent(self.nodes[1], total_count=2, total_sum=6, reused_count=1, reused_sum=1)\n         assert_balances(self.nodes[1], mine={\"used\": 1, \"trusted\": 5})\n \n+    def test_large_destination_group(self):",
    "path": "test/functional/wallet_avoidreuse.py",
    "position": null,
    "original_position": 13,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Suggestion for line 202 if you have to retouch this commit (it's unrelated but wouldn't hurt to sneak it in, as this test is called several times):\r\n```diff\r\n-  self.log.info(\"Test fund send fund send\")\r\n+  self.log.info(\"Test fund send fund send {}\".format(second_addr_type))\r\n```",
    "created_at": "2020-03-11T17:39:52Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r391148769",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391148769"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r391148769"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391148769/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 293,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391392340",
    "pull_request_review_id": 373267970,
    "id": 391392340,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTM5MjM0MA==",
    "diff_hunk": "@@ -288,5 +290,36 @@ def test_getbalances_used(self):\n         assert_unspent(self.nodes[1], total_count=2, total_sum=6, reused_count=1, reused_sum=1)\n         assert_balances(self.nodes[1], mine={\"used\": 1, \"trusted\": 5})\n \n+    def test_large_destination_group(self):\n+        '''\n+        Test the case where [1] only has 11 outputs of 1 BTC in the same reused\n+        address and tries to send a small payment of 0.5 BTC. The wallet\n+        should use 10 outputs from the reused address as inputs and not a\n+        single 1 BTC input, in order to join several outputs from the reused\n+        address.\n+        '''",
    "path": "test/functional/wallet_avoidreuse.py",
    "position": 71,
    "original_position": 20,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think having a test where the code DOES use the discouraged <10 leftover group would be helpful to ensure that this is correctly chosen when necessary.",
    "created_at": "2020-03-12T04:12:04Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r391392340",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391392340"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r391392340"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391392340/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 327,
    "original_line": 327,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391392685",
    "pull_request_review_id": 373268386,
    "id": 391392685,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTM5MjY4NQ==",
    "diff_hunk": "@@ -805,7 +805,7 @@ class CWallet final : public WalletStorage, private interfaces::Chain::Notificat\n     bool IsUsedDestination(const uint256& hash, unsigned int n) const EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n     void SetUsedDestinationState(WalletBatch& batch, const uint256& hash, unsigned int n, bool used, std::set<CTxDestination>& tx_destinations) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n \n-    std::vector<OutputGroup> GroupOutputs(const std::vector<COutput>& outputs, bool single_coin) const;\n+    std::vector<OutputGroup> GroupOutputs(const std::vector<COutput>& outputs, bool single_coin, const size_t max_ancestors = 10000) const;",
    "path": "src/wallet/wallet.h",
    "position": null,
    "original_position": 5,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think this should be based on the wallet-determined max ancestor count, and should not have a default value here. (i.e. I suggest removing ` = 10000`)",
    "created_at": "2020-03-12T04:13:49Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r391392685",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391392685"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r391392685"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391392685/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 808,
    "side": "RIGHT",
    "in_reply_to_id": 391146536
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391393820",
    "pull_request_review_id": 373269766,
    "id": 391393820,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTM5MzgyMA==",
    "diff_hunk": "@@ -805,7 +805,7 @@ class CWallet final : public WalletStorage, private interfaces::Chain::Notificat\n     bool IsUsedDestination(const uint256& hash, unsigned int n) const EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n     void SetUsedDestinationState(WalletBatch& batch, const uint256& hash, unsigned int n, bool used, std::set<CTxDestination>& tx_destinations) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n \n-    std::vector<OutputGroup> GroupOutputs(const std::vector<COutput>& outputs, bool single_coin) const;\n+    std::vector<OutputGroup> GroupOutputs(const std::vector<COutput>& outputs, bool single_coin, const size_t max_ancestors = 10000) const;",
    "path": "src/wallet/wallet.h",
    "position": null,
    "original_position": 5,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Wallet-determined max ancestor count, as in getPackageLimits `gArgs.GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT)`, which defaults to 25?",
    "created_at": "2020-03-12T04:19:45Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r391393820",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391393820"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r391393820"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391393820/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 808,
    "side": "RIGHT",
    "in_reply_to_id": 391146536
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391411942",
    "pull_request_review_id": 373291079,
    "id": 391411942,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQxMTk0Mg==",
    "diff_hunk": "@@ -805,7 +805,7 @@ class CWallet final : public WalletStorage, private interfaces::Chain::Notificat\n     bool IsUsedDestination(const uint256& hash, unsigned int n) const EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n     void SetUsedDestinationState(WalletBatch& batch, const uint256& hash, unsigned int n, bool used, std::set<CTxDestination>& tx_destinations) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n \n-    std::vector<OutputGroup> GroupOutputs(const std::vector<COutput>& outputs, bool single_coin) const;\n+    std::vector<OutputGroup> GroupOutputs(const std::vector<COutput>& outputs, bool single_coin, const size_t max_ancestors = 10000) const;",
    "path": "src/wallet/wallet.h",
    "position": null,
    "original_position": 5,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yep!",
    "created_at": "2020-03-12T05:44:40Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r391411942",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391411942"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r391411942"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/391411942/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 808,
    "side": "RIGHT",
    "in_reply_to_id": 391146536
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392633254",
    "pull_request_review_id": 374765084,
    "id": 392633254,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYzMzI1NA==",
    "diff_hunk": "@@ -2358,6 +2358,13 @@ bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAm\n             ++it;\n     }\n \n+    unsigned int limit_ancestor_count;",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I'm aware this is moved code, but I think these should be initialized.",
    "created_at": "2020-03-15T01:35:16Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r392633254",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392633254"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r392633254"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392633254/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2361,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392633286",
    "pull_request_review_id": 374765084,
    "id": 392633286,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYzMzI4Ng==",
    "diff_hunk": "@@ -2358,6 +2358,13 @@ bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAm\n             ++it;\n     }\n \n+    unsigned int limit_ancestor_count;\n+    unsigned int limit_descendant_count;\n+    chain().getPackageLimits(limit_ancestor_count, limit_descendant_count);\n+    size_t max_ancestors = (size_t)std::max<int64_t>(1, limit_ancestor_count);",
    "path": "src/wallet/wallet.cpp",
    "position": 7,
    "original_position": 7,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I'm aware this is moved code, but any idea why `max<int64_t>`?",
    "created_at": "2020-03-15T01:35:47Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r392633286",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392633286"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r392633286"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392633286/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2378,
    "original_line": 2378,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392633912",
    "pull_request_review_id": 374765084,
    "id": 392633912,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYzMzkxMg==",
    "diff_hunk": "@@ -4040,6 +4041,7 @@ std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outpu\n                 if (gmap[dst].m_outputs.size() >= OUTPUT_GROUP_MAX_ENTRIES) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 44,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit, could fix comment in L4038, s/10/OUTPUT_GROUP_MAX_ENTRIES.",
    "created_at": "2020-03-15T01:49:54Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r392633912",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392633912"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r392633912"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392633912/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4041,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392634313",
    "pull_request_review_id": 374765084,
    "id": 392634313,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYzNDMxMw==",
    "diff_hunk": "@@ -4040,6 +4041,7 @@ std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outpu\n                 if (gmap[dst].m_outputs.size() >= OUTPUT_GROUP_MAX_ENTRIES) {\n                     groups.push_back(gmap[dst]);\n                     gmap.erase(dst);",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 46,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit, there are 3 `dst` lookups in `gmap`, one `find` would be better.",
    "created_at": "2020-03-15T01:59:11Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r392634313",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392634313"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r392634313"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392634313/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4043,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392634618",
    "pull_request_review_id": 374765084,
    "id": 392634618,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYzNDYxOA==",
    "diff_hunk": "@@ -4023,10 +4023,11 @@ bool CWalletTx::IsImmatureCoinBase() const\n     return GetBlocksToMaturity() > 0;\n }\n \n-std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outputs, bool single_coin) const {\n+std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outputs, bool single_coin, const size_t max_ancestors) const {\n     std::vector<OutputGroup> groups;\n     std::map<CTxDestination, OutputGroup> gmap;\n     CTxDestination dst;",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 38,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "IMO this should be in the loop.",
    "created_at": "2020-03-15T02:06:43Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r392634618",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392634618"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r392634618"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/392634618/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4029,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397060971",
    "pull_request_review_id": 380193686,
    "id": 397060971,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA2MDk3MQ==",
    "diff_hunk": "@@ -4023,10 +4023,11 @@ bool CWalletTx::IsImmatureCoinBase() const\n     return GetBlocksToMaturity() > 0;\n }\n \n-std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outputs, bool single_coin) const {\n+std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outputs, bool single_coin, const size_t max_ancestors) const {\n     std::vector<OutputGroup> groups;\n     std::map<CTxDestination, OutputGroup> gmap;\n     CTxDestination dst;",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 38,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "done",
    "created_at": "2020-03-24T10:50:57Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r397060971",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397060971"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r397060971"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397060971/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4029,
    "side": "RIGHT",
    "in_reply_to_id": 392634618
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397061050",
    "pull_request_review_id": 380193792,
    "id": 397061050,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA2MTA1MA==",
    "diff_hunk": "@@ -4040,6 +4041,7 @@ std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outpu\n                 if (gmap[dst].m_outputs.size() >= OUTPUT_GROUP_MAX_ENTRIES) {\n                     groups.push_back(gmap[dst]);\n                     gmap.erase(dst);",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 46,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "done",
    "created_at": "2020-03-24T10:51:05Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r397061050",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397061050"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r397061050"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397061050/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4043,
    "side": "RIGHT",
    "in_reply_to_id": 392634313
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397061110",
    "pull_request_review_id": 380193879,
    "id": 397061110,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA2MTExMA==",
    "diff_hunk": "@@ -4040,6 +4041,7 @@ std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outpu\n                 if (gmap[dst].m_outputs.size() >= OUTPUT_GROUP_MAX_ENTRIES) {",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 44,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "done",
    "created_at": "2020-03-24T10:51:12Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r397061110",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397061110"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r397061110"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397061110/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 4041,
    "side": "RIGHT",
    "in_reply_to_id": 392633912
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397061241",
    "pull_request_review_id": 380194017,
    "id": 397061241,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA2MTI0MQ==",
    "diff_hunk": "@@ -2358,6 +2358,13 @@ bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAm\n             ++it;\n     }\n \n+    unsigned int limit_ancestor_count;",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 4,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "done",
    "created_at": "2020-03-24T10:51:25Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r397061241",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397061241"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r397061241"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397061241/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 2361,
    "side": "RIGHT",
    "in_reply_to_id": 392633254
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397061516",
    "pull_request_review_id": 380194333,
    "id": 397061516,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA2MTUxNg==",
    "diff_hunk": "@@ -288,5 +290,36 @@ def test_getbalances_used(self):\n         assert_unspent(self.nodes[1], total_count=2, total_sum=6, reused_count=1, reused_sum=1)\n         assert_balances(self.nodes[1], mine={\"used\": 1, \"trusted\": 5})\n \n+    def test_large_destination_group(self):\n+        '''\n+        Test the case where [1] only has 11 outputs of 1 BTC in the same reused\n+        address and tries to send a small payment of 0.5 BTC. The wallet\n+        should use 10 outputs from the reused address as inputs and not a\n+        single 1 BTC input, in order to join several outputs from the reused\n+        address.\n+        '''",
    "path": "test/functional/wallet_avoidreuse.py",
    "position": 71,
    "original_position": 20,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Added it, thanks.",
    "created_at": "2020-03-24T10:51:53Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r397061516",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397061516"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r397061516"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397061516/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 327,
    "original_line": 327,
    "side": "RIGHT",
    "in_reply_to_id": 391392340
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397061813",
    "pull_request_review_id": 380194703,
    "id": 397061813,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA2MTgxMw==",
    "diff_hunk": "@@ -288,5 +290,36 @@ def test_getbalances_used(self):\n         assert_unspent(self.nodes[1], total_count=2, total_sum=6, reused_count=1, reused_sum=1)\n         assert_balances(self.nodes[1], mine={\"used\": 1, \"trusted\": 5})\n \n+    def test_large_destination_group(self):",
    "path": "test/functional/wallet_avoidreuse.py",
    "position": null,
    "original_position": 13,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Improved the naming overall in a separate commit. Thanks!",
    "created_at": "2020-03-24T10:52:23Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r397061813",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397061813"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r397061813"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397061813/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 293,
    "side": "RIGHT",
    "in_reply_to_id": 391148769
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397075970",
    "pull_request_review_id": 380212202,
    "id": 397075970,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA3NTk3MA==",
    "diff_hunk": "@@ -805,7 +805,7 @@ class CWallet final : public WalletStorage, private interfaces::Chain::Notificat\n     bool IsUsedDestination(const uint256& hash, unsigned int n) const EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n     void SetUsedDestinationState(WalletBatch& batch, const uint256& hash, unsigned int n, bool used, std::set<CTxDestination>& tx_destinations) EXCLUSIVE_LOCKS_REQUIRED(cs_wallet);\n \n-    std::vector<OutputGroup> GroupOutputs(const std::vector<COutput>& outputs, bool single_coin) const;\n+    std::vector<OutputGroup> GroupOutputs(const std::vector<COutput>& outputs, bool single_coin, const size_t max_ancestors = 10000) const;",
    "path": "src/wallet/wallet.h",
    "position": null,
    "original_position": 5,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I removed the default value (10000), thanks!",
    "created_at": "2020-03-24T11:17:43Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r397075970",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397075970"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r397075970"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397075970/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 808,
    "side": "RIGHT",
    "in_reply_to_id": 391146536
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397079127",
    "pull_request_review_id": 380216087,
    "id": 397079127,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA3OTEyNw==",
    "diff_hunk": "@@ -2358,6 +2358,13 @@ bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAm\n             ++it;\n     }\n \n+    unsigned int limit_ancestor_count;\n+    unsigned int limit_descendant_count;\n+    chain().getPackageLimits(limit_ancestor_count, limit_descendant_count);\n+    size_t max_ancestors = (size_t)std::max<int64_t>(1, limit_ancestor_count);",
    "path": "src/wallet/wallet.cpp",
    "position": 7,
    "original_position": 7,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't know. I did some digging and the type was introduced [here](https://github.com/bitcoin/bitcoin/pull/12634/files#diff-b2bb174788c7409b671c46ccc86034bdR2588) and prior to that a `uint64` was first introduced [here](https://github.com/bitcoin/bitcoin/pull/9262/files#diff-b2bb174788c7409b671c46ccc86034bdR2020) in this context. I can only speculate that since this is a value from user input it was supposed to be as forgiving as possible if a ridiculously high number is provided, but even that does not make too much sense to me.",
    "created_at": "2020-03-24T11:23:16Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r397079127",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397079127"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r397079127"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397079127/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2378,
    "original_line": 2378,
    "side": "RIGHT",
    "in_reply_to_id": 392633286
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397636737",
    "pull_request_review_id": 380888756,
    "id": 397636737,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzYzNjczNw==",
    "diff_hunk": "@@ -2358,6 +2358,13 @@ bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAm\n             ++it;\n     }\n \n+    unsigned int limit_ancestor_count;\n+    unsigned int limit_descendant_count;\n+    chain().getPackageLimits(limit_ancestor_count, limit_descendant_count);\n+    size_t max_ancestors = (size_t)std::max<int64_t>(1, limit_ancestor_count);",
    "path": "src/wallet/wallet.cpp",
    "position": 7,
    "original_position": 7,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "87de015719bc3db37f8de84656450399d2278a91",
    "user": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This may have been a way to safeguard against a user defined value that was negative, but the switch to `getPackageLimits` removed that safeguard. Not sure if that was wise or not, but that's a separate question.",
    "created_at": "2020-03-25T06:43:35Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r397636737",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397636737"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r397636737"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/397636737/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 2378,
    "original_line": 2378,
    "side": "RIGHT",
    "in_reply_to_id": 392633286
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400348545",
    "pull_request_review_id": 384053038,
    "id": 400348545,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM0ODU0NQ==",
    "diff_hunk": "@@ -4023,32 +4023,49 @@ bool CWalletTx::IsImmatureCoinBase() const\n     return GetBlocksToMaturity() > 0;\n }\n \n-std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outputs, bool single_coin) const {\n+std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outputs, bool single_coin, const size_t max_ancestors) const {\n     std::vector<OutputGroup> groups;\n     std::map<CTxDestination, OutputGroup> gmap;\n-    CTxDestination dst;\n+    std::set<CTxDestination> full_groups;\n+\n     for (const auto& output : outputs) {\n         if (output.fSpendable) {\n+            CTxDestination dst;\n             CInputCoin input_coin = output.GetInputCoin();\n \n             size_t ancestors, descendants;\n             chain().getTransactionAncestry(output.tx->GetHash(), ancestors, descendants);\n             if (!single_coin && ExtractDestination(output.tx->tx->vout[output.i].scriptPubKey, dst)) {\n-                // Limit output groups to no more than 10 entries, to protect\n-                // against inadvertently creating a too-large transaction\n-                // when using -avoidpartialspends\n-                if (gmap[dst].m_outputs.size() >= OUTPUT_GROUP_MAX_ENTRIES) {\n-                    groups.push_back(gmap[dst]);\n-                    gmap.erase(dst);\n+                auto it = gmap.find(dst);\n+                if (it != gmap.end()) {\n+                    // Limit output groups to no more than OUTPUT_GROUP_MAX_ENTRIES\n+                    // number of entries, to protect against inadvertently creating\n+                    // a too-large transaction when using -avoidpartialspends to\n+                    // prevent breaking consensus or surprising users with a very\n+                    // high amount of fees.",
    "path": "src/wallet/wallet.cpp",
    "position": 61,
    "original_position": 61,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "9dcafb06dfa3f69bc720b5a4f1134fab95f17e40",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "suggest: s/a very high amount of fees./high fees./\r\n\r\nnote this feedback by @Xekyo mitigating the high fee motivation here: https://bitcoincore.reviews/17824.html#l-329",
    "created_at": "2020-03-30T16:59:26Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r400348545",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400348545"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r400348545"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400348545/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4206,
    "original_line": 4206,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400355185",
    "pull_request_review_id": 384053038,
    "id": 400355185,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM1NTE4NQ==",
    "diff_hunk": "@@ -4023,32 +4023,49 @@ bool CWalletTx::IsImmatureCoinBase() const\n     return GetBlocksToMaturity() > 0;\n }\n \n-std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outputs, bool single_coin) const {\n+std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outputs, bool single_coin, const size_t max_ancestors) const {\n     std::vector<OutputGroup> groups;\n     std::map<CTxDestination, OutputGroup> gmap;\n-    CTxDestination dst;\n+    std::set<CTxDestination> full_groups;\n+\n     for (const auto& output : outputs) {\n         if (output.fSpendable) {\n+            CTxDestination dst;\n             CInputCoin input_coin = output.GetInputCoin();\n \n             size_t ancestors, descendants;\n             chain().getTransactionAncestry(output.tx->GetHash(), ancestors, descendants);\n             if (!single_coin && ExtractDestination(output.tx->tx->vout[output.i].scriptPubKey, dst)) {\n-                // Limit output groups to no more than 10 entries, to protect\n-                // against inadvertently creating a too-large transaction\n-                // when using -avoidpartialspends\n-                if (gmap[dst].m_outputs.size() >= OUTPUT_GROUP_MAX_ENTRIES) {\n-                    groups.push_back(gmap[dst]);\n-                    gmap.erase(dst);\n+                auto it = gmap.find(dst);\n+                if (it != gmap.end()) {\n+                    // Limit output groups to no more than OUTPUT_GROUP_MAX_ENTRIES\n+                    // number of entries, to protect against inadvertently creating\n+                    // a too-large transaction when using -avoidpartialspends to\n+                    // prevent breaking consensus or surprising users with a very\n+                    // high amount of fees.\n+                    if (it->second.m_outputs.size() >= OUTPUT_GROUP_MAX_ENTRIES) {\n+                        groups.push_back(it->second);\n+                        it->second = OutputGroup{};\n+                        full_groups.insert(dst);\n+                    }\n+                    it->second.Insert(input_coin, output.nDepth, output.tx->IsFromMe(ISMINE_ALL), ancestors, descendants);\n+                } else {\n+                    gmap[dst].Insert(input_coin, output.nDepth, output.tx->IsFromMe(ISMINE_ALL), ancestors, descendants);\n                 }\n-                gmap[dst].Insert(input_coin, output.nDepth, output.tx->IsFromMe(ISMINE_ALL), ancestors, descendants);\n             } else {\n                 groups.emplace_back(input_coin, output.nDepth, output.tx->IsFromMe(ISMINE_ALL), ancestors, descendants);\n             }\n         }\n     }\n     if (!single_coin) {\n-        for (const auto& it : gmap) groups.push_back(it.second);\n+        for (auto& it : gmap) {\n+            auto& group = it.second;\n+            if (full_groups.count(it.first) > 0) {\n+                // Make this unattractive as we want coin selection to avoid it if possible",
    "path": "src/wallet/wallet.cpp",
    "position": 82,
    "original_position": 82,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "9dcafb06dfa3f69bc720b5a4f1134fab95f17e40",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Could perhaps expand on this documentation, like in your commit message, along the lines of:\r\n```diff\r\n-                // Make this unattractive as we want coin selection to avoid it if possible\r\n+                // By assigning it one less than the maximum number of ancestors\r\n+                // allowed for this wallet, we move this smaller subgroup to the\r\n+                // bottom of the priority list for the coin selection algorithm.\r\n```",
    "created_at": "2020-03-30T17:10:12Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r400355185",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400355185"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r400355185"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400355185/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4225,
    "original_line": 4225,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400530011",
    "pull_request_review_id": 384053038,
    "id": 400530011,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUzMDAxMQ==",
    "diff_hunk": "@@ -4023,32 +4023,49 @@ bool CWalletTx::IsImmatureCoinBase() const\n     return GetBlocksToMaturity() > 0;\n }\n \n-std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outputs, bool single_coin) const {\n+std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outputs, bool single_coin, const size_t max_ancestors) const {\n     std::vector<OutputGroup> groups;\n     std::map<CTxDestination, OutputGroup> gmap;\n-    CTxDestination dst;\n+    std::set<CTxDestination> full_groups;\n+\n     for (const auto& output : outputs) {\n         if (output.fSpendable) {\n+            CTxDestination dst;\n             CInputCoin input_coin = output.GetInputCoin();\n \n             size_t ancestors, descendants;\n             chain().getTransactionAncestry(output.tx->GetHash(), ancestors, descendants);\n             if (!single_coin && ExtractDestination(output.tx->tx->vout[output.i].scriptPubKey, dst)) {\n-                // Limit output groups to no more than 10 entries, to protect\n-                // against inadvertently creating a too-large transaction\n-                // when using -avoidpartialspends\n-                if (gmap[dst].m_outputs.size() >= OUTPUT_GROUP_MAX_ENTRIES) {\n-                    groups.push_back(gmap[dst]);\n-                    gmap.erase(dst);\n+                auto it = gmap.find(dst);\n+                if (it != gmap.end()) {\n+                    // Limit output groups to no more than OUTPUT_GROUP_MAX_ENTRIES\n+                    // number of entries, to protect against inadvertently creating\n+                    // a too-large transaction when using -avoidpartialspends to\n+                    // prevent breaking consensus or surprising users with a very\n+                    // high amount of fees.\n+                    if (it->second.m_outputs.size() >= OUTPUT_GROUP_MAX_ENTRIES) {\n+                        groups.push_back(it->second);\n+                        it->second = OutputGroup{};\n+                        full_groups.insert(dst);\n+                    }\n+                    it->second.Insert(input_coin, output.nDepth, output.tx->IsFromMe(ISMINE_ALL), ancestors, descendants);\n+                } else {\n+                    gmap[dst].Insert(input_coin, output.nDepth, output.tx->IsFromMe(ISMINE_ALL), ancestors, descendants);\n                 }\n-                gmap[dst].Insert(input_coin, output.nDepth, output.tx->IsFromMe(ISMINE_ALL), ancestors, descendants);\n             } else {\n                 groups.emplace_back(input_coin, output.nDepth, output.tx->IsFromMe(ISMINE_ALL), ancestors, descendants);\n             }\n         }\n     }\n     if (!single_coin) {\n-        for (const auto& it : gmap) groups.push_back(it.second);\n+        for (auto& it : gmap) {\n+            auto& group = it.second;\n+            if (full_groups.count(it.first) > 0) {\n+                // Make this unattractive as we want coin selection to avoid it if possible\n+                group.m_ancestors = max_ancestors - 1;\n+            }\n+            groups.push_back(group);",
    "path": "src/wallet/wallet.cpp",
    "position": 85,
    "original_position": 85,
    "commit_id": "a2324e4d3f47f084b07a364c9a360a0bf31e86a0",
    "original_commit_id": "9dcafb06dfa3f69bc720b5a4f1134fab95f17e40",
    "user": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Do you think it might be better to construct rather than copy?\r\n```diff\r\n-                        groups.push_back(it->second);\r\n+                        groups.emplace_back(it->second);\r\n                         it->second = OutputGroup{};\r\n-                        full_groups.insert(dst);\r\n+                        full_groups.emplace(dst);\r\n@@ -4208,7 +4208,7 @@ std::vector<OutputGroup> CWallet::GroupOutputs(const std::vector<COutput>& outpu\r\n                 // Make this unattractive as we want coin selection to avoid it if possible\r\n                 group.m_ancestors = max_ancestors - 1;\r\n             }\r\n-            groups.push_back(group);\r\n+            groups.emplace_back(group);\r\n```",
    "created_at": "2020-03-30T22:22:28Z",
    "updated_at": "2020-04-14T13:04:12Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r400530011",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400530011"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/17824#discussion_r400530011"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/17824"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400530011/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 4228,
    "original_line": 4228,
    "side": "RIGHT"
  }
]