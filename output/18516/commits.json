[
  {
    "sha": "25e03ba1ff18ca06954786e512000648941b4dfb",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyNWUwM2JhMWZmMThjYTA2OTU0Nzg2ZTUxMjAwMDY0ODk0MWI0ZGZi",
    "commit": {
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2020-04-03T15:12:08Z"
      },
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2020-04-06T15:07:33Z"
      },
      "message": "test: relax bumpfee dust_to_fee txsize an extra vbyte\n\nand add explanatory documentation for the reasoning.",
      "tree": {
        "sha": "2f9d12e95c3cbb156e68b453de5f998f1e30e9c1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2f9d12e95c3cbb156e68b453de5f998f1e30e9c1"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/25e03ba1ff18ca06954786e512000648941b4dfb",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAl6LRcMACgkQT1chs9Dj\nkh2HqBAAhfT4wnJN4V1JfLVEThpZWdClB7R+HxMGhprBsMJPw0VWVG7ANIRkkQrQ\nr0fGUCcV5V+fepOmYVrZJPEZC96f1svK7FUk3WieD6FL40fnfWljsfdAQTaZQ3uQ\nRuu1sUL8kJIUhlT7jL3Mr9C+YG7SLckn331/Y9lGL26oXGWXuOcM8PxIbzHMF2GK\nBzYzfQDbLvQ/r5tOa5KNLz5NUnsPVZgYG6Avj6idRFUa7HWUzP68/Wclq7AbopUz\nZZRg56J0rFN7Cn4lOjn5SAAJDcskEeRIXsbafgBF22qnVy8iiChR0PkMHdJ/2s4d\nHbr+3XDil/YfkeP7dRzHwN25aDdtzDKJe87ZvVid59z0N1T1wwz9ONxnp9cFUIJg\nw4503RvRLod91odYYpTV3oVk7/tqlRnuTxHvaJEcqQoJEJE+U9CVEjqsR6y4fVqJ\nyjkD9tX5yeb5ZDqEfvkXFQYkp+otWJdq1a+LZQJqO5/F1hjD/wpGywgtYau3gDlA\nP7cRhCA0DdrOsTCzjljmQfvi4SFWqaZKoUkVTxTQyU8l6vT3IeQTW589CxjXoP4p\nSiPaNMZ22WACodF0BBOAVHObPxO28K6/az/fSX8eeB0iZJQegHeYzCX80fGRYg+m\nW23tOcGVHw10KprFLyet+656nTMCkT66BX1gyxboRenDNAj3tp0=\n=ZNYV\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwILFzsNXxVCru7S+BcZrYH8Yby2qoncblvwCWf3kGtXeECP/wEAy01piJSCaa\nwmZts0Fj9ZoI8QRei0XF8AhP/Za8/5MwsQCD3+MNLvkMjiMiaHR0cHM6Ly9idGMu\nY2FsZW5kYXIuY2F0YWxsYXh5LmNvbf/wEJATQ0WXToUchgIvNdHTjhQI8QRei0XE\n8Ahq8m1Hlbvg7gCD3+MNLvkMjiwraHR0cHM6Ly9ib2IuYnRjLmNhbGVuZGFyLm9w\nZW50aW1lc3RhbXBzLm9yZ//wEKBFBkBeRcXsLRFD0WFztD0I8CCU0cMDbya/ITr4\nm+a9UsvBn6LyqCr6q5ymgWEcEBVmBgjxBF6LRcXwCKmUhXAHcMzvAIPf4w0u+QyO\nLi1odHRwczovL2FsaWNlLmJ0Yy5jYWxlbmRhci5vcGVudGltZXN0YW1wcy5vcmfw\nEPFcoiVzlhThH5lguV7NMfQI8CDN4ftDVaTTOkpQQ0fL3fdAOwEFt5WR7mFBeFwD\nCmPxwAjxBF6LRcXwCAvlg5kM7J/fAIPf4w0u+QyOKShodHRwczovL2Zpbm5leS5j\nYWxlbmRhci5ldGVybml0eXdhbGwuY29t\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----",
        "payload": "tree 2f9d12e95c3cbb156e68b453de5f998f1e30e9c1\nparent f0d6487e290761a4fb03798240a351b5fddfdb38\nauthor Jon Atack <jon@atack.com> 1585926728 +0200\ncommitter Jon Atack <jon@atack.com> 1586185653 +0200\n\ntest: relax bumpfee dust_to_fee txsize an extra vbyte\n\nand add explanatory documentation for the reasoning.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/25e03ba1ff18ca06954786e512000648941b4dfb",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/25e03ba1ff18ca06954786e512000648941b4dfb",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/25e03ba1ff18ca06954786e512000648941b4dfb/comments",
    "author": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f0d6487e290761a4fb03798240a351b5fddfdb38",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f0d6487e290761a4fb03798240a351b5fddfdb38",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f0d6487e290761a4fb03798240a351b5fddfdb38"
      }
    ],
    "stats": {
      "total": 18,
      "additions": 12,
      "deletions": 6
    },
    "files": [
      {
        "sha": "2e6a3e0ce4400bc94b4b67163b5aa716f555c9d4",
        "filename": "test/functional/wallet_bumpfee.py",
        "status": "modified",
        "additions": 12,
        "deletions": 6,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/25e03ba1ff18ca06954786e512000648941b4dfb/test/functional/wallet_bumpfee.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/25e03ba1ff18ca06954786e512000648941b4dfb/test/functional/wallet_bumpfee.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_bumpfee.py?ref=25e03ba1ff18ca06954786e512000648941b4dfb",
        "patch": "@@ -253,12 +253,18 @@ def test_dust_to_fee(self, rbf_node, dest_address):\n     self.log.info('Test that bumped output that is dust is dropped to fee')\n     rbfid = spend_one_input(rbf_node, dest_address)\n     fulltx = rbf_node.getrawtransaction(rbfid, 1)\n-    # size of transaction (p2wpkh, 1 input, 2 outputs): 141 vbytes\n-    assert_equal(fulltx[\"vsize\"], 141)\n-    # bump with fee_rate of 0.00350000 BTC per 1000 vbytes\n-    # expected bump fee of 141 vbytes * fee_rate 0.00350000 BTC / 1000 vbytes = 0.00049350 BTC\n-    # but dust is dropped, so actual bump fee is 0.00050000\n-    bumped_tx = rbf_node.bumpfee(rbfid, {\"fee_rate\": 0.0035})\n+    # The DER formatting used by Bitcoin to serialize ECDSA signatures means that signatures can have a\n+    # variable size of 70-72 bytes (or possibly even less), with most being 71 or 72 bytes. The signature\n+    # in the witness is divided by 4 for the vsize, so this variance can take the weight across a 4-byte\n+    # boundary. Thus expected transaction size (p2wpkh, 1 input, 2 outputs) is 140-141 vbytes, usually 141.\n+    if not 140 <= fulltx[\"vsize\"] <= 141:\n+        print(\"Error: Invalid tx vsize of {} (140-141 expected), full tx: {}\".format(fulltx[\"vsize\"], fulltx))\n+        raise AssertionError\n+    # Bump with fee_rate of 0.00350250 BTC per 1000 vbytes to create dust.\n+    # Expected fee is 141 vbytes * fee_rate 0.00350250 BTC / 1000 vbytes = 0.00049385 BTC.\n+    # or occasionally 140 vbytes * fee_rate 0.00350250 BTC / 1000 vbytes = 0.00049035 BTC.\n+    # Dust should be dropped to the fee, so actual bump fee is 0.00050000 BTC.\n+    bumped_tx = rbf_node.bumpfee(rbfid, {\"fee_rate\": 0.00350250})\n     full_bumped_tx = rbf_node.getrawtransaction(bumped_tx[\"txid\"], 1)\n     assert_equal(bumped_tx[\"fee\"], Decimal(\"0.00050000\"))\n     assert_equal(len(fulltx[\"vout\"]), 2)"
      }
    ]
  }
]