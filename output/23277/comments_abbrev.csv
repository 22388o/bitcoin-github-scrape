laanwj,2021-10-14 15:49:00,"Concept ACK, I agree this shouldn't cause a crash.",https://github.com/bitcoin/bitcoin/pull/23277#issuecomment-943486637,943486637,
achow101,2021-10-15 02:34:38,"The root cause of the problem this is fixing is that the wallet does not contain the upgraded key metadata because it is encrypted and has not been unlocked yet, and a transaction was found that involved inactive HD chains. So this segfault can be triggered with a non-corrupted wallet. I don't think it is necessarily correct to log an error and move on as doing so could result in missing funds.\n",https://github.com/bitcoin/bitcoin/pull/23277#issuecomment-943937284,943937284,
rooprob,2021-10-15 08:57:32,"when I encountered this, this was the state of meta,\n``` \n(gdb)\np meta\n$1 = {static VERSION_BASIC = 1, static VERSION_WITH_HDDATA = 10, static VERSION_WITH_KEY_ORIGIN = 12, \n  static CURRENT_VERSION = 12, nVersion = 10, nCreateTime = 1509688921, hdKeypath = ""m/0'/0'/0'"", \n  hd_seed_id = {<uint160> = {<base_blob<160>> = {static WIDTH = 20, \n        m_data = ""4\264Y\351...."", <incomplete ",https://github.com/bitcoin/bitcoin/pull/23277#issuecomment-944123158,944123158,
achow101,2021-10-15 16:44:17,"> when I encountered this, this was the state of meta,\n\nThis matches what I expect. The meta is not upgraded (nVersion is 10, not 12, and has_key_origin is false).",https://github.com/bitcoin/bitcoin/pull/23277#issuecomment-944444809,944444809,
achow101,2021-10-18 18:33:14,"Please squash your commits.\n\nI will implement the derivation from the keypath string in a followup PR as that is a bit more complicated to deal with.",https://github.com/bitcoin/bitcoin/pull/23277#issuecomment-946050766,946050766,
DrahtBot,2021-10-19 08:52:08,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23304](https://github.com/bitcoin/bitcoin/pull/23304) (wallet: Derive inactive HD chains in addtional places by achow101",https://github.com/bitcoin/bitcoin/pull/23277#issuecomment-946500437,946500437,
MarcoFalke,2021-10-19 09:09:03,Please squash your commits according to https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#squashing-commits,https://github.com/bitcoin/bitcoin/pull/23277#issuecomment-946514622,946514622,
achow101,2021-11-02 16:45:34,"@rooprob Are you planning on continuing to work on this PR? If not, I can take it over in #23304 ",https://github.com/bitcoin/bitcoin/pull/23277#issuecomment-957934464,957934464,
rooprob,2021-11-03 02:38:48,"> @rooprob Are you planning on continuing to work on this PR? If not, I can take it over in #23304\n\nI think it's better to follow up in your PR.  I shall withdraw this PR.\n\nThanks for picking this up in #23304",https://github.com/bitcoin/bitcoin/pull/23277#issuecomment-958607978,958607978,
laanwj,2021-10-14 15:45:43,Wouldn't `meta.key_origin.path.size() >= 3` be better if the worry is to go out of range here? Might also log a warning when this happens as it means (I guess?) that the wallet is somehow corrupted.,https://github.com/bitcoin/bitcoin/pull/23277#discussion_r729115253,729115253,src/wallet/scriptpubkeyman.cpp
