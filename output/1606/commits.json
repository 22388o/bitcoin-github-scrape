[
  {
    "sha": "18871d4785d579a2da64dab79e6258b9170ef150",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxODg3MWQ0Nzg1ZDU3OWEyZGE2NGRhYjc5ZTYyNThiOTE3MGVmMTUw",
    "commit": {
      "author": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2012-07-17T16:02:31Z"
      },
      "committer": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2012-07-17T16:02:31Z"
      },
      "message": "Give a better error message than 'type mismatch' for complex JSON arguments",
      "tree": {
        "sha": "3c8167ece82cd844863adb002328731d5f578e39",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3c8167ece82cd844863adb002328731d5f578e39"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/18871d4785d579a2da64dab79e6258b9170ef150",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/18871d4785d579a2da64dab79e6258b9170ef150",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/18871d4785d579a2da64dab79e6258b9170ef150",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/18871d4785d579a2da64dab79e6258b9170ef150/comments",
    "author": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "ab0d6428b173cb25f09a4f85d13eedff38de826f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ab0d6428b173cb25f09a4f85d13eedff38de826f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/ab0d6428b173cb25f09a4f85d13eedff38de826f"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 3,
      "deletions": 2
    },
    "files": [
      {
        "sha": "85ef9031c7c3ee5c1e9078ca95b685216319dad8",
        "filename": "src/bitcoinrpc.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 2,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/18871d4785d579a2da64dab79e6258b9170ef150/src/bitcoinrpc.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/18871d4785d579a2da64dab79e6258b9170ef150/src/bitcoinrpc.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoinrpc.cpp?ref=18871d4785d579a2da64dab79e6258b9170ef150",
        "patch": "@@ -2957,8 +2957,9 @@ void ConvertTo(Value& value)\n     {\n         // reinterpret string as unquoted json value\n         Value value2;\n-        if (!read_string(value.get_str(), value2))\n-            throw runtime_error(\"type mismatch\");\n+        string strJSON = value.get_str();\n+        if (!read_string(strJSON, value2))\n+            throw runtime_error(string(\"Error parsing JSON:\")+strJSON);\n         value = value2.get_value<T>();\n     }\n     else"
      }
    ]
  },
  {
    "sha": "3c3666d67ea9036c612bb83d6c8496d011cccaac",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozYzM2NjZkNjdlYTkwMzZjNjEyYmI4M2Q2Yzg0OTZkMDExY2NjYWFj",
    "commit": {
      "author": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2012-07-17T16:06:13Z"
      },
      "committer": {
        "name": "Gavin Andresen",
        "email": "gavinandresen@gmail.com",
        "date": "2012-07-17T16:21:56Z"
      },
      "message": "New feature for signrawtransaction: specify signature hash (ALL/NONE/etc)",
      "tree": {
        "sha": "cd6ac9e987a355c3031b7d9e50c1a7c002a34263",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cd6ac9e987a355c3031b7d9e50c1a7c002a34263"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3c3666d67ea9036c612bb83d6c8496d011cccaac",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3c3666d67ea9036c612bb83d6c8496d011cccaac",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3c3666d67ea9036c612bb83d6c8496d011cccaac",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3c3666d67ea9036c612bb83d6c8496d011cccaac/comments",
    "author": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gavinandresen",
      "id": 331997,
      "node_id": "MDQ6VXNlcjMzMTk5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/331997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gavinandresen",
      "html_url": "https://github.com/gavinandresen",
      "followers_url": "https://api.github.com/users/gavinandresen/followers",
      "following_url": "https://api.github.com/users/gavinandresen/following{/other_user}",
      "gists_url": "https://api.github.com/users/gavinandresen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gavinandresen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gavinandresen/subscriptions",
      "organizations_url": "https://api.github.com/users/gavinandresen/orgs",
      "repos_url": "https://api.github.com/users/gavinandresen/repos",
      "events_url": "https://api.github.com/users/gavinandresen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gavinandresen/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "18871d4785d579a2da64dab79e6258b9170ef150",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/18871d4785d579a2da64dab79e6258b9170ef150",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/18871d4785d579a2da64dab79e6258b9170ef150"
      }
    ],
    "stats": {
      "total": 27,
      "additions": 24,
      "deletions": 3
    },
    "files": [
      {
        "sha": "66e4d85f37561ccdce42d1c679299376893f8d91",
        "filename": "src/rpcrawtransaction.cpp",
        "status": "modified",
        "additions": 24,
        "deletions": 3,
        "changes": 27,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3c3666d67ea9036c612bb83d6c8496d011cccaac/src/rpcrawtransaction.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3c3666d67ea9036c612bb83d6c8496d011cccaac/src/rpcrawtransaction.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpcrawtransaction.cpp?ref=3c3666d67ea9036c612bb83d6c8496d011cccaac",
        "patch": "@@ -276,14 +276,16 @@ Value decoderawtransaction(const Array& params, bool fHelp)\n \n Value signrawtransaction(const Array& params, bool fHelp)\n {\n-    if (fHelp || params.size() < 1 || params.size() > 3)\n+    if (fHelp || params.size() < 1 || params.size() > 4)\n         throw runtime_error(\n-            \"signrawtransaction <hex string> [{\\\"txid\\\":txid,\\\"vout\\\":n,\\\"scriptPubKey\\\":hex},...] [<privatekey1>,...]\\n\"\n+            \"signrawtransaction <hex string> [{\\\"txid\\\":txid,\\\"vout\\\":n,\\\"scriptPubKey\\\":hex},...] [<privatekey1>,...] [sighashtype=\\\"ALL\\\"]\\n\"\n             \"Sign inputs for raw transaction (serialized, hex-encoded).\\n\"\n             \"Second optional argument is an array of previous transaction outputs that\\n\"\n             \"this transaction depends on but may not yet be in the blockchain.\\n\"\n             \"Third optional argument is an array of base58-encoded private\\n\"\n             \"keys that, if given, will be the only keys used to sign the transaction.\\n\"\n+            \"Fourth option is a string that is one of six values; ALL, NONE, SINGLE or\\n\"\n+            \"ALL|ANYONECANPAY, NONE|ANYONECANPAY, SINGLE|ANYONECANPAY.\\n\"\n             \"Returns json object with keys:\\n\"\n             \"  hex : raw transaction with signature(s) (hex-encoded string)\\n\"\n             \"  complete : 1 if transaction has a complete set of signature (0 if not)\"\n@@ -402,6 +404,25 @@ Value signrawtransaction(const Array& params, bool fHelp)\n     }\n     const CKeyStore& keystore = (fGivenKeys ? tempKeystore : *pwalletMain);\n \n+    int nHashType = SIGHASH_ALL;\n+    if (params.size() > 3)\n+    {\n+        static map<string, int> mapSigHashValues =\n+            boost::assign::map_list_of\n+            (string(\"ALL\"), int(SIGHASH_ALL))\n+            (string(\"ALL|ANYONECANPAY\"), int(SIGHASH_ALL|SIGHASH_ANYONECANPAY))\n+            (string(\"NONE\"), int(SIGHASH_NONE))\n+            (string(\"NONE|ANYONECANPAY\"), int(SIGHASH_NONE|SIGHASH_ANYONECANPAY))\n+            (string(\"SINGLE\"), int(SIGHASH_SINGLE))\n+            (string(\"SINGLE|ANYONECANPAY\"), int(SIGHASH_SINGLE|SIGHASH_ANYONECANPAY))\n+            ;\n+        string strHashType = params[3].get_str();\n+        if (mapSigHashValues.count(strHashType))\n+            nHashType = mapSigHashValues[strHashType];\n+        else\n+            throw JSONRPCError(-8, \"Invalid sighash param\");\n+    }\n+\n     // Sign what we can:\n     for (unsigned int i = 0; i < mergedTx.vin.size(); i++)\n     {\n@@ -414,7 +435,7 @@ Value signrawtransaction(const Array& params, bool fHelp)\n         const CScript& prevPubKey = mapPrevOut[txin.prevout];\n \n         txin.scriptSig.clear();\n-        SignSignature(keystore, prevPubKey, mergedTx, i);\n+        SignSignature(keystore, prevPubKey, mergedTx, i, nHashType);\n \n         // ... and merge in other signatures:\n         BOOST_FOREACH(const CTransaction& txv, txVariants)"
      }
    ]
  }
]