[
  {
    "sha": "e1e67148321cff0de9eb5e63d2604f05c12e69d1",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplMWU2NzE0ODMyMWNmZjBkZTllYjVlNjNkMjYwNGYwNWMxMmU2OWQx",
    "commit": {
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2020-12-14T14:51:26Z"
      },
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-02-02T13:49:06Z"
      },
      "message": "doc: refer to BIPs 339/155 in feature negotiation\n\nand add fSuccessfullyConnected doxygen documentation\nto clarify that it is set to true on VERACK",
      "tree": {
        "sha": "abe6bff4daae8709ab4ce00595aabc2b7876b684",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/abe6bff4daae8709ab4ce00595aabc2b7876b684"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e1e67148321cff0de9eb5e63d2604f05c12e69d1",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAmAZWFgACgkQT1chs9Dj\nkh1ZrQ//VD0xxkYZj47dLAlZhUmdTuZox4o2leseCRVUYLZcVwfFjY/vnD27eAlW\nBRRTQ3cb4N0nx8FyM4WjMQ14B6JU95xjbY/21Wuy+cNGC3/YUJ7mLdvEDicSHVER\nryDgCZluaiOWNq6e9rJh+Als5FfCZiFIPr51W3PcWXZw4MGjf8di6rkFbRCnyzV/\n2sloyKIyKHD4G5VZiMVmDoBFy/uL9H0m6PsnxqNVlQO4O3EHLdcBl9A+4jj0elD7\niYKRa5qyHeL+0GYTY+2KT/ZJtptYpKmT4amf1j1+9bpH6vsI2fcuds19vXvKwg2P\npcqHrDyDGtugA1r1pmtz7TF9VDjoUOhnxFsLK0IjkuMgeh6jxEet073GLS+dO1yt\n0ewiqoijzC9O3kc3RDfegET/lLVVX1x2S+1r7CHJ9q2EsCXgcfoaBQpo6p5TMHxx\n6QVy0LIDbsGA3einHuZnKA9lFgO2yvGlsJjIVRNoLqqu/1eVdNpRYnKcHxLBeYEg\nt2Vbg/+l/03vzZsPbwM0dhRF3szaMU5eOUPrYN4lIwAXWUyh/Ci+h81xKxeKrDmT\nBHXEYgowYfiD+klxOmtKiGYb2XxlwxcBEGUbeH9L25hV0afnpQqW5jfixzqVVxkc\nWqEe3nB2OhWgOi/g6s4Hayq1s4hvi5sarDeHRAiojkU8NlDNc0w=\n=xmV/\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwICh9BrB8rbqo4SNGkuyPLFO3TNA1X1RAwqUM3pKXbJb/CP/wEAvNTpmHLbSY\nEtNbtVGpBtQI8CAwZlA+zks9AlUOYQP9kcChHct5ZlztA0P/KeUu1AA1XAjxBGAZ\nWFrwCPGOFP2CwwThAIPf4w0u+QyOLCtodHRwczovL2JvYi5idGMuY2FsZW5kYXIu\nb3BlbnRpbWVzdGFtcHMub3Jn//AQqnCXTXhXPJP/XR6iemGa7QjxBGAZWFrwCARY\nzPDqP4SqAIPf4w0u+QyOIyJodHRwczovL2J0Yy5jYWxlbmRhci5jYXRhbGxheHku\nY29t//AQrrlVSZbJ3u6bbImtbpDXqwjxIGprnUrI4D3QByjy/fk3a3YzXTEwvhbt\n1ZlSB8PTu4TcCPEEYBlKifAIFhTlk/ByOOMAg9/jDS75DI4pKGh0dHBzOi8vZmlu\nbmV5LmNhbGVuZGFyLmV0ZXJuaXR5d2FsbC5jb23wELOAgfdT2msNjGVv5QUVBt0I\n8QRgGVha8AipstLpeMHmgwCD3+MNLvkMji4taHR0cHM6Ly9hbGljZS5idGMuY2Fs\nZW5kYXIub3BlbnRpbWVzdGFtcHMub3Jn\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----",
        "payload": "tree abe6bff4daae8709ab4ce00595aabc2b7876b684\nparent 384e090f9345c07fa81ccafa8cd36037f3cd0813\nauthor Jon Atack <jon@atack.com> 1607957486 +0100\ncommitter Jon Atack <jon@atack.com> 1612273746 +0100\n\ndoc: refer to BIPs 339/155 in feature negotiation\n\nand add fSuccessfullyConnected doxygen documentation\nto clarify that it is set to true on VERACK\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e1e67148321cff0de9eb5e63d2604f05c12e69d1",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e1e67148321cff0de9eb5e63d2604f05c12e69d1",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e1e67148321cff0de9eb5e63d2604f05c12e69d1/comments",
    "author": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "384e090f9345c07fa81ccafa8cd36037f3cd0813",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/384e090f9345c07fa81ccafa8cd36037f3cd0813",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/384e090f9345c07fa81ccafa8cd36037f3cd0813"
      }
    ],
    "stats": {
      "total": 13,
      "additions": 7,
      "deletions": 6
    },
    "files": [
      {
        "sha": "a0aa15705840b8a31e06bddb20379b86ff4daad4",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e1e67148321cff0de9eb5e63d2604f05c12e69d1/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e1e67148321cff0de9eb5e63d2604f05c12e69d1/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=e1e67148321cff0de9eb5e63d2604f05c12e69d1",
        "patch": "@@ -445,6 +445,7 @@ class CNode\n      * messages, implying a preference to receive ADDRv2 instead of ADDR ones.\n      */\n     std::atomic_bool m_wants_addrv2{false};\n+    /** fSuccessfullyConnected is set to true on receiving VERACK from the peer. */\n     std::atomic_bool fSuccessfullyConnected{false};\n     // Setting fDisconnect to true will cause the node to be disconnected the\n     // next time DisconnectNodes() runs"
      },
      {
        "sha": "a246c8fa1c792f1d670d299d384c8fe73815bb3c",
        "filename": "src/net_processing.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 6,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e1e67148321cff0de9eb5e63d2604f05c12e69d1/src/net_processing.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e1e67148321cff0de9eb5e63d2604f05c12e69d1/src/net_processing.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net_processing.cpp?ref=e1e67148321cff0de9eb5e63d2604f05c12e69d1",
        "patch": "@@ -2745,12 +2745,11 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         return;\n     }\n \n-    // Feature negotiation of wtxidrelay must happen between VERSION and VERACK\n-    // to avoid relay problems from switching after a connection is up.\n+    // BIP339 defines feature negotiation of wtxidrelay, which must happen between\n+    // VERSION and VERACK to avoid relay problems from switching after a connection is up.\n     if (msg_type == NetMsgType::WTXIDRELAY) {\n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send wtxidrelay message after VERACK; this\n-            // must be negotiated between VERSION and VERACK.\n+            // Disconnect peers that send a wtxidrelay message after VERACK.\n             LogPrint(BCLog::NET, \"wtxidrelay received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;\n@@ -2769,10 +2768,11 @@ void PeerManagerImpl::ProcessMessage(CNode& pfrom, const std::string& msg_type,\n         return;\n     }\n \n+    // BIP155 defines feature negotiation of addrv2 and sendaddrv2, which must happen\n+    // between VERSION and VERACK.\n     if (msg_type == NetMsgType::SENDADDRV2) {\n         if (pfrom.fSuccessfullyConnected) {\n-            // Disconnect peers that send SENDADDRV2 message after VERACK; this\n-            // must be negotiated between VERSION and VERACK.\n+            // Disconnect peers that send a SENDADDRV2 message after VERACK.\n             LogPrint(BCLog::NET, \"sendaddrv2 received after verack from peer=%d; disconnecting\\n\", pfrom.GetId());\n             pfrom.fDisconnect = true;\n             return;"
      }
    ]
  }
]