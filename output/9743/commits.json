[
  {
    "sha": "321bbc2079e2dc3648ae4eaf845f5b71d30b423a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozMjFiYmMyMDc5ZTJkYzM2NDhhZTRlYWY4NDVmNWI3MWQzMGI0MjNh",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2017-02-11T02:03:14Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2017-04-20T13:25:15Z"
      },
      "message": "fix ubsan: bitcoin-tx: not initialize context before IsFullyValid",
      "tree": {
        "sha": "c2bb05a147c5ccb6c32cac1d738df8c4394741b7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c2bb05a147c5ccb6c32cac1d738df8c4394741b7"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/321bbc2079e2dc3648ae4eaf845f5b71d30b423a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/321bbc2079e2dc3648ae4eaf845f5b71d30b423a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/321bbc2079e2dc3648ae4eaf845f5b71d30b423a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/321bbc2079e2dc3648ae4eaf845f5b71d30b423a/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f34cdcbd806d3e7c9d5dbac2a201755a4cc9828b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f34cdcbd806d3e7c9d5dbac2a201755a4cc9828b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f34cdcbd806d3e7c9d5dbac2a201755a4cc9828b"
      }
    ],
    "stats": {
      "total": 8,
      "additions": 5,
      "deletions": 3
    },
    "files": [
      {
        "sha": "4b64a96822ca16c1b21e97e43439c8a9bcc6a966",
        "filename": "src/bitcoin-tx.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 3,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/321bbc2079e2dc3648ae4eaf845f5b71d30b423a/src/bitcoin-tx.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/321bbc2079e2dc3648ae4eaf845f5b71d30b423a/src/bitcoin-tx.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoin-tx.cpp?ref=321bbc2079e2dc3648ae4eaf845f5b71d30b423a",
        "patch": "@@ -651,11 +651,13 @@ static void MutateTx(CMutableTransaction& tx, const std::string& command,\n         MutateTxDelOutput(tx, commandVal);\n     else if (command == \"outaddr\")\n         MutateTxAddOutAddr(tx, commandVal);\n-    else if (command == \"outpubkey\")\n+    else if (command == \"outpubkey\") {\n+        if (!ecc) { ecc.reset(new Secp256k1Init()); }\n         MutateTxAddOutPubKey(tx, commandVal);\n-    else if (command == \"outmultisig\")\n+    } else if (command == \"outmultisig\") {\n+        if (!ecc) { ecc.reset(new Secp256k1Init()); }\n         MutateTxAddOutMultiSig(tx, commandVal);\n-    else if (command == \"outscript\")\n+    } else if (command == \"outscript\")\n         MutateTxAddOutScript(tx, commandVal);\n     else if (command == \"outdata\")\n         MutateTxAddOutData(tx, commandVal);"
      }
    ]
  },
  {
    "sha": "1d31093d4d8501a5dc031413a963707f6cae0e0a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxZDMxMDkzZDRkODUwMWE1ZGMwMzE0MTNhOTYzNzA3ZjZjYWUwZTBh",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2017-02-11T20:37:05Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2017-04-20T13:25:15Z"
      },
      "message": "fix tsan: utiltime race on nMockTime",
      "tree": {
        "sha": "70eaa76b30a28540db0f93eace4e49a742c8ad07",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/70eaa76b30a28540db0f93eace4e49a742c8ad07"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1d31093d4d8501a5dc031413a963707f6cae0e0a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1d31093d4d8501a5dc031413a963707f6cae0e0a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/1d31093d4d8501a5dc031413a963707f6cae0e0a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1d31093d4d8501a5dc031413a963707f6cae0e0a/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "321bbc2079e2dc3648ae4eaf845f5b71d30b423a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/321bbc2079e2dc3648ae4eaf845f5b71d30b423a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/321bbc2079e2dc3648ae4eaf845f5b71d30b423a"
      }
    ],
    "stats": {
      "total": 12,
      "additions": 8,
      "deletions": 4
    },
    "files": [
      {
        "sha": "510f540b1d51b61c1f9d9447a7042e47c2475e24",
        "filename": "src/utiltime.cpp",
        "status": "modified",
        "additions": 8,
        "deletions": 4,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1d31093d4d8501a5dc031413a963707f6cae0e0a/src/utiltime.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1d31093d4d8501a5dc031413a963707f6cae0e0a/src/utiltime.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/utiltime.cpp?ref=1d31093d4d8501a5dc031413a963707f6cae0e0a",
        "patch": "@@ -9,14 +9,17 @@\n \n #include \"utiltime.h\"\n \n+#include <atomic>\n+\n #include <boost/date_time/posix_time/posix_time.hpp>\n #include <boost/thread.hpp>\n \n-static int64_t nMockTime = 0; //!< For unit testing\n+static std::atomic<int64_t> nMockTime(0); //!< For unit testing\n \n int64_t GetTime()\n {\n-    if (nMockTime) return nMockTime;\n+    int64_t mocktime = nMockTime.load(std::memory_order_relaxed);\n+    if (mocktime) return mocktime;\n \n     time_t now = time(NULL);\n     assert(now > 0);\n@@ -25,7 +28,7 @@ int64_t GetTime()\n \n void SetMockTime(int64_t nMockTimeIn)\n {\n-    nMockTime = nMockTimeIn;\n+    nMockTime.store(nMockTimeIn, std::memory_order_relaxed);\n }\n \n int64_t GetTimeMillis()\n@@ -52,7 +55,8 @@ int64_t GetSystemTimeInSeconds()\n /** Return a time useful for the debug log */\n int64_t GetLogTimeMicros()\n {\n-    if (nMockTime) return nMockTime*1000000;\n+    int64_t mocktime = nMockTime.load(std::memory_order_relaxed);\n+    if (mocktime) return mocktime*1000000;\n \n     return GetTimeMicros();\n }"
      }
    ]
  }
]