[
  {
    "sha": "bda84a08a0ac92dff6cadc99cf9bb8c3fadd7e13",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiZGE4NGEwOGEwYWM5MmRmZjZjYWRjOTljZjliYjhjM2ZhZGQ3ZTEz",
    "commit": {
      "author": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2020-03-31T15:07:33Z"
      },
      "committer": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2020-03-31T15:07:33Z"
      },
      "message": "rpc: Add documentation for deactivating settxfee",
      "tree": {
        "sha": "f2a049de0bd6c32cf69e92a4260c7678b76afa6e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f2a049de0bd6c32cf69e92a4260c7678b76afa6e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bda84a08a0ac92dff6cadc99cf9bb8c3fadd7e13",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQJJBAABCgAzFiEEtFq20ghhrCHSdrgm8T0enYkHmM0FAl6DXLUVHGZqYWhyQHBy\nb3Rvbm1haWwuY29tAAoJEPE9Hp2JB5jNTkkQAIsS67rlk+5boONfGfA9Z5cmukA3\nW4+bEI39cQfatybQf5aTaYoysbQkV0bob5eBJrQ9YKzTgeuBhsPbS8W5eRmLc9yd\nLKVq4+hezgE1u04cefs0esOV0ifi2gC5XpzfH3ERPYrzdcrVlhoEcJRVkGyxv5gc\nMg+XB6Dfaua0KA+AtfJg49tUaABngx0jYNLrupl0hK7sgiClAew22gdS/eAf09XL\nS/nrnCrvoJNmRnyk77Jcz8aRYKU3sX2OQnenlarIuk/ARAdKbASajqUwZYyi9q5u\nJ7yiF/vSldyV/KEXNCqig4jGcm5kPrPmIuB2RcEa8KhAdXHPBBmwg2L8o+dkLtNH\nO7sGwvM5jPjNAd/eW23OWDGjQZdvmiWCpGAi3R3GzUsZTm8kBjcAoPxxY29CQnoq\nq5GyY04tzNUvE2ly+bESl7Vnd2Nh+ehnJkT5e3u7xVkcP3e2pXMmcUyaBeDBAstk\n7bnKVc0tlx7sqURBIkuiK1tsQ0KQBPe2Jwd0nG7Ks2srwFLBVCHNXR7EJPsHJz7O\nerKuh8sSb4fxiHJpdOVnhwZGrRQeZwq89u4PCi0Gkc7Scm08UZhHQ9YIMRvzJQgs\nKWAdgeeqbYmxWW7l4erhfbn2diTfL8g4xNzBVNm7rlddgEPDARmosIArPUyE6i3k\n2rUZ2cYD/cFzkWuz\n=i43o\n-----END PGP SIGNATURE-----",
        "payload": "tree f2a049de0bd6c32cf69e92a4260c7678b76afa6e\nparent 5f9cd62f33fb4d440173b9c376cadf4887e81e9d\nauthor Fabian Jahr <fjahr@protonmail.com> 1585667253 +0200\ncommitter Fabian Jahr <fjahr@protonmail.com> 1585667253 +0200\n\nrpc: Add documentation for deactivating settxfee\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bda84a08a0ac92dff6cadc99cf9bb8c3fadd7e13",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/bda84a08a0ac92dff6cadc99cf9bb8c3fadd7e13",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bda84a08a0ac92dff6cadc99cf9bb8c3fadd7e13/comments",
    "author": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "5f9cd62f33fb4d440173b9c376cadf4887e81e9d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5f9cd62f33fb4d440173b9c376cadf4887e81e9d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5f9cd62f33fb4d440173b9c376cadf4887e81e9d"
      }
    ],
    "stats": {
      "total": 3,
      "additions": 2,
      "deletions": 1
    },
    "files": [
      {
        "sha": "3b8c0e83627f8ef18166e1f72a274d002635f784",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bda84a08a0ac92dff6cadc99cf9bb8c3fadd7e13/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bda84a08a0ac92dff6cadc99cf9bb8c3fadd7e13/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=bda84a08a0ac92dff6cadc99cf9bb8c3fadd7e13",
        "patch": "@@ -2318,7 +2318,8 @@ static UniValue settxfee(const JSONRPCRequest& request)\n     }\n \n             RPCHelpMan{\"settxfee\",\n-                \"\\nSet the transaction fee per kB for this wallet. Overrides the global -paytxfee command line parameter.\\n\",\n+                \"\\nSet the transaction fee per kB for this wallet. Overrides the global -paytxfee command line parameter.\\n\"\n+                \"Can be deactivated by passing 0 as the fee. In that case automatic fee selection will be used by default.\\n\",\n                 {\n                     {\"amount\", RPCArg::Type::AMOUNT, RPCArg::Optional::NO, \"The transaction fee in \" + CURRENCY_UNIT + \"/kB\"},\n                 },"
      }
    ]
  },
  {
    "sha": "38677274f931088218eeb1f258077d3387f39c89",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozODY3NzI3NGY5MzEwODgyMThlZWIxZjI1ODA3N2QzMzg3ZjM5Yzg5",
    "commit": {
      "author": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2020-03-30T19:59:04Z"
      },
      "committer": {
        "name": "Fabian Jahr",
        "email": "fjahr@protonmail.com",
        "date": "2020-04-14T13:52:42Z"
      },
      "message": "rpc: settxfee respects -maxtxfee wallet setting",
      "tree": {
        "sha": "677fe43a398920f65b935fb20666140b15164689",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/677fe43a398920f65b935fb20666140b15164689"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/38677274f931088218eeb1f258077d3387f39c89",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQJJBAABCgAzFiEEtFq20ghhrCHSdrgm8T0enYkHmM0FAl6VwCwVHGZqYWhyQHBy\nb3Rvbm1haWwuY29tAAoJEPE9Hp2JB5jN2J4P/jz+R0rS0Nl45EHpneUB15e9+m9R\nVjaXSJvMv7CtM6U0mh6dyFVvWNRbJdC0vtooLiZAbgBe7+hOCSbBUk+zj0RcNwgv\nnOtqIVDJT1D0cQVzfG9qIOnr+uPGcomiOg8rky/jy8J7EalFnQ6siz4HP3GgcnDr\n/iggx+59u+286Jwd6FYQu6rXl5p4+lXjmSYUo076wfS5eCX/eG8r2yC5GyWoK5sF\nM6g2j8sUJqXVoBJzFBvZriuyH4zTK58jM5YrMcmfsOXOauzasKTDzfg1gJvoFv9f\nluxhXMRfFAqAozJVVY/SGaBEbxRGzgEIzTfhP2+RZGrQkYiEUEd76ewljilYyZ7t\nPvP3O+E2X7nsh2k+UyHamjKFceRPRL/jTvba/6h42wPm+bQtYyJsn5PcyfzbVAJ9\nRJgtOsCoWUrQw9/QjWhgUgFimTLw3rhOCGbOMyxqqoshMZJpqjXmpz4Sz81ZSu4z\nwJDtAaXFWHAA4sa+aN5Tpzbj/JAseUAfiWVApa6ogt9t9jy15dInXT//Rb+ZWFVA\nxZHwloTRcNBneUlVUmTPZg1yONjHwkGixzqqfKZn97LBDiUVsr1iOL52EYnbitOz\nawpjRdzfgSfv4PTCNoxE4WCxzjKAcWxk363Anjus+iT6xHlVW1MhgIj+J7WnhjNY\nriHE+ZPdneydGRMz\n=D5xq\n-----END PGP SIGNATURE-----",
        "payload": "tree 677fe43a398920f65b935fb20666140b15164689\nparent bda84a08a0ac92dff6cadc99cf9bb8c3fadd7e13\nauthor Fabian Jahr <fjahr@protonmail.com> 1585598344 +0200\ncommitter Fabian Jahr <fjahr@protonmail.com> 1586872362 +0200\n\nrpc: settxfee respects -maxtxfee wallet setting\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/38677274f931088218eeb1f258077d3387f39c89",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/38677274f931088218eeb1f258077d3387f39c89",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/38677274f931088218eeb1f258077d3387f39c89/comments",
    "author": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fjahr",
      "id": 1322187,
      "node_id": "MDQ6VXNlcjEzMjIxODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1322187?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjahr",
      "html_url": "https://github.com/fjahr",
      "followers_url": "https://api.github.com/users/fjahr/followers",
      "following_url": "https://api.github.com/users/fjahr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjahr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjahr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjahr/subscriptions",
      "organizations_url": "https://api.github.com/users/fjahr/orgs",
      "repos_url": "https://api.github.com/users/fjahr/repos",
      "events_url": "https://api.github.com/users/fjahr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjahr/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "bda84a08a0ac92dff6cadc99cf9bb8c3fadd7e13",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bda84a08a0ac92dff6cadc99cf9bb8c3fadd7e13",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/bda84a08a0ac92dff6cadc99cf9bb8c3fadd7e13"
      }
    ],
    "stats": {
      "total": 18,
      "additions": 14,
      "deletions": 4
    },
    "files": [
      {
        "sha": "9a0dd1c574109740eededa6eef06e7d8a4facd5c",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/38677274f931088218eeb1f258077d3387f39c89/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/38677274f931088218eeb1f258077d3387f39c89/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=38677274f931088218eeb1f258077d3387f39c89",
        "patch": "@@ -2337,12 +2337,15 @@ static UniValue settxfee(const JSONRPCRequest& request)\n \n     CAmount nAmount = AmountFromValue(request.params[0]);\n     CFeeRate tx_fee_rate(nAmount, 1000);\n+    CFeeRate max_tx_fee_rate(pwallet->m_default_max_tx_fee, 1000);\n     if (tx_fee_rate == CFeeRate(0)) {\n         // automatic selection\n     } else if (tx_fee_rate < pwallet->chain().relayMinFee()) {\n         throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(\"txfee cannot be less than min relay tx fee (%s)\", pwallet->chain().relayMinFee().ToString()));\n     } else if (tx_fee_rate < pwallet->m_min_fee) {\n         throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(\"txfee cannot be less than wallet min fee (%s)\", pwallet->m_min_fee.ToString()));\n+    } else if (tx_fee_rate > max_tx_fee_rate) {\n+        throw JSONRPCError(RPC_INVALID_PARAMETER, strprintf(\"txfee cannot be more than wallet max tx fee (%s)\", max_tx_fee_rate.ToString()));\n     }\n \n     pwallet->m_pay_tx_fee = tx_fee_rate;"
      },
      {
        "sha": "4fd16ecfa17e25de5abff3ce40a9a9e6690a6d22",
        "filename": "test/functional/wallet_bumpfee.py",
        "status": "modified",
        "additions": 8,
        "deletions": 2,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/38677274f931088218eeb1f258077d3387f39c89/test/functional/wallet_bumpfee.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/38677274f931088218eeb1f258077d3387f39c89/test/functional/wallet_bumpfee.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_bumpfee.py?ref=38677274f931088218eeb1f258077d3387f39c89",
        "patch": "@@ -82,14 +82,14 @@ def run_test(self):\n         test_notmine_bumpfee_fails(self, rbf_node, peer_node, dest_address)\n         test_bumpfee_with_descendant_fails(self, rbf_node, rbf_node_address, dest_address)\n         test_dust_to_fee(self, rbf_node, dest_address)\n-        test_settxfee(self, rbf_node, dest_address)\n         test_watchonly_psbt(self, peer_node, rbf_node, dest_address)\n         test_rebumping(self, rbf_node, dest_address)\n         test_rebumping_not_replaceable(self, rbf_node, dest_address)\n         test_unconfirmed_not_spendable(self, rbf_node, rbf_node_address)\n         test_bumpfee_metadata(self, rbf_node, dest_address)\n         test_locked_wallet_fails(self, rbf_node, dest_address)\n         test_change_script_match(self, rbf_node, dest_address)\n+        test_settxfee(self, rbf_node, dest_address)\n         test_maxtxfee_fails(self, rbf_node, dest_address)\n         # These tests wipe out a number of utxos that are expected in other tests\n         test_small_output_with_feerate_succeeds(self, rbf_node, dest_address)\n@@ -281,9 +281,15 @@ def test_settxfee(self, rbf_node, dest_address):\n     assert_greater_than(Decimal(\"0.00001000\"), abs(requested_feerate - actual_feerate))\n     rbf_node.settxfee(Decimal(\"0.00000000\"))  # unset paytxfee\n \n+    # check that settxfee respects -maxtxfee\n+    self.restart_node(1, ['-maxtxfee=0.000025'] + self.extra_args[1])\n+    assert_raises_rpc_error(-8, \"txfee cannot be more than wallet max tx fee\", rbf_node.settxfee, Decimal('0.00003'))\n+    self.restart_node(1, self.extra_args[1])\n+    rbf_node.walletpassphrase(WALLET_PASSPHRASE, WALLET_PASSPHRASE_TIMEOUT)\n+\n \n def test_maxtxfee_fails(self, rbf_node, dest_address):\n-    self.log.info('Test that bumpfee fails when it hits -matxfee')\n+    self.log.info('Test that bumpfee fails when it hits -maxtxfee')\n     # size of bumped transaction (p2wpkh, 1 input, 2 outputs): 141 vbytes\n     # expected bump fee of 141 vbytes * 0.00200000 BTC / 1000 vbytes = 0.00002820 BTC\n     # which exceeds maxtxfee and is expected to raise"
      },
      {
        "sha": "d2bdc6fe1ac3b561d5f2960a18ea99cb89e4cd41",
        "filename": "test/functional/wallet_multiwallet.py",
        "status": "modified",
        "additions": 3,
        "deletions": 2,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/38677274f931088218eeb1f258077d3387f39c89/test/functional/wallet_multiwallet.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/38677274f931088218eeb1f258077d3387f39c89/test/functional/wallet_multiwallet.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_multiwallet.py?ref=38677274f931088218eeb1f258077d3387f39c89",
        "patch": "@@ -6,6 +6,7 @@\n \n Verify that a bitcoind node can load multiple wallet files\n \"\"\"\n+from decimal import Decimal\n import os\n import shutil\n import time\n@@ -193,9 +194,9 @@ def wallet_file(name):\n         self.log.info('Check for per-wallet settxfee call')\n         assert_equal(w1.getwalletinfo()['paytxfee'], 0)\n         assert_equal(w2.getwalletinfo()['paytxfee'], 0)\n-        w2.settxfee(4.0)\n+        w2.settxfee(0.001)\n         assert_equal(w1.getwalletinfo()['paytxfee'], 0)\n-        assert_equal(w2.getwalletinfo()['paytxfee'], 4.0)\n+        assert_equal(w2.getwalletinfo()['paytxfee'], Decimal('0.00100000'))\n \n         self.log.info(\"Test dynamic wallet loading\")\n "
      }
    ]
  }
]