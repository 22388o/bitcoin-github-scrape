[
  {
    "sha": "fac174e2d17e06b63aa5eb20b404af00d38db26e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYWMxNzRlMmQxN2UwNmI2M2FhNWViMjBiNDA0YWYwMGQzOGRiMjZl",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-04-28T14:33:22Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-04-28T16:43:50Z"
      },
      "message": "lint: Check that all wallet args are hidden",
      "tree": {
        "sha": "cc7b7444695a689c71d02277c1f2b39660fa0ae9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cc7b7444695a689c71d02277c1f2b39660fa0ae9"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fac174e2d17e06b63aa5eb20b404af00d38db26e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUhnnAwAtjUZGcSaIcGHL5+FnMjFxQysRZthzYjAhQOlDp62mrulG4H6dMY869o+\nQvSgDpFVumQIBV3bvAlF0NWi41ir1SYaoujzTa44Ggv1hMX/RdlkHrsAsSRFiqmu\neusCUDqpiDK5eeBcBCJzyvbLXdbBsToSlhHN0YQYsOPAUiyju4WsXAvPo274P7AF\nmD9coZ9zdzBZTno4/sItScEZwM70MUzbkOJ3Pai68fIM30g7jnWPm10ZrSC0DBc2\nn9gNETIFhXUHkSX6YRya2mDvsEnFpCfIUf7mihxDZCYwq5nQMoM8OVnRHm0jHikS\nK61T+U1Ni+US7SD2jTxyaQnH1GKTF5AqREkURJjYI+Mrrq1/3cgDm1z1VuL7GxMD\nOyxhlJrH1iskVM3G/lVv1Q4m/Ef1fTINzZMHbR0JOvfhAQBrt8NA+uAVWB219GdT\nlWYiBZFxGMIxtNAvWgOxX1bum9TYr5qYDgWAnctlqvrXa5fLMrz6yuanYNlpVHv1\nR1wrNQp1\n=53PJ\n-----END PGP SIGNATURE-----",
        "payload": "tree cc7b7444695a689c71d02277c1f2b39660fa0ae9\nparent 765d5890be46ed5f5557c1d2b3cb931e6b8eb3b0\nauthor MarcoFalke <falke.marco@gmail.com> 1556462002 -0400\ncommitter MarcoFalke <falke.marco@gmail.com> 1556469830 -0400\n\nlint: Check that all wallet args are hidden\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fac174e2d17e06b63aa5eb20b404af00d38db26e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fac174e2d17e06b63aa5eb20b404af00d38db26e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fac174e2d17e06b63aa5eb20b404af00d38db26e/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "765d5890be46ed5f5557c1d2b3cb931e6b8eb3b0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/765d5890be46ed5f5557c1d2b3cb931e6b8eb3b0",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/765d5890be46ed5f5557c1d2b3cb931e6b8eb3b0"
      }
    ],
    "stats": {
      "total": 34,
      "additions": 24,
      "deletions": 10
    },
    "files": [
      {
        "sha": "1d6122a13dbf35080ebb5dce7192a104f296f68f",
        "filename": "test/lint/check-doc.py",
        "status": "modified",
        "additions": 24,
        "deletions": 10,
        "changes": 34,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fac174e2d17e06b63aa5eb20b404af00d38db26e/test/lint/check-doc.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fac174e2d17e06b63aa5eb20b404af00d38db26e/test/lint/check-doc.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/lint/check-doc.py?ref=fac174e2d17e06b63aa5eb20b404af00d38db26e",
        "patch": "@@ -12,26 +12,23 @@\n \n from subprocess import check_output\n import re\n-import sys\n \n FOLDER_GREP = 'src'\n FOLDER_TEST = 'src/test/'\n REGEX_ARG = '(?:ForceSet|SoftSet|Get|Is)(?:Bool)?Args?(?:Set)?\\(\"(-[^\"]+)\"'\n REGEX_DOC = 'AddArg\\(\"(-[^\"=]+?)(?:=|\")'\n-CMD_ROOT_DIR = '`git rev-parse --show-toplevel`/{}'.format(FOLDER_GREP)\n+CMD_ROOT_DIR = '$(git rev-parse --show-toplevel)/{}'.format(FOLDER_GREP)\n CMD_GREP_ARGS = r\"git grep --perl-regexp '{}' -- {} ':(exclude){}'\".format(REGEX_ARG, CMD_ROOT_DIR, FOLDER_TEST)\n+CMD_GREP_WALLET_ARGS = r\"git grep --function-context 'void WalletInit::AddWalletOptions' -- {} | grep AddArg\".format(CMD_ROOT_DIR)\n+CMD_GREP_WALLET_HIDDEN_ARGS = r\"git grep --function-context 'void DummyWalletInit::AddWalletOptions' -- {}\".format(CMD_ROOT_DIR)\n CMD_GREP_DOCS = r\"git grep --perl-regexp '{}' {}\".format(REGEX_DOC, CMD_ROOT_DIR)\n # list unsupported, deprecated and duplicate args as they need no documentation\n SET_DOC_OPTIONAL = set(['-h', '-help', '-dbcrashratio', '-forcecompactdb'])\n \n \n-def main():\n-    if sys.version_info >= (3, 6):\n-        used = check_output(CMD_GREP_ARGS, shell=True, universal_newlines=True, encoding='utf8')\n-        docd = check_output(CMD_GREP_DOCS, shell=True, universal_newlines=True, encoding='utf8')\n-    else:\n-        used = check_output(CMD_GREP_ARGS, shell=True).decode('utf8').strip()\n-        docd = check_output(CMD_GREP_DOCS, shell=True).decode('utf8').strip()\n+def lint_missing_argument_documentation():\n+    used = check_output(CMD_GREP_ARGS, shell=True).decode('utf8').strip()\n+    docd = check_output(CMD_GREP_DOCS, shell=True).decode('utf8').strip()\n \n     args_used = set(re.findall(re.compile(REGEX_ARG), used))\n     args_docd = set(re.findall(re.compile(REGEX_DOC), docd)).union(SET_DOC_OPTIONAL)\n@@ -45,7 +42,24 @@ def main():\n     print(\"Args unknown     : {}\".format(len(args_unknown)))\n     print(args_unknown)\n \n-    sys.exit(len(args_need_doc))\n+    assert 0 == len(args_need_doc), \"Please document the following arguments: {}\".format(args_need_doc)\n+\n+\n+def lint_missing_hidden_wallet_args():\n+    wallet_args = check_output(CMD_GREP_WALLET_ARGS, shell=True).decode('utf8').strip()\n+    wallet_hidden_args = check_output(CMD_GREP_WALLET_HIDDEN_ARGS, shell=True).decode('utf8').strip()\n+\n+    wallet_args = set(re.findall(re.compile(REGEX_DOC), wallet_args))\n+    wallet_hidden_args = set(re.findall(re.compile(r'    \"([^\"=]+)'), wallet_hidden_args))\n+\n+    hidden_missing = wallet_args.difference(wallet_hidden_args)\n+    if hidden_missing:\n+        assert 0, \"Please add {} to the hidden args in DummyWalletInit::AddWalletOptions\".format(hidden_missing)\n+\n+\n+def main():\n+    lint_missing_argument_documentation()\n+    lint_missing_hidden_wallet_args()\n \n \n if __name__ == \"__main__\":"
      }
    ]
  }
]