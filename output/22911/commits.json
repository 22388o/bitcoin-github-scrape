[
  {
    "sha": "07a9eccb60485e71494664cc2b1964ae06a3dcf0",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowN2E5ZWNjYjYwNDg1ZTcxNDk0NjY0Y2MyYjE5NjRhZTA2YTNkY2Yw",
    "commit": {
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-09-01T13:14:21Z"
      },
      "committer": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-09-07T09:14:50Z"
      },
      "message": "[net] Remove CConnman::Options.m_asmap\n\nThis data member was introduced in ec45646de9e but never used.",
      "tree": {
        "sha": "53203984916f8e8c5db410a748538818c1525a75",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/53203984916f8e8c5db410a748538818c1525a75"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/07a9eccb60485e71494664cc2b1964ae06a3dcf0",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/07a9eccb60485e71494664cc2b1964ae06a3dcf0",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/07a9eccb60485e71494664cc2b1964ae06a3dcf0",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/07a9eccb60485e71494664cc2b1964ae06a3dcf0/comments",
    "author": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "9393666e7817c6d745789144f3a1ac61fe6cdecf",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9393666e7817c6d745789144f3a1ac61fe6cdecf",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9393666e7817c6d745789144f3a1ac61fe6cdecf"
      }
    ],
    "stats": {
      "total": 1,
      "additions": 0,
      "deletions": 1
    },
    "files": [
      {
        "sha": "e7ad959fd9317f9c1b3329d7daaf9e7fbe968ace",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 0,
        "deletions": 1,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/07a9eccb60485e71494664cc2b1964ae06a3dcf0/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/07a9eccb60485e71494664cc2b1964ae06a3dcf0/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=07a9eccb60485e71494664cc2b1964ae06a3dcf0",
        "patch": "@@ -768,7 +768,6 @@ class CConnman\n         bool m_use_addrman_outgoing = true;\n         std::vector<std::string> m_specified_outgoing;\n         std::vector<std::string> m_added_nodes;\n-        std::vector<bool> m_asmap;\n         bool m_i2p_accept_incoming;\n     };\n "
      }
    ]
  },
  {
    "sha": "bfdf4ef334a16ef6108a658bf4f8514754128c18",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiZmRmNGVmMzM0YTE2ZWY2MTA4YTY1OGJmNGY4NTE0NzU0MTI4YzE4",
    "commit": {
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-09-07T12:31:10Z"
      },
      "committer": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-09-07T12:31:10Z"
      },
      "message": "[asmap] Remove SanityCheckASMap() from netaddress\n\nSanityCheckASMap(asmap, bits) simply calls through to SanityCheckASMap(asmap)\nin util/asmap. Update all callers to simply call that function.",
      "tree": {
        "sha": "d26a8ee394821720ca9b5e67180dc0352c69ff30",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d26a8ee394821720ca9b5e67180dc0352c69ff30"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bfdf4ef334a16ef6108a658bf4f8514754128c18",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bfdf4ef334a16ef6108a658bf4f8514754128c18",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/bfdf4ef334a16ef6108a658bf4f8514754128c18",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bfdf4ef334a16ef6108a658bf4f8514754128c18/comments",
    "author": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "07a9eccb60485e71494664cc2b1964ae06a3dcf0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/07a9eccb60485e71494664cc2b1964ae06a3dcf0",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/07a9eccb60485e71494664cc2b1964ae06a3dcf0"
      }
    ],
    "stats": {
      "total": 18,
      "additions": 7,
      "deletions": 11
    },
    "files": [
      {
        "sha": "fd0d3dc6fa8f613cfa45bb888c47c38b7dad87ca",
        "filename": "src/addrman.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bfdf4ef334a16ef6108a658bf4f8514754128c18/src/addrman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bfdf4ef334a16ef6108a658bf4f8514754128c18/src/addrman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.cpp?ref=bfdf4ef334a16ef6108a658bf4f8514754128c18",
        "patch": "@@ -9,6 +9,7 @@\n #include <logging.h>\n #include <netaddress.h>\n #include <serialize.h>\n+#include <util/asmap.h>\n \n #include <cmath>\n #include <optional>\n@@ -1028,7 +1029,7 @@ std::vector<bool> CAddrMan::DecodeAsmap(fs::path path)\n             bits.push_back((cur_byte >> bit) & 1);\n         }\n     }\n-    if (!SanityCheckASMap(bits)) {\n+    if (!SanityCheckASMap(bits, 128)) {\n         LogPrintf(\"Sanity check of asmap file %s failed\\n\", path);\n         return {};\n     }"
      },
      {
        "sha": "b2f4945e3bc816d7fc60c09da84f64924fcc4e21",
        "filename": "src/netaddress.cpp",
        "status": "modified",
        "additions": 0,
        "deletions": 5,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bfdf4ef334a16ef6108a658bf4f8514754128c18/src/netaddress.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bfdf4ef334a16ef6108a658bf4f8514754128c18/src/netaddress.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/netaddress.cpp?ref=bfdf4ef334a16ef6108a658bf4f8514754128c18",
        "patch": "@@ -1242,8 +1242,3 @@ bool operator<(const CSubNet& a, const CSubNet& b)\n {\n     return (a.network < b.network || (a.network == b.network && memcmp(a.netmask, b.netmask, 16) < 0));\n }\n-\n-bool SanityCheckASMap(const std::vector<bool>& asmap)\n-{\n-    return SanityCheckASMap(asmap, 128); // For IP address lookups, the input is 128 bits\n-}"
      },
      {
        "sha": "cfb2edcd34b2d68155824d23dec61e8b28b8fe13",
        "filename": "src/netaddress.h",
        "status": "modified",
        "additions": 0,
        "deletions": 2,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bfdf4ef334a16ef6108a658bf4f8514754128c18/src/netaddress.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bfdf4ef334a16ef6108a658bf4f8514754128c18/src/netaddress.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/netaddress.h?ref=bfdf4ef334a16ef6108a658bf4f8514754128c18",
        "patch": "@@ -567,6 +567,4 @@ class CService : public CNetAddr\n     }\n };\n \n-bool SanityCheckASMap(const std::vector<bool>& asmap);\n-\n #endif // BITCOIN_NETADDRESS_H"
      },
      {
        "sha": "fdbfb3b93b33ad80450a70ae2f1a8415707c23f5",
        "filename": "src/test/fuzz/addrman.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bfdf4ef334a16ef6108a658bf4f8514754128c18/src/test/fuzz/addrman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bfdf4ef334a16ef6108a658bf4f8514754128c18/src/test/fuzz/addrman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/addrman.cpp?ref=bfdf4ef334a16ef6108a658bf4f8514754128c18",
        "patch": "@@ -221,7 +221,7 @@ class CAddrManDeterministic : public CAddrMan\n [[nodiscard]] inline std::vector<bool> ConsumeAsmap(FuzzedDataProvider& fuzzed_data_provider) noexcept\n {\n     std::vector<bool> asmap = ConsumeRandomLengthBitVector(fuzzed_data_provider);\n-    if (!SanityCheckASMap(asmap)) asmap.clear();\n+    if (!SanityCheckASMap(asmap, 128)) asmap.clear();\n     return asmap;\n }\n "
      },
      {
        "sha": "d402f8632ca4d9f9eeb685058a4ef8c50963b868",
        "filename": "src/test/fuzz/asmap.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bfdf4ef334a16ef6108a658bf4f8514754128c18/src/test/fuzz/asmap.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bfdf4ef334a16ef6108a658bf4f8514754128c18/src/test/fuzz/asmap.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/asmap.cpp?ref=bfdf4ef334a16ef6108a658bf4f8514754128c18",
        "patch": "@@ -4,6 +4,7 @@\n \n #include <netaddress.h>\n #include <test/fuzz/fuzz.h>\n+#include <util/asmap.h>\n \n #include <cstdint>\n #include <vector>\n@@ -42,7 +43,7 @@ FUZZ_TARGET(asmap)\n             asmap.push_back((buffer[1 + i] >> j) & 1);\n         }\n     }\n-    if (!SanityCheckASMap(asmap)) return;\n+    if (!SanityCheckASMap(asmap, 128)) return;\n \n     const uint8_t* addr_data = buffer.data() + 1 + asmap_size;\n     CNetAddr net_addr;"
      },
      {
        "sha": "09293760457e1738f39bc696f850c4ef4db75df8",
        "filename": "src/test/fuzz/net.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bfdf4ef334a16ef6108a658bf4f8514754128c18/src/test/fuzz/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bfdf4ef334a16ef6108a658bf4f8514754128c18/src/test/fuzz/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/net.cpp?ref=bfdf4ef334a16ef6108a658bf4f8514754128c18",
        "patch": "@@ -14,6 +14,7 @@\n #include <test/fuzz/util.h>\n #include <test/util/net.h>\n #include <test/util/setup_common.h>\n+#include <util/asmap.h>\n \n #include <cstdint>\n #include <optional>\n@@ -39,7 +40,7 @@ FUZZ_TARGET_INIT(net, initialize_net)\n             },\n             [&] {\n                 const std::vector<bool> asmap = ConsumeRandomLengthBitVector(fuzzed_data_provider);\n-                if (!SanityCheckASMap(asmap)) {\n+                if (!SanityCheckASMap(asmap, 128)) {\n                     return;\n                 }\n                 CNodeStats stats;"
      }
    ]
  },
  {
    "sha": "9fd5618610e91e3949536c5122cf31eb58c9aa6b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5ZmQ1NjE4NjEwZTkxZTM5NDk1MzZjNTEyMmNmMzFlYjU4YzlhYTZi",
    "commit": {
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-09-01T11:41:47Z"
      },
      "committer": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-09-07T14:24:00Z"
      },
      "message": "[asmap] Make DecodeAsmap() a utility function\n\nDecopeAsmap is a pure utility function and doesn't have any\ndependencies on addrman, so move it to util/asmap.\n\nReviewer hint: use:\n\n`git diff --color-moved=dimmed-zebra --color-moved-ws=ignore-all-space`",
      "tree": {
        "sha": "733d7b61305784b61a4c3b2a00b6947c8a42c935",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/733d7b61305784b61a4c3b2a00b6947c8a42c935"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9fd5618610e91e3949536c5122cf31eb58c9aa6b",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9fd5618610e91e3949536c5122cf31eb58c9aa6b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9fd5618610e91e3949536c5122cf31eb58c9aa6b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9fd5618610e91e3949536c5122cf31eb58c9aa6b/comments",
    "author": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "bfdf4ef334a16ef6108a658bf4f8514754128c18",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bfdf4ef334a16ef6108a658bf4f8514754128c18",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/bfdf4ef334a16ef6108a658bf4f8514754128c18"
      }
    ],
    "stats": {
      "total": 78,
      "additions": 43,
      "deletions": 35
    },
    "files": [
      {
        "sha": "49226dde42cf0c4b333f4e06ba14c21078334bf4",
        "filename": "src/addrman.cpp",
        "status": "modified",
        "additions": 0,
        "deletions": 28,
        "changes": 28,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9fd5618610e91e3949536c5122cf31eb58c9aa6b/src/addrman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9fd5618610e91e3949536c5122cf31eb58c9aa6b/src/addrman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.cpp?ref=9fd5618610e91e3949536c5122cf31eb58c9aa6b",
        "patch": "@@ -9,7 +9,6 @@\n #include <logging.h>\n #include <netaddress.h>\n #include <serialize.h>\n-#include <util/asmap.h>\n \n #include <cmath>\n #include <optional>\n@@ -1008,30 +1007,3 @@ CAddrInfo CAddrMan::SelectTriedCollision_()\n \n     return mapInfo[id_old];\n }\n-\n-std::vector<bool> CAddrMan::DecodeAsmap(fs::path path)\n-{\n-    std::vector<bool> bits;\n-    FILE *filestr = fsbridge::fopen(path, \"rb\");\n-    CAutoFile file(filestr, SER_DISK, CLIENT_VERSION);\n-    if (file.IsNull()) {\n-        LogPrintf(\"Failed to open asmap file from disk\\n\");\n-        return bits;\n-    }\n-    fseek(filestr, 0, SEEK_END);\n-    int length = ftell(filestr);\n-    LogPrintf(\"Opened asmap file %s (%d bytes) from disk\\n\", path, length);\n-    fseek(filestr, 0, SEEK_SET);\n-    uint8_t cur_byte;\n-    for (int i = 0; i < length; ++i) {\n-        file >> cur_byte;\n-        for (int bit = 0; bit < 8; ++bit) {\n-            bits.push_back((cur_byte >> bit) & 1);\n-        }\n-    }\n-    if (!SanityCheckASMap(bits, 128)) {\n-        LogPrintf(\"Sanity check of asmap file %s failed\\n\", path);\n-        return {};\n-    }\n-    return bits;\n-}"
      },
      {
        "sha": "48e0f8b8713a34216277142afbfce9e12d9344bf",
        "filename": "src/addrman.h",
        "status": "modified",
        "additions": 0,
        "deletions": 3,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9fd5618610e91e3949536c5122cf31eb58c9aa6b/src/addrman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9fd5618610e91e3949536c5122cf31eb58c9aa6b/src/addrman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.h?ref=9fd5618610e91e3949536c5122cf31eb58c9aa6b",
        "patch": "@@ -149,9 +149,6 @@ static constexpr int ADDRMAN_BUCKET_SIZE{1 << ADDRMAN_BUCKET_SIZE_LOG2};\n class CAddrMan\n {\n public:\n-    // Read asmap from provided binary file\n-    static std::vector<bool> DecodeAsmap(fs::path path);\n-\n     template <typename Stream>\n     void Serialize(Stream& s_) const EXCLUSIVE_LOCKS_REQUIRED(!cs);\n "
      },
      {
        "sha": "1d18d80ec4a713ebe08efb131e00c8593f56d8ad",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9fd5618610e91e3949536c5122cf31eb58c9aa6b/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9fd5618610e91e3949536c5122cf31eb58c9aa6b/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=9fd5618610e91e3949536c5122cf31eb58c9aa6b",
        "patch": "@@ -1189,7 +1189,7 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n                 InitError(strprintf(_(\"Could not find asmap file %s\"), asmap_path));\n                 return false;\n             }\n-            asmap = CAddrMan::DecodeAsmap(asmap_path);\n+            asmap = DecodeAsmap(asmap_path);\n             if (asmap.size() == 0) {\n                 InitError(strprintf(_(\"Could not parse asmap file %s\"), asmap_path));\n                 return false;"
      },
      {
        "sha": "5695c620125c9a27372621176b4cc54aba8d00ca",
        "filename": "src/util/asmap.cpp",
        "status": "modified",
        "additions": 36,
        "deletions": 2,
        "changes": 38,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9fd5618610e91e3949536c5122cf31eb58c9aa6b/src/util/asmap.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9fd5618610e91e3949536c5122cf31eb58c9aa6b/src/util/asmap.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util/asmap.cpp?ref=9fd5618610e91e3949536c5122cf31eb58c9aa6b",
        "patch": "@@ -2,10 +2,16 @@\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n+#include <util/asmap.h>\n+\n+#include <clientversion.h>\n+#include <crypto/common.h>\n+#include <logging.h>\n+#include <streams.h>\n+\n+#include <cassert>\n #include <map>\n #include <vector>\n-#include <assert.h>\n-#include <crypto/common.h>\n \n namespace {\n \n@@ -183,3 +189,31 @@ bool SanityCheckASMap(const std::vector<bool>& asmap, int bits)\n     }\n     return false; // Reached EOF without RETURN instruction\n }\n+\n+std::vector<bool> DecodeAsmap(fs::path path)\n+{\n+    std::vector<bool> bits;\n+    FILE *filestr = fsbridge::fopen(path, \"rb\");\n+    CAutoFile file(filestr, SER_DISK, CLIENT_VERSION);\n+    if (file.IsNull()) {\n+        LogPrintf(\"Failed to open asmap file from disk\\n\");\n+        return bits;\n+    }\n+    fseek(filestr, 0, SEEK_END);\n+    int length = ftell(filestr);\n+    LogPrintf(\"Opened asmap file %s (%d bytes) from disk\\n\", path, length);\n+    fseek(filestr, 0, SEEK_SET);\n+    uint8_t cur_byte;\n+    for (int i = 0; i < length; ++i) {\n+        file >> cur_byte;\n+        for (int bit = 0; bit < 8; ++bit) {\n+            bits.push_back((cur_byte >> bit) & 1);\n+        }\n+    }\n+    if (!SanityCheckASMap(bits, 128)) {\n+        LogPrintf(\"Sanity check of asmap file %s failed\\n\", path);\n+        return {};\n+    }\n+    return bits;\n+}\n+"
      },
      {
        "sha": "810d70b9a1af1389b70af3bb95042c34d6a44612",
        "filename": "src/util/asmap.h",
        "status": "modified",
        "additions": 6,
        "deletions": 1,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9fd5618610e91e3949536c5122cf31eb58c9aa6b/src/util/asmap.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9fd5618610e91e3949536c5122cf31eb58c9aa6b/src/util/asmap.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util/asmap.h?ref=9fd5618610e91e3949536c5122cf31eb58c9aa6b",
        "patch": "@@ -5,11 +5,16 @@\n #ifndef BITCOIN_UTIL_ASMAP_H\n #define BITCOIN_UTIL_ASMAP_H\n \n-#include <stdint.h>\n+#include <fs.h>\n+\n+#include <cstdint>\n #include <vector>\n \n uint32_t Interpret(const std::vector<bool> &asmap, const std::vector<bool> &ip);\n \n bool SanityCheckASMap(const std::vector<bool>& asmap, int bits);\n \n+/** Read asmap from provided binary file */\n+std::vector<bool> DecodeAsmap(fs::path path);\n+\n #endif // BITCOIN_UTIL_ASMAP_H"
      }
    ]
  },
  {
    "sha": "853c4edb70f897a6a7165abaea4a303d7d448721",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4NTNjNGVkYjcwZjg5N2E2YTcxNjVhYmFlYTRhMzAzZDdkNDQ4NzIx",
    "commit": {
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-09-01T10:24:46Z"
      },
      "committer": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2021-09-07T14:24:14Z"
      },
      "message": "[net] Remove asmap argument from CNode::CopyStats()\n\nThis saves passing around a reference to the asmap std::vector<bool>.",
      "tree": {
        "sha": "0f2e63ecf7e36dbf39b35505ddd35dd8d1b93000",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0f2e63ecf7e36dbf39b35505ddd35dd8d1b93000"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/853c4edb70f897a6a7165abaea4a303d7d448721",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/853c4edb70f897a6a7165abaea4a303d7d448721",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/853c4edb70f897a6a7165abaea4a303d7d448721",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/853c4edb70f897a6a7165abaea4a303d7d448721/comments",
    "author": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "9fd5618610e91e3949536c5122cf31eb58c9aa6b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9fd5618610e91e3949536c5122cf31eb58c9aa6b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9fd5618610e91e3949536c5122cf31eb58c9aa6b"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 5,
      "deletions": 9
    },
    "files": [
      {
        "sha": "c8a6e2c76355e7722e0fc7efd001fb9de210d6fa",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 3,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/853c4edb70f897a6a7165abaea4a303d7d448721/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/853c4edb70f897a6a7165abaea4a303d7d448721/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=853c4edb70f897a6a7165abaea4a303d7d448721",
        "patch": "@@ -552,14 +552,13 @@ Network CNode::ConnectedThroughNetwork() const\n \n #undef X\n #define X(name) stats.name = name\n-void CNode::CopyStats(CNodeStats& stats, const std::vector<bool>& asmap)\n+void CNode::CopyStats(CNodeStats& stats)\n {\n     stats.nodeid = this->GetId();\n     X(nServices);\n     X(addr);\n     X(addrBind);\n     stats.m_network = ConnectedThroughNetwork();\n-    stats.m_mapped_as = addr.GetMappedAS(asmap);\n     if (m_tx_relay != nullptr) {\n         LOCK(m_tx_relay->cs_filter);\n         stats.fRelayTxes = m_tx_relay->fRelayTxes;\n@@ -2804,7 +2803,8 @@ void CConnman::GetNodeStats(std::vector<CNodeStats>& vstats) const\n     vstats.reserve(vNodes.size());\n     for (CNode* pnode : vNodes) {\n         vstats.emplace_back();\n-        pnode->CopyStats(vstats.back(), addrman.GetAsmap());\n+        pnode->CopyStats(vstats.back());\n+        vstats.back().m_mapped_as = pnode->addr.GetMappedAS(addrman.GetAsmap());\n     }\n }\n "
      },
      {
        "sha": "1479861bc2728cd70afec646c38a4cdcdfe58c4a",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/853c4edb70f897a6a7165abaea4a303d7d448721/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/853c4edb70f897a6a7165abaea4a303d7d448721/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=853c4edb70f897a6a7165abaea4a303d7d448721",
        "patch": "@@ -652,7 +652,7 @@ class CNode\n \n     void CloseSocketDisconnect();\n \n-    void CopyStats(CNodeStats& stats, const std::vector<bool>& asmap);\n+    void CopyStats(CNodeStats& stats);\n \n     ServiceFlags GetLocalServices() const\n     {"
      },
      {
        "sha": "bd1bb79d0ee39755b1dfc5df34985eed3423b89c",
        "filename": "src/test/fuzz/net.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 5,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/853c4edb70f897a6a7165abaea4a303d7d448721/src/test/fuzz/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/853c4edb70f897a6a7165abaea4a303d7d448721/src/test/fuzz/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/net.cpp?ref=853c4edb70f897a6a7165abaea4a303d7d448721",
        "patch": "@@ -39,12 +39,8 @@ FUZZ_TARGET_INIT(net, initialize_net)\n                 node.CloseSocketDisconnect();\n             },\n             [&] {\n-                const std::vector<bool> asmap = ConsumeRandomLengthBitVector(fuzzed_data_provider);\n-                if (!SanityCheckASMap(asmap, 128)) {\n-                    return;\n-                }\n                 CNodeStats stats;\n-                node.CopyStats(stats, asmap);\n+                node.CopyStats(stats);\n             },\n             [&] {\n                 const CNode* add_ref_node = node.AddRef();"
      }
    ]
  }
]