[
  {
    "sha": "9bb59cf7baea0b33d97ef0c0eeee88a8b104be3a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5YmI1OWNmN2JhZWEwYjMzZDk3ZWYwYzBlZWVlODhhOGIxMDRiZTNh",
    "commit": {
      "author": {
        "name": "Jorge Tim\u00f3n",
        "email": "jtimon@jtimon.cc",
        "date": "2017-08-31T23:57:45Z"
      },
      "committer": {
        "name": "Jorge Tim\u00f3n",
        "email": "jtimon@jtimon.cc",
        "date": "2018-01-31T21:39:58Z"
      },
      "message": "QA: segwit.py: s/find_unspent/find_spendable_utxo/",
      "tree": {
        "sha": "d86de5981a477ab1b95681f9f0c15580b32abc0a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d86de5981a477ab1b95681f9f0c15580b32abc0a"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9bb59cf7baea0b33d97ef0c0eeee88a8b104be3a",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v2\n\niQIcBAABCAAGBQJacjeuAAoJEIhmwY6hyUSi4csQAJN51jNCoM8jhquw2en5BZwq\n2Uepu9+JmrNxI1BGhrAarVD5QImcz3gsmqGShxNST5+huxeRbrC5aMxSPjmF3Hys\nY9xJfUBmoPZSLMDM6F3zD4QEhuZcMNsZV/gO7TXvTXvQMSwvuyCl+v0VUsuV2qrE\nsYwQVvsKoURdzBdDkRu9h0Yz4EYULX1UhhpkRRyL21UDm4lR07WdY/XoV3WzA/OW\nXq7oGuO3IqLfi3D39PfZP4Sge+P1qcXEBjR4Wet8zT6O+Ilk8CHKmw0rLBcL6rcK\nuJMSUvhD8e+E4zwDYejdnYzLpcI3alnCp4orBrdVKJJukNVzgVriQeXg5EHmub3d\nEJkFPbSj+QcrB3B+h7B89Fh2qOr4yfgGLzszXDOnIQu0YRJqe6ala1Zn4vZ9XWzj\n4/QQeYokjdngFnPerKAiiEkeVrbKslzJhBYnx/pKFr4YIKb+O5DM3bZ2f5aW0ng6\nwP5usLYm3eWjtBtD16e61rp9cOW7iDfwEHlUdsRnCONGxRfdXmYaqjGM+YMJp92n\nn95afEiQWPmx6ccguz/AaxZUc8WncNX5eN/CL09LsThfpkarCvBw3mUpYCkpfXGl\nHX9pANYkM7pz+kP1oUd7x+Okv0cySDzBaNjC1YqBmPj4Chc1OA+atqsv06ynoVQ1\nAd3ntsegPuCFmKzNrTE8\n=TEg8\n-----END PGP SIGNATURE-----",
        "payload": "tree d86de5981a477ab1b95681f9f0c15580b32abc0a\nparent 10847fe2d82bd4ffe5be499fd9ad64b6fee78a33\nauthor Jorge Tim\u00f3n <jtimon@jtimon.cc> 1504223865 +0200\ncommitter Jorge Tim\u00f3n <jtimon@jtimon.cc> 1517434798 +0100\n\nQA: segwit.py: s/find_unspent/find_spendable_utxo/\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9bb59cf7baea0b33d97ef0c0eeee88a8b104be3a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9bb59cf7baea0b33d97ef0c0eeee88a8b104be3a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9bb59cf7baea0b33d97ef0c0eeee88a8b104be3a/comments",
    "author": {
      "login": "jtimon",
      "id": 1008458,
      "node_id": "MDQ6VXNlcjEwMDg0NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1008458?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtimon",
      "html_url": "https://github.com/jtimon",
      "followers_url": "https://api.github.com/users/jtimon/followers",
      "following_url": "https://api.github.com/users/jtimon/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtimon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtimon/subscriptions",
      "organizations_url": "https://api.github.com/users/jtimon/orgs",
      "repos_url": "https://api.github.com/users/jtimon/repos",
      "events_url": "https://api.github.com/users/jtimon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtimon/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jtimon",
      "id": 1008458,
      "node_id": "MDQ6VXNlcjEwMDg0NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1008458?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtimon",
      "html_url": "https://github.com/jtimon",
      "followers_url": "https://api.github.com/users/jtimon/followers",
      "following_url": "https://api.github.com/users/jtimon/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtimon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtimon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtimon/subscriptions",
      "organizations_url": "https://api.github.com/users/jtimon/orgs",
      "repos_url": "https://api.github.com/users/jtimon/repos",
      "events_url": "https://api.github.com/users/jtimon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtimon/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "10847fe2d82bd4ffe5be499fd9ad64b6fee78a33",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/10847fe2d82bd4ffe5be499fd9ad64b6fee78a33",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/10847fe2d82bd4ffe5be499fd9ad64b6fee78a33"
      }
    ],
    "stats": {
      "total": 16,
      "additions": 9,
      "deletions": 7
    },
    "files": [
      {
        "sha": "7db05077c9ee25966b45d8126990b2b8ebd5f35d",
        "filename": "test/functional/feature_segwit.py",
        "status": "modified",
        "additions": 9,
        "deletions": 7,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9bb59cf7baea0b33d97ef0c0eeee88a8b104be3a/test/functional/feature_segwit.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9bb59cf7baea0b33d97ef0c0eeee88a8b104be3a/test/functional/feature_segwit.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_segwit.py?ref=9bb59cf7baea0b33d97ef0c0eeee88a8b104be3a",
        "patch": "@@ -30,11 +30,13 @@ def getutxo(txid):\n     utxo[\"txid\"] = txid\n     return utxo\n \n-def find_unspent(node, min_value):\n-    for utxo in node.listunspent():\n-        if utxo['amount'] >= min_value:\n+def find_spendable_utxo(node, min_value):\n+    for utxo in node.listunspent(query_options={'minimumAmount': min_value}):\n+        if utxo['spendable']:\n             return utxo\n \n+    raise AssertionError(\"Unspent output equal or higher than %s not found\" % min_value)\n+\n class SegWitTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n@@ -113,8 +115,8 @@ def run_test(self):\n         for i in range(5):\n             for n in range(3):\n                 for v in range(2):\n-                    wit_ids[n][v].append(send_to_witness(v, self.nodes[0], find_unspent(self.nodes[0], 50), self.pubkey[n], False, Decimal(\"49.999\")))\n-                    p2sh_ids[n][v].append(send_to_witness(v, self.nodes[0], find_unspent(self.nodes[0], 50), self.pubkey[n], True, Decimal(\"49.999\")))\n+                    wit_ids[n][v].append(send_to_witness(v, self.nodes[0], find_spendable_utxo(self.nodes[0], 50), self.pubkey[n], False, Decimal(\"49.999\")))\n+                    p2sh_ids[n][v].append(send_to_witness(v, self.nodes[0], find_spendable_utxo(self.nodes[0], 50), self.pubkey[n], True, Decimal(\"49.999\")))\n \n         self.nodes[0].generate(1) #block 163\n         sync_blocks(self.nodes)\n@@ -209,7 +211,7 @@ def run_test(self):\n         #                      tx2 (segwit input, paying to a non-segwit output) ->\n         #                      tx3 (non-segwit input, paying to a non-segwit output).\n         # tx1 is allowed to appear in the block, but no others.\n-        txid1 = send_to_witness(1, self.nodes[0], find_unspent(self.nodes[0], 50), self.pubkey[0], False, Decimal(\"49.996\"))\n+        txid1 = send_to_witness(1, self.nodes[0], find_spendable_utxo(self.nodes[0], 50), self.pubkey[0], False, Decimal(\"49.996\"))\n         hex_tx = self.nodes[0].gettransaction(txid)['hex']\n         tx = FromHex(CTransaction(), hex_tx)\n         assert(tx.wit.is_null()) # This should not be a segwit input\n@@ -570,7 +572,7 @@ def run_test(self):\n             assert_equal(self.nodes[1].listtransactions(\"*\", 1, 0, True)[0][\"txid\"], txid)\n \n     def mine_and_test_listunspent(self, script_list, ismine):\n-        utxo = find_unspent(self.nodes[0], 50)\n+        utxo = find_spendable_utxo(self.nodes[0], 50)\n         tx = CTransaction()\n         tx.vin.append(CTxIn(COutPoint(int('0x'+utxo['txid'],0), utxo['vout'])))\n         for i in script_list:"
      }
    ]
  }
]