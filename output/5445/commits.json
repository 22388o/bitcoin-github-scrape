[
  {
    "sha": "4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0OTAzYjgwZDZhZDU0YmE5NDQ2MGNmOWQ1OTYzYWE3YjhlODk3YTkw",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2014-12-07T13:44:28Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2014-12-07T13:44:28Z"
      },
      "message": "Squashed 'src/secp256k1/' changes from b0210a9..3545627\n\n3545627 Merge pull request #118\n6a9901e Merge pull request #137\n376b28b Merge pull request #128\n1728806 Merge pull request #138\na5759c5 Check return value of malloc\n39bd94d Variable time normalize\nad86bdf Merge pull request #140\n54b768c Another redundant secp256k1_fe_normalize\n69dcaab Merge pull request #139\n1c29f2e Remove redundant secp256k1_fe_normalize from secp256k1_gej_add_ge_var.\n2b9388b Remove unused secp256k1_fe_inv_all\nf461b76 Allocate precomputation arrays on the heap\nb2c9681 Make {mul,sqr}_inner use the same argument order as {mul,sqr}\n6793505 Convert YASM code into inline assembly\nf048615 Rewrite field assembly to match the C version\n3ce74b1 Tweak precomputed table size for G\n\ngit-subtree-dir: src/secp256k1\ngit-subtree-split: 3545627acb6059832834569829e97fb469933b29",
      "tree": {
        "sha": "ecb1cf61ed696b378cd9bd2af7d4eb429d8f473b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ecb1cf61ed696b378cd9bd2af7d4eb429d8f473b"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "87bddb7a3a83aaad96b5b54b4bac34d8a71b3810",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/87bddb7a3a83aaad96b5b54b4bac34d8a71b3810",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/87bddb7a3a83aaad96b5b54b4bac34d8a71b3810"
      }
    ],
    "stats": {
      "total": 1395,
      "additions": 698,
      "deletions": 697
    },
    "files": [
      {
        "sha": "6e42c64f3f1990aaaf442175d3f6e4ced7806a4b",
        "filename": "Makefile.am",
        "status": "modified",
        "additions": 4,
        "deletions": 20,
        "changes": 24,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/Makefile.am",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/Makefile.am",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/Makefile.am?ref=4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "patch": "@@ -1,12 +1,6 @@\n ACLOCAL_AMFLAGS = -I build-aux/m4\n \n lib_LTLIBRARIES = libsecp256k1.la\n-if USE_ASM\n-COMMON_LIB = libsecp256k1_common.la\n-else\n-COMMON_LIB =\n-endif\n-noinst_LTLIBRARIES = $(COMMON_LIB)\n include_HEADERS = include/secp256k1.h\n noinst_HEADERS =\n noinst_HEADERS += src/scalar.h\n@@ -47,13 +41,9 @@ noinst_HEADERS += src/field_impl.h\n pkgconfigdir = $(libdir)/pkgconfig\n pkgconfig_DATA = libsecp256k1.pc\n \n-if USE_ASM\n-libsecp256k1_common_la_SOURCES = src/field_5x52_asm.asm\n-endif\n-\n libsecp256k1_la_SOURCES = src/secp256k1.c\n libsecp256k1_la_CPPFLAGS = -I$(top_srcdir)/include $(SECP_INCLUDES)\n-libsecp256k1_la_LIBADD = $(COMMON_LIB) $(SECP_LIBS)\n+libsecp256k1_la_LIBADD = $(SECP_LIBS)\n \n \n noinst_PROGRAMS =\n@@ -66,7 +56,7 @@ bench_sign_SOURCES = src/bench_sign.c\n bench_sign_LDADD = libsecp256k1.la $(SECP_LIBS)\n bench_sign_LDFLAGS = -static\n bench_inv_SOURCES = src/bench_inv.c\n-bench_inv_LDADD = $(COMMON_LIB) $(SECP_LIBS)\n+bench_inv_LDADD = $(SECP_LIBS)\n bench_inv_LDFLAGS = -static\n bench_inv_CPPFLAGS = $(SECP_INCLUDES)\n endif\n@@ -75,15 +65,9 @@ if USE_TESTS\n noinst_PROGRAMS += tests\n tests_SOURCES = src/tests.c\n tests_CPPFLAGS = -DVERIFY $(SECP_INCLUDES) $(SECP_TEST_INCLUDES)\n-tests_LDADD = $(COMMON_LIB) $(SECP_LIBS) $(SECP_TEST_LIBS)\n+tests_LDADD = $(SECP_LIBS) $(SECP_TEST_LIBS)\n tests_LDFLAGS = -static\n TESTS = tests\n endif\n \n-EXTRA_DIST = autogen.sh nasm_lt.sh\n-\n-#x86_64 only\n-if USE_ASM\n-.asm.lo:\n-\t$(LIBTOOL) --mode=compile --tag YASM $(srcdir)/nasm_lt.sh $(YASM) -f $(YASM_BINFMT) $(YAFLAGS) -I$(srcdir) -I. $< -o $@\n-endif\n+EXTRA_DIST = autogen.sh"
      },
      {
        "sha": "7163b9480900f004ff6ca8f981cd0a090ca73d11",
        "filename": "build-aux/m4/bitcoin_secp.m4",
        "status": "modified",
        "additions": 10,
        "deletions": 32,
        "changes": 42,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/build-aux/m4/bitcoin_secp.m4",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/build-aux/m4/bitcoin_secp.m4",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/build-aux/m4/bitcoin_secp.m4?ref=4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "patch": "@@ -11,38 +11,16 @@ fi\n \n dnl \n AC_DEFUN([SECP_64BIT_ASM_CHECK],[\n-if test x\"$host_cpu\" == x\"x86_64\"; then\n-  AC_CHECK_PROG(YASM, yasm, yasm)\n-else\n-  if test x\"$set_field\" = x\"64bit_asm\"; then\n-    AC_MSG_ERROR([$set_field field support explicitly requested but is not compatible with this host])\n-  fi\n-fi\n-if test x$YASM = x; then\n-  if test x\"$set_field\" = x\"64bit_asm\"; then\n-    AC_MSG_ERROR([$set_field field support explicitly requested but yasm was not found])\n-  fi\n-  has_64bit_asm=no\n-else\n-  case x\"$host_os\" in\n-  xdarwin*)\n-    YASM_BINFMT=macho64\n-    ;;\n-  x*-gnux32)\n-    YASM_BINFMT=elfx32\n-    ;;\n-  *)\n-    YASM_BINFMT=elf64\n-    ;;\n-  esac\n-  if $YASM -f help | grep -q $YASM_BINFMT; then\n-    has_64bit_asm=yes\n-  else\n-    if test x\"$set_field\" = x\"64bit_asm\"; then\n-      AC_MSG_ERROR([$set_field field support explicitly requested but yasm doesn't support $YASM_BINFMT format])\n-    fi\n-    AC_MSG_WARN([yasm too old for $YASM_BINFMT format])\n-    has_64bit_asm=no\n+AC_MSG_CHECKING(for x86_64 assembly availability)\n+AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n+  #include <stdint.h>]],[[\n+  uint64_t a = 11, tmp;\n+  __asm__ __volatile__(\"movq $0x100000000,%1; mulq %%rsi\" : \"+a\"(a) : \"S\"(tmp) : \"cc\", \"%rdx\");\n+  ]])],[has_64bit_asm=yes],[has_64bit_asm=no])\n+AC_MSG_RESULT([$has_64bit_asm])\n+if test x\"$set_field\" == x\"64bit_asm\"; then\n+  if test x\"$has_64bit_asm\" == x\"no\"; then\n+    AC_MSG_ERROR([$set_field field support explicitly requested but no x86_64 assembly available])\n   fi\n fi\n ])"
      },
      {
        "sha": "60a54051576a17d4124b8407b36195f046760023",
        "filename": "configure.ac",
        "status": "modified",
        "additions": 0,
        "deletions": 1,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/configure.ac",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/configure.ac",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/configure.ac?ref=4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "patch": "@@ -283,7 +283,6 @@ AC_SUBST(SECP_INCLUDES)\n AC_SUBST(SECP_LIBS)\n AC_SUBST(SECP_TEST_LIBS)\n AC_SUBST(SECP_TEST_INCLUDES)\n-AC_SUBST(YASM_BINFMT)\n AM_CONDITIONAL([USE_ASM], [test x\"$set_field\" == x\"64bit_asm\"])\n AM_CONDITIONAL([USE_TESTS], [test x\"$use_tests\" != x\"no\"])\n AM_CONDITIONAL([USE_BENCHMARK], [test x\"$use_benchmark\" != x\"no\"])"
      },
      {
        "sha": "6cd73294c0617c5d186926f1a7903afbde11044c",
        "filename": "nasm_lt.sh",
        "status": "removed",
        "additions": 0,
        "deletions": 57,
        "changes": 57,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/87bddb7a3a83aaad96b5b54b4bac34d8a71b3810/nasm_lt.sh",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/87bddb7a3a83aaad96b5b54b4bac34d8a71b3810/nasm_lt.sh",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/nasm_lt.sh?ref=87bddb7a3a83aaad96b5b54b4bac34d8a71b3810",
        "patch": "@@ -1,57 +0,0 @@\n-#! /bin/sh\n-command=\"\"\n-infile=\"\"\n-o_opt=no\n-pic=no\n-while [ $# -gt 0 ]; do\n-    case \"$1\" in\n-        -DPIC|-fPIC|-fpic|-Kpic|-KPIC)\n-            if [ \"$pic\" != \"yes\" ] ; then\n-                command=\"$command -DPIC\"\n-                pic=yes\n-            fi\n-            ;;\n-        -f|-fbin|-faout|-faoutb|-fcoff|-felf|-felf64|-fas86| \\\n-        -fobj|-fwin32|-fwin64|-frdf|-fieee|-fmacho|-fmacho64)\n-            # it's a file format specifier for nasm.\n-            command=\"$command $1\"\n-            ;;\n-        -f*)\n-            # maybe a code-generation flag for gcc.\n-            ;;\n-        -[Ii]*)\n-            incdir=`echo \"$1\" | sed 's/^-[Ii]//'`\n-            if [ \"x$incdir\" = x -a \"x$2\" != x ] ; then\n-                case \"$2\" in\n-                    -*) ;;\n-                    *) incdir=\"$2\"; shift;;\n-                esac\n-            fi\n-            if [ \"x$incdir\" != x ] ; then\n-                # In the case of NASM, the trailing slash is necessary.\n-                incdir=`echo \"$incdir\" | sed 's%/*$%/%'`\n-                command=\"$command -I$incdir\"\n-            fi\n-            ;;\n-        -o*)\n-            o_opt=yes\n-            command=\"$command $1\"\n-            ;;\n-        *.asm)\n-            infile=$1\n-            command=\"$command $1\"\n-            ;;\n-        *)\n-            command=\"$command $1\"\n-            ;;\n-    esac\n-    shift\n-done\n-if [ \"$o_opt\" != yes ] ; then\n-    # By default, NASM creates an output file\n-    # in the same directory as the input file.\n-    outfile=\"-o `echo $infile | sed -e 's%^.*/%%' -e 's%\\.[^.]*$%%'`.o\"\n-    command=\"$command $outfile\"\n-fi\n-echo $command\n-exec $command"
      },
      {
        "sha": "8825d05fed93b6f043f24b1584431c2c7d384fc9",
        "filename": "src/ecdsa_impl.h",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/ecdsa_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/ecdsa_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/ecdsa_impl.h?ref=4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "patch": "@@ -27,7 +27,7 @@ static void secp256k1_ecdsa_start(void) {\n         return;\n \n     /* Allocate. */\n-    secp256k1_ecdsa_consts_t *ret = (secp256k1_ecdsa_consts_t*)malloc(sizeof(secp256k1_ecdsa_consts_t));\n+    secp256k1_ecdsa_consts_t *ret = (secp256k1_ecdsa_consts_t*)checked_malloc(sizeof(secp256k1_ecdsa_consts_t));\n \n     static const unsigned char order[] = {\n         0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,\n@@ -38,7 +38,7 @@ static void secp256k1_ecdsa_start(void) {\n \n     secp256k1_fe_set_b32(&ret->order_as_fe, order);\n     secp256k1_fe_negate(&ret->p_minus_order, &ret->order_as_fe, 1);\n-    secp256k1_fe_normalize(&ret->p_minus_order);\n+    secp256k1_fe_normalize_var(&ret->p_minus_order);\n \n     /* Set the global pointer. */\n     secp256k1_ecdsa_consts = ret;\n@@ -122,7 +122,7 @@ static int secp256k1_ecdsa_sig_recompute(secp256k1_scalar_t *r2, const secp256k1\n     secp256k1_gej_t pr; secp256k1_ecmult(&pr, &pubkeyj, &u2, &u1);\n     if (!secp256k1_gej_is_infinity(&pr)) {\n         secp256k1_fe_t xr; secp256k1_gej_get_x_var(&xr, &pr);\n-        secp256k1_fe_normalize(&xr);\n+        secp256k1_fe_normalize_var(&xr);\n         unsigned char xrb[32]; secp256k1_fe_get_b32(xrb, &xr);\n         secp256k1_scalar_set_b32(r2, xrb, NULL);\n         ret = 1;\n@@ -144,7 +144,7 @@ static int secp256k1_ecdsa_sig_recover(const secp256k1_ecdsa_sig_t *sig, secp256\n         secp256k1_fe_add(&fx, &secp256k1_ecdsa_consts->order_as_fe);\n     }\n     secp256k1_ge_t x;\n-    if (!secp256k1_ge_set_xo(&x, &fx, recid & 1))\n+    if (!secp256k1_ge_set_xo_var(&x, &fx, recid & 1))\n         return 0;\n     secp256k1_gej_t xj;\n     secp256k1_gej_set_ge(&xj, &x);"
      },
      {
        "sha": "b3fa7d9bd21a974e755e0c9f0d475e9808a264f3",
        "filename": "src/eckey_impl.h",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/eckey_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/eckey_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/eckey_impl.h?ref=4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "patch": "@@ -17,7 +17,7 @@\n static int secp256k1_eckey_pubkey_parse(secp256k1_ge_t *elem, const unsigned char *pub, int size) {\n     if (size == 33 && (pub[0] == 0x02 || pub[0] == 0x03)) {\n         secp256k1_fe_t x;\n-        return secp256k1_fe_set_b32(&x, pub+1) && secp256k1_ge_set_xo(elem, &x, pub[0] == 0x03);\n+        return secp256k1_fe_set_b32(&x, pub+1) && secp256k1_ge_set_xo_var(elem, &x, pub[0] == 0x03);\n     } else if (size == 65 && (pub[0] == 0x04 || pub[0] == 0x06 || pub[0] == 0x07)) {\n         secp256k1_fe_t x, y;\n         if (!secp256k1_fe_set_b32(&x, pub+1) || !secp256k1_fe_set_b32(&y, pub+33)) {\n@@ -26,7 +26,7 @@ static int secp256k1_eckey_pubkey_parse(secp256k1_ge_t *elem, const unsigned cha\n         secp256k1_ge_set_xy(elem, &x, &y);\n         if ((pub[0] == 0x06 || pub[0] == 0x07) && secp256k1_fe_is_odd(&y) != (pub[0] == 0x07))\n             return 0;\n-        return secp256k1_ge_is_valid(elem);\n+        return secp256k1_ge_is_valid_var(elem);\n     } else {\n         return 0;\n     }\n@@ -36,8 +36,8 @@ static int secp256k1_eckey_pubkey_serialize(secp256k1_ge_t *elem, unsigned char\n     if (secp256k1_ge_is_infinity(elem)) {\n         return 0;\n     }\n-    secp256k1_fe_normalize(&elem->x);\n-    secp256k1_fe_normalize(&elem->y);\n+    secp256k1_fe_normalize_var(&elem->x);\n+    secp256k1_fe_normalize_var(&elem->y);\n     secp256k1_fe_get_b32(&pub[1], &elem->x);\n     if (compressed) {\n         *size = 33;"
      },
      {
        "sha": "5a5b16ce14cf84cd4a724ce84c4a383fc5301447",
        "filename": "src/ecmult_gen_impl.h",
        "status": "modified",
        "additions": 3,
        "deletions": 3,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/ecmult_gen_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/ecmult_gen_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/ecmult_gen_impl.h?ref=4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "patch": "@@ -34,7 +34,7 @@ static void secp256k1_ecmult_gen_start(void) {\n         return;\n \n     /* Allocate the precomputation table. */\n-    secp256k1_ecmult_gen_consts_t *ret = (secp256k1_ecmult_gen_consts_t*)malloc(sizeof(secp256k1_ecmult_gen_consts_t));\n+    secp256k1_ecmult_gen_consts_t *ret = (secp256k1_ecmult_gen_consts_t*)checked_malloc(sizeof(secp256k1_ecmult_gen_consts_t));\n \n     /* get the generator */\n     const secp256k1_ge_t *g = &secp256k1_ge_consts->g;\n@@ -47,7 +47,7 @@ static void secp256k1_ecmult_gen_start(void) {\n         secp256k1_fe_t nums_x;\n         VERIFY_CHECK(secp256k1_fe_set_b32(&nums_x, nums_b32));\n         secp256k1_ge_t nums_ge;\n-        VERIFY_CHECK(secp256k1_ge_set_xo(&nums_ge, &nums_x, 0));\n+        VERIFY_CHECK(secp256k1_ge_set_xo_var(&nums_ge, &nums_x, 0));\n         secp256k1_gej_set_ge(&nums_gej, &nums_ge);\n         /* Add G to make the bits in x uniformly distributed. */\n         secp256k1_gej_add_ge_var(&nums_gej, &nums_gej, g);\n@@ -73,7 +73,7 @@ static void secp256k1_ecmult_gen_start(void) {\n             secp256k1_gej_double_var(&numsbase, &numsbase);\n             if (j == 62) {\n                 /* In the last iteration, numsbase is (1 - 2^j) * nums instead. */\n-                secp256k1_gej_neg(&numsbase, &numsbase);\n+                secp256k1_gej_neg_var(&numsbase, &numsbase);\n                 secp256k1_gej_add_var(&numsbase, &numsbase, &nums_gej);\n             }\n         }"
      },
      {
        "sha": "653677104699bd623b1123aa6f6ce528023ad0d8",
        "filename": "src/ecmult_impl.h",
        "status": "modified",
        "additions": 10,
        "deletions": 7,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/ecmult_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/ecmult_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/ecmult_impl.h?ref=4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "patch": "@@ -15,11 +15,13 @@\n #define WINDOW_A 5\n \n /** larger numbers may result in slightly better performance, at the cost of\n-    exponentially larger precomputed tables. WINDOW_G == 14 results in 640 KiB. */\n+    exponentially larger precomputed tables. */\n #ifdef USE_ENDOMORPHISM\n-#define WINDOW_G 14\n-#else\n+/** Two tables for window size 15: 1.375 MiB. */\n #define WINDOW_G 15\n+#else\n+/** One table for window size 16: 1.375 MiB. */\n+#define WINDOW_G 16\n #endif\n \n /** Fill a table 'pre' with precomputed odd multiples of a. W determines the size of the table.\n@@ -43,13 +45,14 @@ static void secp256k1_ecmult_table_precomp_gej_var(secp256k1_gej_t *pre, const s\n \n static void secp256k1_ecmult_table_precomp_ge_var(secp256k1_ge_t *pre, const secp256k1_gej_t *a, int w) {\n     const int table_size = 1 << (w-2);\n-    secp256k1_gej_t prej[table_size];\n+    secp256k1_gej_t *prej = checked_malloc(sizeof(secp256k1_gej_t) * table_size);\n     prej[0] = *a;\n     secp256k1_gej_t d; secp256k1_gej_double_var(&d, a);\n     for (int i=1; i<table_size; i++) {\n         secp256k1_gej_add_var(&prej[i], &d, &prej[i-1]);\n     }\n     secp256k1_ge_set_all_gej_var(table_size, pre, prej);\n+    free(prej);\n }\n \n /** The number of entries a table with precomputed multiples needs to have. */\n@@ -67,8 +70,8 @@ static void secp256k1_ecmult_table_precomp_ge_var(secp256k1_ge_t *pre, const sec\n         (neg)((r), &(pre)[(-(n)-1)/2]); \\\n } while(0)\n \n-#define ECMULT_TABLE_GET_GEJ(r,pre,n,w) ECMULT_TABLE_GET((r),(pre),(n),(w),secp256k1_gej_neg)\n-#define ECMULT_TABLE_GET_GE(r,pre,n,w)  ECMULT_TABLE_GET((r),(pre),(n),(w),secp256k1_ge_neg)\n+#define ECMULT_TABLE_GET_GEJ(r,pre,n,w) ECMULT_TABLE_GET((r),(pre),(n),(w),secp256k1_gej_neg_var)\n+#define ECMULT_TABLE_GET_GE(r,pre,n,w)  ECMULT_TABLE_GET((r),(pre),(n),(w),secp256k1_ge_neg_var)\n \n typedef struct {\n     /* For accelerating the computation of a*P + b*G: */\n@@ -85,7 +88,7 @@ static void secp256k1_ecmult_start(void) {\n         return;\n \n     /* Allocate the precomputation table. */\n-    secp256k1_ecmult_consts_t *ret = (secp256k1_ecmult_consts_t*)malloc(sizeof(secp256k1_ecmult_consts_t));\n+    secp256k1_ecmult_consts_t *ret = (secp256k1_ecmult_consts_t*)checked_malloc(sizeof(secp256k1_ecmult_consts_t));\n \n     /* get the generator */\n     const secp256k1_ge_t *g = &secp256k1_ge_consts->g;"
      },
      {
        "sha": "53aa29e13fd563b6f65db1bb240340d36970073e",
        "filename": "src/field.h",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/field.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/field.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/field.h?ref=4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "patch": "@@ -50,6 +50,9 @@ static void secp256k1_fe_stop(void);\n /** Normalize a field element. */\n static void secp256k1_fe_normalize(secp256k1_fe_t *r);\n \n+/** Normalize a field element, without constant-time guarantee. */\n+static void secp256k1_fe_normalize_var(secp256k1_fe_t *r);\n+\n /** Set a field element equal to a small integer. Resulting field element is normalized. */\n static void secp256k1_fe_set_int(secp256k1_fe_t *r, int a);\n \n@@ -93,7 +96,7 @@ static void secp256k1_fe_sqr(secp256k1_fe_t *r, const secp256k1_fe_t *a);\n /** Sets a field element to be the (modular) square root (if any exist) of another. Requires the\n  *  input's magnitude to be at most 8. The output magnitude is 1 (but not guaranteed to be\n  *  normalized). Return value indicates whether a square root was found. */\n-static int secp256k1_fe_sqrt(secp256k1_fe_t *r, const secp256k1_fe_t *a);\n+static int secp256k1_fe_sqrt_var(secp256k1_fe_t *r, const secp256k1_fe_t *a);\n \n /** Sets a field element to be the (modular) inverse of another. Requires the input's magnitude to be\n  *  at most 8. The output magnitude is 1 (but not guaranteed to be normalized). */\n@@ -105,9 +108,6 @@ static void secp256k1_fe_inv_var(secp256k1_fe_t *r, const secp256k1_fe_t *a);\n /** Calculate the (modular) inverses of a batch of field elements. Requires the inputs' magnitudes to be\n  *  at most 8. The output magnitudes are 1 (but not guaranteed to be normalized). The inputs and\n  *  outputs must not overlap in memory. */\n-static void secp256k1_fe_inv_all(size_t len, secp256k1_fe_t r[len], const secp256k1_fe_t a[len]);\n-\n-/** Potentially faster version of secp256k1_fe_inv_all, without constant-time guarantee. */\n static void secp256k1_fe_inv_all_var(size_t len, secp256k1_fe_t r[len], const secp256k1_fe_t a[len]);\n \n /** Convert a field element to a hexadecimal string. */"
      },
      {
        "sha": "d20229cda6b955615961916fde4138ceae8cdd60",
        "filename": "src/field_10x26_impl.h",
        "status": "modified",
        "additions": 60,
        "deletions": 4,
        "changes": 64,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/field_10x26_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/field_10x26_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/field_10x26_impl.h?ref=4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "patch": "@@ -103,6 +103,62 @@ static void secp256k1_fe_normalize(secp256k1_fe_t *r) {\n #endif\n }\n \n+static void secp256k1_fe_normalize_var(secp256k1_fe_t *r) {\n+    uint32_t t0 = r->n[0], t1 = r->n[1], t2 = r->n[2], t3 = r->n[3], t4 = r->n[4],\n+             t5 = r->n[5], t6 = r->n[6], t7 = r->n[7], t8 = r->n[8], t9 = r->n[9];\n+\n+    /* Reduce t9 at the start so there will be at most a single carry from the first pass */\n+    uint32_t x = t9 >> 22; t9 &= 0x03FFFFFUL;\n+    uint32_t m;\n+\n+    /* The first pass ensures the magnitude is 1, ... */\n+    t0 += x * 0x3D1UL; t1 += (x << 6);\n+    t1 += (t0 >> 26); t0 &= 0x3FFFFFFUL;\n+    t2 += (t1 >> 26); t1 &= 0x3FFFFFFUL;\n+    t3 += (t2 >> 26); t2 &= 0x3FFFFFFUL; m = t2;\n+    t4 += (t3 >> 26); t3 &= 0x3FFFFFFUL; m &= t3;\n+    t5 += (t4 >> 26); t4 &= 0x3FFFFFFUL; m &= t4;\n+    t6 += (t5 >> 26); t5 &= 0x3FFFFFFUL; m &= t5;\n+    t7 += (t6 >> 26); t6 &= 0x3FFFFFFUL; m &= t6;\n+    t8 += (t7 >> 26); t7 &= 0x3FFFFFFUL; m &= t7;\n+    t9 += (t8 >> 26); t8 &= 0x3FFFFFFUL; m &= t8;\n+\n+    /* ... except for a possible carry at bit 22 of t9 (i.e. bit 256 of the field element) */\n+    VERIFY_CHECK(t9 >> 23 == 0);\n+\n+    /* At most a single final reduction is needed; check if the value is >= the field characteristic */\n+    x = (t9 >> 22) | ((t9 == 0x03FFFFFUL) & (m == 0x3FFFFFFUL)\n+        & ((t1 + 0x40UL + ((t0 + 0x3D1UL) >> 26)) > 0x3FFFFFFUL));\n+\n+    if (x) {\n+        t0 += 0x3D1UL; t1 += (x << 6);\n+        t1 += (t0 >> 26); t0 &= 0x3FFFFFFUL;\n+        t2 += (t1 >> 26); t1 &= 0x3FFFFFFUL;\n+        t3 += (t2 >> 26); t2 &= 0x3FFFFFFUL;\n+        t4 += (t3 >> 26); t3 &= 0x3FFFFFFUL;\n+        t5 += (t4 >> 26); t4 &= 0x3FFFFFFUL;\n+        t6 += (t5 >> 26); t5 &= 0x3FFFFFFUL;\n+        t7 += (t6 >> 26); t6 &= 0x3FFFFFFUL;\n+        t8 += (t7 >> 26); t7 &= 0x3FFFFFFUL;\n+        t9 += (t8 >> 26); t8 &= 0x3FFFFFFUL;\n+\n+        /* If t9 didn't carry to bit 22 already, then it should have after any final reduction */\n+        VERIFY_CHECK(t9 >> 22 == x);\n+\n+        /* Mask off the possible multiple of 2^256 from the final reduction */\n+        t9 &= 0x03FFFFFUL;\n+    }\n+\n+    r->n[0] = t0; r->n[1] = t1; r->n[2] = t2; r->n[3] = t3; r->n[4] = t4;\n+    r->n[5] = t5; r->n[6] = t6; r->n[7] = t7; r->n[8] = t8; r->n[9] = t9;\n+\n+#ifdef VERIFY\n+    r->magnitude = 1;\n+    r->normalized = 1;\n+    secp256k1_fe_verify(r);\n+#endif\n+}\n+\n SECP256K1_INLINE static void secp256k1_fe_set_int(secp256k1_fe_t *r, int a) {\n     r->n[0] = a;\n     r->n[1] = r->n[2] = r->n[3] = r->n[4] = r->n[5] = r->n[6] = r->n[7] = r->n[8] = r->n[9] = 0;\n@@ -271,7 +327,7 @@ SECP256K1_INLINE static void secp256k1_fe_add(secp256k1_fe_t *r, const secp256k1\n #define VERIFY_BITS(x, n) do { } while(0)\n #endif\n \n-SECP256K1_INLINE static void secp256k1_fe_mul_inner(const uint32_t *a, const uint32_t * SECP256K1_RESTRICT b, uint32_t *r) {\n+SECP256K1_INLINE static void secp256k1_fe_mul_inner(uint32_t *r, const uint32_t *a, const uint32_t * SECP256K1_RESTRICT b) {\n     VERIFY_BITS(a[0], 30);\n     VERIFY_BITS(a[1], 30);\n     VERIFY_BITS(a[2], 30);\n@@ -598,7 +654,7 @@ SECP256K1_INLINE static void secp256k1_fe_mul_inner(const uint32_t *a, const uin\n     /* [r9 r8 r7 r6 r5 r4 r3 r2 r1 r0] = [p18 p17 p16 p15 p14 p13 p12 p11 p10 p9 p8 p7 p6 p5 p4 p3 p2 p1 p0] */\n }\n \n-SECP256K1_INLINE static void secp256k1_fe_sqr_inner(const uint32_t *a, uint32_t *r) {\n+SECP256K1_INLINE static void secp256k1_fe_sqr_inner(uint32_t *r, const uint32_t *a) {\n     VERIFY_BITS(a[0], 30);\n     VERIFY_BITS(a[1], 30);\n     VERIFY_BITS(a[2], 30);\n@@ -879,7 +935,7 @@ static void secp256k1_fe_mul(secp256k1_fe_t *r, const secp256k1_fe_t *a, const s\n     secp256k1_fe_verify(b);\n     VERIFY_CHECK(r != b);\n #endif\n-    secp256k1_fe_mul_inner(a->n, b->n, r->n);\n+    secp256k1_fe_mul_inner(r->n, a->n, b->n);\n #ifdef VERIFY\n     r->magnitude = 1;\n     r->normalized = 0;\n@@ -892,7 +948,7 @@ static void secp256k1_fe_sqr(secp256k1_fe_t *r, const secp256k1_fe_t *a) {\n     VERIFY_CHECK(a->magnitude <= 8);\n     secp256k1_fe_verify(a);\n #endif\n-    secp256k1_fe_sqr_inner(a->n, r->n);\n+    secp256k1_fe_sqr_inner(r->n, a->n);\n #ifdef VERIFY\n     r->magnitude = 1;\n     r->normalized = 0;"
      },
      {
        "sha": "5e785f763055eaf695f92116dc3582a0985bf71d",
        "filename": "src/field_5x52_asm.asm",
        "status": "removed",
        "additions": 0,
        "deletions": 469,
        "changes": 469,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/87bddb7a3a83aaad96b5b54b4bac34d8a71b3810/src/field_5x52_asm.asm",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/87bddb7a3a83aaad96b5b54b4bac34d8a71b3810/src/field_5x52_asm.asm",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/field_5x52_asm.asm?ref=87bddb7a3a83aaad96b5b54b4bac34d8a71b3810",
        "patch": "@@ -1,469 +0,0 @@\n-\t;; Added by Diederik Huys, March 2013\n-\t;;\n-\t;; Provided public procedures:\n-\t;; \tsecp256k1_fe_mul_inner\n-\t;; \tsecp256k1_fe_sqr_inner\n-\t;;\n-\t;; Needed tools: YASM (http://yasm.tortall.net)\n-\t;;\n-\t;; \n-\n-\tBITS 64\n-\n-%ifidn   __OUTPUT_FORMAT__,macho64\n-%define SYM(x) _ %+ x\n-%else\n-%define SYM(x) x\n-%endif\n-\n-\t;;  Procedure ExSetMult\n-\t;;  Register Layout:\n-\t;;  INPUT: \trdi\t= a->n\n-\t;; \t   \trsi  \t= b->n\n-\t;; \t   \trdx  \t= r->a\n-\t;; \n-\t;;  INTERNAL:\trdx:rax  = multiplication accumulator\n-\t;; \t\tr9:r8    = c\n-\t;; \t\tr10-r13  = t0-t3\n-\t;; \t\tr14\t = b.n[0] / t4\n-\t;; \t\tr15\t = b.n[1] / t5\n-\t;; \t\trbx\t = b.n[2] / t6\n-\t;; \t\trcx\t = b.n[3] / t7\n-\t;; \t\trbp\t = Constant 0FFFFFFFFFFFFFh / t8\n-\t;; \t\trsi\t = b.n / b.n[4] / t9\n-\n-\tGLOBAL SYM(secp256k1_fe_mul_inner)\n-\tALIGN 32\n-SYM(secp256k1_fe_mul_inner):\n-\tpush rbp\n-\tpush rbx\n-\tpush r12\n-\tpush r13\n-\tpush r14\n-\tpush r15\n-\tpush rdx\n-\tmov r14,[rsi+8*0]\t; preload b.n[0]. This will be the case until\n-\t\t\t\t; b.n[0] is no longer needed, then we reassign\n-\t\t\t\t; r14 to t4\n-\t;; c=a.n[0] * b.n[0]\n-   \tmov rax,[rdi+0*8]\t; load a.n[0]\n-\tmov rbp,0FFFFFFFFFFFFFh\n-\tmul r14\t\t\t; rdx:rax=a.n[0]*b.n[0]\n-\tmov r15,[rsi+1*8]\n-\tmov r10,rbp\t\t; load modulus into target register for t0\n-\tmov r8,rax\n-\tand r10,rax\t\t; only need lower qword of c\n-\tshrd r8,rdx,52\n-\txor r9,r9\t\t; c < 2^64, so we ditch the HO part \n-\n-\t;; c+=a.n[0] * b.n[1] + a.n[1] * b.n[0]\n-\tmov rax,[rdi+0*8]\n-\tmul r15\t\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+1*8]\n-\tmul r14\t\t\t\n-\tmov r11,rbp\n-\tmov rbx,[rsi+2*8]\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand r11,r8\n-\tshrd r8,r9,52\n-\txor r9,r9\n-\t\n-\t;; c+=a.n[0 1 2] * b.n[2 1 0]\n-\tmov rax,[rdi+0*8]\n-\tmul rbx\t\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+1*8]\n-\tmul r15\t\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+2*8]\n-\tmul r14\n-\tmov r12,rbp\t\t\n-\tmov rcx,[rsi+3*8]\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand r12,r8\t\t\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=a.n[0 1 2 3] * b.n[3 2 1 0]\n-\tmov rax,[rdi+0*8]\n-\tmul rcx\t\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+1*8]\n-\tmul rbx\t\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+2*8]\n-\tmul r15\t\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\t\n-\tmov rax,[rdi+3*8]\n-\tmul r14\t\t\t\n-\tmov r13,rbp             \n-\tmov rsi,[rsi+4*8]\t; load b.n[4] and destroy pointer\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand r13,r8\n-\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\n-\t;; c+=a.n[0 1 2 3 4] * b.n[4 3 2 1 0]\n-\tmov rax,[rdi+0*8]\n-\tmul rsi\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+1*8]\n-\tmul rcx\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+2*8]\n-\tmul rbx\t\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+3*8]\n-\tmul r15\t\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+4*8]\n-\tmul r14\t\t\t\n-\tmov r14,rbp             ; load modulus into t4 and destroy a.n[0]\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand r14,r8\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=a.n[1 2 3 4] * b.n[4 3 2 1]\n-\tmov rax,[rdi+1*8]\n-\tmul rsi\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+2*8]\n-\tmul rcx\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+3*8]\n-\tmul rbx\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+4*8]\n-\tmul r15\n-\tmov r15,rbp\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tand r15,r8\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=a.n[2 3 4] * b.n[4 3 2]\n-\tmov rax,[rdi+2*8]\n-\tmul rsi\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+3*8]\n-\tmul rcx\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+4*8]\n-\tmul rbx\n-\tmov rbx,rbp\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tand rbx,r8\t\t\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=a.n[3 4] * b.n[4 3]\n-\tmov rax,[rdi+3*8]\n-\tmul rsi\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+4*8]\n-\tmul rcx\n-\tmov rcx,rbp\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand rcx,r8\t\t\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=a.n[4] * b.n[4]\n-\tmov rax,[rdi+4*8]\n-\tmul rsi\n-\t;; mov rbp,rbp\t\t; modulus already there!\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand rbp,r8 \n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\tmov rsi,r8\t\t; load c into t9 and destroy b.n[4]\n-\n-\t;; *******************************************************\n-common_exit_norm:\n-\tmov rdi,01000003D10h\t; load constant\n-\n-\tmov rax,r15\t\t; get t5\n-\tmul rdi\n-\tadd rax,r10    \t\t; +t0\n-\tadc rdx,0\n-\tmov r10,0FFFFFFFFFFFFFh ; modulus. Sadly, we ran out of registers!\n-\tmov r8,rax\t\t; +c\n-\tand r10,rax\n-\tshrd r8,rdx,52\n-\txor r9,r9\n-\n-\tmov rax,rbx\t\t; get t6\n-\tmul rdi\n-\tadd rax,r11\t\t; +t1\n-\tadc rdx,0\n-\tmov r11,0FFFFFFFFFFFFFh ; modulus\n-\tadd r8,rax\t\t; +c\n-\tadc r9,rdx\n-\tand r11,r8\n-\tshrd r8,r9,52\n-\txor r9,r9\n-\n-\tmov rax,rcx    \t\t; get t7\n-\tmul rdi\n-\tadd rax,r12\t\t; +t2\n-\tadc rdx,0\n-\tpop rbx\t\t\t; retrieve pointer to this.n\t\n-\tmov r12,0FFFFFFFFFFFFFh ; modulus\n-\tadd r8,rax\t\t; +c\n-\tadc r9,rdx\n-\tand r12,r8\n-\tmov [rbx+2*8],r12\t; mov into this.n[2]\n-\tshrd r8,r9,52\n-\txor r9,r9\n-\t\n-\tmov rax,rbp    \t\t; get t8\n-\tmul rdi\n-\tadd rax,r13    \t\t; +t3\n-\tadc rdx,0\n-\tmov r13,0FFFFFFFFFFFFFh ; modulus\n-\tadd r8,rax\t\t; +c\n-\tadc r9,rdx\n-\tand r13,r8\n-\tmov [rbx+3*8],r13\t; -> this.n[3]\n-\tshrd r8,r9,52\n-\txor r9,r9\n-\t\n-\tmov rax,rsi    \t\t; get t9\n-\tmul rdi\n-\tadd rax,r14    \t\t; +t4\n-\tadc rdx,0\n-\tmov r14,0FFFFFFFFFFFFh\t; !!!\n-\tadd r8,rax\t\t; +c\n-\tadc r9,rdx\n-\tand r14,r8\n-\tmov [rbx+4*8],r14\t; -> this.n[4]\n-\tshrd r8,r9,48\t\t; !!!\n-\txor r9,r9\n-\t\n-\tmov rax,01000003D1h\n-\tmul r8\t\t\n-\tadd rax,r10\n-\tadc rdx,0\n-\tmov r10,0FFFFFFFFFFFFFh ; modulus\n-\tmov r8,rax\n-\tand rax,r10\n-\tshrd r8,rdx,52\n-\tmov [rbx+0*8],rax\t; -> this.n[0]\n-\tadd r8,r11\n-\tmov [rbx+1*8],r8\t; -> this.n[1]\n-\n-\tpop r15\n-\tpop r14\n-\tpop r13\n-\tpop r12\n-\tpop rbx\n-\tpop rbp\n-\tret\n-\n-\t\n-\t;;  PROC ExSetSquare\n-\t;;  Register Layout:\n-\t;;  INPUT: \trdi\t = a.n\n-\t;; \t   \trsi  \t = this.a\n-\t;;  INTERNAL:\trdx:rax  = multiplication accumulator\n-\t;; \t\tr9:r8    = c\n-\t;; \t\tr10-r13  = t0-t3\n-\t;; \t\tr14\t = a.n[0] / t4\n-\t;; \t\tr15\t = a.n[1] / t5\n-\t;; \t\trbx\t = a.n[2] / t6\n-\t;; \t\trcx\t = a.n[3] / t7\n-\t;; \t\trbp\t = 0FFFFFFFFFFFFFh / t8\n-\t;; \t\trsi\t = a.n[4] / t9\n-\tGLOBAL SYM(secp256k1_fe_sqr_inner)\n-\tALIGN 32\n-SYM(secp256k1_fe_sqr_inner):\n-\tpush rbp\n-\tpush rbx\n-\tpush r12\n-\tpush r13\n-\tpush r14\n-\tpush r15\n-\tpush rsi\n-\tmov rbp,0FFFFFFFFFFFFFh\n-\t\n-\t;; c=a.n[0] * a.n[0]\n-   \tmov r14,[rdi+0*8]\t; r14=a.n[0]\n-\tmov r10,rbp\t\t; modulus \n-\tmov rax,r14\n-\tmul rax\n-\tmov r15,[rdi+1*8]\t; a.n[1]\n-\tadd r14,r14\t\t; r14=2*a.n[0]\n-\tmov r8,rax\n-\tand r10,rax\t\t; only need lower qword\n-\tshrd r8,rdx,52\n-\txor r9,r9\n-\n-\t;; c+=2*a.n[0] * a.n[1]\n-\tmov rax,r14\t\t; r14=2*a.n[0]\n-\tmul r15\n-\tmov rbx,[rdi+2*8]\t; rbx=a.n[2]\n-\tmov r11,rbp \t\t; modulus\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand r11,r8\n-\tshrd r8,r9,52\n-\txor r9,r9\n-\t\n-\t;; c+=2*a.n[0]*a.n[2]+a.n[1]*a.n[1]\n-\tmov rax,r14\n-\tmul rbx\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,r15\n-\tmov r12,rbp\t\t; modulus\n-\tmul rax\n-\tmov rcx,[rdi+3*8]\t; rcx=a.n[3]\n-\tadd r15,r15\t\t; r15=a.n[1]*2\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand r12,r8\t\t; only need lower dword\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=2*a.n[0]*a.n[3]+2*a.n[1]*a.n[2]\n-\tmov rax,r14\n-\tmul rcx\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,r15\t\t; rax=2*a.n[1]\n-\tmov r13,rbp\t\t; modulus\n-\tmul rbx\n-\tmov rsi,[rdi+4*8]\t; rsi=a.n[4]\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand r13,r8\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=2*a.n[0]*a.n[4]+2*a.n[1]*a.n[3]+a.n[2]*a.n[2]\n-\tmov rax,r14\t\t; last time we need 2*a.n[0]\n-\tmul rsi\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,r15\n-\tmul rcx\n-\tmov r14,rbp\t\t; modulus\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,rbx\n-\tmul rax\n-\tadd rbx,rbx\t\t; rcx=2*a.n[2]\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand r14,r8\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=2*a.n[1]*a.n[4]+2*a.n[2]*a.n[3]\n-\tmov rax,r15\t\t; last time we need 2*a.n[1]\n-\tmul rsi\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,rbx\n-\tmul rcx\n-\tmov r15,rbp\t\t; modulus\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand r15,r8\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=2*a.n[2]*a.n[4]+a.n[3]*a.n[3]\n-\tmov rax,rbx\t\t; last time we need 2*a.n[2]\n-\tmul rsi\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,rcx\t\t; a.n[3]\n-\tmul rax\n-\tmov rbx,rbp\t\t; modulus\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand rbx,r8\t\t; only need lower dword\n-\tlea rax,[2*rcx]\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=2*a.n[3]*a.n[4]\n-\tmul rsi\n-\tmov rcx,rbp\t\t; modulus\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand rcx,r8\t\t; only need lower dword\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=a.n[4]*a.n[4]\n-\tmov rax,rsi\n-\tmul rax\n-\t;; mov rbp,rbp\t\t; modulus is already there!\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand rbp,r8 \n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\tmov rsi,r8\n-\n-\t;; *******************************************************\n-\tjmp common_exit_norm\n-\tend\n-\n-\t"
      },
      {
        "sha": "af12fd30d2cf629e18fb8be72b2277d9f04528d2",
        "filename": "src/field_5x52_asm_impl.h",
        "status": "modified",
        "additions": 492,
        "deletions": 3,
        "changes": 495,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/field_5x52_asm_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/field_5x52_asm_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/field_5x52_asm_impl.h?ref=4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "patch": "@@ -1,13 +1,502 @@\n /**********************************************************************\n- * Copyright (c) 2013 Pieter Wuille                                   *\n+ * Copyright (c) 2013-2014 Diederik Huys, Pieter Wuille               *\n  * Distributed under the MIT software license, see the accompanying   *\n  * file COPYING or http://www.opensource.org/licenses/mit-license.php.*\n  **********************************************************************/\n \n+/**\n+ * Changelog:\n+ * - March 2013, Diederik Huys:    original version\n+ * - November 2014, Pieter Wuille: updated to use Peter Dettman's parallel multiplication algorithm\n+ * - December 2014, Pieter Wuille: converted from YASM to GCC inline assembly\n+ */\n+\n #ifndef _SECP256K1_FIELD_INNER5X52_IMPL_H_\n #define _SECP256K1_FIELD_INNER5X52_IMPL_H_\n \n-void __attribute__ ((sysv_abi)) secp256k1_fe_mul_inner(const uint64_t *a, const uint64_t *b, uint64_t *r);\n-void __attribute__ ((sysv_abi)) secp256k1_fe_sqr_inner(const uint64_t *a, uint64_t *r);\n+SECP256K1_INLINE static void secp256k1_fe_mul_inner(uint64_t *r, const uint64_t *a, const uint64_t * SECP256K1_RESTRICT b) {\n+/**\n+ * Registers: rdx:rax = multiplication accumulator\n+ *            r9:r8   = c\n+ *            r15:rcx = d\n+ *            r10-r14 = a0-a4\n+ *            rbx     = b\n+ *            %2      = r\n+ *            %0      = a / t?\n+ *            rbp     = R (0x1000003d10)\n+ */\n+__asm__ __volatile__(\n+    \"pushq %%rbp\\n\"\n+\n+    \"movq 0(%0),%%r10\\n\"\n+    \"movq 8(%0),%%r11\\n\"\n+    \"movq 16(%0),%%r12\\n\"\n+    \"movq 24(%0),%%r13\\n\"\n+    \"movq 32(%0),%%r14\\n\"\n+    \"movq $0x1000003d10,%%rbp\\n\"\n+\n+    /* d += a3 * b0 */\n+    \"movq 0(%%rbx),%%rax\\n\"\n+    \"mulq %%r13\\n\"\n+    \"movq %%rax,%%rcx\\n\"\n+    \"movq %%rdx,%%r15\\n\"\n+    /* d += a2 * b1 */\n+    \"movq 8(%%rbx),%%rax\\n\"\n+    \"mulq %%r12\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a1 * b2 */\n+    \"movq 16(%%rbx),%%rax\\n\"\n+    \"mulq %%r11\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d = a0 * b3 */\n+    \"movq 24(%%rbx),%%rax\\n\"\n+    \"mulq %%r10\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* c = a4 * b4 */\n+    \"movq 32(%%rbx),%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"movq %%rax,%%r8\\n\"\n+    \"movq %%rdx,%%r9\\n\"\n+    /* d += (c & M) * R */\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* c >>= 52 (%%r8 only) */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    /* t3 (stack) = d & M */\n+    \"movq %%rcx,%0\\n\"\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%0\\n\"\n+    \"pushq %0\\n\"\n+    /* d >>= 52 */\n+    \"shrdq $52,%%r15,%%rcx\\n\"\n+    \"xorq %%r15,%%r15\\n\"\n+    /* d += a4 * b0 */\n+    \"movq 0(%%rbx),%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a3 * b1 */\n+    \"movq 8(%%rbx),%%rax\\n\"\n+    \"mulq %%r13\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a2 * b2 */\n+    \"movq 16(%%rbx),%%rax\\n\"\n+    \"mulq %%r12\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a1 * b3 */\n+    \"movq 24(%%rbx),%%rax\\n\"\n+    \"mulq %%r11\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a0 * b4 */\n+    \"movq 32(%%rbx),%%rax\\n\"\n+    \"mulq %%r10\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += c * R */\n+    \"movq %%r8,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* t4 = d & M (%0) */\n+    \"movq %%rcx,%0\\n\"\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%0\\n\"\n+    /* d >>= 52 */\n+    \"shrdq $52,%%r15,%%rcx\\n\"\n+    \"xorq %%r15,%%r15\\n\"\n+    /* tx = t4 >> 48 (%%rbp, overwrites R) */\n+    \"movq %0,%%rbp\\n\"\n+    \"shrq $48,%%rbp\\n\"\n+    /* t4 &= (M >> 4) (stack) */\n+    \"movq $0xffffffffffff,%%rax\\n\"\n+    \"andq %%rax,%0\\n\"\n+    \"pushq %0\\n\"\n+    /* c = a0 * b0 */\n+    \"movq 0(%%rbx),%%rax\\n\"\n+    \"mulq %%r10\\n\"\n+    \"movq %%rax,%%r8\\n\"\n+    \"movq %%rdx,%%r9\\n\"\n+    /* d += a4 * b1 */\n+    \"movq 8(%%rbx),%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a3 * b2 */\n+    \"movq 16(%%rbx),%%rax\\n\"\n+    \"mulq %%r13\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a2 * b3 */\n+    \"movq 24(%%rbx),%%rax\\n\"\n+    \"mulq %%r12\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a1 * b4 */\n+    \"movq 32(%%rbx),%%rax\\n\"\n+    \"mulq %%r11\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* u0 = d & M (%0) */\n+    \"movq %%rcx,%0\\n\"\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%0\\n\"\n+    /* d >>= 52 */\n+    \"shrdq $52,%%r15,%%rcx\\n\"\n+    \"xorq %%r15,%%r15\\n\"\n+    /* u0 = (u0 << 4) | tx (%0) */\n+    \"shlq $4,%0\\n\"\n+    \"orq %%rbp,%0\\n\"\n+    /* c += u0 * (R >> 4) */\n+    \"movq $0x1000003d1,%%rax\\n\"\n+    \"mulq %0\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* r[0] = c & M */\n+    \"movq %%r8,%%rax\\n\"\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%%rax\\n\"\n+    \"movq %%rax,0(%2)\\n\"\n+    /* c >>= 52 */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    \"xorq %%r9,%%r9\\n\"\n+    /* c += a1 * b0 */\n+    \"movq 0(%%rbx),%%rax\\n\"\n+    \"mulq %%r11\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* c += a0 * b1 */\n+    \"movq 8(%%rbx),%%rax\\n\"\n+    \"mulq %%r10\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* d += a4 * b2 */\n+    \"movq 16(%%rbx),%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a3 * b3 */\n+    \"movq 24(%%rbx),%%rax\\n\"\n+    \"mulq %%r13\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a2 * b4 */\n+    \"movq 32(%%rbx),%%rax\\n\"\n+    \"mulq %%r12\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* restore rdp = R */\n+    \"movq $0x1000003d10,%%rbp\\n\"\n+    /* c += (d & M) * R */\n+    \"movq %%rcx,%%rax\\n\"\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* d >>= 52 */\n+    \"shrdq $52,%%r15,%%rcx\\n\"\n+    \"xorq %%r15,%%r15\\n\"\n+    /* r[1] = c & M */\n+    \"movq %%r8,%%rax\\n\"\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%%rax\\n\"\n+    \"movq %%rax,8(%2)\\n\"\n+    /* c >>= 52 */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    \"xorq %%r9,%%r9\\n\"\n+    /* c += a2 * b0 */\n+    \"movq 0(%%rbx),%%rax\\n\"\n+    \"mulq %%r12\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* c += a1 * b1 */\n+    \"movq 8(%%rbx),%%rax\\n\"\n+    \"mulq %%r11\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* c += a0 * b2 (last use of %%r10 = a0) */\n+    \"movq 16(%%rbx),%%rax\\n\"\n+    \"mulq %%r10\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* fetch t3 (%%r10, overwrites a0),t4 (%0) */\n+    \"popq %0\\n\"\n+    \"popq %%r10\\n\"\n+    /* d += a4 * b3 */\n+    \"movq 24(%%rbx),%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a3 * b4 */\n+    \"movq 32(%%rbx),%%rax\\n\"\n+    \"mulq %%r13\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* c += (d & M) * R */\n+    \"movq %%rcx,%%rax\\n\"\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* d >>= 52 (%%rcx only) */\n+    \"shrdq $52,%%r15,%%rcx\\n\"\n+    /* r[2] = c & M */\n+    \"movq %%r8,%%rax\\n\"\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%%rax\\n\"\n+    \"movq %%rax,16(%2)\\n\"\n+    /* c >>= 52 */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    \"xorq %%r9,%%r9\\n\"\n+    /* c += t3 */\n+    \"addq %%r10,%%r8\\n\"\n+    /* c += d * R */\n+    \"movq %%rcx,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* r[3] = c & M */\n+    \"movq %%r8,%%rax\\n\"\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%%rax\\n\"\n+    \"movq %%rax,24(%2)\\n\"\n+    /* c >>= 52 (%%r8 only) */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    /* c += t4 (%%r8 only) */\n+    \"addq %0,%%r8\\n\"\n+    /* r[4] = c */\n+    \"movq %%r8,32(%2)\\n\"\n+\n+    \"popq %%rbp\\n\"\n+: \"+S\"(a)\n+: \"b\"(b), \"D\"(r)\n+: \"%rax\", \"%rcx\", \"%rdx\", \"%r8\", \"%r9\", \"%r10\", \"%r11\", \"%r12\", \"%r13\", \"%r14\", \"%r15\", \"cc\", \"memory\"\n+);\n+}\n+\n+SECP256K1_INLINE static void secp256k1_fe_sqr_inner(uint64_t *r, const uint64_t *a) {\n+/**\n+ * Registers: rdx:rax = multiplication accumulator\n+ *            r9:r8   = c\n+ *            rcx:rbx = d\n+ *            r10-r14 = a0-a4\n+ *            r15     = M (0xfffffffffffff)\n+ *            %1      = r\n+ *            %0      = a / t?\n+ *            rbp     = R (0x1000003d10)\n+ */\n+__asm__ __volatile__(\n+    \"pushq %%rbp\\n\"\n+\n+    \"movq 0(%0),%%r10\\n\"\n+    \"movq 8(%0),%%r11\\n\"\n+    \"movq 16(%0),%%r12\\n\"\n+    \"movq 24(%0),%%r13\\n\"\n+    \"movq 32(%0),%%r14\\n\"\n+    \"movq $0x1000003d10,%%rbp\\n\"\n+    \"movq $0xfffffffffffff,%%r15\\n\"\n+\n+    /* d = (a0*2) * a3 */\n+    \"leaq (%%r10,%%r10,1),%%rax\\n\"\n+    \"mulq %%r13\\n\"\n+    \"movq %%rax,%%rbx\\n\"\n+    \"movq %%rdx,%%rcx\\n\"\n+    /* d += (a1*2) * a2 */\n+    \"leaq (%%r11,%%r11,1),%%rax\\n\"\n+    \"mulq %%r12\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* c = a4 * a4 */\n+    \"movq %%r14,%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"movq %%rax,%%r8\\n\"\n+    \"movq %%rdx,%%r9\\n\"\n+    /* d += (c & M) * R */\n+    \"andq %%r15,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* c >>= 52 (%%r8 only) */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    /* t3 (stack) = d & M */\n+    \"movq %%rbx,%0\\n\"\n+    \"andq %%r15,%0\\n\"\n+    \"pushq %0\\n\"\n+    /* d >>= 52 */\n+    \"shrdq $52,%%rcx,%%rbx\\n\"\n+    \"xorq %%rcx,%%rcx\\n\"\n+    /* a4 *= 2 */\n+    \"addq %%r14,%%r14\\n\"\n+    /* d += a0 * a4 */\n+    \"movq %%r10,%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* d+= (a1*2) * a3 */\n+    \"leaq (%%r11,%%r11,1),%%rax\\n\"\n+    \"mulq %%r13\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* d += a2 * a2 */\n+    \"movq %%r12,%%rax\\n\"\n+    \"mulq %%r12\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* d += c * R */\n+    \"movq %%r8,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* t4 = d & M (%0) */\n+    \"movq %%rbx,%0\\n\"\n+    \"andq %%r15,%0\\n\"\n+    /* d >>= 52 */\n+    \"shrdq $52,%%rcx,%%rbx\\n\"\n+    \"xorq %%rcx,%%rcx\\n\"\n+    /* tx = t4 >> 48 (%%rbp, overwrites constant) */\n+    \"movq %0,%%rbp\\n\"\n+    \"shrq $48,%%rbp\\n\"\n+    /* t4 &= (M >> 4) (stack) */\n+    \"movq $0xffffffffffff,%%rax\\n\"\n+    \"andq %%rax,%0\\n\"\n+    \"pushq %0\\n\"\n+    /* c = a0 * a0 */\n+    \"movq %%r10,%%rax\\n\"\n+    \"mulq %%r10\\n\"\n+    \"movq %%rax,%%r8\\n\"\n+    \"movq %%rdx,%%r9\\n\"\n+    /* d += a1 * a4 */\n+    \"movq %%r11,%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* d += (a2*2) * a3 */\n+    \"leaq (%%r12,%%r12,1),%%rax\\n\"\n+    \"mulq %%r13\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* u0 = d & M (%0) */\n+    \"movq %%rbx,%0\\n\"\n+    \"andq %%r15,%0\\n\"\n+    /* d >>= 52 */\n+    \"shrdq $52,%%rcx,%%rbx\\n\"\n+    \"xorq %%rcx,%%rcx\\n\"\n+    /* u0 = (u0 << 4) | tx (%0) */\n+    \"shlq $4,%0\\n\"\n+    \"orq %%rbp,%0\\n\"\n+    /* c += u0 * (R >> 4) */\n+    \"movq $0x1000003d1,%%rax\\n\"\n+    \"mulq %0\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* r[0] = c & M */\n+    \"movq %%r8,%%rax\\n\"\n+    \"andq %%r15,%%rax\\n\"\n+    \"movq %%rax,0(%1)\\n\"\n+    /* c >>= 52 */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    \"xorq %%r9,%%r9\\n\"\n+    /* a0 *= 2 */\n+    \"addq %%r10,%%r10\\n\"\n+    /* c += a0 * a1 */\n+    \"movq %%r10,%%rax\\n\"\n+    \"mulq %%r11\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* d += a2 * a4 */\n+    \"movq %%r12,%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* d += a3 * a3 */\n+    \"movq %%r13,%%rax\\n\"\n+    \"mulq %%r13\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* load R in %%rbp */\n+    \"movq $0x1000003d10,%%rbp\\n\"\n+    /* c += (d & M) * R */\n+    \"movq %%rbx,%%rax\\n\"\n+    \"andq %%r15,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* d >>= 52 */\n+    \"shrdq $52,%%rcx,%%rbx\\n\"\n+    \"xorq %%rcx,%%rcx\\n\"\n+    /* r[1] = c & M */\n+    \"movq %%r8,%%rax\\n\"\n+    \"andq %%r15,%%rax\\n\"\n+    \"movq %%rax,8(%1)\\n\"\n+    /* c >>= 52 */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    \"xorq %%r9,%%r9\\n\"\n+    /* c += a0 * a2 (last use of %%r10) */\n+    \"movq %%r10,%%rax\\n\"\n+    \"mulq %%r12\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* fetch t3 (%%r10, overwrites a0),t4 (%0) */\n+    \"popq %0\\n\"\n+    \"popq %%r10\\n\"\n+    /* c += a1 * a1 */\n+    \"movq %%r11,%%rax\\n\"\n+    \"mulq %%r11\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* d += a3 * a4 */\n+    \"movq %%r13,%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* c += (d & M) * R */\n+    \"movq %%rbx,%%rax\\n\"\n+    \"andq %%r15,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* d >>= 52 (%%rbx only) */\n+    \"shrdq $52,%%rcx,%%rbx\\n\"\n+    /* r[2] = c & M */\n+    \"movq %%r8,%%rax\\n\"\n+    \"andq %%r15,%%rax\\n\"\n+    \"movq %%rax,16(%1)\\n\"\n+    /* c >>= 52 */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    \"xorq %%r9,%%r9\\n\"\n+    /* c += t3 */\n+    \"addq %%r10,%%r8\\n\"\n+    /* c += d * R */\n+    \"movq %%rbx,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* r[3] = c & M */\n+    \"movq %%r8,%%rax\\n\"\n+    \"andq %%r15,%%rax\\n\"\n+    \"movq %%rax,24(%1)\\n\"\n+    /* c >>= 52 (%%r8 only) */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    /* c += t4 (%%r8 only) */\n+    \"addq %0,%%r8\\n\"\n+    /* r[4] = c */\n+    \"movq %%r8,32(%1)\\n\"\n+\n+    \"popq %%rbp\\n\"\n+: \"+S\"(a)\n+: \"D\"(r)\n+: \"%rax\", \"%rbx\", \"%rcx\", \"%rdx\", \"%r8\", \"%r9\", \"%r10\", \"%r11\", \"%r12\", \"%r13\", \"%r14\", \"%r15\", \"cc\", \"memory\"\n+);\n+}\n \n #endif"
      },
      {
        "sha": "63176d6de406cf1276a612904be248e13550576a",
        "filename": "src/field_5x52_impl.h",
        "status": "modified",
        "additions": 46,
        "deletions": 2,
        "changes": 48,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/field_5x52_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/field_5x52_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/field_5x52_impl.h?ref=4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "patch": "@@ -102,6 +102,50 @@ static void secp256k1_fe_normalize(secp256k1_fe_t *r) {\n #endif\n }\n \n+static void secp256k1_fe_normalize_var(secp256k1_fe_t *r) {\n+    uint64_t t0 = r->n[0], t1 = r->n[1], t2 = r->n[2], t3 = r->n[3], t4 = r->n[4];\n+\n+    /* Reduce t4 at the start so there will be at most a single carry from the first pass */\n+    uint64_t x = t4 >> 48; t4 &= 0x0FFFFFFFFFFFFULL;\n+    uint64_t m;\n+\n+    /* The first pass ensures the magnitude is 1, ... */\n+    t0 += x * 0x1000003D1ULL;\n+    t1 += (t0 >> 52); t0 &= 0xFFFFFFFFFFFFFULL;\n+    t2 += (t1 >> 52); t1 &= 0xFFFFFFFFFFFFFULL; m = t1;\n+    t3 += (t2 >> 52); t2 &= 0xFFFFFFFFFFFFFULL; m &= t2;\n+    t4 += (t3 >> 52); t3 &= 0xFFFFFFFFFFFFFULL; m &= t3;\n+\n+    /* ... except for a possible carry at bit 48 of t4 (i.e. bit 256 of the field element) */\n+    VERIFY_CHECK(t4 >> 49 == 0);\n+\n+    /* At most a single final reduction is needed; check if the value is >= the field characteristic */\n+    x = (t4 >> 48) | ((t4 == 0x0FFFFFFFFFFFFULL) & (m == 0xFFFFFFFFFFFFFULL)\n+        & (t0 >= 0xFFFFEFFFFFC2FULL));\n+\n+    if (x) {\n+        t0 += 0x1000003D1ULL;\n+        t1 += (t0 >> 52); t0 &= 0xFFFFFFFFFFFFFULL;\n+        t2 += (t1 >> 52); t1 &= 0xFFFFFFFFFFFFFULL;\n+        t3 += (t2 >> 52); t2 &= 0xFFFFFFFFFFFFFULL;\n+        t4 += (t3 >> 52); t3 &= 0xFFFFFFFFFFFFFULL;\n+\n+        /* If t4 didn't carry to bit 48 already, then it should have after any final reduction */\n+        VERIFY_CHECK(t4 >> 48 == x);\n+\n+        /* Mask off the possible multiple of 2^256 from the final reduction */\n+        t4 &= 0x0FFFFFFFFFFFFULL;\n+    }\n+\n+    r->n[0] = t0; r->n[1] = t1; r->n[2] = t2; r->n[3] = t3; r->n[4] = t4;\n+\n+#ifdef VERIFY\n+    r->magnitude = 1;\n+    r->normalized = 1;\n+    secp256k1_fe_verify(r);\n+#endif\n+}\n+\n SECP256K1_INLINE static void secp256k1_fe_set_int(secp256k1_fe_t *r, int a) {\n     r->n[0] = a;\n     r->n[1] = r->n[2] = r->n[3] = r->n[4] = 0;\n@@ -255,7 +299,7 @@ static void secp256k1_fe_mul(secp256k1_fe_t *r, const secp256k1_fe_t *a, const s\n     secp256k1_fe_verify(b);\n     VERIFY_CHECK(r != b);\n #endif\n-    secp256k1_fe_mul_inner(a->n, b->n, r->n);\n+    secp256k1_fe_mul_inner(r->n, a->n, b->n);\n #ifdef VERIFY\n     r->magnitude = 1;\n     r->normalized = 0;\n@@ -268,7 +312,7 @@ static void secp256k1_fe_sqr(secp256k1_fe_t *r, const secp256k1_fe_t *a) {\n     VERIFY_CHECK(a->magnitude <= 8);\n     secp256k1_fe_verify(a);\n #endif\n-    secp256k1_fe_sqr_inner(a->n, r->n);\n+    secp256k1_fe_sqr_inner(r->n, a->n);\n #ifdef VERIFY\n     r->magnitude = 1;\n     r->normalized = 0;"
      },
      {
        "sha": "ec631833cfa1ad86109691ae05f60d05de933423",
        "filename": "src/field_5x52_int128_impl.h",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/field_5x52_int128_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/field_5x52_int128_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/field_5x52_int128_impl.h?ref=4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "patch": "@@ -15,7 +15,7 @@\n #define VERIFY_BITS(x, n) do { } while(0)\n #endif\n \n-SECP256K1_INLINE static void secp256k1_fe_mul_inner(const uint64_t *a, const uint64_t * SECP256K1_RESTRICT b, uint64_t *r) {\n+SECP256K1_INLINE static void secp256k1_fe_mul_inner(uint64_t *r, const uint64_t *a, const uint64_t * SECP256K1_RESTRICT b) {\n     VERIFY_BITS(a[0], 56);\n     VERIFY_BITS(a[1], 56);\n     VERIFY_BITS(a[2], 56);\n@@ -152,7 +152,7 @@ SECP256K1_INLINE static void secp256k1_fe_mul_inner(const uint64_t *a, const uin\n     /* [r4 r3 r2 r1 r0] = [p8 p7 p6 p5 p4 p3 p2 p1 p0] */\n }\n \n-SECP256K1_INLINE static void secp256k1_fe_sqr_inner(const uint64_t *a, uint64_t *r) {\n+SECP256K1_INLINE static void secp256k1_fe_sqr_inner(uint64_t *r, const uint64_t *a) {\n     VERIFY_BITS(a[0], 56);\n     VERIFY_BITS(a[1], 56);\n     VERIFY_BITS(a[2], 56);"
      },
      {
        "sha": "73a55c4f00d4523f5851daa9c45ffd5f9ca6dd2e",
        "filename": "src/field_gmp_impl.h",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/field_gmp_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/field_gmp_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/field_gmp_impl.h?ref=4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "patch": "@@ -46,6 +46,10 @@ static void secp256k1_fe_normalize(secp256k1_fe_t *r) {\n         mpn_sub(r->n, r->n, FIELD_LIMBS, secp256k1_field_p, FIELD_LIMBS);\n }\n \n+static void secp256k1_fe_normalize_var(secp256k1_fe_t *r) {\n+    secp256k1_fe_normalize(r);\n+}\n+\n SECP256K1_INLINE static void secp256k1_fe_set_int(secp256k1_fe_t *r, int a) {\n     r->n[0] = a;\n     for (int i=1; i<FIELD_LIMBS+1; i++)"
      },
      {
        "sha": "24d3104ed188b1e23b8ef2d448903b5da2900c08",
        "filename": "src/field_impl.h",
        "status": "modified",
        "additions": 4,
        "deletions": 28,
        "changes": 32,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/field_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/field_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/field_impl.h?ref=4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "patch": "@@ -66,7 +66,7 @@ static int secp256k1_fe_set_hex(secp256k1_fe_t *r, const char *a, int alen) {\n     return secp256k1_fe_set_b32(r, tmp);\n }\n \n-static int secp256k1_fe_sqrt(secp256k1_fe_t *r, const secp256k1_fe_t *a) {\n+static int secp256k1_fe_sqrt_var(secp256k1_fe_t *r, const secp256k1_fe_t *a) {\n \n     /** The binary representation of (p + 1)/4 has 3 blocks of 1s, with lengths in\n      *  { 2, 22, 223 }. Use an addition chain to calculate 2^n - 1 for each block:\n@@ -132,7 +132,7 @@ static int secp256k1_fe_sqrt(secp256k1_fe_t *r, const secp256k1_fe_t *a) {\n     secp256k1_fe_sqr(&t1, r);\n     secp256k1_fe_negate(&t1, &t1, 1);\n     secp256k1_fe_add(&t1, a);\n-    secp256k1_fe_normalize(&t1);\n+    secp256k1_fe_normalize_var(&t1);\n     return secp256k1_fe_is_zero(&t1);\n }\n \n@@ -206,7 +206,7 @@ static void secp256k1_fe_inv_var(secp256k1_fe_t *r, const secp256k1_fe_t *a) {\n #elif defined(USE_FIELD_INV_NUM)\n     unsigned char b[32];\n     secp256k1_fe_t c = *a;\n-    secp256k1_fe_normalize(&c);\n+    secp256k1_fe_normalize_var(&c);\n     secp256k1_fe_get_b32(b, &c);\n     secp256k1_num_t n;\n     secp256k1_num_set_bin(&n, b, 32);\n@@ -218,30 +218,6 @@ static void secp256k1_fe_inv_var(secp256k1_fe_t *r, const secp256k1_fe_t *a) {\n #endif\n }\n \n-static void secp256k1_fe_inv_all(size_t len, secp256k1_fe_t r[len], const secp256k1_fe_t a[len]) {\n-    if (len < 1)\n-        return;\n-\n-    VERIFY_CHECK((r + len <= a) || (a + len <= r));\n-\n-    r[0] = a[0];\n-\n-    size_t i = 0;\n-    while (++i < len) {\n-        secp256k1_fe_mul(&r[i], &r[i - 1], &a[i]);\n-    }\n-\n-    secp256k1_fe_t u; secp256k1_fe_inv(&u, &r[--i]);\n-\n-    while (i > 0) {\n-        int j = i--;\n-        secp256k1_fe_mul(&r[j], &r[i], &u);\n-        secp256k1_fe_mul(&u, &u, &a[j]);\n-    }\n-\n-    r[0] = u;\n-}\n-\n static void secp256k1_fe_inv_all_var(size_t len, secp256k1_fe_t r[len], const secp256k1_fe_t a[len]) {\n     if (len < 1)\n         return;\n@@ -277,7 +253,7 @@ static void secp256k1_fe_start(void) {\n #endif\n     if (secp256k1_fe_consts == NULL) {\n         secp256k1_fe_inner_start();\n-        secp256k1_fe_consts_t *ret = (secp256k1_fe_consts_t*)malloc(sizeof(secp256k1_fe_consts_t));\n+        secp256k1_fe_consts_t *ret = (secp256k1_fe_consts_t*)checked_malloc(sizeof(secp256k1_fe_consts_t));\n #ifndef USE_NUM_NONE\n         secp256k1_num_set_bin(&ret->p, secp256k1_fe_consts_p, sizeof(secp256k1_fe_consts_p));\n #endif"
      },
      {
        "sha": "ecfebcdc0c0dc3c387952b2315f89847204f0da1",
        "filename": "src/group.h",
        "status": "modified",
        "additions": 4,
        "deletions": 3,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/group.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/group.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/group.h?ref=4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "patch": "@@ -51,15 +51,16 @@ static void secp256k1_ge_set_xy(secp256k1_ge_t *r, const secp256k1_fe_t *x, cons\n \n /** Set a group element (affine) equal to the point with the given X coordinate, and given oddness\n  *  for Y. Return value indicates whether the result is valid. */\n-static int secp256k1_ge_set_xo(secp256k1_ge_t *r, const secp256k1_fe_t *x, int odd);\n+static int secp256k1_ge_set_xo_var(secp256k1_ge_t *r, const secp256k1_fe_t *x, int odd);\n \n /** Check whether a group element is the point at infinity. */\n static int secp256k1_ge_is_infinity(const secp256k1_ge_t *a);\n \n /** Check whether a group element is valid (i.e., on the curve). */\n-static int secp256k1_ge_is_valid(const secp256k1_ge_t *a);\n+static int secp256k1_ge_is_valid_var(const secp256k1_ge_t *a);\n \n static void secp256k1_ge_neg(secp256k1_ge_t *r, const secp256k1_ge_t *a);\n+static void secp256k1_ge_neg_var(secp256k1_ge_t *r, const secp256k1_ge_t *a);\n \n /** Get a hex representation of a point. *rlen will be overwritten with the real length. */\n static void secp256k1_ge_get_hex(char *r, int *rlen, const secp256k1_ge_t *a);\n@@ -84,7 +85,7 @@ static void secp256k1_gej_set_ge(secp256k1_gej_t *r, const secp256k1_ge_t *a);\n static void secp256k1_gej_get_x_var(secp256k1_fe_t *r, const secp256k1_gej_t *a);\n \n /** Set r equal to the inverse of a (i.e., mirrored around the X axis) */\n-static void secp256k1_gej_neg(secp256k1_gej_t *r, const secp256k1_gej_t *a);\n+static void secp256k1_gej_neg_var(secp256k1_gej_t *r, const secp256k1_gej_t *a);\n \n /** Check whether a group element is the point at infinity. */\n static int secp256k1_gej_is_infinity(const secp256k1_gej_t *a);"
      },
      {
        "sha": "1ab5d5fe7bfc8e77d2728af9511fae6316d53a4f",
        "filename": "src/group_impl.h",
        "status": "modified",
        "additions": 32,
        "deletions": 27,
        "changes": 59,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/group_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/group_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/group_impl.h?ref=4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "patch": "@@ -28,13 +28,17 @@ static int secp256k1_ge_is_infinity(const secp256k1_ge_t *a) {\n }\n \n static void secp256k1_ge_neg(secp256k1_ge_t *r, const secp256k1_ge_t *a) {\n-    r->infinity = a->infinity;\n-    r->x = a->x;\n-    r->y = a->y;\n+    *r = *a;\n     secp256k1_fe_normalize(&r->y);\n     secp256k1_fe_negate(&r->y, &r->y, 1);\n }\n \n+static void secp256k1_ge_neg_var(secp256k1_ge_t *r, const secp256k1_ge_t *a) {\n+    *r = *a;\n+    secp256k1_fe_normalize_var(&r->y);\n+    secp256k1_fe_negate(&r->y, &r->y, 1);\n+}\n+\n static void secp256k1_ge_get_hex(char *r, int *rlen, const secp256k1_ge_t *a) {\n     char cx[65]; int lx=65;\n     char cy[65]; int ly=65;\n@@ -85,15 +89,16 @@ static void secp256k1_ge_set_gej_var(secp256k1_ge_t *r, secp256k1_gej_t *a) {\n \n static void secp256k1_ge_set_all_gej_var(size_t len, secp256k1_ge_t r[len], const secp256k1_gej_t a[len]) {\n     size_t count = 0;\n-    secp256k1_fe_t az[len];\n+    secp256k1_fe_t *az = checked_malloc(sizeof(secp256k1_fe_t) * len);\n     for (size_t i=0; i<len; i++) {\n         if (!a[i].infinity) {\n             az[count++] = a[i].z;\n         }\n     }\n \n-    secp256k1_fe_t azi[count];\n+    secp256k1_fe_t *azi = checked_malloc(sizeof(secp256k1_fe_t) * count);\n     secp256k1_fe_inv_all_var(count, azi, az);\n+    free(az);\n \n     count = 0;\n     for (size_t i=0; i<len; i++) {\n@@ -106,6 +111,7 @@ static void secp256k1_ge_set_all_gej_var(size_t len, secp256k1_ge_t r[len], cons\n             secp256k1_fe_mul(&r[i].y, &a[i].y, &zi3);\n         }\n     }\n+    free(azi);\n }\n \n static void secp256k1_gej_set_infinity(secp256k1_gej_t *r) {\n@@ -135,16 +141,16 @@ static void secp256k1_ge_clear(secp256k1_ge_t *r) {\n     secp256k1_fe_clear(&r->y);\n }\n \n-static int secp256k1_ge_set_xo(secp256k1_ge_t *r, const secp256k1_fe_t *x, int odd) {\n+static int secp256k1_ge_set_xo_var(secp256k1_ge_t *r, const secp256k1_fe_t *x, int odd) {\n     r->x = *x;\n     secp256k1_fe_t x2; secp256k1_fe_sqr(&x2, x);\n     secp256k1_fe_t x3; secp256k1_fe_mul(&x3, x, &x2);\n     r->infinity = 0;\n     secp256k1_fe_t c; secp256k1_fe_set_int(&c, 7);\n     secp256k1_fe_add(&c, &x3);\n-    if (!secp256k1_fe_sqrt(&r->y, &c))\n+    if (!secp256k1_fe_sqrt_var(&r->y, &c))\n         return 0;\n-    secp256k1_fe_normalize(&r->y);\n+    secp256k1_fe_normalize_var(&r->y);\n     if (secp256k1_fe_is_odd(&r->y) != odd)\n         secp256k1_fe_negate(&r->y, &r->y, 1);\n     return 1;\n@@ -162,20 +168,20 @@ static void secp256k1_gej_get_x_var(secp256k1_fe_t *r, const secp256k1_gej_t *a)\n     secp256k1_fe_mul(r, &a->x, &zi2);\n }\n \n-static void secp256k1_gej_neg(secp256k1_gej_t *r, const secp256k1_gej_t *a) {\n+static void secp256k1_gej_neg_var(secp256k1_gej_t *r, const secp256k1_gej_t *a) {\n     r->infinity = a->infinity;\n     r->x = a->x;\n     r->y = a->y;\n     r->z = a->z;\n-    secp256k1_fe_normalize(&r->y);\n+    secp256k1_fe_normalize_var(&r->y);\n     secp256k1_fe_negate(&r->y, &r->y, 1);\n }\n \n static int secp256k1_gej_is_infinity(const secp256k1_gej_t *a) {\n     return a->infinity;\n }\n \n-static int secp256k1_gej_is_valid(const secp256k1_gej_t *a) {\n+static int secp256k1_gej_is_valid_var(const secp256k1_gej_t *a) {\n     if (a->infinity)\n         return 0;\n     /** y^2 = x^3 + 7\n@@ -189,21 +195,21 @@ static int secp256k1_gej_is_valid(const secp256k1_gej_t *a) {\n     secp256k1_fe_t z6; secp256k1_fe_sqr(&z6, &z2); secp256k1_fe_mul(&z6, &z6, &z2);\n     secp256k1_fe_mul_int(&z6, 7);\n     secp256k1_fe_add(&x3, &z6);\n-    secp256k1_fe_normalize(&y2);\n-    secp256k1_fe_normalize(&x3);\n+    secp256k1_fe_normalize_var(&y2);\n+    secp256k1_fe_normalize_var(&x3);\n     return secp256k1_fe_equal(&y2, &x3);\n }\n \n-static int secp256k1_ge_is_valid(const secp256k1_ge_t *a) {\n+static int secp256k1_ge_is_valid_var(const secp256k1_ge_t *a) {\n     if (a->infinity)\n         return 0;\n     /* y^2 = x^3 + 7 */\n     secp256k1_fe_t y2; secp256k1_fe_sqr(&y2, &a->y);\n     secp256k1_fe_t x3; secp256k1_fe_sqr(&x3, &a->x); secp256k1_fe_mul(&x3, &x3, &a->x);\n     secp256k1_fe_t c; secp256k1_fe_set_int(&c, 7);\n     secp256k1_fe_add(&x3, &c);\n-    secp256k1_fe_normalize(&y2);\n-    secp256k1_fe_normalize(&x3);\n+    secp256k1_fe_normalize_var(&y2);\n+    secp256k1_fe_normalize_var(&x3);\n     return secp256k1_fe_equal(&y2, &x3);\n }\n \n@@ -255,11 +261,11 @@ static void secp256k1_gej_add_var(secp256k1_gej_t *r, const secp256k1_gej_t *a,\n     secp256k1_fe_t u2; secp256k1_fe_mul(&u2, &b->x, &z12);\n     secp256k1_fe_t s1; secp256k1_fe_mul(&s1, &a->y, &z22); secp256k1_fe_mul(&s1, &s1, &b->z);\n     secp256k1_fe_t s2; secp256k1_fe_mul(&s2, &b->y, &z12); secp256k1_fe_mul(&s2, &s2, &a->z);\n-    secp256k1_fe_normalize(&u1);\n-    secp256k1_fe_normalize(&u2);\n+    secp256k1_fe_normalize_var(&u1);\n+    secp256k1_fe_normalize_var(&u2);\n     if (secp256k1_fe_equal(&u1, &u2)) {\n-        secp256k1_fe_normalize(&s1);\n-        secp256k1_fe_normalize(&s2);\n+        secp256k1_fe_normalize_var(&s1);\n+        secp256k1_fe_normalize_var(&s2);\n         if (secp256k1_fe_equal(&s1, &s2)) {\n             secp256k1_gej_double_var(r, a);\n         } else {\n@@ -294,15 +300,14 @@ static void secp256k1_gej_add_ge_var(secp256k1_gej_t *r, const secp256k1_gej_t *\n     }\n     r->infinity = 0;\n     secp256k1_fe_t z12; secp256k1_fe_sqr(&z12, &a->z);\n-    secp256k1_fe_t u1 = a->x; secp256k1_fe_normalize(&u1);\n+    secp256k1_fe_t u1 = a->x;\n     secp256k1_fe_t u2; secp256k1_fe_mul(&u2, &b->x, &z12);\n-    secp256k1_fe_t s1 = a->y; secp256k1_fe_normalize(&s1);\n+    secp256k1_fe_t s1 = a->y; secp256k1_fe_normalize_var(&s1);\n     secp256k1_fe_t s2; secp256k1_fe_mul(&s2, &b->y, &z12); secp256k1_fe_mul(&s2, &s2, &a->z);\n-    secp256k1_fe_normalize(&u1);\n-    secp256k1_fe_normalize(&u2);\n+    secp256k1_fe_normalize_var(&u1);\n+    secp256k1_fe_normalize_var(&u2);\n     if (secp256k1_fe_equal(&u1, &u2)) {\n-        secp256k1_fe_normalize(&s1);\n-        secp256k1_fe_normalize(&s2);\n+        secp256k1_fe_normalize_var(&s2);\n         if (secp256k1_fe_equal(&s1, &s2)) {\n             secp256k1_gej_double_var(r, a);\n         } else {\n@@ -434,7 +439,7 @@ static void secp256k1_ge_start(void) {\n     };\n #endif\n     if (secp256k1_ge_consts == NULL) {\n-        secp256k1_ge_consts_t *ret = (secp256k1_ge_consts_t*)malloc(sizeof(secp256k1_ge_consts_t));\n+        secp256k1_ge_consts_t *ret = (secp256k1_ge_consts_t*)checked_malloc(sizeof(secp256k1_ge_consts_t));\n #ifdef USE_ENDOMORPHISM\n         VERIFY_CHECK(secp256k1_fe_set_b32(&ret->beta, secp256k1_ge_consts_beta));\n #endif"
      },
      {
        "sha": "4408cce2d887b9ccd7b0b2eeb4bf8d28ce50d392",
        "filename": "src/scalar_impl.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/scalar_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/scalar_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/scalar_impl.h?ref=4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "patch": "@@ -40,7 +40,7 @@ static void secp256k1_scalar_start(void) {\n         return;\n \n     /* Allocate. */\n-    secp256k1_scalar_consts_t *ret = (secp256k1_scalar_consts_t*)malloc(sizeof(secp256k1_scalar_consts_t));\n+    secp256k1_scalar_consts_t *ret = (secp256k1_scalar_consts_t*)checked_malloc(sizeof(secp256k1_scalar_consts_t));\n \n #ifndef USE_NUM_NONE\n     static const unsigned char secp256k1_scalar_consts_order[] = {"
      },
      {
        "sha": "305a240e6c652b6776f278e1da29e53e94fe95e5",
        "filename": "src/tests.c",
        "status": "modified",
        "additions": 8,
        "deletions": 26,
        "changes": 34,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/tests.c",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/tests.c",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/tests.c?ref=4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "patch": "@@ -46,7 +46,7 @@ void random_group_element_test(secp256k1_ge_t *ge) {\n     secp256k1_fe_t fe;\n     do {\n         random_field_element_test(&fe);\n-        if (secp256k1_ge_set_xo(ge, &fe, secp256k1_rand32() & 1))\n+        if (secp256k1_ge_set_xo_var(ge, &fe, secp256k1_rand32() & 1))\n             break;\n     } while(1);\n }\n@@ -459,7 +459,7 @@ void random_fe_non_zero(secp256k1_fe_t *nz) {\n void random_fe_non_square(secp256k1_fe_t *ns) {\n     random_fe_non_zero(ns);\n     secp256k1_fe_t r;\n-    if (secp256k1_fe_sqrt(&r, ns)) {\n+    if (secp256k1_fe_sqrt_var(&r, ns)) {\n         secp256k1_fe_negate(ns, ns, 1);\n     }\n }\n@@ -498,23 +498,6 @@ void run_field_inv_var(void) {\n     }\n }\n \n-void run_field_inv_all(void) {\n-    secp256k1_fe_t x[16], xi[16], xii[16];\n-    /* Check it's safe to call for 0 elements */\n-    secp256k1_fe_inv_all(0, xi, x);\n-    for (int i=0; i<count; i++) {\n-        size_t len = (secp256k1_rand32() & 15) + 1;\n-        for (size_t j=0; j<len; j++)\n-            random_fe_non_zero(&x[j]);\n-        secp256k1_fe_inv_all(len, xi, x);\n-        for (size_t j=0; j<len; j++)\n-            CHECK(check_fe_inverse(&x[j], &xi[j]));\n-        secp256k1_fe_inv_all(len, xii, xi);\n-        for (size_t j=0; j<len; j++)\n-            CHECK(check_fe_equal(&x[j], &xii[j]));\n-    }\n-}\n-\n void run_field_inv_all_var(void) {\n     secp256k1_fe_t x[16], xi[16], xii[16];\n     /* Check it's safe to call for 0 elements */\n@@ -549,7 +532,7 @@ void run_sqr(void) {\n \n void test_sqrt(const secp256k1_fe_t *a, const secp256k1_fe_t *k) {\n     secp256k1_fe_t r1, r2;\n-    int v = secp256k1_fe_sqrt(&r1, a);\n+    int v = secp256k1_fe_sqrt_var(&r1, a);\n     CHECK((v == 0) == (k == NULL));\n \n     if (k != NULL) {\n@@ -779,22 +762,22 @@ void test_point_times_order(const secp256k1_gej_t *point) {\n     secp256k1_ecmult(&res2, point, &nx, &nx); /* calc res2 = (order - x) * point + (order - x) * G; */\n     secp256k1_gej_add_var(&res1, &res1, &res2);\n     CHECK(secp256k1_gej_is_infinity(&res1));\n-    CHECK(secp256k1_gej_is_valid(&res1) == 0);\n+    CHECK(secp256k1_gej_is_valid_var(&res1) == 0);\n     secp256k1_ge_t res3;\n     secp256k1_ge_set_gej(&res3, &res1);\n     CHECK(secp256k1_ge_is_infinity(&res3));\n-    CHECK(secp256k1_ge_is_valid(&res3) == 0);\n+    CHECK(secp256k1_ge_is_valid_var(&res3) == 0);\n }\n \n void run_point_times_order(void) {\n     secp256k1_fe_t x; VERIFY_CHECK(secp256k1_fe_set_hex(&x, \"02\", 2));\n     for (int i=0; i<500; i++) {\n         secp256k1_ge_t p;\n-        if (secp256k1_ge_set_xo(&p, &x, 1)) {\n-            CHECK(secp256k1_ge_is_valid(&p));\n+        if (secp256k1_ge_set_xo_var(&p, &x, 1)) {\n+            CHECK(secp256k1_ge_is_valid_var(&p));\n             secp256k1_gej_t j;\n             secp256k1_gej_set_ge(&j, &p);\n-            CHECK(secp256k1_gej_is_valid(&j));\n+            CHECK(secp256k1_gej_is_valid_var(&j));\n             test_point_times_order(&j);\n         }\n         secp256k1_fe_sqr(&x, &x);\n@@ -1185,7 +1168,6 @@ int main(int argc, char **argv) {\n     /* field tests */\n     run_field_inv();\n     run_field_inv_var();\n-    run_field_inv_all();\n     run_field_inv_all_var();\n     run_sqr();\n     run_sqrt();"
      },
      {
        "sha": "c3a8f3a42bff366b478ff0428d9d3e06b91fa9a4",
        "filename": "src/util.h",
        "status": "modified",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/util.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4903b80d6ad54ba94460cf9d5963aa7b8e897a90/src/util.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util.h?ref=4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "patch": "@@ -61,6 +61,12 @@\n #define VERIFY_CHECK(cond) do { (void)(cond); } while(0)\n #endif\n \n+static inline void *checked_malloc(size_t size) {\n+    void *ret = malloc(size);\n+    CHECK(ret != NULL);\n+    return ret;\n+}\n+\n /* Macro for restrict, when available and not in a VERIFY build. */\n #if defined(SECP256K1_BUILD) && defined(VERIFY)\n # define SECP256K1_RESTRICT"
      }
    ]
  },
  {
    "sha": "6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2ZDE5ODBmMDJlY2FkMWJjMjdjZWFhODRhZGQzZTUyYTM4NGY3YjUy",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2014-12-07T13:44:28Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2014-12-07T13:44:28Z"
      },
      "message": "Update libsecp256k1",
      "tree": {
        "sha": "27521a6d80770c2e76da559dfa9e92246e0b05d6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/27521a6d80770c2e76da559dfa9e92246e0b05d6"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4383319e4e0cb96818d2be734f7280181daac9fa",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4383319e4e0cb96818d2be734f7280181daac9fa",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4383319e4e0cb96818d2be734f7280181daac9fa"
      },
      {
        "sha": "4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4903b80d6ad54ba94460cf9d5963aa7b8e897a90",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4903b80d6ad54ba94460cf9d5963aa7b8e897a90"
      }
    ],
    "stats": {
      "total": 1395,
      "additions": 698,
      "deletions": 697
    },
    "files": [
      {
        "sha": "6e42c64f3f1990aaaf442175d3f6e4ced7806a4b",
        "filename": "src/secp256k1/Makefile.am",
        "status": "modified",
        "additions": 4,
        "deletions": 20,
        "changes": 24,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/Makefile.am",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/Makefile.am",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/Makefile.am?ref=6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "patch": "@@ -1,12 +1,6 @@\n ACLOCAL_AMFLAGS = -I build-aux/m4\n \n lib_LTLIBRARIES = libsecp256k1.la\n-if USE_ASM\n-COMMON_LIB = libsecp256k1_common.la\n-else\n-COMMON_LIB =\n-endif\n-noinst_LTLIBRARIES = $(COMMON_LIB)\n include_HEADERS = include/secp256k1.h\n noinst_HEADERS =\n noinst_HEADERS += src/scalar.h\n@@ -47,13 +41,9 @@ noinst_HEADERS += src/field_impl.h\n pkgconfigdir = $(libdir)/pkgconfig\n pkgconfig_DATA = libsecp256k1.pc\n \n-if USE_ASM\n-libsecp256k1_common_la_SOURCES = src/field_5x52_asm.asm\n-endif\n-\n libsecp256k1_la_SOURCES = src/secp256k1.c\n libsecp256k1_la_CPPFLAGS = -I$(top_srcdir)/include $(SECP_INCLUDES)\n-libsecp256k1_la_LIBADD = $(COMMON_LIB) $(SECP_LIBS)\n+libsecp256k1_la_LIBADD = $(SECP_LIBS)\n \n \n noinst_PROGRAMS =\n@@ -66,7 +56,7 @@ bench_sign_SOURCES = src/bench_sign.c\n bench_sign_LDADD = libsecp256k1.la $(SECP_LIBS)\n bench_sign_LDFLAGS = -static\n bench_inv_SOURCES = src/bench_inv.c\n-bench_inv_LDADD = $(COMMON_LIB) $(SECP_LIBS)\n+bench_inv_LDADD = $(SECP_LIBS)\n bench_inv_LDFLAGS = -static\n bench_inv_CPPFLAGS = $(SECP_INCLUDES)\n endif\n@@ -75,15 +65,9 @@ if USE_TESTS\n noinst_PROGRAMS += tests\n tests_SOURCES = src/tests.c\n tests_CPPFLAGS = -DVERIFY $(SECP_INCLUDES) $(SECP_TEST_INCLUDES)\n-tests_LDADD = $(COMMON_LIB) $(SECP_LIBS) $(SECP_TEST_LIBS)\n+tests_LDADD = $(SECP_LIBS) $(SECP_TEST_LIBS)\n tests_LDFLAGS = -static\n TESTS = tests\n endif\n \n-EXTRA_DIST = autogen.sh nasm_lt.sh\n-\n-#x86_64 only\n-if USE_ASM\n-.asm.lo:\n-\t$(LIBTOOL) --mode=compile --tag YASM $(srcdir)/nasm_lt.sh $(YASM) -f $(YASM_BINFMT) $(YAFLAGS) -I$(srcdir) -I. $< -o $@\n-endif\n+EXTRA_DIST = autogen.sh"
      },
      {
        "sha": "7163b9480900f004ff6ca8f981cd0a090ca73d11",
        "filename": "src/secp256k1/build-aux/m4/bitcoin_secp.m4",
        "status": "modified",
        "additions": 10,
        "deletions": 32,
        "changes": 42,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/build-aux/m4/bitcoin_secp.m4",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/build-aux/m4/bitcoin_secp.m4",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/build-aux/m4/bitcoin_secp.m4?ref=6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "patch": "@@ -11,38 +11,16 @@ fi\n \n dnl \n AC_DEFUN([SECP_64BIT_ASM_CHECK],[\n-if test x\"$host_cpu\" == x\"x86_64\"; then\n-  AC_CHECK_PROG(YASM, yasm, yasm)\n-else\n-  if test x\"$set_field\" = x\"64bit_asm\"; then\n-    AC_MSG_ERROR([$set_field field support explicitly requested but is not compatible with this host])\n-  fi\n-fi\n-if test x$YASM = x; then\n-  if test x\"$set_field\" = x\"64bit_asm\"; then\n-    AC_MSG_ERROR([$set_field field support explicitly requested but yasm was not found])\n-  fi\n-  has_64bit_asm=no\n-else\n-  case x\"$host_os\" in\n-  xdarwin*)\n-    YASM_BINFMT=macho64\n-    ;;\n-  x*-gnux32)\n-    YASM_BINFMT=elfx32\n-    ;;\n-  *)\n-    YASM_BINFMT=elf64\n-    ;;\n-  esac\n-  if $YASM -f help | grep -q $YASM_BINFMT; then\n-    has_64bit_asm=yes\n-  else\n-    if test x\"$set_field\" = x\"64bit_asm\"; then\n-      AC_MSG_ERROR([$set_field field support explicitly requested but yasm doesn't support $YASM_BINFMT format])\n-    fi\n-    AC_MSG_WARN([yasm too old for $YASM_BINFMT format])\n-    has_64bit_asm=no\n+AC_MSG_CHECKING(for x86_64 assembly availability)\n+AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n+  #include <stdint.h>]],[[\n+  uint64_t a = 11, tmp;\n+  __asm__ __volatile__(\"movq $0x100000000,%1; mulq %%rsi\" : \"+a\"(a) : \"S\"(tmp) : \"cc\", \"%rdx\");\n+  ]])],[has_64bit_asm=yes],[has_64bit_asm=no])\n+AC_MSG_RESULT([$has_64bit_asm])\n+if test x\"$set_field\" == x\"64bit_asm\"; then\n+  if test x\"$has_64bit_asm\" == x\"no\"; then\n+    AC_MSG_ERROR([$set_field field support explicitly requested but no x86_64 assembly available])\n   fi\n fi\n ])"
      },
      {
        "sha": "60a54051576a17d4124b8407b36195f046760023",
        "filename": "src/secp256k1/configure.ac",
        "status": "modified",
        "additions": 0,
        "deletions": 1,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/configure.ac",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/configure.ac",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/configure.ac?ref=6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "patch": "@@ -283,7 +283,6 @@ AC_SUBST(SECP_INCLUDES)\n AC_SUBST(SECP_LIBS)\n AC_SUBST(SECP_TEST_LIBS)\n AC_SUBST(SECP_TEST_INCLUDES)\n-AC_SUBST(YASM_BINFMT)\n AM_CONDITIONAL([USE_ASM], [test x\"$set_field\" == x\"64bit_asm\"])\n AM_CONDITIONAL([USE_TESTS], [test x\"$use_tests\" != x\"no\"])\n AM_CONDITIONAL([USE_BENCHMARK], [test x\"$use_benchmark\" != x\"no\"])"
      },
      {
        "sha": "6cd73294c0617c5d186926f1a7903afbde11044c",
        "filename": "src/secp256k1/nasm_lt.sh",
        "status": "removed",
        "additions": 0,
        "deletions": 57,
        "changes": 57,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4383319e4e0cb96818d2be734f7280181daac9fa/src/secp256k1/nasm_lt.sh",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4383319e4e0cb96818d2be734f7280181daac9fa/src/secp256k1/nasm_lt.sh",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/nasm_lt.sh?ref=4383319e4e0cb96818d2be734f7280181daac9fa",
        "patch": "@@ -1,57 +0,0 @@\n-#! /bin/sh\n-command=\"\"\n-infile=\"\"\n-o_opt=no\n-pic=no\n-while [ $# -gt 0 ]; do\n-    case \"$1\" in\n-        -DPIC|-fPIC|-fpic|-Kpic|-KPIC)\n-            if [ \"$pic\" != \"yes\" ] ; then\n-                command=\"$command -DPIC\"\n-                pic=yes\n-            fi\n-            ;;\n-        -f|-fbin|-faout|-faoutb|-fcoff|-felf|-felf64|-fas86| \\\n-        -fobj|-fwin32|-fwin64|-frdf|-fieee|-fmacho|-fmacho64)\n-            # it's a file format specifier for nasm.\n-            command=\"$command $1\"\n-            ;;\n-        -f*)\n-            # maybe a code-generation flag for gcc.\n-            ;;\n-        -[Ii]*)\n-            incdir=`echo \"$1\" | sed 's/^-[Ii]//'`\n-            if [ \"x$incdir\" = x -a \"x$2\" != x ] ; then\n-                case \"$2\" in\n-                    -*) ;;\n-                    *) incdir=\"$2\"; shift;;\n-                esac\n-            fi\n-            if [ \"x$incdir\" != x ] ; then\n-                # In the case of NASM, the trailing slash is necessary.\n-                incdir=`echo \"$incdir\" | sed 's%/*$%/%'`\n-                command=\"$command -I$incdir\"\n-            fi\n-            ;;\n-        -o*)\n-            o_opt=yes\n-            command=\"$command $1\"\n-            ;;\n-        *.asm)\n-            infile=$1\n-            command=\"$command $1\"\n-            ;;\n-        *)\n-            command=\"$command $1\"\n-            ;;\n-    esac\n-    shift\n-done\n-if [ \"$o_opt\" != yes ] ; then\n-    # By default, NASM creates an output file\n-    # in the same directory as the input file.\n-    outfile=\"-o `echo $infile | sed -e 's%^.*/%%' -e 's%\\.[^.]*$%%'`.o\"\n-    command=\"$command $outfile\"\n-fi\n-echo $command\n-exec $command"
      },
      {
        "sha": "8825d05fed93b6f043f24b1584431c2c7d384fc9",
        "filename": "src/secp256k1/src/ecdsa_impl.h",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/ecdsa_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/ecdsa_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/src/ecdsa_impl.h?ref=6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "patch": "@@ -27,7 +27,7 @@ static void secp256k1_ecdsa_start(void) {\n         return;\n \n     /* Allocate. */\n-    secp256k1_ecdsa_consts_t *ret = (secp256k1_ecdsa_consts_t*)malloc(sizeof(secp256k1_ecdsa_consts_t));\n+    secp256k1_ecdsa_consts_t *ret = (secp256k1_ecdsa_consts_t*)checked_malloc(sizeof(secp256k1_ecdsa_consts_t));\n \n     static const unsigned char order[] = {\n         0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,\n@@ -38,7 +38,7 @@ static void secp256k1_ecdsa_start(void) {\n \n     secp256k1_fe_set_b32(&ret->order_as_fe, order);\n     secp256k1_fe_negate(&ret->p_minus_order, &ret->order_as_fe, 1);\n-    secp256k1_fe_normalize(&ret->p_minus_order);\n+    secp256k1_fe_normalize_var(&ret->p_minus_order);\n \n     /* Set the global pointer. */\n     secp256k1_ecdsa_consts = ret;\n@@ -122,7 +122,7 @@ static int secp256k1_ecdsa_sig_recompute(secp256k1_scalar_t *r2, const secp256k1\n     secp256k1_gej_t pr; secp256k1_ecmult(&pr, &pubkeyj, &u2, &u1);\n     if (!secp256k1_gej_is_infinity(&pr)) {\n         secp256k1_fe_t xr; secp256k1_gej_get_x_var(&xr, &pr);\n-        secp256k1_fe_normalize(&xr);\n+        secp256k1_fe_normalize_var(&xr);\n         unsigned char xrb[32]; secp256k1_fe_get_b32(xrb, &xr);\n         secp256k1_scalar_set_b32(r2, xrb, NULL);\n         ret = 1;\n@@ -144,7 +144,7 @@ static int secp256k1_ecdsa_sig_recover(const secp256k1_ecdsa_sig_t *sig, secp256\n         secp256k1_fe_add(&fx, &secp256k1_ecdsa_consts->order_as_fe);\n     }\n     secp256k1_ge_t x;\n-    if (!secp256k1_ge_set_xo(&x, &fx, recid & 1))\n+    if (!secp256k1_ge_set_xo_var(&x, &fx, recid & 1))\n         return 0;\n     secp256k1_gej_t xj;\n     secp256k1_gej_set_ge(&xj, &x);"
      },
      {
        "sha": "b3fa7d9bd21a974e755e0c9f0d475e9808a264f3",
        "filename": "src/secp256k1/src/eckey_impl.h",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/eckey_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/eckey_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/src/eckey_impl.h?ref=6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "patch": "@@ -17,7 +17,7 @@\n static int secp256k1_eckey_pubkey_parse(secp256k1_ge_t *elem, const unsigned char *pub, int size) {\n     if (size == 33 && (pub[0] == 0x02 || pub[0] == 0x03)) {\n         secp256k1_fe_t x;\n-        return secp256k1_fe_set_b32(&x, pub+1) && secp256k1_ge_set_xo(elem, &x, pub[0] == 0x03);\n+        return secp256k1_fe_set_b32(&x, pub+1) && secp256k1_ge_set_xo_var(elem, &x, pub[0] == 0x03);\n     } else if (size == 65 && (pub[0] == 0x04 || pub[0] == 0x06 || pub[0] == 0x07)) {\n         secp256k1_fe_t x, y;\n         if (!secp256k1_fe_set_b32(&x, pub+1) || !secp256k1_fe_set_b32(&y, pub+33)) {\n@@ -26,7 +26,7 @@ static int secp256k1_eckey_pubkey_parse(secp256k1_ge_t *elem, const unsigned cha\n         secp256k1_ge_set_xy(elem, &x, &y);\n         if ((pub[0] == 0x06 || pub[0] == 0x07) && secp256k1_fe_is_odd(&y) != (pub[0] == 0x07))\n             return 0;\n-        return secp256k1_ge_is_valid(elem);\n+        return secp256k1_ge_is_valid_var(elem);\n     } else {\n         return 0;\n     }\n@@ -36,8 +36,8 @@ static int secp256k1_eckey_pubkey_serialize(secp256k1_ge_t *elem, unsigned char\n     if (secp256k1_ge_is_infinity(elem)) {\n         return 0;\n     }\n-    secp256k1_fe_normalize(&elem->x);\n-    secp256k1_fe_normalize(&elem->y);\n+    secp256k1_fe_normalize_var(&elem->x);\n+    secp256k1_fe_normalize_var(&elem->y);\n     secp256k1_fe_get_b32(&pub[1], &elem->x);\n     if (compressed) {\n         *size = 33;"
      },
      {
        "sha": "5a5b16ce14cf84cd4a724ce84c4a383fc5301447",
        "filename": "src/secp256k1/src/ecmult_gen_impl.h",
        "status": "modified",
        "additions": 3,
        "deletions": 3,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/ecmult_gen_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/ecmult_gen_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/src/ecmult_gen_impl.h?ref=6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "patch": "@@ -34,7 +34,7 @@ static void secp256k1_ecmult_gen_start(void) {\n         return;\n \n     /* Allocate the precomputation table. */\n-    secp256k1_ecmult_gen_consts_t *ret = (secp256k1_ecmult_gen_consts_t*)malloc(sizeof(secp256k1_ecmult_gen_consts_t));\n+    secp256k1_ecmult_gen_consts_t *ret = (secp256k1_ecmult_gen_consts_t*)checked_malloc(sizeof(secp256k1_ecmult_gen_consts_t));\n \n     /* get the generator */\n     const secp256k1_ge_t *g = &secp256k1_ge_consts->g;\n@@ -47,7 +47,7 @@ static void secp256k1_ecmult_gen_start(void) {\n         secp256k1_fe_t nums_x;\n         VERIFY_CHECK(secp256k1_fe_set_b32(&nums_x, nums_b32));\n         secp256k1_ge_t nums_ge;\n-        VERIFY_CHECK(secp256k1_ge_set_xo(&nums_ge, &nums_x, 0));\n+        VERIFY_CHECK(secp256k1_ge_set_xo_var(&nums_ge, &nums_x, 0));\n         secp256k1_gej_set_ge(&nums_gej, &nums_ge);\n         /* Add G to make the bits in x uniformly distributed. */\n         secp256k1_gej_add_ge_var(&nums_gej, &nums_gej, g);\n@@ -73,7 +73,7 @@ static void secp256k1_ecmult_gen_start(void) {\n             secp256k1_gej_double_var(&numsbase, &numsbase);\n             if (j == 62) {\n                 /* In the last iteration, numsbase is (1 - 2^j) * nums instead. */\n-                secp256k1_gej_neg(&numsbase, &numsbase);\n+                secp256k1_gej_neg_var(&numsbase, &numsbase);\n                 secp256k1_gej_add_var(&numsbase, &numsbase, &nums_gej);\n             }\n         }"
      },
      {
        "sha": "653677104699bd623b1123aa6f6ce528023ad0d8",
        "filename": "src/secp256k1/src/ecmult_impl.h",
        "status": "modified",
        "additions": 10,
        "deletions": 7,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/ecmult_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/ecmult_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/src/ecmult_impl.h?ref=6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "patch": "@@ -15,11 +15,13 @@\n #define WINDOW_A 5\n \n /** larger numbers may result in slightly better performance, at the cost of\n-    exponentially larger precomputed tables. WINDOW_G == 14 results in 640 KiB. */\n+    exponentially larger precomputed tables. */\n #ifdef USE_ENDOMORPHISM\n-#define WINDOW_G 14\n-#else\n+/** Two tables for window size 15: 1.375 MiB. */\n #define WINDOW_G 15\n+#else\n+/** One table for window size 16: 1.375 MiB. */\n+#define WINDOW_G 16\n #endif\n \n /** Fill a table 'pre' with precomputed odd multiples of a. W determines the size of the table.\n@@ -43,13 +45,14 @@ static void secp256k1_ecmult_table_precomp_gej_var(secp256k1_gej_t *pre, const s\n \n static void secp256k1_ecmult_table_precomp_ge_var(secp256k1_ge_t *pre, const secp256k1_gej_t *a, int w) {\n     const int table_size = 1 << (w-2);\n-    secp256k1_gej_t prej[table_size];\n+    secp256k1_gej_t *prej = checked_malloc(sizeof(secp256k1_gej_t) * table_size);\n     prej[0] = *a;\n     secp256k1_gej_t d; secp256k1_gej_double_var(&d, a);\n     for (int i=1; i<table_size; i++) {\n         secp256k1_gej_add_var(&prej[i], &d, &prej[i-1]);\n     }\n     secp256k1_ge_set_all_gej_var(table_size, pre, prej);\n+    free(prej);\n }\n \n /** The number of entries a table with precomputed multiples needs to have. */\n@@ -67,8 +70,8 @@ static void secp256k1_ecmult_table_precomp_ge_var(secp256k1_ge_t *pre, const sec\n         (neg)((r), &(pre)[(-(n)-1)/2]); \\\n } while(0)\n \n-#define ECMULT_TABLE_GET_GEJ(r,pre,n,w) ECMULT_TABLE_GET((r),(pre),(n),(w),secp256k1_gej_neg)\n-#define ECMULT_TABLE_GET_GE(r,pre,n,w)  ECMULT_TABLE_GET((r),(pre),(n),(w),secp256k1_ge_neg)\n+#define ECMULT_TABLE_GET_GEJ(r,pre,n,w) ECMULT_TABLE_GET((r),(pre),(n),(w),secp256k1_gej_neg_var)\n+#define ECMULT_TABLE_GET_GE(r,pre,n,w)  ECMULT_TABLE_GET((r),(pre),(n),(w),secp256k1_ge_neg_var)\n \n typedef struct {\n     /* For accelerating the computation of a*P + b*G: */\n@@ -85,7 +88,7 @@ static void secp256k1_ecmult_start(void) {\n         return;\n \n     /* Allocate the precomputation table. */\n-    secp256k1_ecmult_consts_t *ret = (secp256k1_ecmult_consts_t*)malloc(sizeof(secp256k1_ecmult_consts_t));\n+    secp256k1_ecmult_consts_t *ret = (secp256k1_ecmult_consts_t*)checked_malloc(sizeof(secp256k1_ecmult_consts_t));\n \n     /* get the generator */\n     const secp256k1_ge_t *g = &secp256k1_ge_consts->g;"
      },
      {
        "sha": "53aa29e13fd563b6f65db1bb240340d36970073e",
        "filename": "src/secp256k1/src/field.h",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/field.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/field.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/src/field.h?ref=6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "patch": "@@ -50,6 +50,9 @@ static void secp256k1_fe_stop(void);\n /** Normalize a field element. */\n static void secp256k1_fe_normalize(secp256k1_fe_t *r);\n \n+/** Normalize a field element, without constant-time guarantee. */\n+static void secp256k1_fe_normalize_var(secp256k1_fe_t *r);\n+\n /** Set a field element equal to a small integer. Resulting field element is normalized. */\n static void secp256k1_fe_set_int(secp256k1_fe_t *r, int a);\n \n@@ -93,7 +96,7 @@ static void secp256k1_fe_sqr(secp256k1_fe_t *r, const secp256k1_fe_t *a);\n /** Sets a field element to be the (modular) square root (if any exist) of another. Requires the\n  *  input's magnitude to be at most 8. The output magnitude is 1 (but not guaranteed to be\n  *  normalized). Return value indicates whether a square root was found. */\n-static int secp256k1_fe_sqrt(secp256k1_fe_t *r, const secp256k1_fe_t *a);\n+static int secp256k1_fe_sqrt_var(secp256k1_fe_t *r, const secp256k1_fe_t *a);\n \n /** Sets a field element to be the (modular) inverse of another. Requires the input's magnitude to be\n  *  at most 8. The output magnitude is 1 (but not guaranteed to be normalized). */\n@@ -105,9 +108,6 @@ static void secp256k1_fe_inv_var(secp256k1_fe_t *r, const secp256k1_fe_t *a);\n /** Calculate the (modular) inverses of a batch of field elements. Requires the inputs' magnitudes to be\n  *  at most 8. The output magnitudes are 1 (but not guaranteed to be normalized). The inputs and\n  *  outputs must not overlap in memory. */\n-static void secp256k1_fe_inv_all(size_t len, secp256k1_fe_t r[len], const secp256k1_fe_t a[len]);\n-\n-/** Potentially faster version of secp256k1_fe_inv_all, without constant-time guarantee. */\n static void secp256k1_fe_inv_all_var(size_t len, secp256k1_fe_t r[len], const secp256k1_fe_t a[len]);\n \n /** Convert a field element to a hexadecimal string. */"
      },
      {
        "sha": "d20229cda6b955615961916fde4138ceae8cdd60",
        "filename": "src/secp256k1/src/field_10x26_impl.h",
        "status": "modified",
        "additions": 60,
        "deletions": 4,
        "changes": 64,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/field_10x26_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/field_10x26_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/src/field_10x26_impl.h?ref=6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "patch": "@@ -103,6 +103,62 @@ static void secp256k1_fe_normalize(secp256k1_fe_t *r) {\n #endif\n }\n \n+static void secp256k1_fe_normalize_var(secp256k1_fe_t *r) {\n+    uint32_t t0 = r->n[0], t1 = r->n[1], t2 = r->n[2], t3 = r->n[3], t4 = r->n[4],\n+             t5 = r->n[5], t6 = r->n[6], t7 = r->n[7], t8 = r->n[8], t9 = r->n[9];\n+\n+    /* Reduce t9 at the start so there will be at most a single carry from the first pass */\n+    uint32_t x = t9 >> 22; t9 &= 0x03FFFFFUL;\n+    uint32_t m;\n+\n+    /* The first pass ensures the magnitude is 1, ... */\n+    t0 += x * 0x3D1UL; t1 += (x << 6);\n+    t1 += (t0 >> 26); t0 &= 0x3FFFFFFUL;\n+    t2 += (t1 >> 26); t1 &= 0x3FFFFFFUL;\n+    t3 += (t2 >> 26); t2 &= 0x3FFFFFFUL; m = t2;\n+    t4 += (t3 >> 26); t3 &= 0x3FFFFFFUL; m &= t3;\n+    t5 += (t4 >> 26); t4 &= 0x3FFFFFFUL; m &= t4;\n+    t6 += (t5 >> 26); t5 &= 0x3FFFFFFUL; m &= t5;\n+    t7 += (t6 >> 26); t6 &= 0x3FFFFFFUL; m &= t6;\n+    t8 += (t7 >> 26); t7 &= 0x3FFFFFFUL; m &= t7;\n+    t9 += (t8 >> 26); t8 &= 0x3FFFFFFUL; m &= t8;\n+\n+    /* ... except for a possible carry at bit 22 of t9 (i.e. bit 256 of the field element) */\n+    VERIFY_CHECK(t9 >> 23 == 0);\n+\n+    /* At most a single final reduction is needed; check if the value is >= the field characteristic */\n+    x = (t9 >> 22) | ((t9 == 0x03FFFFFUL) & (m == 0x3FFFFFFUL)\n+        & ((t1 + 0x40UL + ((t0 + 0x3D1UL) >> 26)) > 0x3FFFFFFUL));\n+\n+    if (x) {\n+        t0 += 0x3D1UL; t1 += (x << 6);\n+        t1 += (t0 >> 26); t0 &= 0x3FFFFFFUL;\n+        t2 += (t1 >> 26); t1 &= 0x3FFFFFFUL;\n+        t3 += (t2 >> 26); t2 &= 0x3FFFFFFUL;\n+        t4 += (t3 >> 26); t3 &= 0x3FFFFFFUL;\n+        t5 += (t4 >> 26); t4 &= 0x3FFFFFFUL;\n+        t6 += (t5 >> 26); t5 &= 0x3FFFFFFUL;\n+        t7 += (t6 >> 26); t6 &= 0x3FFFFFFUL;\n+        t8 += (t7 >> 26); t7 &= 0x3FFFFFFUL;\n+        t9 += (t8 >> 26); t8 &= 0x3FFFFFFUL;\n+\n+        /* If t9 didn't carry to bit 22 already, then it should have after any final reduction */\n+        VERIFY_CHECK(t9 >> 22 == x);\n+\n+        /* Mask off the possible multiple of 2^256 from the final reduction */\n+        t9 &= 0x03FFFFFUL;\n+    }\n+\n+    r->n[0] = t0; r->n[1] = t1; r->n[2] = t2; r->n[3] = t3; r->n[4] = t4;\n+    r->n[5] = t5; r->n[6] = t6; r->n[7] = t7; r->n[8] = t8; r->n[9] = t9;\n+\n+#ifdef VERIFY\n+    r->magnitude = 1;\n+    r->normalized = 1;\n+    secp256k1_fe_verify(r);\n+#endif\n+}\n+\n SECP256K1_INLINE static void secp256k1_fe_set_int(secp256k1_fe_t *r, int a) {\n     r->n[0] = a;\n     r->n[1] = r->n[2] = r->n[3] = r->n[4] = r->n[5] = r->n[6] = r->n[7] = r->n[8] = r->n[9] = 0;\n@@ -271,7 +327,7 @@ SECP256K1_INLINE static void secp256k1_fe_add(secp256k1_fe_t *r, const secp256k1\n #define VERIFY_BITS(x, n) do { } while(0)\n #endif\n \n-SECP256K1_INLINE static void secp256k1_fe_mul_inner(const uint32_t *a, const uint32_t * SECP256K1_RESTRICT b, uint32_t *r) {\n+SECP256K1_INLINE static void secp256k1_fe_mul_inner(uint32_t *r, const uint32_t *a, const uint32_t * SECP256K1_RESTRICT b) {\n     VERIFY_BITS(a[0], 30);\n     VERIFY_BITS(a[1], 30);\n     VERIFY_BITS(a[2], 30);\n@@ -598,7 +654,7 @@ SECP256K1_INLINE static void secp256k1_fe_mul_inner(const uint32_t *a, const uin\n     /* [r9 r8 r7 r6 r5 r4 r3 r2 r1 r0] = [p18 p17 p16 p15 p14 p13 p12 p11 p10 p9 p8 p7 p6 p5 p4 p3 p2 p1 p0] */\n }\n \n-SECP256K1_INLINE static void secp256k1_fe_sqr_inner(const uint32_t *a, uint32_t *r) {\n+SECP256K1_INLINE static void secp256k1_fe_sqr_inner(uint32_t *r, const uint32_t *a) {\n     VERIFY_BITS(a[0], 30);\n     VERIFY_BITS(a[1], 30);\n     VERIFY_BITS(a[2], 30);\n@@ -879,7 +935,7 @@ static void secp256k1_fe_mul(secp256k1_fe_t *r, const secp256k1_fe_t *a, const s\n     secp256k1_fe_verify(b);\n     VERIFY_CHECK(r != b);\n #endif\n-    secp256k1_fe_mul_inner(a->n, b->n, r->n);\n+    secp256k1_fe_mul_inner(r->n, a->n, b->n);\n #ifdef VERIFY\n     r->magnitude = 1;\n     r->normalized = 0;\n@@ -892,7 +948,7 @@ static void secp256k1_fe_sqr(secp256k1_fe_t *r, const secp256k1_fe_t *a) {\n     VERIFY_CHECK(a->magnitude <= 8);\n     secp256k1_fe_verify(a);\n #endif\n-    secp256k1_fe_sqr_inner(a->n, r->n);\n+    secp256k1_fe_sqr_inner(r->n, a->n);\n #ifdef VERIFY\n     r->magnitude = 1;\n     r->normalized = 0;"
      },
      {
        "sha": "5e785f763055eaf695f92116dc3582a0985bf71d",
        "filename": "src/secp256k1/src/field_5x52_asm.asm",
        "status": "removed",
        "additions": 0,
        "deletions": 469,
        "changes": 469,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4383319e4e0cb96818d2be734f7280181daac9fa/src/secp256k1/src/field_5x52_asm.asm",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4383319e4e0cb96818d2be734f7280181daac9fa/src/secp256k1/src/field_5x52_asm.asm",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/src/field_5x52_asm.asm?ref=4383319e4e0cb96818d2be734f7280181daac9fa",
        "patch": "@@ -1,469 +0,0 @@\n-\t;; Added by Diederik Huys, March 2013\n-\t;;\n-\t;; Provided public procedures:\n-\t;; \tsecp256k1_fe_mul_inner\n-\t;; \tsecp256k1_fe_sqr_inner\n-\t;;\n-\t;; Needed tools: YASM (http://yasm.tortall.net)\n-\t;;\n-\t;; \n-\n-\tBITS 64\n-\n-%ifidn   __OUTPUT_FORMAT__,macho64\n-%define SYM(x) _ %+ x\n-%else\n-%define SYM(x) x\n-%endif\n-\n-\t;;  Procedure ExSetMult\n-\t;;  Register Layout:\n-\t;;  INPUT: \trdi\t= a->n\n-\t;; \t   \trsi  \t= b->n\n-\t;; \t   \trdx  \t= r->a\n-\t;; \n-\t;;  INTERNAL:\trdx:rax  = multiplication accumulator\n-\t;; \t\tr9:r8    = c\n-\t;; \t\tr10-r13  = t0-t3\n-\t;; \t\tr14\t = b.n[0] / t4\n-\t;; \t\tr15\t = b.n[1] / t5\n-\t;; \t\trbx\t = b.n[2] / t6\n-\t;; \t\trcx\t = b.n[3] / t7\n-\t;; \t\trbp\t = Constant 0FFFFFFFFFFFFFh / t8\n-\t;; \t\trsi\t = b.n / b.n[4] / t9\n-\n-\tGLOBAL SYM(secp256k1_fe_mul_inner)\n-\tALIGN 32\n-SYM(secp256k1_fe_mul_inner):\n-\tpush rbp\n-\tpush rbx\n-\tpush r12\n-\tpush r13\n-\tpush r14\n-\tpush r15\n-\tpush rdx\n-\tmov r14,[rsi+8*0]\t; preload b.n[0]. This will be the case until\n-\t\t\t\t; b.n[0] is no longer needed, then we reassign\n-\t\t\t\t; r14 to t4\n-\t;; c=a.n[0] * b.n[0]\n-   \tmov rax,[rdi+0*8]\t; load a.n[0]\n-\tmov rbp,0FFFFFFFFFFFFFh\n-\tmul r14\t\t\t; rdx:rax=a.n[0]*b.n[0]\n-\tmov r15,[rsi+1*8]\n-\tmov r10,rbp\t\t; load modulus into target register for t0\n-\tmov r8,rax\n-\tand r10,rax\t\t; only need lower qword of c\n-\tshrd r8,rdx,52\n-\txor r9,r9\t\t; c < 2^64, so we ditch the HO part \n-\n-\t;; c+=a.n[0] * b.n[1] + a.n[1] * b.n[0]\n-\tmov rax,[rdi+0*8]\n-\tmul r15\t\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+1*8]\n-\tmul r14\t\t\t\n-\tmov r11,rbp\n-\tmov rbx,[rsi+2*8]\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand r11,r8\n-\tshrd r8,r9,52\n-\txor r9,r9\n-\t\n-\t;; c+=a.n[0 1 2] * b.n[2 1 0]\n-\tmov rax,[rdi+0*8]\n-\tmul rbx\t\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+1*8]\n-\tmul r15\t\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+2*8]\n-\tmul r14\n-\tmov r12,rbp\t\t\n-\tmov rcx,[rsi+3*8]\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand r12,r8\t\t\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=a.n[0 1 2 3] * b.n[3 2 1 0]\n-\tmov rax,[rdi+0*8]\n-\tmul rcx\t\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+1*8]\n-\tmul rbx\t\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+2*8]\n-\tmul r15\t\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\t\n-\tmov rax,[rdi+3*8]\n-\tmul r14\t\t\t\n-\tmov r13,rbp             \n-\tmov rsi,[rsi+4*8]\t; load b.n[4] and destroy pointer\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand r13,r8\n-\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\n-\t;; c+=a.n[0 1 2 3 4] * b.n[4 3 2 1 0]\n-\tmov rax,[rdi+0*8]\n-\tmul rsi\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+1*8]\n-\tmul rcx\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+2*8]\n-\tmul rbx\t\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+3*8]\n-\tmul r15\t\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+4*8]\n-\tmul r14\t\t\t\n-\tmov r14,rbp             ; load modulus into t4 and destroy a.n[0]\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand r14,r8\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=a.n[1 2 3 4] * b.n[4 3 2 1]\n-\tmov rax,[rdi+1*8]\n-\tmul rsi\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+2*8]\n-\tmul rcx\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+3*8]\n-\tmul rbx\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+4*8]\n-\tmul r15\n-\tmov r15,rbp\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tand r15,r8\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=a.n[2 3 4] * b.n[4 3 2]\n-\tmov rax,[rdi+2*8]\n-\tmul rsi\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+3*8]\n-\tmul rcx\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+4*8]\n-\tmul rbx\n-\tmov rbx,rbp\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tand rbx,r8\t\t\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=a.n[3 4] * b.n[4 3]\n-\tmov rax,[rdi+3*8]\n-\tmul rsi\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,[rdi+4*8]\n-\tmul rcx\n-\tmov rcx,rbp\t\t\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand rcx,r8\t\t\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=a.n[4] * b.n[4]\n-\tmov rax,[rdi+4*8]\n-\tmul rsi\n-\t;; mov rbp,rbp\t\t; modulus already there!\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand rbp,r8 \n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\tmov rsi,r8\t\t; load c into t9 and destroy b.n[4]\n-\n-\t;; *******************************************************\n-common_exit_norm:\n-\tmov rdi,01000003D10h\t; load constant\n-\n-\tmov rax,r15\t\t; get t5\n-\tmul rdi\n-\tadd rax,r10    \t\t; +t0\n-\tadc rdx,0\n-\tmov r10,0FFFFFFFFFFFFFh ; modulus. Sadly, we ran out of registers!\n-\tmov r8,rax\t\t; +c\n-\tand r10,rax\n-\tshrd r8,rdx,52\n-\txor r9,r9\n-\n-\tmov rax,rbx\t\t; get t6\n-\tmul rdi\n-\tadd rax,r11\t\t; +t1\n-\tadc rdx,0\n-\tmov r11,0FFFFFFFFFFFFFh ; modulus\n-\tadd r8,rax\t\t; +c\n-\tadc r9,rdx\n-\tand r11,r8\n-\tshrd r8,r9,52\n-\txor r9,r9\n-\n-\tmov rax,rcx    \t\t; get t7\n-\tmul rdi\n-\tadd rax,r12\t\t; +t2\n-\tadc rdx,0\n-\tpop rbx\t\t\t; retrieve pointer to this.n\t\n-\tmov r12,0FFFFFFFFFFFFFh ; modulus\n-\tadd r8,rax\t\t; +c\n-\tadc r9,rdx\n-\tand r12,r8\n-\tmov [rbx+2*8],r12\t; mov into this.n[2]\n-\tshrd r8,r9,52\n-\txor r9,r9\n-\t\n-\tmov rax,rbp    \t\t; get t8\n-\tmul rdi\n-\tadd rax,r13    \t\t; +t3\n-\tadc rdx,0\n-\tmov r13,0FFFFFFFFFFFFFh ; modulus\n-\tadd r8,rax\t\t; +c\n-\tadc r9,rdx\n-\tand r13,r8\n-\tmov [rbx+3*8],r13\t; -> this.n[3]\n-\tshrd r8,r9,52\n-\txor r9,r9\n-\t\n-\tmov rax,rsi    \t\t; get t9\n-\tmul rdi\n-\tadd rax,r14    \t\t; +t4\n-\tadc rdx,0\n-\tmov r14,0FFFFFFFFFFFFh\t; !!!\n-\tadd r8,rax\t\t; +c\n-\tadc r9,rdx\n-\tand r14,r8\n-\tmov [rbx+4*8],r14\t; -> this.n[4]\n-\tshrd r8,r9,48\t\t; !!!\n-\txor r9,r9\n-\t\n-\tmov rax,01000003D1h\n-\tmul r8\t\t\n-\tadd rax,r10\n-\tadc rdx,0\n-\tmov r10,0FFFFFFFFFFFFFh ; modulus\n-\tmov r8,rax\n-\tand rax,r10\n-\tshrd r8,rdx,52\n-\tmov [rbx+0*8],rax\t; -> this.n[0]\n-\tadd r8,r11\n-\tmov [rbx+1*8],r8\t; -> this.n[1]\n-\n-\tpop r15\n-\tpop r14\n-\tpop r13\n-\tpop r12\n-\tpop rbx\n-\tpop rbp\n-\tret\n-\n-\t\n-\t;;  PROC ExSetSquare\n-\t;;  Register Layout:\n-\t;;  INPUT: \trdi\t = a.n\n-\t;; \t   \trsi  \t = this.a\n-\t;;  INTERNAL:\trdx:rax  = multiplication accumulator\n-\t;; \t\tr9:r8    = c\n-\t;; \t\tr10-r13  = t0-t3\n-\t;; \t\tr14\t = a.n[0] / t4\n-\t;; \t\tr15\t = a.n[1] / t5\n-\t;; \t\trbx\t = a.n[2] / t6\n-\t;; \t\trcx\t = a.n[3] / t7\n-\t;; \t\trbp\t = 0FFFFFFFFFFFFFh / t8\n-\t;; \t\trsi\t = a.n[4] / t9\n-\tGLOBAL SYM(secp256k1_fe_sqr_inner)\n-\tALIGN 32\n-SYM(secp256k1_fe_sqr_inner):\n-\tpush rbp\n-\tpush rbx\n-\tpush r12\n-\tpush r13\n-\tpush r14\n-\tpush r15\n-\tpush rsi\n-\tmov rbp,0FFFFFFFFFFFFFh\n-\t\n-\t;; c=a.n[0] * a.n[0]\n-   \tmov r14,[rdi+0*8]\t; r14=a.n[0]\n-\tmov r10,rbp\t\t; modulus \n-\tmov rax,r14\n-\tmul rax\n-\tmov r15,[rdi+1*8]\t; a.n[1]\n-\tadd r14,r14\t\t; r14=2*a.n[0]\n-\tmov r8,rax\n-\tand r10,rax\t\t; only need lower qword\n-\tshrd r8,rdx,52\n-\txor r9,r9\n-\n-\t;; c+=2*a.n[0] * a.n[1]\n-\tmov rax,r14\t\t; r14=2*a.n[0]\n-\tmul r15\n-\tmov rbx,[rdi+2*8]\t; rbx=a.n[2]\n-\tmov r11,rbp \t\t; modulus\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand r11,r8\n-\tshrd r8,r9,52\n-\txor r9,r9\n-\t\n-\t;; c+=2*a.n[0]*a.n[2]+a.n[1]*a.n[1]\n-\tmov rax,r14\n-\tmul rbx\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,r15\n-\tmov r12,rbp\t\t; modulus\n-\tmul rax\n-\tmov rcx,[rdi+3*8]\t; rcx=a.n[3]\n-\tadd r15,r15\t\t; r15=a.n[1]*2\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand r12,r8\t\t; only need lower dword\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=2*a.n[0]*a.n[3]+2*a.n[1]*a.n[2]\n-\tmov rax,r14\n-\tmul rcx\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,r15\t\t; rax=2*a.n[1]\n-\tmov r13,rbp\t\t; modulus\n-\tmul rbx\n-\tmov rsi,[rdi+4*8]\t; rsi=a.n[4]\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand r13,r8\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=2*a.n[0]*a.n[4]+2*a.n[1]*a.n[3]+a.n[2]*a.n[2]\n-\tmov rax,r14\t\t; last time we need 2*a.n[0]\n-\tmul rsi\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,r15\n-\tmul rcx\n-\tmov r14,rbp\t\t; modulus\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,rbx\n-\tmul rax\n-\tadd rbx,rbx\t\t; rcx=2*a.n[2]\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand r14,r8\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=2*a.n[1]*a.n[4]+2*a.n[2]*a.n[3]\n-\tmov rax,r15\t\t; last time we need 2*a.n[1]\n-\tmul rsi\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,rbx\n-\tmul rcx\n-\tmov r15,rbp\t\t; modulus\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand r15,r8\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=2*a.n[2]*a.n[4]+a.n[3]*a.n[3]\n-\tmov rax,rbx\t\t; last time we need 2*a.n[2]\n-\tmul rsi\n-\tadd r8,rax\n-\tadc r9,rdx\n-\n-\tmov rax,rcx\t\t; a.n[3]\n-\tmul rax\n-\tmov rbx,rbp\t\t; modulus\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand rbx,r8\t\t; only need lower dword\n-\tlea rax,[2*rcx]\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=2*a.n[3]*a.n[4]\n-\tmul rsi\n-\tmov rcx,rbp\t\t; modulus\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand rcx,r8\t\t; only need lower dword\n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\t;; c+=a.n[4]*a.n[4]\n-\tmov rax,rsi\n-\tmul rax\n-\t;; mov rbp,rbp\t\t; modulus is already there!\n-\tadd r8,rax\n-\tadc r9,rdx\n-\tand rbp,r8 \n-\tshrd r8,r9,52\n-\txor r9,r9\t\t\n-\n-\tmov rsi,r8\n-\n-\t;; *******************************************************\n-\tjmp common_exit_norm\n-\tend\n-\n-\t"
      },
      {
        "sha": "af12fd30d2cf629e18fb8be72b2277d9f04528d2",
        "filename": "src/secp256k1/src/field_5x52_asm_impl.h",
        "status": "modified",
        "additions": 492,
        "deletions": 3,
        "changes": 495,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/field_5x52_asm_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/field_5x52_asm_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/src/field_5x52_asm_impl.h?ref=6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "patch": "@@ -1,13 +1,502 @@\n /**********************************************************************\n- * Copyright (c) 2013 Pieter Wuille                                   *\n+ * Copyright (c) 2013-2014 Diederik Huys, Pieter Wuille               *\n  * Distributed under the MIT software license, see the accompanying   *\n  * file COPYING or http://www.opensource.org/licenses/mit-license.php.*\n  **********************************************************************/\n \n+/**\n+ * Changelog:\n+ * - March 2013, Diederik Huys:    original version\n+ * - November 2014, Pieter Wuille: updated to use Peter Dettman's parallel multiplication algorithm\n+ * - December 2014, Pieter Wuille: converted from YASM to GCC inline assembly\n+ */\n+\n #ifndef _SECP256K1_FIELD_INNER5X52_IMPL_H_\n #define _SECP256K1_FIELD_INNER5X52_IMPL_H_\n \n-void __attribute__ ((sysv_abi)) secp256k1_fe_mul_inner(const uint64_t *a, const uint64_t *b, uint64_t *r);\n-void __attribute__ ((sysv_abi)) secp256k1_fe_sqr_inner(const uint64_t *a, uint64_t *r);\n+SECP256K1_INLINE static void secp256k1_fe_mul_inner(uint64_t *r, const uint64_t *a, const uint64_t * SECP256K1_RESTRICT b) {\n+/**\n+ * Registers: rdx:rax = multiplication accumulator\n+ *            r9:r8   = c\n+ *            r15:rcx = d\n+ *            r10-r14 = a0-a4\n+ *            rbx     = b\n+ *            %2      = r\n+ *            %0      = a / t?\n+ *            rbp     = R (0x1000003d10)\n+ */\n+__asm__ __volatile__(\n+    \"pushq %%rbp\\n\"\n+\n+    \"movq 0(%0),%%r10\\n\"\n+    \"movq 8(%0),%%r11\\n\"\n+    \"movq 16(%0),%%r12\\n\"\n+    \"movq 24(%0),%%r13\\n\"\n+    \"movq 32(%0),%%r14\\n\"\n+    \"movq $0x1000003d10,%%rbp\\n\"\n+\n+    /* d += a3 * b0 */\n+    \"movq 0(%%rbx),%%rax\\n\"\n+    \"mulq %%r13\\n\"\n+    \"movq %%rax,%%rcx\\n\"\n+    \"movq %%rdx,%%r15\\n\"\n+    /* d += a2 * b1 */\n+    \"movq 8(%%rbx),%%rax\\n\"\n+    \"mulq %%r12\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a1 * b2 */\n+    \"movq 16(%%rbx),%%rax\\n\"\n+    \"mulq %%r11\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d = a0 * b3 */\n+    \"movq 24(%%rbx),%%rax\\n\"\n+    \"mulq %%r10\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* c = a4 * b4 */\n+    \"movq 32(%%rbx),%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"movq %%rax,%%r8\\n\"\n+    \"movq %%rdx,%%r9\\n\"\n+    /* d += (c & M) * R */\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* c >>= 52 (%%r8 only) */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    /* t3 (stack) = d & M */\n+    \"movq %%rcx,%0\\n\"\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%0\\n\"\n+    \"pushq %0\\n\"\n+    /* d >>= 52 */\n+    \"shrdq $52,%%r15,%%rcx\\n\"\n+    \"xorq %%r15,%%r15\\n\"\n+    /* d += a4 * b0 */\n+    \"movq 0(%%rbx),%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a3 * b1 */\n+    \"movq 8(%%rbx),%%rax\\n\"\n+    \"mulq %%r13\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a2 * b2 */\n+    \"movq 16(%%rbx),%%rax\\n\"\n+    \"mulq %%r12\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a1 * b3 */\n+    \"movq 24(%%rbx),%%rax\\n\"\n+    \"mulq %%r11\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a0 * b4 */\n+    \"movq 32(%%rbx),%%rax\\n\"\n+    \"mulq %%r10\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += c * R */\n+    \"movq %%r8,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* t4 = d & M (%0) */\n+    \"movq %%rcx,%0\\n\"\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%0\\n\"\n+    /* d >>= 52 */\n+    \"shrdq $52,%%r15,%%rcx\\n\"\n+    \"xorq %%r15,%%r15\\n\"\n+    /* tx = t4 >> 48 (%%rbp, overwrites R) */\n+    \"movq %0,%%rbp\\n\"\n+    \"shrq $48,%%rbp\\n\"\n+    /* t4 &= (M >> 4) (stack) */\n+    \"movq $0xffffffffffff,%%rax\\n\"\n+    \"andq %%rax,%0\\n\"\n+    \"pushq %0\\n\"\n+    /* c = a0 * b0 */\n+    \"movq 0(%%rbx),%%rax\\n\"\n+    \"mulq %%r10\\n\"\n+    \"movq %%rax,%%r8\\n\"\n+    \"movq %%rdx,%%r9\\n\"\n+    /* d += a4 * b1 */\n+    \"movq 8(%%rbx),%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a3 * b2 */\n+    \"movq 16(%%rbx),%%rax\\n\"\n+    \"mulq %%r13\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a2 * b3 */\n+    \"movq 24(%%rbx),%%rax\\n\"\n+    \"mulq %%r12\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a1 * b4 */\n+    \"movq 32(%%rbx),%%rax\\n\"\n+    \"mulq %%r11\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* u0 = d & M (%0) */\n+    \"movq %%rcx,%0\\n\"\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%0\\n\"\n+    /* d >>= 52 */\n+    \"shrdq $52,%%r15,%%rcx\\n\"\n+    \"xorq %%r15,%%r15\\n\"\n+    /* u0 = (u0 << 4) | tx (%0) */\n+    \"shlq $4,%0\\n\"\n+    \"orq %%rbp,%0\\n\"\n+    /* c += u0 * (R >> 4) */\n+    \"movq $0x1000003d1,%%rax\\n\"\n+    \"mulq %0\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* r[0] = c & M */\n+    \"movq %%r8,%%rax\\n\"\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%%rax\\n\"\n+    \"movq %%rax,0(%2)\\n\"\n+    /* c >>= 52 */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    \"xorq %%r9,%%r9\\n\"\n+    /* c += a1 * b0 */\n+    \"movq 0(%%rbx),%%rax\\n\"\n+    \"mulq %%r11\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* c += a0 * b1 */\n+    \"movq 8(%%rbx),%%rax\\n\"\n+    \"mulq %%r10\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* d += a4 * b2 */\n+    \"movq 16(%%rbx),%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a3 * b3 */\n+    \"movq 24(%%rbx),%%rax\\n\"\n+    \"mulq %%r13\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a2 * b4 */\n+    \"movq 32(%%rbx),%%rax\\n\"\n+    \"mulq %%r12\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* restore rdp = R */\n+    \"movq $0x1000003d10,%%rbp\\n\"\n+    /* c += (d & M) * R */\n+    \"movq %%rcx,%%rax\\n\"\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* d >>= 52 */\n+    \"shrdq $52,%%r15,%%rcx\\n\"\n+    \"xorq %%r15,%%r15\\n\"\n+    /* r[1] = c & M */\n+    \"movq %%r8,%%rax\\n\"\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%%rax\\n\"\n+    \"movq %%rax,8(%2)\\n\"\n+    /* c >>= 52 */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    \"xorq %%r9,%%r9\\n\"\n+    /* c += a2 * b0 */\n+    \"movq 0(%%rbx),%%rax\\n\"\n+    \"mulq %%r12\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* c += a1 * b1 */\n+    \"movq 8(%%rbx),%%rax\\n\"\n+    \"mulq %%r11\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* c += a0 * b2 (last use of %%r10 = a0) */\n+    \"movq 16(%%rbx),%%rax\\n\"\n+    \"mulq %%r10\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* fetch t3 (%%r10, overwrites a0),t4 (%0) */\n+    \"popq %0\\n\"\n+    \"popq %%r10\\n\"\n+    /* d += a4 * b3 */\n+    \"movq 24(%%rbx),%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* d += a3 * b4 */\n+    \"movq 32(%%rbx),%%rax\\n\"\n+    \"mulq %%r13\\n\"\n+    \"addq %%rax,%%rcx\\n\"\n+    \"adcq %%rdx,%%r15\\n\"\n+    /* c += (d & M) * R */\n+    \"movq %%rcx,%%rax\\n\"\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* d >>= 52 (%%rcx only) */\n+    \"shrdq $52,%%r15,%%rcx\\n\"\n+    /* r[2] = c & M */\n+    \"movq %%r8,%%rax\\n\"\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%%rax\\n\"\n+    \"movq %%rax,16(%2)\\n\"\n+    /* c >>= 52 */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    \"xorq %%r9,%%r9\\n\"\n+    /* c += t3 */\n+    \"addq %%r10,%%r8\\n\"\n+    /* c += d * R */\n+    \"movq %%rcx,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* r[3] = c & M */\n+    \"movq %%r8,%%rax\\n\"\n+    \"movq $0xfffffffffffff,%%rdx\\n\"\n+    \"andq %%rdx,%%rax\\n\"\n+    \"movq %%rax,24(%2)\\n\"\n+    /* c >>= 52 (%%r8 only) */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    /* c += t4 (%%r8 only) */\n+    \"addq %0,%%r8\\n\"\n+    /* r[4] = c */\n+    \"movq %%r8,32(%2)\\n\"\n+\n+    \"popq %%rbp\\n\"\n+: \"+S\"(a)\n+: \"b\"(b), \"D\"(r)\n+: \"%rax\", \"%rcx\", \"%rdx\", \"%r8\", \"%r9\", \"%r10\", \"%r11\", \"%r12\", \"%r13\", \"%r14\", \"%r15\", \"cc\", \"memory\"\n+);\n+}\n+\n+SECP256K1_INLINE static void secp256k1_fe_sqr_inner(uint64_t *r, const uint64_t *a) {\n+/**\n+ * Registers: rdx:rax = multiplication accumulator\n+ *            r9:r8   = c\n+ *            rcx:rbx = d\n+ *            r10-r14 = a0-a4\n+ *            r15     = M (0xfffffffffffff)\n+ *            %1      = r\n+ *            %0      = a / t?\n+ *            rbp     = R (0x1000003d10)\n+ */\n+__asm__ __volatile__(\n+    \"pushq %%rbp\\n\"\n+\n+    \"movq 0(%0),%%r10\\n\"\n+    \"movq 8(%0),%%r11\\n\"\n+    \"movq 16(%0),%%r12\\n\"\n+    \"movq 24(%0),%%r13\\n\"\n+    \"movq 32(%0),%%r14\\n\"\n+    \"movq $0x1000003d10,%%rbp\\n\"\n+    \"movq $0xfffffffffffff,%%r15\\n\"\n+\n+    /* d = (a0*2) * a3 */\n+    \"leaq (%%r10,%%r10,1),%%rax\\n\"\n+    \"mulq %%r13\\n\"\n+    \"movq %%rax,%%rbx\\n\"\n+    \"movq %%rdx,%%rcx\\n\"\n+    /* d += (a1*2) * a2 */\n+    \"leaq (%%r11,%%r11,1),%%rax\\n\"\n+    \"mulq %%r12\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* c = a4 * a4 */\n+    \"movq %%r14,%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"movq %%rax,%%r8\\n\"\n+    \"movq %%rdx,%%r9\\n\"\n+    /* d += (c & M) * R */\n+    \"andq %%r15,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* c >>= 52 (%%r8 only) */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    /* t3 (stack) = d & M */\n+    \"movq %%rbx,%0\\n\"\n+    \"andq %%r15,%0\\n\"\n+    \"pushq %0\\n\"\n+    /* d >>= 52 */\n+    \"shrdq $52,%%rcx,%%rbx\\n\"\n+    \"xorq %%rcx,%%rcx\\n\"\n+    /* a4 *= 2 */\n+    \"addq %%r14,%%r14\\n\"\n+    /* d += a0 * a4 */\n+    \"movq %%r10,%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* d+= (a1*2) * a3 */\n+    \"leaq (%%r11,%%r11,1),%%rax\\n\"\n+    \"mulq %%r13\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* d += a2 * a2 */\n+    \"movq %%r12,%%rax\\n\"\n+    \"mulq %%r12\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* d += c * R */\n+    \"movq %%r8,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* t4 = d & M (%0) */\n+    \"movq %%rbx,%0\\n\"\n+    \"andq %%r15,%0\\n\"\n+    /* d >>= 52 */\n+    \"shrdq $52,%%rcx,%%rbx\\n\"\n+    \"xorq %%rcx,%%rcx\\n\"\n+    /* tx = t4 >> 48 (%%rbp, overwrites constant) */\n+    \"movq %0,%%rbp\\n\"\n+    \"shrq $48,%%rbp\\n\"\n+    /* t4 &= (M >> 4) (stack) */\n+    \"movq $0xffffffffffff,%%rax\\n\"\n+    \"andq %%rax,%0\\n\"\n+    \"pushq %0\\n\"\n+    /* c = a0 * a0 */\n+    \"movq %%r10,%%rax\\n\"\n+    \"mulq %%r10\\n\"\n+    \"movq %%rax,%%r8\\n\"\n+    \"movq %%rdx,%%r9\\n\"\n+    /* d += a1 * a4 */\n+    \"movq %%r11,%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* d += (a2*2) * a3 */\n+    \"leaq (%%r12,%%r12,1),%%rax\\n\"\n+    \"mulq %%r13\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* u0 = d & M (%0) */\n+    \"movq %%rbx,%0\\n\"\n+    \"andq %%r15,%0\\n\"\n+    /* d >>= 52 */\n+    \"shrdq $52,%%rcx,%%rbx\\n\"\n+    \"xorq %%rcx,%%rcx\\n\"\n+    /* u0 = (u0 << 4) | tx (%0) */\n+    \"shlq $4,%0\\n\"\n+    \"orq %%rbp,%0\\n\"\n+    /* c += u0 * (R >> 4) */\n+    \"movq $0x1000003d1,%%rax\\n\"\n+    \"mulq %0\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* r[0] = c & M */\n+    \"movq %%r8,%%rax\\n\"\n+    \"andq %%r15,%%rax\\n\"\n+    \"movq %%rax,0(%1)\\n\"\n+    /* c >>= 52 */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    \"xorq %%r9,%%r9\\n\"\n+    /* a0 *= 2 */\n+    \"addq %%r10,%%r10\\n\"\n+    /* c += a0 * a1 */\n+    \"movq %%r10,%%rax\\n\"\n+    \"mulq %%r11\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* d += a2 * a4 */\n+    \"movq %%r12,%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* d += a3 * a3 */\n+    \"movq %%r13,%%rax\\n\"\n+    \"mulq %%r13\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* load R in %%rbp */\n+    \"movq $0x1000003d10,%%rbp\\n\"\n+    /* c += (d & M) * R */\n+    \"movq %%rbx,%%rax\\n\"\n+    \"andq %%r15,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* d >>= 52 */\n+    \"shrdq $52,%%rcx,%%rbx\\n\"\n+    \"xorq %%rcx,%%rcx\\n\"\n+    /* r[1] = c & M */\n+    \"movq %%r8,%%rax\\n\"\n+    \"andq %%r15,%%rax\\n\"\n+    \"movq %%rax,8(%1)\\n\"\n+    /* c >>= 52 */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    \"xorq %%r9,%%r9\\n\"\n+    /* c += a0 * a2 (last use of %%r10) */\n+    \"movq %%r10,%%rax\\n\"\n+    \"mulq %%r12\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* fetch t3 (%%r10, overwrites a0),t4 (%0) */\n+    \"popq %0\\n\"\n+    \"popq %%r10\\n\"\n+    /* c += a1 * a1 */\n+    \"movq %%r11,%%rax\\n\"\n+    \"mulq %%r11\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* d += a3 * a4 */\n+    \"movq %%r13,%%rax\\n\"\n+    \"mulq %%r14\\n\"\n+    \"addq %%rax,%%rbx\\n\"\n+    \"adcq %%rdx,%%rcx\\n\"\n+    /* c += (d & M) * R */\n+    \"movq %%rbx,%%rax\\n\"\n+    \"andq %%r15,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* d >>= 52 (%%rbx only) */\n+    \"shrdq $52,%%rcx,%%rbx\\n\"\n+    /* r[2] = c & M */\n+    \"movq %%r8,%%rax\\n\"\n+    \"andq %%r15,%%rax\\n\"\n+    \"movq %%rax,16(%1)\\n\"\n+    /* c >>= 52 */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    \"xorq %%r9,%%r9\\n\"\n+    /* c += t3 */\n+    \"addq %%r10,%%r8\\n\"\n+    /* c += d * R */\n+    \"movq %%rbx,%%rax\\n\"\n+    \"mulq %%rbp\\n\"\n+    \"addq %%rax,%%r8\\n\"\n+    \"adcq %%rdx,%%r9\\n\"\n+    /* r[3] = c & M */\n+    \"movq %%r8,%%rax\\n\"\n+    \"andq %%r15,%%rax\\n\"\n+    \"movq %%rax,24(%1)\\n\"\n+    /* c >>= 52 (%%r8 only) */\n+    \"shrdq $52,%%r9,%%r8\\n\"\n+    /* c += t4 (%%r8 only) */\n+    \"addq %0,%%r8\\n\"\n+    /* r[4] = c */\n+    \"movq %%r8,32(%1)\\n\"\n+\n+    \"popq %%rbp\\n\"\n+: \"+S\"(a)\n+: \"D\"(r)\n+: \"%rax\", \"%rbx\", \"%rcx\", \"%rdx\", \"%r8\", \"%r9\", \"%r10\", \"%r11\", \"%r12\", \"%r13\", \"%r14\", \"%r15\", \"cc\", \"memory\"\n+);\n+}\n \n #endif"
      },
      {
        "sha": "63176d6de406cf1276a612904be248e13550576a",
        "filename": "src/secp256k1/src/field_5x52_impl.h",
        "status": "modified",
        "additions": 46,
        "deletions": 2,
        "changes": 48,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/field_5x52_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/field_5x52_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/src/field_5x52_impl.h?ref=6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "patch": "@@ -102,6 +102,50 @@ static void secp256k1_fe_normalize(secp256k1_fe_t *r) {\n #endif\n }\n \n+static void secp256k1_fe_normalize_var(secp256k1_fe_t *r) {\n+    uint64_t t0 = r->n[0], t1 = r->n[1], t2 = r->n[2], t3 = r->n[3], t4 = r->n[4];\n+\n+    /* Reduce t4 at the start so there will be at most a single carry from the first pass */\n+    uint64_t x = t4 >> 48; t4 &= 0x0FFFFFFFFFFFFULL;\n+    uint64_t m;\n+\n+    /* The first pass ensures the magnitude is 1, ... */\n+    t0 += x * 0x1000003D1ULL;\n+    t1 += (t0 >> 52); t0 &= 0xFFFFFFFFFFFFFULL;\n+    t2 += (t1 >> 52); t1 &= 0xFFFFFFFFFFFFFULL; m = t1;\n+    t3 += (t2 >> 52); t2 &= 0xFFFFFFFFFFFFFULL; m &= t2;\n+    t4 += (t3 >> 52); t3 &= 0xFFFFFFFFFFFFFULL; m &= t3;\n+\n+    /* ... except for a possible carry at bit 48 of t4 (i.e. bit 256 of the field element) */\n+    VERIFY_CHECK(t4 >> 49 == 0);\n+\n+    /* At most a single final reduction is needed; check if the value is >= the field characteristic */\n+    x = (t4 >> 48) | ((t4 == 0x0FFFFFFFFFFFFULL) & (m == 0xFFFFFFFFFFFFFULL)\n+        & (t0 >= 0xFFFFEFFFFFC2FULL));\n+\n+    if (x) {\n+        t0 += 0x1000003D1ULL;\n+        t1 += (t0 >> 52); t0 &= 0xFFFFFFFFFFFFFULL;\n+        t2 += (t1 >> 52); t1 &= 0xFFFFFFFFFFFFFULL;\n+        t3 += (t2 >> 52); t2 &= 0xFFFFFFFFFFFFFULL;\n+        t4 += (t3 >> 52); t3 &= 0xFFFFFFFFFFFFFULL;\n+\n+        /* If t4 didn't carry to bit 48 already, then it should have after any final reduction */\n+        VERIFY_CHECK(t4 >> 48 == x);\n+\n+        /* Mask off the possible multiple of 2^256 from the final reduction */\n+        t4 &= 0x0FFFFFFFFFFFFULL;\n+    }\n+\n+    r->n[0] = t0; r->n[1] = t1; r->n[2] = t2; r->n[3] = t3; r->n[4] = t4;\n+\n+#ifdef VERIFY\n+    r->magnitude = 1;\n+    r->normalized = 1;\n+    secp256k1_fe_verify(r);\n+#endif\n+}\n+\n SECP256K1_INLINE static void secp256k1_fe_set_int(secp256k1_fe_t *r, int a) {\n     r->n[0] = a;\n     r->n[1] = r->n[2] = r->n[3] = r->n[4] = 0;\n@@ -255,7 +299,7 @@ static void secp256k1_fe_mul(secp256k1_fe_t *r, const secp256k1_fe_t *a, const s\n     secp256k1_fe_verify(b);\n     VERIFY_CHECK(r != b);\n #endif\n-    secp256k1_fe_mul_inner(a->n, b->n, r->n);\n+    secp256k1_fe_mul_inner(r->n, a->n, b->n);\n #ifdef VERIFY\n     r->magnitude = 1;\n     r->normalized = 0;\n@@ -268,7 +312,7 @@ static void secp256k1_fe_sqr(secp256k1_fe_t *r, const secp256k1_fe_t *a) {\n     VERIFY_CHECK(a->magnitude <= 8);\n     secp256k1_fe_verify(a);\n #endif\n-    secp256k1_fe_sqr_inner(a->n, r->n);\n+    secp256k1_fe_sqr_inner(r->n, a->n);\n #ifdef VERIFY\n     r->magnitude = 1;\n     r->normalized = 0;"
      },
      {
        "sha": "ec631833cfa1ad86109691ae05f60d05de933423",
        "filename": "src/secp256k1/src/field_5x52_int128_impl.h",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/field_5x52_int128_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/field_5x52_int128_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/src/field_5x52_int128_impl.h?ref=6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "patch": "@@ -15,7 +15,7 @@\n #define VERIFY_BITS(x, n) do { } while(0)\n #endif\n \n-SECP256K1_INLINE static void secp256k1_fe_mul_inner(const uint64_t *a, const uint64_t * SECP256K1_RESTRICT b, uint64_t *r) {\n+SECP256K1_INLINE static void secp256k1_fe_mul_inner(uint64_t *r, const uint64_t *a, const uint64_t * SECP256K1_RESTRICT b) {\n     VERIFY_BITS(a[0], 56);\n     VERIFY_BITS(a[1], 56);\n     VERIFY_BITS(a[2], 56);\n@@ -152,7 +152,7 @@ SECP256K1_INLINE static void secp256k1_fe_mul_inner(const uint64_t *a, const uin\n     /* [r4 r3 r2 r1 r0] = [p8 p7 p6 p5 p4 p3 p2 p1 p0] */\n }\n \n-SECP256K1_INLINE static void secp256k1_fe_sqr_inner(const uint64_t *a, uint64_t *r) {\n+SECP256K1_INLINE static void secp256k1_fe_sqr_inner(uint64_t *r, const uint64_t *a) {\n     VERIFY_BITS(a[0], 56);\n     VERIFY_BITS(a[1], 56);\n     VERIFY_BITS(a[2], 56);"
      },
      {
        "sha": "73a55c4f00d4523f5851daa9c45ffd5f9ca6dd2e",
        "filename": "src/secp256k1/src/field_gmp_impl.h",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/field_gmp_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/field_gmp_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/src/field_gmp_impl.h?ref=6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "patch": "@@ -46,6 +46,10 @@ static void secp256k1_fe_normalize(secp256k1_fe_t *r) {\n         mpn_sub(r->n, r->n, FIELD_LIMBS, secp256k1_field_p, FIELD_LIMBS);\n }\n \n+static void secp256k1_fe_normalize_var(secp256k1_fe_t *r) {\n+    secp256k1_fe_normalize(r);\n+}\n+\n SECP256K1_INLINE static void secp256k1_fe_set_int(secp256k1_fe_t *r, int a) {\n     r->n[0] = a;\n     for (int i=1; i<FIELD_LIMBS+1; i++)"
      },
      {
        "sha": "24d3104ed188b1e23b8ef2d448903b5da2900c08",
        "filename": "src/secp256k1/src/field_impl.h",
        "status": "modified",
        "additions": 4,
        "deletions": 28,
        "changes": 32,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/field_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/field_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/src/field_impl.h?ref=6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "patch": "@@ -66,7 +66,7 @@ static int secp256k1_fe_set_hex(secp256k1_fe_t *r, const char *a, int alen) {\n     return secp256k1_fe_set_b32(r, tmp);\n }\n \n-static int secp256k1_fe_sqrt(secp256k1_fe_t *r, const secp256k1_fe_t *a) {\n+static int secp256k1_fe_sqrt_var(secp256k1_fe_t *r, const secp256k1_fe_t *a) {\n \n     /** The binary representation of (p + 1)/4 has 3 blocks of 1s, with lengths in\n      *  { 2, 22, 223 }. Use an addition chain to calculate 2^n - 1 for each block:\n@@ -132,7 +132,7 @@ static int secp256k1_fe_sqrt(secp256k1_fe_t *r, const secp256k1_fe_t *a) {\n     secp256k1_fe_sqr(&t1, r);\n     secp256k1_fe_negate(&t1, &t1, 1);\n     secp256k1_fe_add(&t1, a);\n-    secp256k1_fe_normalize(&t1);\n+    secp256k1_fe_normalize_var(&t1);\n     return secp256k1_fe_is_zero(&t1);\n }\n \n@@ -206,7 +206,7 @@ static void secp256k1_fe_inv_var(secp256k1_fe_t *r, const secp256k1_fe_t *a) {\n #elif defined(USE_FIELD_INV_NUM)\n     unsigned char b[32];\n     secp256k1_fe_t c = *a;\n-    secp256k1_fe_normalize(&c);\n+    secp256k1_fe_normalize_var(&c);\n     secp256k1_fe_get_b32(b, &c);\n     secp256k1_num_t n;\n     secp256k1_num_set_bin(&n, b, 32);\n@@ -218,30 +218,6 @@ static void secp256k1_fe_inv_var(secp256k1_fe_t *r, const secp256k1_fe_t *a) {\n #endif\n }\n \n-static void secp256k1_fe_inv_all(size_t len, secp256k1_fe_t r[len], const secp256k1_fe_t a[len]) {\n-    if (len < 1)\n-        return;\n-\n-    VERIFY_CHECK((r + len <= a) || (a + len <= r));\n-\n-    r[0] = a[0];\n-\n-    size_t i = 0;\n-    while (++i < len) {\n-        secp256k1_fe_mul(&r[i], &r[i - 1], &a[i]);\n-    }\n-\n-    secp256k1_fe_t u; secp256k1_fe_inv(&u, &r[--i]);\n-\n-    while (i > 0) {\n-        int j = i--;\n-        secp256k1_fe_mul(&r[j], &r[i], &u);\n-        secp256k1_fe_mul(&u, &u, &a[j]);\n-    }\n-\n-    r[0] = u;\n-}\n-\n static void secp256k1_fe_inv_all_var(size_t len, secp256k1_fe_t r[len], const secp256k1_fe_t a[len]) {\n     if (len < 1)\n         return;\n@@ -277,7 +253,7 @@ static void secp256k1_fe_start(void) {\n #endif\n     if (secp256k1_fe_consts == NULL) {\n         secp256k1_fe_inner_start();\n-        secp256k1_fe_consts_t *ret = (secp256k1_fe_consts_t*)malloc(sizeof(secp256k1_fe_consts_t));\n+        secp256k1_fe_consts_t *ret = (secp256k1_fe_consts_t*)checked_malloc(sizeof(secp256k1_fe_consts_t));\n #ifndef USE_NUM_NONE\n         secp256k1_num_set_bin(&ret->p, secp256k1_fe_consts_p, sizeof(secp256k1_fe_consts_p));\n #endif"
      },
      {
        "sha": "ecfebcdc0c0dc3c387952b2315f89847204f0da1",
        "filename": "src/secp256k1/src/group.h",
        "status": "modified",
        "additions": 4,
        "deletions": 3,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/group.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/group.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/src/group.h?ref=6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "patch": "@@ -51,15 +51,16 @@ static void secp256k1_ge_set_xy(secp256k1_ge_t *r, const secp256k1_fe_t *x, cons\n \n /** Set a group element (affine) equal to the point with the given X coordinate, and given oddness\n  *  for Y. Return value indicates whether the result is valid. */\n-static int secp256k1_ge_set_xo(secp256k1_ge_t *r, const secp256k1_fe_t *x, int odd);\n+static int secp256k1_ge_set_xo_var(secp256k1_ge_t *r, const secp256k1_fe_t *x, int odd);\n \n /** Check whether a group element is the point at infinity. */\n static int secp256k1_ge_is_infinity(const secp256k1_ge_t *a);\n \n /** Check whether a group element is valid (i.e., on the curve). */\n-static int secp256k1_ge_is_valid(const secp256k1_ge_t *a);\n+static int secp256k1_ge_is_valid_var(const secp256k1_ge_t *a);\n \n static void secp256k1_ge_neg(secp256k1_ge_t *r, const secp256k1_ge_t *a);\n+static void secp256k1_ge_neg_var(secp256k1_ge_t *r, const secp256k1_ge_t *a);\n \n /** Get a hex representation of a point. *rlen will be overwritten with the real length. */\n static void secp256k1_ge_get_hex(char *r, int *rlen, const secp256k1_ge_t *a);\n@@ -84,7 +85,7 @@ static void secp256k1_gej_set_ge(secp256k1_gej_t *r, const secp256k1_ge_t *a);\n static void secp256k1_gej_get_x_var(secp256k1_fe_t *r, const secp256k1_gej_t *a);\n \n /** Set r equal to the inverse of a (i.e., mirrored around the X axis) */\n-static void secp256k1_gej_neg(secp256k1_gej_t *r, const secp256k1_gej_t *a);\n+static void secp256k1_gej_neg_var(secp256k1_gej_t *r, const secp256k1_gej_t *a);\n \n /** Check whether a group element is the point at infinity. */\n static int secp256k1_gej_is_infinity(const secp256k1_gej_t *a);"
      },
      {
        "sha": "1ab5d5fe7bfc8e77d2728af9511fae6316d53a4f",
        "filename": "src/secp256k1/src/group_impl.h",
        "status": "modified",
        "additions": 32,
        "deletions": 27,
        "changes": 59,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/group_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/group_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/src/group_impl.h?ref=6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "patch": "@@ -28,13 +28,17 @@ static int secp256k1_ge_is_infinity(const secp256k1_ge_t *a) {\n }\n \n static void secp256k1_ge_neg(secp256k1_ge_t *r, const secp256k1_ge_t *a) {\n-    r->infinity = a->infinity;\n-    r->x = a->x;\n-    r->y = a->y;\n+    *r = *a;\n     secp256k1_fe_normalize(&r->y);\n     secp256k1_fe_negate(&r->y, &r->y, 1);\n }\n \n+static void secp256k1_ge_neg_var(secp256k1_ge_t *r, const secp256k1_ge_t *a) {\n+    *r = *a;\n+    secp256k1_fe_normalize_var(&r->y);\n+    secp256k1_fe_negate(&r->y, &r->y, 1);\n+}\n+\n static void secp256k1_ge_get_hex(char *r, int *rlen, const secp256k1_ge_t *a) {\n     char cx[65]; int lx=65;\n     char cy[65]; int ly=65;\n@@ -85,15 +89,16 @@ static void secp256k1_ge_set_gej_var(secp256k1_ge_t *r, secp256k1_gej_t *a) {\n \n static void secp256k1_ge_set_all_gej_var(size_t len, secp256k1_ge_t r[len], const secp256k1_gej_t a[len]) {\n     size_t count = 0;\n-    secp256k1_fe_t az[len];\n+    secp256k1_fe_t *az = checked_malloc(sizeof(secp256k1_fe_t) * len);\n     for (size_t i=0; i<len; i++) {\n         if (!a[i].infinity) {\n             az[count++] = a[i].z;\n         }\n     }\n \n-    secp256k1_fe_t azi[count];\n+    secp256k1_fe_t *azi = checked_malloc(sizeof(secp256k1_fe_t) * count);\n     secp256k1_fe_inv_all_var(count, azi, az);\n+    free(az);\n \n     count = 0;\n     for (size_t i=0; i<len; i++) {\n@@ -106,6 +111,7 @@ static void secp256k1_ge_set_all_gej_var(size_t len, secp256k1_ge_t r[len], cons\n             secp256k1_fe_mul(&r[i].y, &a[i].y, &zi3);\n         }\n     }\n+    free(azi);\n }\n \n static void secp256k1_gej_set_infinity(secp256k1_gej_t *r) {\n@@ -135,16 +141,16 @@ static void secp256k1_ge_clear(secp256k1_ge_t *r) {\n     secp256k1_fe_clear(&r->y);\n }\n \n-static int secp256k1_ge_set_xo(secp256k1_ge_t *r, const secp256k1_fe_t *x, int odd) {\n+static int secp256k1_ge_set_xo_var(secp256k1_ge_t *r, const secp256k1_fe_t *x, int odd) {\n     r->x = *x;\n     secp256k1_fe_t x2; secp256k1_fe_sqr(&x2, x);\n     secp256k1_fe_t x3; secp256k1_fe_mul(&x3, x, &x2);\n     r->infinity = 0;\n     secp256k1_fe_t c; secp256k1_fe_set_int(&c, 7);\n     secp256k1_fe_add(&c, &x3);\n-    if (!secp256k1_fe_sqrt(&r->y, &c))\n+    if (!secp256k1_fe_sqrt_var(&r->y, &c))\n         return 0;\n-    secp256k1_fe_normalize(&r->y);\n+    secp256k1_fe_normalize_var(&r->y);\n     if (secp256k1_fe_is_odd(&r->y) != odd)\n         secp256k1_fe_negate(&r->y, &r->y, 1);\n     return 1;\n@@ -162,20 +168,20 @@ static void secp256k1_gej_get_x_var(secp256k1_fe_t *r, const secp256k1_gej_t *a)\n     secp256k1_fe_mul(r, &a->x, &zi2);\n }\n \n-static void secp256k1_gej_neg(secp256k1_gej_t *r, const secp256k1_gej_t *a) {\n+static void secp256k1_gej_neg_var(secp256k1_gej_t *r, const secp256k1_gej_t *a) {\n     r->infinity = a->infinity;\n     r->x = a->x;\n     r->y = a->y;\n     r->z = a->z;\n-    secp256k1_fe_normalize(&r->y);\n+    secp256k1_fe_normalize_var(&r->y);\n     secp256k1_fe_negate(&r->y, &r->y, 1);\n }\n \n static int secp256k1_gej_is_infinity(const secp256k1_gej_t *a) {\n     return a->infinity;\n }\n \n-static int secp256k1_gej_is_valid(const secp256k1_gej_t *a) {\n+static int secp256k1_gej_is_valid_var(const secp256k1_gej_t *a) {\n     if (a->infinity)\n         return 0;\n     /** y^2 = x^3 + 7\n@@ -189,21 +195,21 @@ static int secp256k1_gej_is_valid(const secp256k1_gej_t *a) {\n     secp256k1_fe_t z6; secp256k1_fe_sqr(&z6, &z2); secp256k1_fe_mul(&z6, &z6, &z2);\n     secp256k1_fe_mul_int(&z6, 7);\n     secp256k1_fe_add(&x3, &z6);\n-    secp256k1_fe_normalize(&y2);\n-    secp256k1_fe_normalize(&x3);\n+    secp256k1_fe_normalize_var(&y2);\n+    secp256k1_fe_normalize_var(&x3);\n     return secp256k1_fe_equal(&y2, &x3);\n }\n \n-static int secp256k1_ge_is_valid(const secp256k1_ge_t *a) {\n+static int secp256k1_ge_is_valid_var(const secp256k1_ge_t *a) {\n     if (a->infinity)\n         return 0;\n     /* y^2 = x^3 + 7 */\n     secp256k1_fe_t y2; secp256k1_fe_sqr(&y2, &a->y);\n     secp256k1_fe_t x3; secp256k1_fe_sqr(&x3, &a->x); secp256k1_fe_mul(&x3, &x3, &a->x);\n     secp256k1_fe_t c; secp256k1_fe_set_int(&c, 7);\n     secp256k1_fe_add(&x3, &c);\n-    secp256k1_fe_normalize(&y2);\n-    secp256k1_fe_normalize(&x3);\n+    secp256k1_fe_normalize_var(&y2);\n+    secp256k1_fe_normalize_var(&x3);\n     return secp256k1_fe_equal(&y2, &x3);\n }\n \n@@ -255,11 +261,11 @@ static void secp256k1_gej_add_var(secp256k1_gej_t *r, const secp256k1_gej_t *a,\n     secp256k1_fe_t u2; secp256k1_fe_mul(&u2, &b->x, &z12);\n     secp256k1_fe_t s1; secp256k1_fe_mul(&s1, &a->y, &z22); secp256k1_fe_mul(&s1, &s1, &b->z);\n     secp256k1_fe_t s2; secp256k1_fe_mul(&s2, &b->y, &z12); secp256k1_fe_mul(&s2, &s2, &a->z);\n-    secp256k1_fe_normalize(&u1);\n-    secp256k1_fe_normalize(&u2);\n+    secp256k1_fe_normalize_var(&u1);\n+    secp256k1_fe_normalize_var(&u2);\n     if (secp256k1_fe_equal(&u1, &u2)) {\n-        secp256k1_fe_normalize(&s1);\n-        secp256k1_fe_normalize(&s2);\n+        secp256k1_fe_normalize_var(&s1);\n+        secp256k1_fe_normalize_var(&s2);\n         if (secp256k1_fe_equal(&s1, &s2)) {\n             secp256k1_gej_double_var(r, a);\n         } else {\n@@ -294,15 +300,14 @@ static void secp256k1_gej_add_ge_var(secp256k1_gej_t *r, const secp256k1_gej_t *\n     }\n     r->infinity = 0;\n     secp256k1_fe_t z12; secp256k1_fe_sqr(&z12, &a->z);\n-    secp256k1_fe_t u1 = a->x; secp256k1_fe_normalize(&u1);\n+    secp256k1_fe_t u1 = a->x;\n     secp256k1_fe_t u2; secp256k1_fe_mul(&u2, &b->x, &z12);\n-    secp256k1_fe_t s1 = a->y; secp256k1_fe_normalize(&s1);\n+    secp256k1_fe_t s1 = a->y; secp256k1_fe_normalize_var(&s1);\n     secp256k1_fe_t s2; secp256k1_fe_mul(&s2, &b->y, &z12); secp256k1_fe_mul(&s2, &s2, &a->z);\n-    secp256k1_fe_normalize(&u1);\n-    secp256k1_fe_normalize(&u2);\n+    secp256k1_fe_normalize_var(&u1);\n+    secp256k1_fe_normalize_var(&u2);\n     if (secp256k1_fe_equal(&u1, &u2)) {\n-        secp256k1_fe_normalize(&s1);\n-        secp256k1_fe_normalize(&s2);\n+        secp256k1_fe_normalize_var(&s2);\n         if (secp256k1_fe_equal(&s1, &s2)) {\n             secp256k1_gej_double_var(r, a);\n         } else {\n@@ -434,7 +439,7 @@ static void secp256k1_ge_start(void) {\n     };\n #endif\n     if (secp256k1_ge_consts == NULL) {\n-        secp256k1_ge_consts_t *ret = (secp256k1_ge_consts_t*)malloc(sizeof(secp256k1_ge_consts_t));\n+        secp256k1_ge_consts_t *ret = (secp256k1_ge_consts_t*)checked_malloc(sizeof(secp256k1_ge_consts_t));\n #ifdef USE_ENDOMORPHISM\n         VERIFY_CHECK(secp256k1_fe_set_b32(&ret->beta, secp256k1_ge_consts_beta));\n #endif"
      },
      {
        "sha": "4408cce2d887b9ccd7b0b2eeb4bf8d28ce50d392",
        "filename": "src/secp256k1/src/scalar_impl.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/scalar_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/scalar_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/src/scalar_impl.h?ref=6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "patch": "@@ -40,7 +40,7 @@ static void secp256k1_scalar_start(void) {\n         return;\n \n     /* Allocate. */\n-    secp256k1_scalar_consts_t *ret = (secp256k1_scalar_consts_t*)malloc(sizeof(secp256k1_scalar_consts_t));\n+    secp256k1_scalar_consts_t *ret = (secp256k1_scalar_consts_t*)checked_malloc(sizeof(secp256k1_scalar_consts_t));\n \n #ifndef USE_NUM_NONE\n     static const unsigned char secp256k1_scalar_consts_order[] = {"
      },
      {
        "sha": "305a240e6c652b6776f278e1da29e53e94fe95e5",
        "filename": "src/secp256k1/src/tests.c",
        "status": "modified",
        "additions": 8,
        "deletions": 26,
        "changes": 34,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/tests.c",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/tests.c",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/src/tests.c?ref=6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "patch": "@@ -46,7 +46,7 @@ void random_group_element_test(secp256k1_ge_t *ge) {\n     secp256k1_fe_t fe;\n     do {\n         random_field_element_test(&fe);\n-        if (secp256k1_ge_set_xo(ge, &fe, secp256k1_rand32() & 1))\n+        if (secp256k1_ge_set_xo_var(ge, &fe, secp256k1_rand32() & 1))\n             break;\n     } while(1);\n }\n@@ -459,7 +459,7 @@ void random_fe_non_zero(secp256k1_fe_t *nz) {\n void random_fe_non_square(secp256k1_fe_t *ns) {\n     random_fe_non_zero(ns);\n     secp256k1_fe_t r;\n-    if (secp256k1_fe_sqrt(&r, ns)) {\n+    if (secp256k1_fe_sqrt_var(&r, ns)) {\n         secp256k1_fe_negate(ns, ns, 1);\n     }\n }\n@@ -498,23 +498,6 @@ void run_field_inv_var(void) {\n     }\n }\n \n-void run_field_inv_all(void) {\n-    secp256k1_fe_t x[16], xi[16], xii[16];\n-    /* Check it's safe to call for 0 elements */\n-    secp256k1_fe_inv_all(0, xi, x);\n-    for (int i=0; i<count; i++) {\n-        size_t len = (secp256k1_rand32() & 15) + 1;\n-        for (size_t j=0; j<len; j++)\n-            random_fe_non_zero(&x[j]);\n-        secp256k1_fe_inv_all(len, xi, x);\n-        for (size_t j=0; j<len; j++)\n-            CHECK(check_fe_inverse(&x[j], &xi[j]));\n-        secp256k1_fe_inv_all(len, xii, xi);\n-        for (size_t j=0; j<len; j++)\n-            CHECK(check_fe_equal(&x[j], &xii[j]));\n-    }\n-}\n-\n void run_field_inv_all_var(void) {\n     secp256k1_fe_t x[16], xi[16], xii[16];\n     /* Check it's safe to call for 0 elements */\n@@ -549,7 +532,7 @@ void run_sqr(void) {\n \n void test_sqrt(const secp256k1_fe_t *a, const secp256k1_fe_t *k) {\n     secp256k1_fe_t r1, r2;\n-    int v = secp256k1_fe_sqrt(&r1, a);\n+    int v = secp256k1_fe_sqrt_var(&r1, a);\n     CHECK((v == 0) == (k == NULL));\n \n     if (k != NULL) {\n@@ -779,22 +762,22 @@ void test_point_times_order(const secp256k1_gej_t *point) {\n     secp256k1_ecmult(&res2, point, &nx, &nx); /* calc res2 = (order - x) * point + (order - x) * G; */\n     secp256k1_gej_add_var(&res1, &res1, &res2);\n     CHECK(secp256k1_gej_is_infinity(&res1));\n-    CHECK(secp256k1_gej_is_valid(&res1) == 0);\n+    CHECK(secp256k1_gej_is_valid_var(&res1) == 0);\n     secp256k1_ge_t res3;\n     secp256k1_ge_set_gej(&res3, &res1);\n     CHECK(secp256k1_ge_is_infinity(&res3));\n-    CHECK(secp256k1_ge_is_valid(&res3) == 0);\n+    CHECK(secp256k1_ge_is_valid_var(&res3) == 0);\n }\n \n void run_point_times_order(void) {\n     secp256k1_fe_t x; VERIFY_CHECK(secp256k1_fe_set_hex(&x, \"02\", 2));\n     for (int i=0; i<500; i++) {\n         secp256k1_ge_t p;\n-        if (secp256k1_ge_set_xo(&p, &x, 1)) {\n-            CHECK(secp256k1_ge_is_valid(&p));\n+        if (secp256k1_ge_set_xo_var(&p, &x, 1)) {\n+            CHECK(secp256k1_ge_is_valid_var(&p));\n             secp256k1_gej_t j;\n             secp256k1_gej_set_ge(&j, &p);\n-            CHECK(secp256k1_gej_is_valid(&j));\n+            CHECK(secp256k1_gej_is_valid_var(&j));\n             test_point_times_order(&j);\n         }\n         secp256k1_fe_sqr(&x, &x);\n@@ -1185,7 +1168,6 @@ int main(int argc, char **argv) {\n     /* field tests */\n     run_field_inv();\n     run_field_inv_var();\n-    run_field_inv_all();\n     run_field_inv_all_var();\n     run_sqr();\n     run_sqrt();"
      },
      {
        "sha": "c3a8f3a42bff366b478ff0428d9d3e06b91fa9a4",
        "filename": "src/secp256k1/src/util.h",
        "status": "modified",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/util.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6d1980f02ecad1bc27ceaa84add3e52a384f7b52/src/secp256k1/src/util.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/src/util.h?ref=6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "patch": "@@ -61,6 +61,12 @@\n #define VERIFY_CHECK(cond) do { (void)(cond); } while(0)\n #endif\n \n+static inline void *checked_malloc(size_t size) {\n+    void *ret = malloc(size);\n+    CHECK(ret != NULL);\n+    return ret;\n+}\n+\n /* Macro for restrict, when available and not in a VERIFY build. */\n #if defined(SECP256K1_BUILD) && defined(VERIFY)\n # define SECP256K1_RESTRICT"
      }
    ]
  },
  {
    "sha": "f7cd7b8f29c10865617d6769c3fb2350b3335f45",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmN2NkN2I4ZjI5YzEwODY1NjE3ZDY3NjljM2ZiMjM1MGIzMzM1ZjQ1",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2014-12-08T12:06:02Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2014-12-08T14:21:23Z"
      },
      "message": "Upload result",
      "tree": {
        "sha": "d8a3f064bf86ff4936a1fe7ffd0b93b1434d125e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d8a3f064bf86ff4936a1fe7ffd0b93b1434d125e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f7cd7b8f29c10865617d6769c3fb2350b3335f45",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f7cd7b8f29c10865617d6769c3fb2350b3335f45",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f7cd7b8f29c10865617d6769c3fb2350b3335f45",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f7cd7b8f29c10865617d6769c3fb2350b3335f45/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6d1980f02ecad1bc27ceaa84add3e52a384f7b52",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/6d1980f02ecad1bc27ceaa84add3e52a384f7b52"
      }
    ],
    "stats": {
      "total": 11,
      "additions": 8,
      "deletions": 3
    },
    "files": [
      {
        "sha": "b664748d8c7d7da81773495f714b5fccb65c651b",
        "filename": ".travis.yml",
        "status": "modified",
        "additions": 3,
        "deletions": 3,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f7cd7b8f29c10865617d6769c3fb2350b3335f45/.travis.yml",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f7cd7b8f29c10865617d6769c3fb2350b3335f45/.travis.yml",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/.travis.yml?ref=f7cd7b8f29c10865617d6769c3fb2350b3335f45",
        "patch": "@@ -15,6 +15,7 @@ env:\n     - CCACHE_COMPRESS=1\n     - BASE_OUTDIR=$TRAVIS_BUILD_DIR/out\n     - SDK_URL=https://bitcoincore.org/depends-sources/sdks\n+    - UPLOAD=false\n cache:\n   apt: true\n   directories:\n@@ -29,7 +30,7 @@ matrix:\n     - compiler: \": bitcoind\"\n       env: HOST=x86_64-unknown-linux-gnu PACKAGES=\"bc\" DEP_OPTS=\"NO_QT=1 NO_UPNP=1 DEBUG=1\" RUN_TESTS=true GOAL=\"install\" BITCOIN_CONFIG=\"--enable-glibc-back-compat CPPFLAGS=-DDEBUG_LOCKORDER\"\n     - compiler: \": No wallet\"\n-      env: HOST=x86_64-unknown-linux-gnu DEP_OPTS=\"NO_WALLET=1\" RUN_TESTS=true GOAL=\"install\" BITCOIN_CONFIG=\"--enable-glibc-back-compat\"\n+      env: HOST=x86_64-unknown-linux-gnu DEP_OPTS=\"NO_WALLET=1\" RUN_TESTS=true UPLOAD=true GOAL=\"install\" BITCOIN_CONFIG=\"--enable-glibc-back-compat\"\n     - compiler: \": 32-bit + dash\"\n       env: HOST=i686-pc-linux-gnu PACKAGES=\"g++-multilib bc\" RUN_TESTS=true GOAL=\"install\" BITCOIN_CONFIG=\"--enable-glibc-back-compat\" USE_SHELL=\"/bin/dash\"\n     - compiler: \": Cross-Mac\"\n@@ -60,7 +61,6 @@ script:\n     - ./configure --cache-file=../config.cache $BITCOIN_CONFIG_ALL $BITCOIN_CONFIG || ( cat config.log && false)\n     - make $MAKEJOBS $GOAL || ( echo \"Build failure. Verbose build follows.\" && make $GOAL V=1 ; false )\n     - export LD_LIBRARY_PATH=$TRAVIS_BUILD_DIR/depends/$HOST/lib\n+    - if [ \"$UPLOAD\" = \"true\" ]; then scp -i ./key -o StrictHostKeyChecking=no -r $BASE_OUTDIR upload@bitcoin.sipa.be:test/ || echo \"upload failed\"; fi\n     - if [ \"$RUN_TESTS\" = \"true\" ]; then make check; fi\n     - if [ \"$RUN_TESTS\" = \"true\" ]; then qa/pull-tester/rpc-tests.sh; fi\n-after_script:\n-    - if [ \"$TRAVIS_PULL_REQUEST\" != \"false\" ]; then (echo \"Upload goes here. Something like: scp -r $BASE_OUTDIR server\" || echo \"upload failed\"); fi"
      },
      {
        "sha": "cc6e7ac03a42e5ff232942102d8d9e0cb120f3aa",
        "filename": "key",
        "status": "added",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f7cd7b8f29c10865617d6769c3fb2350b3335f45/key",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f7cd7b8f29c10865617d6769c3fb2350b3335f45/key",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/key?ref=f7cd7b8f29c10865617d6769c3fb2350b3335f45",
        "patch": "@@ -0,0 +1,5 @@\n+-----BEGIN EC PRIVATE KEY-----\n+MHcCAQEEILGid6U0wsl9GzkIxCS5QbOQHnxH3eFyCARsgibdk7vLoAoGCCqGSM49\n+AwEHoUQDQgAE9AgY1t9DA5XUo4ILFK5PPyEhPub4evtj9UP1yi0WskQFH5CZwXwr\n+xS2J1NCw8GtIv2T6OTgrRI1mynWxHk8ouA==\n+-----END EC PRIVATE KEY-----"
      }
    ]
  },
  {
    "sha": "06c0bf9249f3968f2cd9a66ea506f7d34515a42a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowNmMwYmY5MjQ5ZjM5NjhmMmNkOWE2NmVhNTA2ZjdkMzQ1MTVhNDJh",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2014-12-08T14:22:27Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2014-12-08T14:22:27Z"
      },
      "message": "Explicit and I/O registers",
      "tree": {
        "sha": "a22316469bffa6de6301adf92c0e7f9cb7475f40",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a22316469bffa6de6301adf92c0e7f9cb7475f40"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/06c0bf9249f3968f2cd9a66ea506f7d34515a42a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/06c0bf9249f3968f2cd9a66ea506f7d34515a42a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/06c0bf9249f3968f2cd9a66ea506f7d34515a42a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/06c0bf9249f3968f2cd9a66ea506f7d34515a42a/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f7cd7b8f29c10865617d6769c3fb2350b3335f45",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f7cd7b8f29c10865617d6769c3fb2350b3335f45",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f7cd7b8f29c10865617d6769c3fb2350b3335f45"
      }
    ],
    "stats": {
      "total": 128,
      "additions": 64,
      "deletions": 64
    },
    "files": [
      {
        "sha": "fca18bdec6926790301a5c1e4b3a4d922a1a2dbf",
        "filename": "src/secp256k1/src/field_5x52_asm_impl.h",
        "status": "modified",
        "additions": 64,
        "deletions": 64,
        "changes": 128,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/06c0bf9249f3968f2cd9a66ea506f7d34515a42a/src/secp256k1/src/field_5x52_asm_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/06c0bf9249f3968f2cd9a66ea506f7d34515a42a/src/secp256k1/src/field_5x52_asm_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/src/field_5x52_asm_impl.h?ref=06c0bf9249f3968f2cd9a66ea506f7d34515a42a",
        "patch": "@@ -21,18 +21,18 @@ SECP256K1_INLINE static void secp256k1_fe_mul_inner(uint64_t *r, const uint64_t\n  *            r15:rcx = d\n  *            r10-r14 = a0-a4\n  *            rbx     = b\n- *            %2      = r\n- *            %0      = a / t?\n+ *            rdi     = r\n+ *            rsi     = a / t?\n  *            rbp     = R (0x1000003d10)\n  */\n __asm__ __volatile__(\n     \"pushq %%rbp\\n\"\n \n-    \"movq 0(%0),%%r10\\n\"\n-    \"movq 8(%0),%%r11\\n\"\n-    \"movq 16(%0),%%r12\\n\"\n-    \"movq 24(%0),%%r13\\n\"\n-    \"movq 32(%0),%%r14\\n\"\n+    \"movq 0(%%rsi),%%r10\\n\"\n+    \"movq 8(%%rsi),%%r11\\n\"\n+    \"movq 16(%%rsi),%%r12\\n\"\n+    \"movq 24(%%rsi),%%r13\\n\"\n+    \"movq 32(%%rsi),%%r14\\n\"\n     \"movq $0x1000003d10,%%rbp\\n\"\n \n     /* d += a3 * b0 */\n@@ -69,10 +69,10 @@ __asm__ __volatile__(\n     /* c >>= 52 (%%r8 only) */\n     \"shrdq $52,%%r9,%%r8\\n\"\n     /* t3 (stack) = d & M */\n-    \"movq %%rcx,%0\\n\"\n+    \"movq %%rcx,%%rsi\\n\"\n     \"movq $0xfffffffffffff,%%rdx\\n\"\n-    \"andq %%rdx,%0\\n\"\n-    \"pushq %0\\n\"\n+    \"andq %%rdx,%%rsi\\n\"\n+    \"pushq %%rsi\\n\"\n     /* d >>= 52 */\n     \"shrdq $52,%%r15,%%rcx\\n\"\n     \"xorq %%r15,%%r15\\n\"\n@@ -106,20 +106,20 @@ __asm__ __volatile__(\n     \"mulq %%rbp\\n\"\n     \"addq %%rax,%%rcx\\n\"\n     \"adcq %%rdx,%%r15\\n\"\n-    /* t4 = d & M (%0) */\n-    \"movq %%rcx,%0\\n\"\n+    /* t4 = d & M (%%rsi) */\n+    \"movq %%rcx,%%rsi\\n\"\n     \"movq $0xfffffffffffff,%%rdx\\n\"\n-    \"andq %%rdx,%0\\n\"\n+    \"andq %%rdx,%%rsi\\n\"\n     /* d >>= 52 */\n     \"shrdq $52,%%r15,%%rcx\\n\"\n     \"xorq %%r15,%%r15\\n\"\n     /* tx = t4 >> 48 (%%rbp, overwrites R) */\n-    \"movq %0,%%rbp\\n\"\n+    \"movq %%rsi,%%rbp\\n\"\n     \"shrq $48,%%rbp\\n\"\n     /* t4 &= (M >> 4) (stack) */\n     \"movq $0xffffffffffff,%%rax\\n\"\n-    \"andq %%rax,%0\\n\"\n-    \"pushq %0\\n\"\n+    \"andq %%rax,%%rsi\\n\"\n+    \"pushq %%rsi\\n\"\n     /* c = a0 * b0 */\n     \"movq 0(%%rbx),%%rax\\n\"\n     \"mulq %%r10\\n\"\n@@ -145,26 +145,26 @@ __asm__ __volatile__(\n     \"mulq %%r11\\n\"\n     \"addq %%rax,%%rcx\\n\"\n     \"adcq %%rdx,%%r15\\n\"\n-    /* u0 = d & M (%0) */\n-    \"movq %%rcx,%0\\n\"\n+    /* u0 = d & M (%%rsi) */\n+    \"movq %%rcx,%%rsi\\n\"\n     \"movq $0xfffffffffffff,%%rdx\\n\"\n-    \"andq %%rdx,%0\\n\"\n+    \"andq %%rdx,%%rsi\\n\"\n     /* d >>= 52 */\n     \"shrdq $52,%%r15,%%rcx\\n\"\n     \"xorq %%r15,%%r15\\n\"\n-    /* u0 = (u0 << 4) | tx (%0) */\n-    \"shlq $4,%0\\n\"\n-    \"orq %%rbp,%0\\n\"\n+    /* u0 = (u0 << 4) | tx (%%rsi) */\n+    \"shlq $4,%%rsi\\n\"\n+    \"orq %%rbp,%%rsi\\n\"\n     /* c += u0 * (R >> 4) */\n     \"movq $0x1000003d1,%%rax\\n\"\n-    \"mulq %0\\n\"\n+    \"mulq %%rsi\\n\"\n     \"addq %%rax,%%r8\\n\"\n     \"adcq %%rdx,%%r9\\n\"\n     /* r[0] = c & M */\n     \"movq %%r8,%%rax\\n\"\n     \"movq $0xfffffffffffff,%%rdx\\n\"\n     \"andq %%rdx,%%rax\\n\"\n-    \"movq %%rax,0(%2)\\n\"\n+    \"movq %%rax,0(%%rdi)\\n\"\n     /* c >>= 52 */\n     \"shrdq $52,%%r9,%%r8\\n\"\n     \"xorq %%r9,%%r9\\n\"\n@@ -209,7 +209,7 @@ __asm__ __volatile__(\n     \"movq %%r8,%%rax\\n\"\n     \"movq $0xfffffffffffff,%%rdx\\n\"\n     \"andq %%rdx,%%rax\\n\"\n-    \"movq %%rax,8(%2)\\n\"\n+    \"movq %%rax,8(%%rdi)\\n\"\n     /* c >>= 52 */\n     \"shrdq $52,%%r9,%%r8\\n\"\n     \"xorq %%r9,%%r9\\n\"\n@@ -228,8 +228,8 @@ __asm__ __volatile__(\n     \"mulq %%r10\\n\"\n     \"addq %%rax,%%r8\\n\"\n     \"adcq %%rdx,%%r9\\n\"\n-    /* fetch t3 (%%r10, overwrites a0),t4 (%0) */\n-    \"popq %0\\n\"\n+    /* fetch t3 (%%r10, overwrites a0),t4 (%%rsi) */\n+    \"popq %%rsi\\n\"\n     \"popq %%r10\\n\"\n     /* d += a4 * b3 */\n     \"movq 24(%%rbx),%%rax\\n\"\n@@ -254,7 +254,7 @@ __asm__ __volatile__(\n     \"movq %%r8,%%rax\\n\"\n     \"movq $0xfffffffffffff,%%rdx\\n\"\n     \"andq %%rdx,%%rax\\n\"\n-    \"movq %%rax,16(%2)\\n\"\n+    \"movq %%rax,16(%%rdi)\\n\"\n     /* c >>= 52 */\n     \"shrdq $52,%%r9,%%r8\\n\"\n     \"xorq %%r9,%%r9\\n\"\n@@ -269,17 +269,17 @@ __asm__ __volatile__(\n     \"movq %%r8,%%rax\\n\"\n     \"movq $0xfffffffffffff,%%rdx\\n\"\n     \"andq %%rdx,%%rax\\n\"\n-    \"movq %%rax,24(%2)\\n\"\n+    \"movq %%rax,24(%%rdi)\\n\"\n     /* c >>= 52 (%%r8 only) */\n     \"shrdq $52,%%r9,%%r8\\n\"\n     /* c += t4 (%%r8 only) */\n-    \"addq %0,%%r8\\n\"\n+    \"addq %%rsi,%%r8\\n\"\n     /* r[4] = c */\n-    \"movq %%r8,32(%2)\\n\"\n+    \"movq %%r8,32(%%rdi)\\n\"\n \n     \"popq %%rbp\\n\"\n : \"+S\"(a)\n-: \"b\"(b), \"D\"(r)\n+: \"0\"(a), \"b\"(b), \"D\"(r)\n : \"%rax\", \"%rcx\", \"%rdx\", \"%r8\", \"%r9\", \"%r10\", \"%r11\", \"%r12\", \"%r13\", \"%r14\", \"%r15\", \"cc\", \"memory\"\n );\n }\n@@ -291,18 +291,18 @@ SECP256K1_INLINE static void secp256k1_fe_sqr_inner(uint64_t *r, const uint64_t\n  *            rcx:rbx = d\n  *            r10-r14 = a0-a4\n  *            r15     = M (0xfffffffffffff)\n- *            %1      = r\n- *            %0      = a / t?\n+ *            rdi     = r\n+ *            rsi     = a / t?\n  *            rbp     = R (0x1000003d10)\n  */\n __asm__ __volatile__(\n     \"pushq %%rbp\\n\"\n \n-    \"movq 0(%0),%%r10\\n\"\n-    \"movq 8(%0),%%r11\\n\"\n-    \"movq 16(%0),%%r12\\n\"\n-    \"movq 24(%0),%%r13\\n\"\n-    \"movq 32(%0),%%r14\\n\"\n+    \"movq 0(%%rsi),%%r10\\n\"\n+    \"movq 8(%%rsi),%%r11\\n\"\n+    \"movq 16(%%rsi),%%r12\\n\"\n+    \"movq 24(%%rsi),%%r13\\n\"\n+    \"movq 32(%%rsi),%%r14\\n\"\n     \"movq $0x1000003d10,%%rbp\\n\"\n     \"movq $0xfffffffffffff,%%r15\\n\"\n \n@@ -329,9 +329,9 @@ __asm__ __volatile__(\n     /* c >>= 52 (%%r8 only) */\n     \"shrdq $52,%%r9,%%r8\\n\"\n     /* t3 (stack) = d & M */\n-    \"movq %%rbx,%0\\n\"\n-    \"andq %%r15,%0\\n\"\n-    \"pushq %0\\n\"\n+    \"movq %%rbx,%%rsi\\n\"\n+    \"andq %%r15,%%rsi\\n\"\n+    \"pushq %%rsi\\n\"\n     /* d >>= 52 */\n     \"shrdq $52,%%rcx,%%rbx\\n\"\n     \"xorq %%rcx,%%rcx\\n\"\n@@ -357,19 +357,19 @@ __asm__ __volatile__(\n     \"mulq %%rbp\\n\"\n     \"addq %%rax,%%rbx\\n\"\n     \"adcq %%rdx,%%rcx\\n\"\n-    /* t4 = d & M (%0) */\n-    \"movq %%rbx,%0\\n\"\n-    \"andq %%r15,%0\\n\"\n+    /* t4 = d & M (%%rsi) */\n+    \"movq %%rbx,%%rsi\\n\"\n+    \"andq %%r15,%%rsi\\n\"\n     /* d >>= 52 */\n     \"shrdq $52,%%rcx,%%rbx\\n\"\n     \"xorq %%rcx,%%rcx\\n\"\n     /* tx = t4 >> 48 (%%rbp, overwrites constant) */\n-    \"movq %0,%%rbp\\n\"\n+    \"movq %%rsi,%%rbp\\n\"\n     \"shrq $48,%%rbp\\n\"\n     /* t4 &= (M >> 4) (stack) */\n     \"movq $0xffffffffffff,%%rax\\n\"\n-    \"andq %%rax,%0\\n\"\n-    \"pushq %0\\n\"\n+    \"andq %%rax,%%rsi\\n\"\n+    \"pushq %%rsi\\n\"\n     /* c = a0 * a0 */\n     \"movq %%r10,%%rax\\n\"\n     \"mulq %%r10\\n\"\n@@ -385,24 +385,24 @@ __asm__ __volatile__(\n     \"mulq %%r13\\n\"\n     \"addq %%rax,%%rbx\\n\"\n     \"adcq %%rdx,%%rcx\\n\"\n-    /* u0 = d & M (%0) */\n-    \"movq %%rbx,%0\\n\"\n-    \"andq %%r15,%0\\n\"\n+    /* u0 = d & M (%%rsi) */\n+    \"movq %%rbx,%%rsi\\n\"\n+    \"andq %%r15,%%rsi\\n\"\n     /* d >>= 52 */\n     \"shrdq $52,%%rcx,%%rbx\\n\"\n     \"xorq %%rcx,%%rcx\\n\"\n-    /* u0 = (u0 << 4) | tx (%0) */\n-    \"shlq $4,%0\\n\"\n-    \"orq %%rbp,%0\\n\"\n+    /* u0 = (u0 << 4) | tx (%%rsi) */\n+    \"shlq $4,%%rsi\\n\"\n+    \"orq %%rbp,%%rsi\\n\"\n     /* c += u0 * (R >> 4) */\n     \"movq $0x1000003d1,%%rax\\n\"\n-    \"mulq %0\\n\"\n+    \"mulq %%rsi\\n\"\n     \"addq %%rax,%%r8\\n\"\n     \"adcq %%rdx,%%r9\\n\"\n     /* r[0] = c & M */\n     \"movq %%r8,%%rax\\n\"\n     \"andq %%r15,%%rax\\n\"\n-    \"movq %%rax,0(%1)\\n\"\n+    \"movq %%rax,0(%%rdi)\\n\"\n     /* c >>= 52 */\n     \"shrdq $52,%%r9,%%r8\\n\"\n     \"xorq %%r9,%%r9\\n\"\n@@ -437,7 +437,7 @@ __asm__ __volatile__(\n     /* r[1] = c & M */\n     \"movq %%r8,%%rax\\n\"\n     \"andq %%r15,%%rax\\n\"\n-    \"movq %%rax,8(%1)\\n\"\n+    \"movq %%rax,8(%%rdi)\\n\"\n     /* c >>= 52 */\n     \"shrdq $52,%%r9,%%r8\\n\"\n     \"xorq %%r9,%%r9\\n\"\n@@ -446,8 +446,8 @@ __asm__ __volatile__(\n     \"mulq %%r12\\n\"\n     \"addq %%rax,%%r8\\n\"\n     \"adcq %%rdx,%%r9\\n\"\n-    /* fetch t3 (%%r10, overwrites a0),t4 (%0) */\n-    \"popq %0\\n\"\n+    /* fetch t3 (%%r10, overwrites a0),t4 (%%rsi) */\n+    \"popq %%rsi\\n\"\n     \"popq %%r10\\n\"\n     /* c += a1 * a1 */\n     \"movq %%r11,%%rax\\n\"\n@@ -470,7 +470,7 @@ __asm__ __volatile__(\n     /* r[2] = c & M */\n     \"movq %%r8,%%rax\\n\"\n     \"andq %%r15,%%rax\\n\"\n-    \"movq %%rax,16(%1)\\n\"\n+    \"movq %%rax,16(%%rdi)\\n\"\n     /* c >>= 52 */\n     \"shrdq $52,%%r9,%%r8\\n\"\n     \"xorq %%r9,%%r9\\n\"\n@@ -484,17 +484,17 @@ __asm__ __volatile__(\n     /* r[3] = c & M */\n     \"movq %%r8,%%rax\\n\"\n     \"andq %%r15,%%rax\\n\"\n-    \"movq %%rax,24(%1)\\n\"\n+    \"movq %%rax,24(%%rdi)\\n\"\n     /* c >>= 52 (%%r8 only) */\n     \"shrdq $52,%%r9,%%r8\\n\"\n     /* c += t4 (%%r8 only) */\n-    \"addq %0,%%r8\\n\"\n+    \"addq %%rsi,%%r8\\n\"\n     /* r[4] = c */\n-    \"movq %%r8,32(%1)\\n\"\n+    \"movq %%r8,32(%%rdi)\\n\"\n \n     \"popq %%rbp\\n\"\n : \"+S\"(a)\n-: \"D\"(r)\n+: \"0\"(a), \"D\"(r)\n : \"%rax\", \"%rbx\", \"%rcx\", \"%rdx\", \"%r8\", \"%r9\", \"%r10\", \"%r11\", \"%r12\", \"%r13\", \"%r14\", \"%r15\", \"cc\", \"memory\"\n );\n }"
      }
    ]
  },
  {
    "sha": "f241cf6f2ed3a66c4f15e8bb6d4697e9c1192ddc",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmMjQxY2Y2ZjJlZDNhNjZjNGYxNWU4YmI2ZDQ2OTdlOWMxMTkyZGRj",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2014-12-08T14:44:56Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2014-12-08T14:50:32Z"
      },
      "message": "Rename keyfile",
      "tree": {
        "sha": "23123d4bcf48561cb8d7433dec0f66ec6ebf5657",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/23123d4bcf48561cb8d7433dec0f66ec6ebf5657"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f241cf6f2ed3a66c4f15e8bb6d4697e9c1192ddc",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f241cf6f2ed3a66c4f15e8bb6d4697e9c1192ddc",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f241cf6f2ed3a66c4f15e8bb6d4697e9c1192ddc",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f241cf6f2ed3a66c4f15e8bb6d4697e9c1192ddc/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "06c0bf9249f3968f2cd9a66ea506f7d34515a42a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/06c0bf9249f3968f2cd9a66ea506f7d34515a42a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/06c0bf9249f3968f2cd9a66ea506f7d34515a42a"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "bbdde079e7c5b4bfcc90ac0973e1a411dc68b4a0",
        "filename": ".travis.yml",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f241cf6f2ed3a66c4f15e8bb6d4697e9c1192ddc/.travis.yml",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f241cf6f2ed3a66c4f15e8bb6d4697e9c1192ddc/.travis.yml",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/.travis.yml?ref=f241cf6f2ed3a66c4f15e8bb6d4697e9c1192ddc",
        "patch": "@@ -61,6 +61,6 @@ script:\n     - ./configure --cache-file=../config.cache $BITCOIN_CONFIG_ALL $BITCOIN_CONFIG || ( cat config.log && false)\n     - make $MAKEJOBS $GOAL || ( echo \"Build failure. Verbose build follows.\" && make $GOAL V=1 ; false )\n     - export LD_LIBRARY_PATH=$TRAVIS_BUILD_DIR/depends/$HOST/lib\n-    - if [ \"$UPLOAD\" = \"true\" ]; then scp -i ./key -o StrictHostKeyChecking=no -r $BASE_OUTDIR upload@bitcoin.sipa.be:test/ || echo \"upload failed\"; fi\n+    - if [ \"$UPLOAD\" = \"true\" ]; then chmod 0400 ../key; scp -i ../key -o StrictHostKeyChecking=no -r $BASE_OUTDIR upload@bitcoin.sipa.be:test/ || echo \"upload failed\"; fi\n     - if [ \"$RUN_TESTS\" = \"true\" ]; then make check; fi\n     - if [ \"$RUN_TESTS\" = \"true\" ]; then qa/pull-tester/rpc-tests.sh; fi"
      }
    ]
  },
  {
    "sha": "9483cccc99e85127cd6c993be92e1b2522e5734a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5NDgzY2NjYzk5ZTg1MTI3Y2Q2Yzk5M2JlOTJlMWIyNTIyZTU3MzRh",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2014-12-08T15:11:14Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2014-12-08T15:11:14Z"
      },
      "message": "Upload other",
      "tree": {
        "sha": "d472ba9a9ee9c1c14bb7e62c8eca566c1385c0bf",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d472ba9a9ee9c1c14bb7e62c8eca566c1385c0bf"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9483cccc99e85127cd6c993be92e1b2522e5734a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9483cccc99e85127cd6c993be92e1b2522e5734a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9483cccc99e85127cd6c993be92e1b2522e5734a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9483cccc99e85127cd6c993be92e1b2522e5734a/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f241cf6f2ed3a66c4f15e8bb6d4697e9c1192ddc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f241cf6f2ed3a66c4f15e8bb6d4697e9c1192ddc",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f241cf6f2ed3a66c4f15e8bb6d4697e9c1192ddc"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 2,
      "deletions": 2
    },
    "files": [
      {
        "sha": "cb1e5851249c012021528d0a33f1df0aa717e7bb",
        "filename": ".travis.yml",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9483cccc99e85127cd6c993be92e1b2522e5734a/.travis.yml",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9483cccc99e85127cd6c993be92e1b2522e5734a/.travis.yml",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/.travis.yml?ref=9483cccc99e85127cd6c993be92e1b2522e5734a",
        "patch": "@@ -28,9 +28,9 @@ matrix:\n     - compiler: \": ARM\"\n       env: HOST=arm-linux-gnueabihf PACKAGES=\"g++-arm-linux-gnueabihf\" DEP_OPTS=\"NO_QT=1\" GOAL=\"install\" BITCOIN_CONFIG=\"--enable-glibc-back-compat\"\n     - compiler: \": bitcoind\"\n-      env: HOST=x86_64-unknown-linux-gnu PACKAGES=\"bc\" DEP_OPTS=\"NO_QT=1 NO_UPNP=1 DEBUG=1\" RUN_TESTS=true GOAL=\"install\" BITCOIN_CONFIG=\"--enable-glibc-back-compat CPPFLAGS=-DDEBUG_LOCKORDER\"\n+      env: HOST=x86_64-unknown-linux-gnu PACKAGES=\"bc\" DEP_OPTS=\"NO_QT=1 NO_UPNP=1 DEBUG=1\" RUN_TESTS=true UPLOAD=true GOAL=\"install\" BITCOIN_CONFIG=\"--enable-glibc-back-compat CPPFLAGS=-DDEBUG_LOCKORDER\"\n     - compiler: \": No wallet\"\n-      env: HOST=x86_64-unknown-linux-gnu DEP_OPTS=\"NO_WALLET=1\" RUN_TESTS=true UPLOAD=true GOAL=\"install\" BITCOIN_CONFIG=\"--enable-glibc-back-compat\"\n+      env: HOST=x86_64-unknown-linux-gnu DEP_OPTS=\"NO_WALLET=1\" RUN_TESTS=true GOAL=\"install\" BITCOIN_CONFIG=\"--enable-glibc-back-compat\"\n     - compiler: \": 32-bit + dash\"\n       env: HOST=i686-pc-linux-gnu PACKAGES=\"g++-multilib bc\" RUN_TESTS=true GOAL=\"install\" BITCOIN_CONFIG=\"--enable-glibc-back-compat\" USE_SHELL=\"/bin/dash\"\n     - compiler: \": Cross-Mac\""
      }
    ]
  },
  {
    "sha": "e07302cde8811fb3e59439d6fa895d2d69b729c7",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplMDczMDJjZGU4ODExZmIzZTU5NDM5ZDZmYTg5NWQyZDY5YjcyOWM3",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2014-12-08T16:23:17Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2014-12-08T16:23:17Z"
      },
      "message": "Don't use the stack in assembly",
      "tree": {
        "sha": "697c88391d1d73d0f5a68ec5e456366d9354fada",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/697c88391d1d73d0f5a68ec5e456366d9354fada"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e07302cde8811fb3e59439d6fa895d2d69b729c7",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e07302cde8811fb3e59439d6fa895d2d69b729c7",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e07302cde8811fb3e59439d6fa895d2d69b729c7",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e07302cde8811fb3e59439d6fa895d2d69b729c7/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "9483cccc99e85127cd6c993be92e1b2522e5734a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9483cccc99e85127cd6c993be92e1b2522e5734a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9483cccc99e85127cd6c993be92e1b2522e5734a"
      }
    ],
    "stats": {
      "total": 32,
      "additions": 18,
      "deletions": 14
    },
    "files": [
      {
        "sha": "db923ca43cf7c86825bc4631d7b00217b0562982",
        "filename": "src/secp256k1/src/field_5x52_asm_impl.h",
        "status": "modified",
        "additions": 18,
        "deletions": 14,
        "changes": 32,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e07302cde8811fb3e59439d6fa895d2d69b729c7/src/secp256k1/src/field_5x52_asm_impl.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e07302cde8811fb3e59439d6fa895d2d69b729c7/src/secp256k1/src/field_5x52_asm_impl.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/secp256k1/src/field_5x52_asm_impl.h?ref=e07302cde8811fb3e59439d6fa895d2d69b729c7",
        "patch": "@@ -25,8 +25,10 @@ SECP256K1_INLINE static void secp256k1_fe_mul_inner(uint64_t *r, const uint64_t\n  *            rsi     = a / t?\n  *            rbp     = R (0x1000003d10)\n  */\n+  void* tmp1;\n+  uint64_t tmp2, tmp3;\n __asm__ __volatile__(\n-    \"pushq %%rbp\\n\"\n+    \"movq %%rbp,%4\\n\"\n \n     \"movq 0(%%rsi),%%r10\\n\"\n     \"movq 8(%%rsi),%%r11\\n\"\n@@ -72,7 +74,7 @@ __asm__ __volatile__(\n     \"movq %%rcx,%%rsi\\n\"\n     \"movq $0xfffffffffffff,%%rdx\\n\"\n     \"andq %%rdx,%%rsi\\n\"\n-    \"pushq %%rsi\\n\"\n+    \"movq %%rsi,%5\\n\"\n     /* d >>= 52 */\n     \"shrdq $52,%%r15,%%rcx\\n\"\n     \"xorq %%r15,%%r15\\n\"\n@@ -119,7 +121,7 @@ __asm__ __volatile__(\n     /* t4 &= (M >> 4) (stack) */\n     \"movq $0xffffffffffff,%%rax\\n\"\n     \"andq %%rax,%%rsi\\n\"\n-    \"pushq %%rsi\\n\"\n+    \"movq %%rsi,%6\\n\"\n     /* c = a0 * b0 */\n     \"movq 0(%%rbx),%%rax\\n\"\n     \"mulq %%r10\\n\"\n@@ -229,8 +231,8 @@ __asm__ __volatile__(\n     \"addq %%rax,%%r8\\n\"\n     \"adcq %%rdx,%%r9\\n\"\n     /* fetch t3 (%%r10, overwrites a0),t4 (%%rsi) */\n-    \"popq %%rsi\\n\"\n-    \"popq %%r10\\n\"\n+    \"movq %6,%%rsi\\n\"\n+    \"movq %5,%%r10\\n\"\n     /* d += a4 * b3 */\n     \"movq 24(%%rbx),%%rax\\n\"\n     \"mulq %%r14\\n\"\n@@ -277,9 +279,9 @@ __asm__ __volatile__(\n     /* r[4] = c */\n     \"movq %%r8,32(%%rdi)\\n\"\n \n-    \"popq %%rbp\\n\"\n+    \"movq %4,%%rbp\\n\"\n : \"+S\"(a)\n-: \"0\"(a), \"b\"(b), \"D\"(r)\n+: \"0\"(a), \"b\"(b), \"D\"(r), \"m\"(tmp1), \"m\"(tmp2), \"m\"(tmp3)\n : \"%rax\", \"%rcx\", \"%rdx\", \"%r8\", \"%r9\", \"%r10\", \"%r11\", \"%r12\", \"%r13\", \"%r14\", \"%r15\", \"cc\", \"memory\"\n );\n }\n@@ -295,8 +297,10 @@ SECP256K1_INLINE static void secp256k1_fe_sqr_inner(uint64_t *r, const uint64_t\n  *            rsi     = a / t?\n  *            rbp     = R (0x1000003d10)\n  */\n+  void* tmp1;\n+  uint64_t tmp2, tmp3;\n __asm__ __volatile__(\n-    \"pushq %%rbp\\n\"\n+    \"movq %%rbp,%3\\n\"\n \n     \"movq 0(%%rsi),%%r10\\n\"\n     \"movq 8(%%rsi),%%r11\\n\"\n@@ -331,7 +335,7 @@ __asm__ __volatile__(\n     /* t3 (stack) = d & M */\n     \"movq %%rbx,%%rsi\\n\"\n     \"andq %%r15,%%rsi\\n\"\n-    \"pushq %%rsi\\n\"\n+    \"movq %%rsi,%4\\n\"\n     /* d >>= 52 */\n     \"shrdq $52,%%rcx,%%rbx\\n\"\n     \"xorq %%rcx,%%rcx\\n\"\n@@ -369,7 +373,7 @@ __asm__ __volatile__(\n     /* t4 &= (M >> 4) (stack) */\n     \"movq $0xffffffffffff,%%rax\\n\"\n     \"andq %%rax,%%rsi\\n\"\n-    \"pushq %%rsi\\n\"\n+    \"movq %%rsi,%5\\n\"\n     /* c = a0 * a0 */\n     \"movq %%r10,%%rax\\n\"\n     \"mulq %%r10\\n\"\n@@ -447,8 +451,8 @@ __asm__ __volatile__(\n     \"addq %%rax,%%r8\\n\"\n     \"adcq %%rdx,%%r9\\n\"\n     /* fetch t3 (%%r10, overwrites a0),t4 (%%rsi) */\n-    \"popq %%rsi\\n\"\n-    \"popq %%r10\\n\"\n+    \"movq %5,%%rsi\\n\"\n+    \"movq %4,%%r10\\n\"\n     /* c += a1 * a1 */\n     \"movq %%r11,%%rax\\n\"\n     \"mulq %%r11\\n\"\n@@ -492,9 +496,9 @@ __asm__ __volatile__(\n     /* r[4] = c */\n     \"movq %%r8,32(%%rdi)\\n\"\n \n-    \"popq %%rbp\\n\"\n+    \"movq %3,%%rbp\\n\"\n : \"+S\"(a)\n-: \"0\"(a), \"D\"(r)\n+: \"0\"(a), \"D\"(r), \"m\"(tmp1), \"m\"(tmp2), \"m\"(tmp3)\n : \"%rax\", \"%rbx\", \"%rcx\", \"%rdx\", \"%r8\", \"%r9\", \"%r10\", \"%r11\", \"%r12\", \"%r13\", \"%r14\", \"%r15\", \"cc\", \"memory\"\n );\n }"
      }
    ]
  }
]