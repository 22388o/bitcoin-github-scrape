[
  {
    "sha": "7e7cd83caac8d5ee5bf7f6c1dd2313432697883b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3ZTdjZDgzY2FhYzhkNWVlNWJmN2Y2YzFkZDIzMTM0MzI2OTc4ODNi",
    "commit": {
      "author": {
        "name": "practicalswift",
        "email": "practicalswift@users.noreply.github.com",
        "date": "2020-02-11T22:29:27Z"
      },
      "committer": {
        "name": "practicalswift",
        "email": "practicalswift@users.noreply.github.com",
        "date": "2020-02-12T11:57:55Z"
      },
      "message": "bitcoind init: Add locale sanity check making sure the global bitcoind C and C++ locales are set to the classic \"C\" locale (the minimal locale)",
      "tree": {
        "sha": "fb599de39a6053f44f9ebb4c7557f67b4827d66f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fb599de39a6053f44f9ebb4c7557f67b4827d66f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7e7cd83caac8d5ee5bf7f6c1dd2313432697883b",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7e7cd83caac8d5ee5bf7f6c1dd2313432697883b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/7e7cd83caac8d5ee5bf7f6c1dd2313432697883b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7e7cd83caac8d5ee5bf7f6c1dd2313432697883b/comments",
    "author": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "98264e2ccb177a6603fe957f7e263fb413b50d04",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/98264e2ccb177a6603fe957f7e263fb413b50d04",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/98264e2ccb177a6603fe957f7e263fb413b50d04"
      }
    ],
    "stats": {
      "total": 13,
      "additions": 13,
      "deletions": 0
    },
    "files": [
      {
        "sha": "5456d54dd6a8b618d574287be23a06b91682ebf6",
        "filename": "src/bitcoind.cpp",
        "status": "modified",
        "additions": 12,
        "deletions": 0,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7e7cd83caac8d5ee5bf7f6c1dd2313432697883b/src/bitcoind.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7e7cd83caac8d5ee5bf7f6c1dd2313432697883b/src/bitcoind.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoind.cpp?ref=7e7cd83caac8d5ee5bf7f6c1dd2313432697883b",
        "patch": "@@ -34,6 +34,13 @@ static void WaitForShutdown(NodeContext& node)\n     Interrupt(node);\n }\n \n+static bool LocaleSanityCheck() noexcept\n+{\n+    const std::locale current_cpp_locale;\n+    const std::string current_c_locale{setlocale(LC_ALL, nullptr)};\n+    return current_cpp_locale == std::locale::classic() && current_c_locale == \"C\";\n+}\n+\n //////////////////////////////////////////////////////////////////////////////\n //\n // Start\n@@ -117,6 +124,11 @@ static bool AppInit(int argc, char* argv[])\n             // InitError will have been called with detailed error, which ends up on console\n             return false;\n         }\n+        if (!LocaleSanityCheck())\n+        {\n+            InitError(\"Locale sanity check failure. Aborting.\");\n+            return false;\n+        }\n         if (gArgs.GetBoolArg(\"-daemon\", false))\n         {\n #if HAVE_DECL_DAEMON"
      },
      {
        "sha": "f2ce428b420a7342ea6132078563b7cffae26146",
        "filename": "test/lint/lint-locale-dependence.sh",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7e7cd83caac8d5ee5bf7f6c1dd2313432697883b/test/lint/lint-locale-dependence.sh",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7e7cd83caac8d5ee5bf7f6c1dd2313432697883b/test/lint/lint-locale-dependence.sh",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/lint/lint-locale-dependence.sh?ref=7e7cd83caac8d5ee5bf7f6c1dd2313432697883b",
        "patch": "@@ -8,6 +8,7 @@ KNOWN_VIOLATIONS=(\n     \"src/bitcoin-tx.cpp.*stoul\"\n     \"src/bitcoin-tx.cpp.*std::to_string\"\n     \"src/bitcoin-tx.cpp.*trim_right\"\n+    \"src/bitcoind.cpp.*setlocale\"\n     \"src/dbwrapper.cpp.*stoul\"\n     \"src/dbwrapper.cpp:.*vsnprintf\"\n     \"src/httprpc.cpp.*trim\""
      }
    ]
  },
  {
    "sha": "83ba9b251391b269f37b225e0d37fc19bc7e520e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4M2JhOWIyNTEzOTFiMjY5ZjM3YjIyNWUwZDM3ZmMxOWJjN2U1MjBl",
    "commit": {
      "author": {
        "name": "practicalswift",
        "email": "practicalswift@users.noreply.github.com",
        "date": "2020-02-12T11:48:49Z"
      },
      "committer": {
        "name": "practicalswift",
        "email": "practicalswift@users.noreply.github.com",
        "date": "2020-02-12T12:04:42Z"
      },
      "message": "bitcoin-qt init: Add locale sanity check to making sure the global bitcoin-qt C++ locale is set to the classic \"C\" locale (the minimal locale)",
      "tree": {
        "sha": "a19b91c531b458aa315503f80d91086900842c9c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a19b91c531b458aa315503f80d91086900842c9c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/83ba9b251391b269f37b225e0d37fc19bc7e520e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/83ba9b251391b269f37b225e0d37fc19bc7e520e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/83ba9b251391b269f37b225e0d37fc19bc7e520e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/83ba9b251391b269f37b225e0d37fc19bc7e520e/comments",
    "author": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "7e7cd83caac8d5ee5bf7f6c1dd2313432697883b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7e7cd83caac8d5ee5bf7f6c1dd2313432697883b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/7e7cd83caac8d5ee5bf7f6c1dd2313432697883b"
      }
    ],
    "stats": {
      "total": 15,
      "additions": 14,
      "deletions": 1
    },
    "files": [
      {
        "sha": "c4893619aca8f5e69c4b41c2c3a8a3cd0ed822de",
        "filename": "src/qt/bitcoin.cpp",
        "status": "modified",
        "additions": 14,
        "deletions": 1,
        "changes": 15,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/83ba9b251391b269f37b225e0d37fc19bc7e520e/src/qt/bitcoin.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/83ba9b251391b269f37b225e0d37fc19bc7e520e/src/qt/bitcoin.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoin.cpp?ref=83ba9b251391b269f37b225e0d37fc19bc7e520e",
        "patch": "@@ -246,9 +246,22 @@ void BitcoinApplication::createSplashScreen(const NetworkStyle *networkStyle)\n     connect(this, &BitcoinApplication::requestedShutdown, splash, &QWidget::close);\n }\n \n+static void GUILocaleSanityCheck() noexcept\n+{\n+    // In bitcoin-qt we assume that the global C++ locale (std::locale) is the\n+    // classic locale, but we do not make any assumptions about the C locale\n+    // (setlocale).\n+    const std::locale current_cpp_locale;\n+    if (current_cpp_locale != std::locale::classic()) {\n+        std::abort();\n+    }\n+}\n+\n bool BitcoinApplication::baseInitialize()\n {\n-    return m_node.baseInitialize();\n+    const bool initialized = m_node.baseInitialize();\n+    GUILocaleSanityCheck();\n+    return initialized;\n }\n \n void BitcoinApplication::startThread()"
      }
    ]
  },
  {
    "sha": "e489fb9e5f526c4a6a3cda55a2c7673bead97eb7",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplNDg5ZmI5ZTVmNTI2YzRhNmEzY2RhNTVhMmM3NjczYmVhZDk3ZWI3",
    "commit": {
      "author": {
        "name": "practicalswift",
        "email": "practicalswift@users.noreply.github.com",
        "date": "2020-02-11T21:27:05Z"
      },
      "committer": {
        "name": "practicalswift",
        "email": "practicalswift@users.noreply.github.com",
        "date": "2020-02-12T12:04:42Z"
      },
      "message": "doc: Clarify locale assumptions",
      "tree": {
        "sha": "94705f08ab54de4596875e4200d5bbaf8f0c0858",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/94705f08ab54de4596875e4200d5bbaf8f0c0858"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e489fb9e5f526c4a6a3cda55a2c7673bead97eb7",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e489fb9e5f526c4a6a3cda55a2c7673bead97eb7",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e489fb9e5f526c4a6a3cda55a2c7673bead97eb7",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e489fb9e5f526c4a6a3cda55a2c7673bead97eb7/comments",
    "author": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "83ba9b251391b269f37b225e0d37fc19bc7e520e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/83ba9b251391b269f37b225e0d37fc19bc7e520e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/83ba9b251391b269f37b225e0d37fc19bc7e520e"
      }
    ],
    "stats": {
      "total": 8,
      "additions": 7,
      "deletions": 1
    },
    "files": [
      {
        "sha": "7b825dcd8643635b4c5ebd0cdcdcc7900a665db0",
        "filename": "src/compat/assumptions.h",
        "status": "modified",
        "additions": 7,
        "deletions": 1,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e489fb9e5f526c4a6a3cda55a2c7673bead97eb7/src/compat/assumptions.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e489fb9e5f526c4a6a3cda55a2c7673bead97eb7/src/compat/assumptions.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/compat/assumptions.h?ref=e489fb9e5f526c4a6a3cda55a2c7673bead97eb7",
        "patch": "@@ -59,7 +59,13 @@ static_assert(sizeof(size_t) == sizeof(void*), \"Sizes of size_t and void* assume\n \n // Some important things we are NOT assuming (non-exhaustive list):\n // * We are NOT assuming a specific value for std::endian::native.\n-// * We are NOT assuming a specific value for std::locale(\"\").name().\n+// * In bitcoin-qt we are NOT assuming a specific C locale (setlocale), but we\n+//   do assume that the global C++ locale (std::locale) is set to the classic\n+//   locale. This is verified at run-time by GUILocaleSanityCheck().\n+//\n+//   In bitcoind we assume that BOTH the C locale and C++ locale are set to the\n+//   classic locale. This is verified at run-time by LocaleSanityCheck().\n // * We are NOT assuming a specific value for std::numeric_limits<char>::is_signed.\n \n+\n #endif // BITCOIN_COMPAT_ASSUMPTIONS_H"
      }
    ]
  }
]