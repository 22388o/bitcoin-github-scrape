[
  {
    "sha": "af9103eb75182f51a987e7c35fa3eae61c58d010",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphZjkxMDNlYjc1MTgyZjUxYTk4N2U3YzM1ZmEzZWFlNjFjNThkMDEw",
    "commit": {
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@gmail.com",
        "date": "2017-11-16T04:26:02Z"
      },
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@gmail.com",
        "date": "2017-11-16T19:49:19Z"
      },
      "message": "[build] Add a script for installing db4\n\nInstead of maintaining not-easily-tested instructions for building BerkeleyDB\nin doc/build-unix.md, package the installation as a script in contrib/. This\nallows shared usage from a number of contexts, e.g. Docker.\n\nThanks to @jonasschnelli, @laanwj for feedback.",
      "tree": {
        "sha": "40fb61193f97221548bcff4de0121772583aa614",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/40fb61193f97221548bcff4de0121772583aa614"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/af9103eb75182f51a987e7c35fa3eae61c58d010",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/af9103eb75182f51a987e7c35fa3eae61c58d010",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/af9103eb75182f51a987e7c35fa3eae61c58d010",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/af9103eb75182f51a987e7c35fa3eae61c58d010/comments",
    "author": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "54aedc013744c86b11157423fa3cffc9a51eef02",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/54aedc013744c86b11157423fa3cffc9a51eef02",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/54aedc013744c86b11157423fa3cffc9a51eef02"
      }
    ],
    "stats": {
      "total": 146,
      "additions": 103,
      "deletions": 43
    },
    "files": [
      {
        "sha": "9b791cc0e80ce29c64bc11d21fb32a89c337488d",
        "filename": "Makefile.am",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/af9103eb75182f51a987e7c35fa3eae61c58d010/Makefile.am",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/af9103eb75182f51a987e7c35fa3eae61c58d010/Makefile.am",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/Makefile.am?ref=af9103eb75182f51a987e7c35fa3eae61c58d010",
        "patch": "@@ -42,6 +42,7 @@ DIST_CONTRIB = $(top_srcdir)/contrib/bitcoin-cli.bash-completion \\\n \t       $(top_srcdir)/contrib/bitcoin-tx.bash-completion \\\n \t       $(top_srcdir)/contrib/bitcoind.bash-completion \\\n \t       $(top_srcdir)/contrib/init \\\n+\t       $(top_srcdir)/contrib/install_db4.sh \\\n \t       $(top_srcdir)/contrib/rpm\n DIST_SHARE = \\\n   $(top_srcdir)/share/genbuild.sh \\"
      },
      {
        "sha": "1d33e8d3baf181dcfbe6b0f393eee5bf3d8bb3d8",
        "filename": "contrib/install_db4.sh",
        "status": "added",
        "additions": 87,
        "deletions": 0,
        "changes": 87,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/af9103eb75182f51a987e7c35fa3eae61c58d010/contrib/install_db4.sh",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/af9103eb75182f51a987e7c35fa3eae61c58d010/contrib/install_db4.sh",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/install_db4.sh?ref=af9103eb75182f51a987e7c35fa3eae61c58d010",
        "patch": "@@ -0,0 +1,87 @@\n+#!/bin/sh\n+\n+# Install libdb4.8 (Berkeley DB).\n+\n+set -e\n+\n+if [ -z \"${1}\" ]; then\n+  echo \"Usage: ./install_db4.sh <base-dir> [<extra-bdb-configure-flag> ...]\"\n+  echo\n+  echo \"Must specify a single argument: the directory in which db5 will be built.\"\n+  echo \"This is probably \\`pwd\\` if you're at the root of the bitcoin repository.\"\n+  exit 1\n+fi\n+\n+expand_path() {\n+  echo \"$(cd \"${1}\" && pwd -P)\"\n+}\n+\n+BDB_PREFIX=\"$(expand_path ${1})/db4\"; shift;\n+BDB_EXTRA_CONFIGURE_FLAGS=\"${@}\"\n+BDB_VERSION='db-4.8.30.NC'\n+BDB_HASH='12edc0df75bf9abd7f82f821795bcee50f42cb2e5f76a6a281b85732798364ef'\n+BDB_URL=\"https://download.oracle.com/berkeley-db/${BDB_VERSION}.tar.gz\"\n+\n+check_exists() {\n+  which \"$1\" >/dev/null 2>&1\n+}\n+\n+sha256_check() {\n+  # Args: <sha256_hash> <filename>\n+  #\n+  if check_exists sha256sum; then\n+    echo \"${1}  ${2}\" | sha256sum -c\n+  elif check_exists sha256; then\n+    echo \"${1}  ${2}\" | sha256 -c\n+  else\n+    echo \"${1}  ${2}\" | shasum -a 256 -c\n+  fi\n+}\n+\n+http_get() {\n+  # Args: <url> <filename> <sha256_hash>\n+  #\n+  # It's acceptable that we don't require SSL here because we manually verify\n+  # content hashes below.\n+  #\n+  if [ -f \"${2}\" ]; then\n+    echo \"File ${2} already exists; not downloading again\"\n+  elif check_exists curl; then\n+    curl --insecure \"${1}\" -o \"${2}\"\n+  else\n+    wget --no-check-certificate \"${1}\" -O \"${2}\"\n+  fi\n+\n+  sha256_check \"${3}\" \"${2}\"\n+}\n+\n+mkdir -p \"${BDB_PREFIX}\"\n+http_get \"${BDB_URL}\" \"${BDB_VERSION}.tar.gz\" \"${BDB_HASH}\"\n+tar -xzvf ${BDB_VERSION}.tar.gz -C \"$BDB_PREFIX\"\n+cd \"${BDB_PREFIX}/${BDB_VERSION}/\"\n+\n+# Apply a patch when building on OS X to make the build work with Xcode.\n+#\n+if [ \"$(uname)\" = \"Darwin\" ]; then\n+  BDB_OSX_ATOMIC_PATCH_URL='https://raw.githubusercontent.com/narkoleptik/os-x-berkeleydb-patch/0007e2846ae3fc9757849f5277018f4179ad17ef/atomic.patch'\n+  BDB_OSX_ATOMIC_PATCH_HASH='ba0e2b4f53e9cb0ec58f60a979b53b8567b4565f0384886196f1fc1ef111d151'\n+\n+  http_get \"${BDB_OSX_ATOMIC_PATCH_URL}\" atomic.patch \"${BDB_OSX_ATOMIC_PATCH_HASH}\"\n+  patch -p1 < atomic.patch\n+fi\n+\n+cd build_unix/\n+\n+\"${BDB_PREFIX}/${BDB_VERSION}/dist/configure\" \\\n+  --enable-cxx --disable-shared --with-pic --prefix=\"${BDB_PREFIX}\" \\\n+  \"${BDB_EXTRA_CONFIGURE_FLAGS}\"\n+\n+make install\n+\n+echo\n+echo \"db4 build complete.\"\n+echo\n+echo 'When compiling bitcoind, run `./configure` in the following way:'\n+echo\n+echo \"  export BDB_PREFIX='${BDB_PREFIX}'\"\n+echo '  ./configure LDFLAGS=\"-L${BDB_PREFIX}/lib/\" CPPFLAGS=\"-I${BDB_PREFIX}/include/\" ...'"
      },
      {
        "sha": "cd1d217b47a79148c571826eb74ac26296d796b2",
        "filename": "doc/build-openbsd.md",
        "status": "modified",
        "additions": 8,
        "deletions": 19,
        "changes": 27,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/af9103eb75182f51a987e7c35fa3eae61c58d010/doc/build-openbsd.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/af9103eb75182f51a987e7c35fa3eae61c58d010/doc/build-openbsd.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/build-openbsd.md?ref=af9103eb75182f51a987e7c35fa3eae61c58d010",
        "patch": "@@ -38,28 +38,17 @@ The default C++ compiler that comes with OpenBSD 6.2 is g++ 4.2.1. This version\n \n BerkeleyDB is only necessary for the wallet functionality. To skip this, pass `--disable-wallet` to `./configure`.\n \n-See \"Berkeley DB\" in [build-unix.md](build-unix.md#berkeley-db) for instructions on how to build BerkeleyDB 4.8.\n-You cannot use the BerkeleyDB library from ports, for the same reason as boost above (g++/libstd++ incompatibility).\n+It is recommended to use Berkeley DB 4.8. You cannot use the BerkeleyDB library\n+from ports, for the same reason as boost above (g++/libstd++ incompatibility).\n+If you have to build it yourself, you can use [the installation script included\n+in contrib/](contrib/install_db4.sh) like so\n \n-```bash\n-# Pick some path to install BDB to, here we create a directory within the bitcoin directory\n-BITCOIN_ROOT=$(pwd)\n-BDB_PREFIX=\"${BITCOIN_ROOT}/db4\"\n-mkdir -p $BDB_PREFIX\n-\n-# Fetch the source and verify that it is not tampered with\n-curl -o db-4.8.30.NC.tar.gz 'http://download.oracle.com/berkeley-db/db-4.8.30.NC.tar.gz'\n-echo '12edc0df75bf9abd7f82f821795bcee50f42cb2e5f76a6a281b85732798364ef  db-4.8.30.NC.tar.gz' | sha256 -c\n-# MUST output: (SHA256) db-4.8.30.NC.tar.gz: OK\n-tar -xzf db-4.8.30.NC.tar.gz\n-\n-# Build the library and install to specified prefix\n-cd db-4.8.30.NC/build_unix/\n-#  Note: Do a static build so that it can be embedded into the executable, instead of having to find a .so at runtime\n-../dist/configure --enable-cxx --disable-shared --with-pic --prefix=$BDB_PREFIX CC=egcc CXX=eg++ CPP=ecpp\n-make install # do NOT use -jX, this is broken\n+```shell\n+./contrib/install_db4.sh `pwd` CC=egcc CXX=eg++ CPP=ecpp\n ```\n \n+from the root of the repository.\n+\n ### Resource limits\n \n The standard ulimit restrictions in OpenBSD are very strict:"
      },
      {
        "sha": "5d3329e2cfe89395546f65edd267acd1c7431a83",
        "filename": "doc/build-unix.md",
        "status": "modified",
        "additions": 7,
        "deletions": 24,
        "changes": 31,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/af9103eb75182f51a987e7c35fa3eae61c58d010/doc/build-unix.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/af9103eb75182f51a987e7c35fa3eae61c58d010/doc/build-unix.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/build-unix.md?ref=af9103eb75182f51a987e7c35fa3eae61c58d010",
        "patch": "@@ -165,33 +165,16 @@ turned off by default.  See the configure options for upnp behavior desired:\n \n Berkeley DB\n -----------\n-It is recommended to use Berkeley DB 4.8. If you have to build it yourself:\n+It is recommended to use Berkeley DB 4.8. If you have to build it yourself,\n+you can use [the installation script included in contrib/](contrib/install_db4.sh)\n+like so\n \n-```bash\n-BITCOIN_ROOT=$(pwd)\n-\n-# Pick some path to install BDB to, here we create a directory within the bitcoin directory\n-BDB_PREFIX=\"${BITCOIN_ROOT}/db4\"\n-mkdir -p $BDB_PREFIX\n-\n-# Fetch the source and verify that it is not tampered with\n-wget 'http://download.oracle.com/berkeley-db/db-4.8.30.NC.tar.gz'\n-echo '12edc0df75bf9abd7f82f821795bcee50f42cb2e5f76a6a281b85732798364ef  db-4.8.30.NC.tar.gz' | sha256sum -c\n-# -> db-4.8.30.NC.tar.gz: OK\n-tar -xzvf db-4.8.30.NC.tar.gz\n-\n-# Build the library and install to our prefix\n-cd db-4.8.30.NC/build_unix/\n-#  Note: Do a static build so that it can be embedded into the executable, instead of having to find a .so at runtime\n-../dist/configure --enable-cxx --disable-shared --with-pic --prefix=$BDB_PREFIX\n-make install\n-\n-# Configure Bitcoin Core to use our own-built instance of BDB\n-cd $BITCOIN_ROOT\n-./autogen.sh\n-./configure LDFLAGS=\"-L${BDB_PREFIX}/lib/\" CPPFLAGS=\"-I${BDB_PREFIX}/include/\" # (other args...)\n+```shell\n+./contrib/install_db4.sh `pwd`\n ```\n \n+from the root of the repository.\n+\n **Note**: You only need Berkeley DB if the wallet is enabled (see the section *Disable-Wallet mode* below).\n \n Boost"
      }
    ]
  },
  {
    "sha": "6e4cdd67b1f2b3927a525ebba843c27ef3c63e1c",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2ZTRjZGQ2N2IxZjJiMzkyN2E1MjVlYmJhODQzYzI3ZWYzYzYzZTFj",
    "commit": {
      "author": {
        "name": "James O'Beirne",
        "email": "james.obeirne@gmail.com",
        "date": "2017-11-16T07:36:08Z"
      },
      "committer": {
        "name": "James O'Beirne",
        "email": "james.obeirne@gmail.com",
        "date": "2017-11-16T19:49:34Z"
      },
      "message": "[docs] Add reference to install_db4.sh in OS X build instructions",
      "tree": {
        "sha": "63b0c5c4b76eb0d3a426f214e8092dacdc125f91",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/63b0c5c4b76eb0d3a426f214e8092dacdc125f91"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/6e4cdd67b1f2b3927a525ebba843c27ef3c63e1c",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6e4cdd67b1f2b3927a525ebba843c27ef3c63e1c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/6e4cdd67b1f2b3927a525ebba843c27ef3c63e1c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6e4cdd67b1f2b3927a525ebba843c27ef3c63e1c/comments",
    "author": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jamesob",
      "id": 73197,
      "node_id": "MDQ6VXNlcjczMTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/73197?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesob",
      "html_url": "https://github.com/jamesob",
      "followers_url": "https://api.github.com/users/jamesob/followers",
      "following_url": "https://api.github.com/users/jamesob/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesob/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesob/orgs",
      "repos_url": "https://api.github.com/users/jamesob/repos",
      "events_url": "https://api.github.com/users/jamesob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesob/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "af9103eb75182f51a987e7c35fa3eae61c58d010",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/af9103eb75182f51a987e7c35fa3eae61c58d010",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/af9103eb75182f51a987e7c35fa3eae61c58d010"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 14,
      "deletions": 0
    },
    "files": [
      {
        "sha": "6f08562ff8f5f5ef694c043567ec60cf41e849b9",
        "filename": "doc/build-osx.md",
        "status": "modified",
        "additions": 14,
        "deletions": 0,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/6e4cdd67b1f2b3927a525ebba843c27ef3c63e1c/doc/build-osx.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/6e4cdd67b1f2b3927a525ebba843c27ef3c63e1c/doc/build-osx.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/build-osx.md?ref=6e4cdd67b1f2b3927a525ebba843c27ef3c63e1c",
        "patch": "@@ -26,6 +26,20 @@ If you want to build the disk image with `make deploy` (.dmg / optional), you ne\n \n NOTE: Building with Qt4 is still supported, however, could result in a broken UI. Building with Qt5 is recommended.\n \n+Berkeley DB\n+-----------\n+It is recommended to use Berkeley DB 4.8. If you have to build it yourself,\n+you can use [the installation script included in contrib/](contrib/install_db4.sh)\n+like so\n+\n+```shell\n+./contrib/install_db4.sh .\n+```\n+\n+from the root of the repository.\n+\n+**Note**: You only need Berkeley DB if the wallet is enabled (see the section *Disable-Wallet mode* below).\n+\n Build Bitcoin Core\n ------------------------\n "
      }
    ]
  }
]