[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/846344191",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#issuecomment-846344191",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22019",
    "id": 846344191,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NjM0NDE5MQ==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-22T03:49:39Z",
    "updated_at": "2021-12-01T06:12:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23534](https://github.com/bitcoin/bitcoin/pull/23534) (wallet: Allow negtive effective value inputs when subtracting fee from outputs by achow101)\n* [#23497](https://github.com/bitcoin/bitcoin/pull/23497) (Add `src/node/` and `src/wallet/` code to `node::` and `wallet::` namespaces by ryanofsky)\n* [#23475](https://github.com/bitcoin/bitcoin/pull/23475) (wallet: add config to prioritize a solution that doesn't create change in coin selection by brunoerg)\n* [#23367](https://github.com/bitcoin/bitcoin/pull/23367) (Optimize coin selection by dropping BnB upper limit by S3RK)\n* [#23202](https://github.com/bitcoin/bitcoin/pull/23202) (wallet: allow psbtbumpfee to work with txs with external inputs by achow101)\n* [#23201](https://github.com/bitcoin/bitcoin/pull/23201) (wallet: Allow users to specify input weights when funding a transaction by achow101)\n* [#13226](https://github.com/bitcoin/bitcoin/pull/13226) (Optimize SelectCoinsBnB by tracking the selection by index rather than by position by Empact)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/846344191/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/915297129",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#issuecomment-915297129",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22019",
    "id": 915297129,
    "node_id": "IC_kwDOABII5842jlNp",
    "user": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-08T14:38:13Z",
    "updated_at": "2021-09-08T14:38:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "Concept ACK",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/915297129/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/929692924",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#issuecomment-929692924",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22019",
    "id": 929692924,
    "node_id": "IC_kwDOABII5843afz8",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-28T23:18:56Z",
    "updated_at": "2021-09-28T23:18:56Z",
    "author_association": "MEMBER",
    "body": "Rebased. I've also made some additional changes. Notably, instead of using `SelectionResult` as an out parameter, all of the coin selection functions will return an `std::optional<SelectionResult>` instead.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/929692924/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/937544686",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#issuecomment-937544686",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22019",
    "id": 937544686,
    "node_id": "IC_kwDOABII58434cvu",
    "user": {
      "login": "S3RK",
      "id": 1466284,
      "node_id": "MDQ6VXNlcjE0NjYyODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/S3RK",
      "html_url": "https://github.com/S3RK",
      "followers_url": "https://api.github.com/users/S3RK/followers",
      "following_url": "https://api.github.com/users/S3RK/following{/other_user}",
      "gists_url": "https://api.github.com/users/S3RK/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
      "organizations_url": "https://api.github.com/users/S3RK/orgs",
      "repos_url": "https://api.github.com/users/S3RK/repos",
      "events_url": "https://api.github.com/users/S3RK/events{/privacy}",
      "received_events_url": "https://api.github.com/users/S3RK/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-07T07:53:58Z",
    "updated_at": "2021-10-07T07:53:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "Concept ACK, going to review the code",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/937544686/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/942238913",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#issuecomment-942238913",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22019",
    "id": 942238913,
    "node_id": "IC_kwDOABII5844KWzB",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?u=a1574ca2038ff1dfaa9a7764c59ea5ff4f305b5d&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-13T12:12:22Z",
    "updated_at": "2021-10-13T12:36:02Z",
    "author_association": "MEMBER",
    "body": "Concept ACK.\r\n\r\nWas troubled by the largely unused `cost_of_change` attr, and looked to narrow its scope. I think I've come up with some useful additions here: https://github.com/achow101/bitcoin/compare/selectionresult...Empact:selectionresult\r\n\r\n* test: Drop unused knapsack_result var\r\n* refactor: Move cost_of_change param from SelectionResult to #GetWaste\r\n* refactor: Calculate waste once for each result, rather than once for comparison\r\n* refactor: Move SelectionResult#Equivalent/EqualResult to test",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/942238913/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/942552328",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#issuecomment-942552328",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/22019",
    "id": 942552328,
    "node_id": "IC_kwDOABII5844LjUI",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?u=9791e96cd4268d48e3517bac41eaf2b1d09759fd&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-13T17:29:52Z",
    "updated_at": "2021-10-13T17:29:52Z",
    "author_association": "MEMBER",
    "body": "I've pulled in all of the suggested changes.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/942552328/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702143396",
    "pull_request_review_id": 746445559,
    "id": 702143396,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjE0MzM5Ng==",
    "diff_hunk": "@@ -178,15 +197,15 @@ BOOST_AUTO_TEST_CASE(bnb_search_test)\n     // Select 1 Cent\n     add_coin(1 * CENT, 1, actual_selection);\n     BOOST_CHECK(SelectCoinsBnB(GroupCoins(utxo_pool), 1 * CENT, 0.5 * CENT, selection, value_ret));\n-    BOOST_CHECK(equal_sets(selection, actual_selection));\n+    BOOST_CHECK(equivalent_sets(selection, actual_selection));",
    "path": "src/wallet/test/coinselector_tests.cpp",
    "position": null,
    "original_position": 61,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "bf455047a0cc4ed9d968b92884f1f77f8e60eada",
    "user": {
      "login": "Xekyo",
      "id": 4060799,
      "node_id": "MDQ6VXNlcjQwNjA3OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Xekyo",
      "html_url": "https://github.com/Xekyo",
      "followers_url": "https://api.github.com/users/Xekyo/followers",
      "following_url": "https://api.github.com/users/Xekyo/following{/other_user}",
      "gists_url": "https://api.github.com/users/Xekyo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
      "organizations_url": "https://api.github.com/users/Xekyo/orgs",
      "repos_url": "https://api.github.com/users/Xekyo/repos",
      "events_url": "https://api.github.com/users/Xekyo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Xekyo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Commit 80402a13e52671aa7359e3b87d85098805926a63: This may be more a comment on the commit message, but shouldn't the result of BnB be deterministic? Are the OutputGroups unsorted, or how is this happening?",
    "created_at": "2021-09-03T20:22:38Z",
    "updated_at": "2021-09-03T21:43:38Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702143396",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702143396"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702143396"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702143396/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 200,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702158462",
    "pull_request_review_id": 746445559,
    "id": 702158462,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjE1ODQ2Mg==",
    "diff_hunk": "@@ -193,6 +193,17 @@ struct SelectionResult\n      *  hit a specific target.\n      */\n     CAmount input_fees{0};\n+    /** Whether the input values for calculations should be the the effective value (true) or normal value (false) */",
    "path": "src/wallet/coinselection.h",
    "position": null,
    "original_position": 4,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "187a9d92854e99104e17b551bb39a4072a5d09fe",
    "user": {
      "login": "Xekyo",
      "id": 4060799,
      "node_id": "MDQ6VXNlcjQwNjA3OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Xekyo",
      "html_url": "https://github.com/Xekyo",
      "followers_url": "https://api.github.com/users/Xekyo/followers",
      "following_url": "https://api.github.com/users/Xekyo/following{/other_user}",
      "gists_url": "https://api.github.com/users/Xekyo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
      "organizations_url": "https://api.github.com/users/Xekyo/orgs",
      "repos_url": "https://api.github.com/users/Xekyo/repos",
      "events_url": "https://api.github.com/users/Xekyo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Xekyo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n    /** Whether the input values for calculations should be the effective value (true) or normal value (false) */\r\n```",
    "created_at": "2021-09-03T21:00:23Z",
    "updated_at": "2021-09-03T21:43:39Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702158462",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702158462"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702158462"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702158462/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 198,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702160046",
    "pull_request_review_id": 746445559,
    "id": 702160046,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjE2MDA0Ng==",
    "diff_hunk": "@@ -193,6 +193,17 @@ struct SelectionResult\n      *  hit a specific target.\n      */\n     CAmount input_fees{0};\n+    /** Whether the input values for calculations should be the the effective value (true) or normal value (false) */\n+    bool m_use_effective{true};\n+    /** The algorithm used supports making change outputs. */\n+    bool m_make_change{false};\n+    /** The cost of making a change output and spending it in the future. Since this is largely a static parameter independent of the selection, it is not cleared by Clear() */",
    "path": "src/wallet/coinselection.h",
    "position": null,
    "original_position": 8,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "187a9d92854e99104e17b551bb39a4072a5d09fe",
    "user": {
      "login": "Xekyo",
      "id": 4060799,
      "node_id": "MDQ6VXNlcjQwNjA3OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Xekyo",
      "html_url": "https://github.com/Xekyo",
      "followers_url": "https://api.github.com/users/Xekyo/followers",
      "following_url": "https://api.github.com/users/Xekyo/following{/other_user}",
      "gists_url": "https://api.github.com/users/Xekyo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
      "organizations_url": "https://api.github.com/users/Xekyo/orgs",
      "repos_url": "https://api.github.com/users/Xekyo/repos",
      "events_url": "https://api.github.com/users/Xekyo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Xekyo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "What do you mean with \"independent of the selection\"? Do you mean that it's the same across different algorithms, independent of the inputs that get picked, or smth else? It's definitely dependent on the selection parameters, especially the feerate.",
    "created_at": "2021-09-03T21:05:04Z",
    "updated_at": "2021-09-03T21:43:39Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702160046",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702160046"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702160046"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702160046/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 202,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702160682",
    "pull_request_review_id": 746445559,
    "id": 702160682,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjE2MDY4Mg==",
    "diff_hunk": "@@ -177,7 +177,7 @@ BOOST_AUTO_TEST_CASE(bnb_search_test)\n     // Setup\n     std::vector<CInputCoin> utxo_pool;\n     CoinSet selection;\n-    CoinSet actual_selection;\n+    SelectionResult expected_result;",
    "path": "src/wallet/test/coinselector_tests.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "405e7801105bce4396732017d5910d7b223388c7",
    "user": {
      "login": "Xekyo",
      "id": 4060799,
      "node_id": "MDQ6VXNlcjQwNjA3OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Xekyo",
      "html_url": "https://github.com/Xekyo",
      "followers_url": "https://api.github.com/users/Xekyo/followers",
      "following_url": "https://api.github.com/users/Xekyo/following{/other_user}",
      "gists_url": "https://api.github.com/users/Xekyo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
      "organizations_url": "https://api.github.com/users/Xekyo/orgs",
      "repos_url": "https://api.github.com/users/Xekyo/repos",
      "events_url": "https://api.github.com/users/Xekyo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Xekyo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Could 75672596d018f857013599b94f65efaf6446a825 perhaps be a scripted diff?",
    "created_at": "2021-09-03T21:06:59Z",
    "updated_at": "2021-09-03T21:43:39Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702160682",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702160682"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702160682"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702160682/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 157,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702168017",
    "pull_request_review_id": 746445559,
    "id": 702168017,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjE2ODAxNw==",
    "diff_hunk": "@@ -357,17 +357,15 @@ std::vector<OutputGroup> GroupOutputs(const CWallet& wallet, const std::vector<C\n     return groups_out;\n }\n \n-bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n-                                 std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CoinSelectionParams& coin_selection_params)\n+bool AttemptSelection(const CWallet& walletconst CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,",
    "path": "src/wallet/spend.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "b6ef0e496a5d91d4cbd8d6e7ff9dbb6935b9a172",
    "user": {
      "login": "Xekyo",
      "id": 4060799,
      "node_id": "MDQ6VXNlcjQwNjA3OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Xekyo",
      "html_url": "https://github.com/Xekyo",
      "followers_url": "https://api.github.com/users/Xekyo/followers",
      "following_url": "https://api.github.com/users/Xekyo/following{/other_user}",
      "gists_url": "https://api.github.com/users/Xekyo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
      "organizations_url": "https://api.github.com/users/Xekyo/orgs",
      "repos_url": "https://api.github.com/users/Xekyo/repos",
      "events_url": "https://api.github.com/users/Xekyo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Xekyo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This looks perhaps like an accidental edit\r\n```suggestion\r\nbool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\r\n```",
    "created_at": "2021-09-03T21:28:39Z",
    "updated_at": "2021-09-03T21:43:39Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702168017",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702168017"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702168017"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702168017/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 360,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702169072",
    "pull_request_review_id": 746445559,
    "id": 702169072,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjE2OTA3Mg==",
    "diff_hunk": "@@ -394,29 +394,32 @@ bool AttemptSelection(const CWallet& walletconst CAmount& nTargetValue, const Co\n     return true;\n }\n \n-bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params)\n+bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params, SelectionResult& result)\n {\n-    SelectionResult result;\n+    result.Clear();\n+\n     std::vector<COutput> vCoins(vAvailableCoins);\n     CAmount value_to_select = nTargetValue;\n \n+    OutputGroup preset_inputs(coin_selection_params);\n+\n     // coin control -> return all selected outputs (we want all selected to go into the transaction for sure)\n     if (coin_control.HasSelected() && !coin_control.fAllowOtherInputs)\n     {\n-        for (const COutput& out : vCoins)\n-        {\n-            if (!out.fSpendable)\n-                 continue;\n-            nValueRet += out.tx->tx->vout[out.i].nValue;\n-            setCoinsRet.insert(out.GetInputCoin());\n+        for (const COutput& out : vCoins) {\n+            if (!out.fSpendable) continue;\n+            /* Set depth, from_me, ancestors, and descendants to 0 or false as don't matter for preset inputs as no actual selection is being done.",
    "path": "src/wallet/spend.cpp",
    "position": null,
    "original_position": 26,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "10492b60ad8f439b29a200b9fa3acce7cdce8f6d",
    "user": {
      "login": "Xekyo",
      "id": 4060799,
      "node_id": "MDQ6VXNlcjQwNjA3OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4060799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Xekyo",
      "html_url": "https://github.com/Xekyo",
      "followers_url": "https://api.github.com/users/Xekyo/followers",
      "following_url": "https://api.github.com/users/Xekyo/following{/other_user}",
      "gists_url": "https://api.github.com/users/Xekyo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Xekyo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Xekyo/subscriptions",
      "organizations_url": "https://api.github.com/users/Xekyo/orgs",
      "repos_url": "https://api.github.com/users/Xekyo/repos",
      "events_url": "https://api.github.com/users/Xekyo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Xekyo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "\"as don't matter\" seems to be missing a word",
    "created_at": "2021-09-03T21:31:48Z",
    "updated_at": "2021-09-03T21:43:39Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702169072",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702169072"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702169072"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702169072/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 411,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702180754",
    "pull_request_review_id": 746492501,
    "id": 702180754,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjE4MDc1NA==",
    "diff_hunk": "@@ -178,15 +197,15 @@ BOOST_AUTO_TEST_CASE(bnb_search_test)\n     // Select 1 Cent\n     add_coin(1 * CENT, 1, actual_selection);\n     BOOST_CHECK(SelectCoinsBnB(GroupCoins(utxo_pool), 1 * CENT, 0.5 * CENT, selection, value_ret));\n-    BOOST_CHECK(equal_sets(selection, actual_selection));\n+    BOOST_CHECK(equivalent_sets(selection, actual_selection));",
    "path": "src/wallet/test/coinselector_tests.cpp",
    "position": null,
    "original_position": 61,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "bf455047a0cc4ed9d968b92884f1f77f8e60eada",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't remember the specifics, but I think it had to with different txids being in `utxo_pool` and `actual_selection`",
    "created_at": "2021-09-03T22:12:32Z",
    "updated_at": "2021-09-03T22:12:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702180754",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702180754"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702180754"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702180754/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 200,
    "side": "RIGHT",
    "in_reply_to_id": 702143396
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702181824",
    "pull_request_review_id": 746493751,
    "id": 702181824,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjE4MTgyNA==",
    "diff_hunk": "@@ -193,6 +193,17 @@ struct SelectionResult\n      *  hit a specific target.\n      */\n     CAmount input_fees{0};\n+    /** Whether the input values for calculations should be the the effective value (true) or normal value (false) */\n+    bool m_use_effective{true};\n+    /** The algorithm used supports making change outputs. */\n+    bool m_make_change{false};\n+    /** The cost of making a change output and spending it in the future. Since this is largely a static parameter independent of the selection, it is not cleared by Clear() */",
    "path": "src/wallet/coinselection.h",
    "position": null,
    "original_position": 8,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "187a9d92854e99104e17b551bb39a4072a5d09fe",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Independent of the algorithm.",
    "created_at": "2021-09-03T22:16:36Z",
    "updated_at": "2021-09-03T22:16:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702181824",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702181824"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702181824"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702181824/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 202,
    "side": "RIGHT",
    "in_reply_to_id": 702160046
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208825",
    "pull_request_review_id": 746523146,
    "id": 702208825,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjIwODgyNQ==",
    "diff_hunk": "@@ -193,6 +193,17 @@ struct SelectionResult\n      *  hit a specific target.\n      */\n     CAmount input_fees{0};\n+    /** Whether the input values for calculations should be the the effective value (true) or normal value (false) */",
    "path": "src/wallet/coinselection.h",
    "position": null,
    "original_position": 4,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "187a9d92854e99104e17b551bb39a4072a5d09fe",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed",
    "created_at": "2021-09-04T00:34:33Z",
    "updated_at": "2021-09-04T00:34:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208825",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208825"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208825"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208825/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 198,
    "side": "RIGHT",
    "in_reply_to_id": 702158462
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208834",
    "pull_request_review_id": 746523157,
    "id": 702208834,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjIwODgzNA==",
    "diff_hunk": "@@ -193,6 +193,17 @@ struct SelectionResult\n      *  hit a specific target.\n      */\n     CAmount input_fees{0};\n+    /** Whether the input values for calculations should be the the effective value (true) or normal value (false) */\n+    bool m_use_effective{true};\n+    /** The algorithm used supports making change outputs. */\n+    bool m_make_change{false};\n+    /** The cost of making a change output and spending it in the future. Since this is largely a static parameter independent of the selection, it is not cleared by Clear() */",
    "path": "src/wallet/coinselection.h",
    "position": null,
    "original_position": 8,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "187a9d92854e99104e17b551bb39a4072a5d09fe",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Clarified the comment.",
    "created_at": "2021-09-04T00:34:40Z",
    "updated_at": "2021-09-04T00:34:40Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208834",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208834"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208834"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208834/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 202,
    "side": "RIGHT",
    "in_reply_to_id": 702160046
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208838",
    "pull_request_review_id": 746523164,
    "id": 702208838,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjIwODgzOA==",
    "diff_hunk": "@@ -177,7 +177,7 @@ BOOST_AUTO_TEST_CASE(bnb_search_test)\n     // Setup\n     std::vector<CInputCoin> utxo_pool;\n     CoinSet selection;\n-    CoinSet actual_selection;\n+    SelectionResult expected_result;",
    "path": "src/wallet/test/coinselector_tests.cpp",
    "position": null,
    "original_position": 5,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "405e7801105bce4396732017d5910d7b223388c7",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2021-09-04T00:34:44Z",
    "updated_at": "2021-09-04T00:34:44Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208838",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208838"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208838"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208838/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 157,
    "side": "RIGHT",
    "in_reply_to_id": 702160682
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208846",
    "pull_request_review_id": 746523172,
    "id": 702208846,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjIwODg0Ng==",
    "diff_hunk": "@@ -357,17 +357,15 @@ std::vector<OutputGroup> GroupOutputs(const CWallet& wallet, const std::vector<C\n     return groups_out;\n }\n \n-bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n-                                 std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CoinSelectionParams& coin_selection_params)\n+bool AttemptSelection(const CWallet& walletconst CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,",
    "path": "src/wallet/spend.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "b6ef0e496a5d91d4cbd8d6e7ff9dbb6935b9a172",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed",
    "created_at": "2021-09-04T00:34:51Z",
    "updated_at": "2021-09-04T00:34:51Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208846",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208846"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208846"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208846/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 360,
    "side": "RIGHT",
    "in_reply_to_id": 702168017
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208852",
    "pull_request_review_id": 746523179,
    "id": 702208852,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDcwMjIwODg1Mg==",
    "diff_hunk": "@@ -394,29 +394,32 @@ bool AttemptSelection(const CWallet& walletconst CAmount& nTargetValue, const Co\n     return true;\n }\n \n-bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params)\n+bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params, SelectionResult& result)\n {\n-    SelectionResult result;\n+    result.Clear();\n+\n     std::vector<COutput> vCoins(vAvailableCoins);\n     CAmount value_to_select = nTargetValue;\n \n+    OutputGroup preset_inputs(coin_selection_params);\n+\n     // coin control -> return all selected outputs (we want all selected to go into the transaction for sure)\n     if (coin_control.HasSelected() && !coin_control.fAllowOtherInputs)\n     {\n-        for (const COutput& out : vCoins)\n-        {\n-            if (!out.fSpendable)\n-                 continue;\n-            nValueRet += out.tx->tx->vout[out.i].nValue;\n-            setCoinsRet.insert(out.GetInputCoin());\n+        for (const COutput& out : vCoins) {\n+            if (!out.fSpendable) continue;\n+            /* Set depth, from_me, ancestors, and descendants to 0 or false as don't matter for preset inputs as no actual selection is being done.",
    "path": "src/wallet/spend.cpp",
    "position": null,
    "original_position": 26,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "10492b60ad8f439b29a200b9fa3acce7cdce8f6d",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "fixed",
    "created_at": "2021-09-04T00:34:56Z",
    "updated_at": "2021-09-04T00:34:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208852",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208852"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r702208852"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/702208852/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 411,
    "side": "RIGHT",
    "in_reply_to_id": 702169072
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/727997015",
    "pull_request_review_id": 778485819,
    "id": 727997015,
    "node_id": "PRRC_kwDOABII584rZFpX",
    "diff_hunk": "@@ -602,8 +622,7 @@ BOOST_AUTO_TEST_CASE(knapsack_solver_test)\n \n BOOST_AUTO_TEST_CASE(ApproximateBestSubset)\n {\n-    CoinSet setCoinsRet;\n-    CAmount nValueRet;\n+    SelectionResult knapsack_result(CAmount(0), true);",
    "path": "src/wallet/test/coinselector_tests.cpp",
    "position": null,
    "original_position": 615,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c5da3dfe9367713d01569df18c65b563eca25087",
    "user": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This is apparently unused. https://github.com/Empact/bitcoin/commit/4719cc5aacf7531724d24a81b5b8935d2605f13f",
    "created_at": "2021-10-13T12:14:04Z",
    "updated_at": "2021-10-13T12:14:38Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r727997015",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/727997015"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r727997015"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/727997015/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 625,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740817760",
    "pull_request_review_id": 795009378,
    "id": 740817760,
    "node_id": "PRRC_kwDOABII584sJ_tg",
    "diff_hunk": "@@ -373,76 +373,72 @@ std::vector<OutputGroup> GroupOutputs(const CWallet& wallet, const std::vector<C\n     return groups_out;\n }\n \n-bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n-                                 std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n+                               const CoinSelectionParams& coin_selection_params)\n {\n-    setCoinsRet.clear();\n-    nValueRet = 0;\n-    // Vector of results for use with waste calculation\n-    // In order: calculated waste, selected inputs, selected input value (sum of input values)\n-    // TODO: Use a struct representing the selection result\n-    std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n+    // Vector of result and waste pairs. We will choose the best one based on waste.\n+    std::vector<std::pair<SelectionResult, CAmount>> results;\n \n     // Note that unlike KnapsackSolver, we do not include the fee for creating a change output as BnB will not create a change output.\n     std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, true /* positive_only */);\n-    std::set<CInputCoin> bnb_coins;\n-    CAmount bnb_value;\n-    if (SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change, bnb_coins, bnb_value)) {\n-        const auto waste = GetSelectionWaste(bnb_coins, /* cost of change */ CAmount(0), nTargetValue, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(bnb_coins), bnb_value));\n+    std::optional<SelectionResult> bnb_result = SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change);\n+    if (bnb_result) {\n+        results.push_back(std::make_pair(*bnb_result, bnb_result->GetWaste(CAmount(0))));\n     }\n \n     // The knapsack solver has some legacy behavior where it will spend dust outputs. We retain this behavior, so don't filter for positive only here.\n     std::vector<OutputGroup> all_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, false /* positive_only */);\n     // While nTargetValue includes the transaction fees for non-input things, it does not include the fee for creating a change output.\n     // So we need to include that for KnapsackSolver as well, as we are expecting to create a change output.\n-    std::set<CInputCoin> knapsack_coins;\n-    CAmount knapsack_value;\n-    if (KnapsackSolver(nTargetValue + coin_selection_params.m_change_fee, all_groups, knapsack_coins, knapsack_value)) {\n-        const auto waste = GetSelectionWaste(knapsack_coins, coin_selection_params.m_cost_of_change, nTargetValue + coin_selection_params.m_change_fee, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(knapsack_coins), knapsack_value));\n+    std::optional<SelectionResult> knapsack_result = KnapsackSolver(all_groups, nTargetValue + coin_selection_params.m_change_fee);\n+    if (knapsack_result) {\n+        results.push_back(std::make_pair(*knapsack_result, knapsack_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     // We include the minimum final change for SRD as we do want to avoid making really small change.\n     // KnapsackSolver does not need this because it includes MIN_CHANGE internally.\n     const CAmount srd_target = nTargetValue + coin_selection_params.m_change_fee + MIN_FINAL_CHANGE;\n     auto srd_result = SelectCoinsSRD(positive_groups, srd_target);\n     if (srd_result != std::nullopt) {\n-        const auto waste = GetSelectionWaste(srd_result->first, coin_selection_params.m_cost_of_change, srd_target, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(srd_result->first), srd_result->second));\n+        results.push_back(std::make_pair(*srd_result, srd_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     if (results.size() == 0) {\n         // No solution found\n-        return false;\n+        return std::nullopt;\n     }\n \n     // Choose the result with the least waste\n     // If the waste is the same, choose the one which spends more inputs.\n-    const auto& best_result = std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b) {\n-        return std::get<0>(a) < std::get<0>(b) || (std::get<0>(a) == std::get<0>(b) && std::get<1>(a).size() > std::get<1>(b).size());\n+    auto [best_result, waste] = *std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b){\n+        const auto [a_result, a_waste] = a;\n+        const auto [b_result, b_waste] = b;\n+        return a_waste < b_waste || (a_waste == b_waste && a_result.m_selected_inputs.size() > b_result.m_selected_inputs.size());\n     });\n-    setCoinsRet = std::get<1>(*best_result);\n-    nValueRet = std::get<2>(*best_result);\n-    return true;\n+    return best_result;\n }\n \n-bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params)\n {\n     std::vector<COutput> vCoins(vAvailableCoins);\n     CAmount value_to_select = nTargetValue;\n \n+    OutputGroup preset_inputs(coin_selection_params);\n+\n     // coin control -> return all selected outputs (we want all selected to go into the transaction for sure)\n     if (coin_control.HasSelected() && !coin_control.fAllowOtherInputs)\n     {\n-        for (const COutput& out : vCoins)\n-        {\n-            if (!out.fSpendable)\n-                 continue;\n-            nValueRet += out.tx->tx->vout[out.i].nValue;\n-            setCoinsRet.insert(out.GetInputCoin());\n+        for (const COutput& out : vCoins) {\n+            if (!out.fSpendable) continue;\n+            /* Set depth, from_me, ancestors, and descendants to 0 or false as these don't matter for preset inputs as no actual selection is being done.\n+             * positive_only is set to false because we want to include all preset inputs, even if they are dust.\n+             */\n+            preset_inputs.Insert(out.GetInputCoin(), 0, false, 0, 0, false);\n         }\n-        return (nValueRet >= nTargetValue);\n+        SelectionResult result(nTargetValue);\n+        result.AddInput(preset_inputs);\n+        if (result.GetSelectedValue() >= nTargetValue) return std::nullopt;",
    "path": "src/wallet/spend.cpp",
    "position": null,
    "original_position": 102,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "1036ab72f8db0f85c7a294d01c25d00ec8f0b421",
    "user": {
      "login": "S3RK",
      "id": 1466284,
      "node_id": "MDQ6VXNlcjE0NjYyODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/S3RK",
      "html_url": "https://github.com/S3RK",
      "followers_url": "https://api.github.com/users/S3RK/followers",
      "following_url": "https://api.github.com/users/S3RK/following{/other_user}",
      "gists_url": "https://api.github.com/users/S3RK/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
      "organizations_url": "https://api.github.com/users/S3RK/orgs",
      "repos_url": "https://api.github.com/users/S3RK/repos",
      "events_url": "https://api.github.com/users/S3RK/events{/privacy}",
      "received_events_url": "https://api.github.com/users/S3RK/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n        if (result.GetSelectedValue() < nTargetValue) return std::nullopt;\r\n```",
    "created_at": "2021-11-02T08:34:09Z",
    "updated_at": "2021-11-02T08:34:09Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r740817760",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740817760"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r740817760"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/740817760/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 440,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741267727",
    "pull_request_review_id": 795651850,
    "id": 741267727,
    "node_id": "PRRC_kwDOABII584sLtkP",
    "diff_hunk": "@@ -373,76 +373,72 @@ std::vector<OutputGroup> GroupOutputs(const CWallet& wallet, const std::vector<C\n     return groups_out;\n }\n \n-bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n-                                 std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n+                               const CoinSelectionParams& coin_selection_params)\n {\n-    setCoinsRet.clear();\n-    nValueRet = 0;\n-    // Vector of results for use with waste calculation\n-    // In order: calculated waste, selected inputs, selected input value (sum of input values)\n-    // TODO: Use a struct representing the selection result\n-    std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n+    // Vector of result and waste pairs. We will choose the best one based on waste.\n+    std::vector<std::pair<SelectionResult, CAmount>> results;\n \n     // Note that unlike KnapsackSolver, we do not include the fee for creating a change output as BnB will not create a change output.\n     std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, true /* positive_only */);\n-    std::set<CInputCoin> bnb_coins;\n-    CAmount bnb_value;\n-    if (SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change, bnb_coins, bnb_value)) {\n-        const auto waste = GetSelectionWaste(bnb_coins, /* cost of change */ CAmount(0), nTargetValue, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(bnb_coins), bnb_value));\n+    std::optional<SelectionResult> bnb_result = SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change);\n+    if (bnb_result) {\n+        results.push_back(std::make_pair(*bnb_result, bnb_result->GetWaste(CAmount(0))));\n     }\n \n     // The knapsack solver has some legacy behavior where it will spend dust outputs. We retain this behavior, so don't filter for positive only here.\n     std::vector<OutputGroup> all_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, false /* positive_only */);\n     // While nTargetValue includes the transaction fees for non-input things, it does not include the fee for creating a change output.\n     // So we need to include that for KnapsackSolver as well, as we are expecting to create a change output.\n-    std::set<CInputCoin> knapsack_coins;\n-    CAmount knapsack_value;\n-    if (KnapsackSolver(nTargetValue + coin_selection_params.m_change_fee, all_groups, knapsack_coins, knapsack_value)) {\n-        const auto waste = GetSelectionWaste(knapsack_coins, coin_selection_params.m_cost_of_change, nTargetValue + coin_selection_params.m_change_fee, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(knapsack_coins), knapsack_value));\n+    std::optional<SelectionResult> knapsack_result = KnapsackSolver(all_groups, nTargetValue + coin_selection_params.m_change_fee);\n+    if (knapsack_result) {\n+        results.push_back(std::make_pair(*knapsack_result, knapsack_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     // We include the minimum final change for SRD as we do want to avoid making really small change.\n     // KnapsackSolver does not need this because it includes MIN_CHANGE internally.\n     const CAmount srd_target = nTargetValue + coin_selection_params.m_change_fee + MIN_FINAL_CHANGE;\n     auto srd_result = SelectCoinsSRD(positive_groups, srd_target);\n     if (srd_result != std::nullopt) {\n-        const auto waste = GetSelectionWaste(srd_result->first, coin_selection_params.m_cost_of_change, srd_target, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(srd_result->first), srd_result->second));\n+        results.push_back(std::make_pair(*srd_result, srd_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     if (results.size() == 0) {\n         // No solution found\n-        return false;\n+        return std::nullopt;\n     }\n \n     // Choose the result with the least waste\n     // If the waste is the same, choose the one which spends more inputs.\n-    const auto& best_result = std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b) {\n-        return std::get<0>(a) < std::get<0>(b) || (std::get<0>(a) == std::get<0>(b) && std::get<1>(a).size() > std::get<1>(b).size());\n+    auto [best_result, waste] = *std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b){\n+        const auto [a_result, a_waste] = a;\n+        const auto [b_result, b_waste] = b;\n+        return a_waste < b_waste || (a_waste == b_waste && a_result.m_selected_inputs.size() > b_result.m_selected_inputs.size());\n     });\n-    setCoinsRet = std::get<1>(*best_result);\n-    nValueRet = std::get<2>(*best_result);\n-    return true;\n+    return best_result;\n }\n \n-bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params)\n {\n     std::vector<COutput> vCoins(vAvailableCoins);\n     CAmount value_to_select = nTargetValue;\n \n+    OutputGroup preset_inputs(coin_selection_params);\n+\n     // coin control -> return all selected outputs (we want all selected to go into the transaction for sure)\n     if (coin_control.HasSelected() && !coin_control.fAllowOtherInputs)\n     {\n-        for (const COutput& out : vCoins)\n-        {\n-            if (!out.fSpendable)\n-                 continue;\n-            nValueRet += out.tx->tx->vout[out.i].nValue;\n-            setCoinsRet.insert(out.GetInputCoin());\n+        for (const COutput& out : vCoins) {\n+            if (!out.fSpendable) continue;\n+            /* Set depth, from_me, ancestors, and descendants to 0 or false as these don't matter for preset inputs as no actual selection is being done.\n+             * positive_only is set to false because we want to include all preset inputs, even if they are dust.\n+             */\n+            preset_inputs.Insert(out.GetInputCoin(), 0, false, 0, 0, false);\n         }\n-        return (nValueRet >= nTargetValue);\n+        SelectionResult result(nTargetValue);\n+        result.AddInput(preset_inputs);\n+        if (result.GetSelectedValue() >= nTargetValue) return std::nullopt;",
    "path": "src/wallet/spend.cpp",
    "position": null,
    "original_position": 102,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "1036ab72f8db0f85c7a294d01c25d00ec8f0b421",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Oops, fixed.",
    "created_at": "2021-11-02T16:29:05Z",
    "updated_at": "2021-11-02T16:29:05Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r741267727",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741267727"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r741267727"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741267727/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 440,
    "side": "RIGHT",
    "in_reply_to_id": 740817760
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741394282",
    "pull_request_review_id": 795825067,
    "id": 741394282,
    "node_id": "PRRC_kwDOABII584sMMdq",
    "diff_hunk": "@@ -373,76 +373,72 @@ std::vector<OutputGroup> GroupOutputs(const CWallet& wallet, const std::vector<C\n     return groups_out;\n }\n \n-bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n-                                 std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n+                               const CoinSelectionParams& coin_selection_params)\n {\n-    setCoinsRet.clear();\n-    nValueRet = 0;\n-    // Vector of results for use with waste calculation\n-    // In order: calculated waste, selected inputs, selected input value (sum of input values)\n-    // TODO: Use a struct representing the selection result\n-    std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n+    // Vector of result and waste pairs. We will choose the best one based on waste.\n+    std::vector<std::pair<SelectionResult, CAmount>> results;\n \n     // Note that unlike KnapsackSolver, we do not include the fee for creating a change output as BnB will not create a change output.\n     std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, true /* positive_only */);\n-    std::set<CInputCoin> bnb_coins;\n-    CAmount bnb_value;\n-    if (SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change, bnb_coins, bnb_value)) {\n-        const auto waste = GetSelectionWaste(bnb_coins, /* cost of change */ CAmount(0), nTargetValue, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(bnb_coins), bnb_value));\n+    std::optional<SelectionResult> bnb_result = SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change);\n+    if (bnb_result) {\n+        results.push_back(std::make_pair(*bnb_result, bnb_result->GetWaste(CAmount(0))));\n     }\n \n     // The knapsack solver has some legacy behavior where it will spend dust outputs. We retain this behavior, so don't filter for positive only here.\n     std::vector<OutputGroup> all_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, false /* positive_only */);\n     // While nTargetValue includes the transaction fees for non-input things, it does not include the fee for creating a change output.\n     // So we need to include that for KnapsackSolver as well, as we are expecting to create a change output.\n-    std::set<CInputCoin> knapsack_coins;\n-    CAmount knapsack_value;\n-    if (KnapsackSolver(nTargetValue + coin_selection_params.m_change_fee, all_groups, knapsack_coins, knapsack_value)) {\n-        const auto waste = GetSelectionWaste(knapsack_coins, coin_selection_params.m_cost_of_change, nTargetValue + coin_selection_params.m_change_fee, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(knapsack_coins), knapsack_value));\n+    std::optional<SelectionResult> knapsack_result = KnapsackSolver(all_groups, nTargetValue + coin_selection_params.m_change_fee);\n+    if (knapsack_result) {\n+        results.push_back(std::make_pair(*knapsack_result, knapsack_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     // We include the minimum final change for SRD as we do want to avoid making really small change.\n     // KnapsackSolver does not need this because it includes MIN_CHANGE internally.\n     const CAmount srd_target = nTargetValue + coin_selection_params.m_change_fee + MIN_FINAL_CHANGE;\n     auto srd_result = SelectCoinsSRD(positive_groups, srd_target);\n     if (srd_result != std::nullopt) {\n-        const auto waste = GetSelectionWaste(srd_result->first, coin_selection_params.m_cost_of_change, srd_target, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(srd_result->first), srd_result->second));\n+        results.push_back(std::make_pair(*srd_result, srd_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     if (results.size() == 0) {\n         // No solution found\n-        return false;\n+        return std::nullopt;\n     }\n \n     // Choose the result with the least waste\n     // If the waste is the same, choose the one which spends more inputs.\n-    const auto& best_result = std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b) {\n-        return std::get<0>(a) < std::get<0>(b) || (std::get<0>(a) == std::get<0>(b) && std::get<1>(a).size() > std::get<1>(b).size());\n+    auto [best_result, waste] = *std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b){\n+        const auto [a_result, a_waste] = a;\n+        const auto [b_result, b_waste] = b;\n+        return a_waste < b_waste || (a_waste == b_waste && a_result.m_selected_inputs.size() > b_result.m_selected_inputs.size());\n     });\n-    setCoinsRet = std::get<1>(*best_result);\n-    nValueRet = std::get<2>(*best_result);\n-    return true;\n+    return best_result;\n }\n \n-bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCoins, const CAmount& nTargetValue, const CCoinControl& coin_control, CoinSelectionParams& coin_selection_params)\n {\n     std::vector<COutput> vCoins(vAvailableCoins);\n     CAmount value_to_select = nTargetValue;\n \n+    OutputGroup preset_inputs(coin_selection_params);\n+\n     // coin control -> return all selected outputs (we want all selected to go into the transaction for sure)\n     if (coin_control.HasSelected() && !coin_control.fAllowOtherInputs)\n     {\n-        for (const COutput& out : vCoins)\n-        {\n-            if (!out.fSpendable)\n-                 continue;\n-            nValueRet += out.tx->tx->vout[out.i].nValue;\n-            setCoinsRet.insert(out.GetInputCoin());\n+        for (const COutput& out : vCoins) {\n+            if (!out.fSpendable) continue;\n+            /* Set depth, from_me, ancestors, and descendants to 0 or false as these don't matter for preset inputs as no actual selection is being done.\n+             * positive_only is set to false because we want to include all preset inputs, even if they are dust.\n+             */\n+            preset_inputs.Insert(out.GetInputCoin(), 0, false, 0, 0, false);\n         }\n-        return (nValueRet >= nTargetValue);\n+        SelectionResult result(nTargetValue);\n+        result.AddInput(preset_inputs);\n+        if (result.GetSelectedValue() >= nTargetValue) return std::nullopt;",
    "path": "src/wallet/spend.cpp",
    "position": null,
    "original_position": 102,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "1036ab72f8db0f85c7a294d01c25d00ec8f0b421",
    "user": {
      "login": "S3RK",
      "id": 1466284,
      "node_id": "MDQ6VXNlcjE0NjYyODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1466284?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/S3RK",
      "html_url": "https://github.com/S3RK",
      "followers_url": "https://api.github.com/users/S3RK/followers",
      "following_url": "https://api.github.com/users/S3RK/following{/other_user}",
      "gists_url": "https://api.github.com/users/S3RK/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/S3RK/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/S3RK/subscriptions",
      "organizations_url": "https://api.github.com/users/S3RK/orgs",
      "repos_url": "https://api.github.com/users/S3RK/repos",
      "events_url": "https://api.github.com/users/S3RK/events{/privacy}",
      "received_events_url": "https://api.github.com/users/S3RK/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Looks like this hasn't been caught by the tests, probably a nice to have follow up and a good first issue.",
    "created_at": "2021-11-02T19:16:52Z",
    "updated_at": "2021-11-02T19:16:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r741394282",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741394282"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r741394282"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/741394282/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 440,
    "side": "RIGHT",
    "in_reply_to_id": 740817760
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748866164",
    "pull_request_review_id": 805482179,
    "id": 748866164,
    "node_id": "PRRC_kwDOABII584sosp0",
    "diff_hunk": "@@ -81,6 +83,23 @@ static void add_coin(std::vector<COutput>& coins, CWallet& wallet, const CAmount\n     coins.push_back(output);\n }\n \n+static bool equivalent_sets(CoinSet a, CoinSet b)",
    "path": "src/wallet/test/coinselector_tests.cpp",
    "position": null,
    "original_position": 35,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "94d851d28cb909a8f1f8ab795f1d9fc74bebfc7f",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In 94d851d28cb909a8f1f8ab795f1d9fc74bebfc7f\r\n\r\nI think there should definitely be a comment here about the difference describing exactly what `equivalent_sets` checks and its difference vs `equal_sets`",
    "created_at": "2021-11-14T14:58:57Z",
    "updated_at": "2021-11-14T15:43:35Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748866164",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748866164"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748866164"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748866164/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 86,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748866401",
    "pull_request_review_id": 805482179,
    "id": 748866401,
    "node_id": "PRRC_kwDOABII584sosth",
    "diff_hunk": "@@ -197,6 +197,32 @@ struct OutputGroup\n  */\n [[nodiscard]] CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cost, CAmount target, bool use_effective_value = true);\n \n+struct SelectionResult\n+{\n+    /** Set of inputs selected by the algorithm to use in the transaction */\n+    std::set<CInputCoin> m_selected_inputs;",
    "path": "src/wallet/coinselection.h",
    "position": 18,
    "original_position": 7,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "fe4d2eff23f22ec09b71bd4f218a28c66a386f10",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In fe4d2eff23f22ec09b71bd4f218a28c66a386f10:\r\nShould this be `private`? Especially since you have functions to `AddInput()` and `GetInputVector()`, nobody should have direct access to this set.",
    "created_at": "2021-11-14T15:00:48Z",
    "updated_at": "2021-11-14T15:44:48Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748866401",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748866401"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748866401"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748866401/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 206,
    "original_line": 206,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748866526",
    "pull_request_review_id": 805482179,
    "id": 748866526,
    "node_id": "PRRC_kwDOABII584sosve",
    "diff_hunk": "@@ -197,6 +197,32 @@ struct OutputGroup\n  */\n [[nodiscard]] CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cost, CAmount target, bool use_effective_value = true);\n \n+struct SelectionResult\n+{\n+    /** Set of inputs selected by the algorithm to use in the transaction */\n+    std::set<CInputCoin> m_selected_inputs;\n+    /** The target the algorithm selected for. Note that this may not be equal to the recipient amount as it can include non-input fees */\n+    const CAmount m_target;\n+    /** Whether the input values for calculations should be the effective value (true) or normal value (false) */\n+    bool m_use_effective{false};\n+\n+    explicit SelectionResult(const CAmount target)\n+        : m_target(target) {}",
    "path": "src/wallet/coinselection.h",
    "position": 28,
    "original_position": 14,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "fe4d2eff23f22ec09b71bd4f218a28c66a386f10",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In fe4d2eff23f22ec09b71bd4f218a28c66a386f10:\r\ndelete default ctor, to make it impossible to create a `SelectionResult` with no specified target?",
    "created_at": "2021-11-14T15:01:30Z",
    "updated_at": "2021-11-14T15:44:56Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748866526",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748866526"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748866526"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748866526/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 215,
    "original_start_line": 209,
    "start_side": "RIGHT",
    "line": 216,
    "original_line": 216,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748867141",
    "pull_request_review_id": 805482179,
    "id": 748867141,
    "node_id": "PRRC_kwDOABII584sos5F",
    "diff_hunk": "@@ -418,6 +413,7 @@ void SelectionResult::Clear()\n void SelectionResult::AddInput(const OutputGroup& group)\n {\n     util::insert(m_selected_inputs, group.m_outputs);\n+    m_use_effective = !group.m_subtract_fee_outputs;",
    "path": "src/wallet/coinselection.cpp",
    "position": 180,
    "original_position": 57,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "cb6507ca5fc2be3d88ad5764185419e0f20a175c",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In cb6507ca5fc2be3d88ad5764185419e0f20a175c:\r\n\r\nThis seems strange, since `m_use_effective` should never really change. IIRC, `m_subtract_fee_outputs` is known right from the start (`CreateTransactionInternal()`) right? It seems that `SelectionResult::m_use_effective` should be a `const bool` and set in the constructor.",
    "created_at": "2021-11-14T15:05:41Z",
    "updated_at": "2021-11-14T15:43:35Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748867141",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748867141"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748867141"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748867141/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 414,
    "original_line": 414,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748867273",
    "pull_request_review_id": 805482179,
    "id": 748867273,
    "node_id": "PRRC_kwDOABII584sos7J",
    "diff_hunk": "@@ -418,6 +413,7 @@ void SelectionResult::Clear()\n void SelectionResult::AddInput(const OutputGroup& group)\n {\n     util::insert(m_selected_inputs, group.m_outputs);\n+    m_use_effective = !group.m_subtract_fee_outputs;",
    "path": "src/wallet/coinselection.cpp",
    "position": 180,
    "original_position": 57,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "cb6507ca5fc2be3d88ad5764185419e0f20a175c",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "My expectation would be to `Assume(group.m_subtract_fee_outputs != m_use_effective)`. Maybe I'm misunderstanding?",
    "created_at": "2021-11-14T15:06:35Z",
    "updated_at": "2021-11-14T15:43:35Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748867273",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748867273"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748867273"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748867273/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 414,
    "original_line": 414,
    "side": "RIGHT",
    "in_reply_to_id": 748867141
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748868349",
    "pull_request_review_id": 805482179,
    "id": 748868349,
    "node_id": "PRRC_kwDOABII584sotL9",
    "diff_hunk": "@@ -515,60 +515,60 @@ bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCo\n     // Coin Selection attempts to select inputs from a pool of eligible UTXOs to fund the\n     // transaction at a target feerate. If an attempt fails, more attempts may be made using a more\n     // permissive CoinEligibilityFilter.\n-    const bool res = [&] {\n+    std::optional<SelectionResult> res = [&] {\n         // Pre-selected inputs already cover the target amount.\n-        if (value_to_select <= 0) return true;\n+        if (value_to_select <= 0) return std::make_optional(SelectionResult(nTargetValue));\n \n         // If possible, fund the transaction with confirmed UTXOs only. Prefer at least six\n         // confirmations on outputs received from other wallets and only spend confirmed change.\n-        if (AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 6, 0), vCoins, setCoinsRet, nValueRet, coin_selection_params)) return true;\n-        if (AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 1, 0), vCoins, setCoinsRet, nValueRet, coin_selection_params)) return true;\n+        std::optional<SelectionResult> r1 = AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 6, 0), vCoins, coin_selection_params);\n+        if (r1) return r1;",
    "path": "src/wallet/spend.cpp",
    "position": null,
    "original_position": 160,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think this is cleaner, and keeps the scope of the result to this `if` block. There's no reason why `r1`'s scope should persist through the end of the lambda.\r\n```suggestion\r\n        if (auto r1{AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 6, 0), vCoins, coin_selection_params)}) {\r\n            return r1.value();\r\n        }\r\n```",
    "created_at": "2021-11-14T15:14:14Z",
    "updated_at": "2021-11-14T15:43:35Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748868349",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748868349"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748868349"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748868349/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 524,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 525,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748868619",
    "pull_request_review_id": 805482179,
    "id": 748868619,
    "node_id": "PRRC_kwDOABII584sotQL",
    "diff_hunk": "@@ -515,60 +515,60 @@ bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCo\n     // Coin Selection attempts to select inputs from a pool of eligible UTXOs to fund the\n     // transaction at a target feerate. If an attempt fails, more attempts may be made using a more\n     // permissive CoinEligibilityFilter.\n-    const bool res = [&] {\n+    std::optional<SelectionResult> res = [&] {\n         // Pre-selected inputs already cover the target amount.\n-        if (value_to_select <= 0) return true;\n+        if (value_to_select <= 0) return std::make_optional(SelectionResult(nTargetValue));\n \n         // If possible, fund the transaction with confirmed UTXOs only. Prefer at least six\n         // confirmations on outputs received from other wallets and only spend confirmed change.\n-        if (AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 6, 0), vCoins, setCoinsRet, nValueRet, coin_selection_params)) return true;\n-        if (AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 1, 0), vCoins, setCoinsRet, nValueRet, coin_selection_params)) return true;\n+        std::optional<SelectionResult> r1 = AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 6, 0), vCoins, coin_selection_params);\n+        if (r1) return r1;",
    "path": "src/wallet/spend.cpp",
    "position": null,
    "original_position": 160,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "(same with the rest of the `AttemptSelection` calls)",
    "created_at": "2021-11-14T15:16:33Z",
    "updated_at": "2021-11-14T15:43:35Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748868619",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748868619"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748868619"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748868619/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 524,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 525,
    "side": "RIGHT",
    "in_reply_to_id": 748868349
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870402",
    "pull_request_review_id": 805482179,
    "id": 748870402,
    "node_id": "PRRC_kwDOABII584sotsC",
    "diff_hunk": "@@ -156,25 +153,22 @@ bool SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selectio\n \n     // Check for solution\n     if (best_selection.empty()) {\n-        return false;\n+        return std::nullopt;\n     }\n \n     // Set output set\n-    value_ret = 0;\n     for (size_t i = 0; i < best_selection.size(); ++i) {\n         if (best_selection.at(i)) {\n-            util::insert(out_set, utxo_pool.at(i).m_outputs);\n-            value_ret += utxo_pool.at(i).m_value;\n+            result.AddInput(utxo_pool.at(i));\n         }\n     }\n \n-    return true;\n+    return std::make_optional(result);",
    "path": "src/wallet/coinselection.cpp",
    "position": null,
    "original_position": 49,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "is there any benefit to using a `std::make_optional` here?\r\n```suggestion\r\n    return result;\r\n```",
    "created_at": "2021-11-14T15:30:53Z",
    "updated_at": "2021-11-14T15:43:35Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748870402",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870402"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748870402"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870402/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 166,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870486",
    "pull_request_review_id": 805482179,
    "id": 748870486,
    "node_id": "PRRC_kwDOABII584sottW",
    "diff_hunk": "@@ -515,60 +515,60 @@ bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCo\n     // Coin Selection attempts to select inputs from a pool of eligible UTXOs to fund the\n     // transaction at a target feerate. If an attempt fails, more attempts may be made using a more\n     // permissive CoinEligibilityFilter.\n-    const bool res = [&] {\n+    std::optional<SelectionResult> res = [&] {\n         // Pre-selected inputs already cover the target amount.\n-        if (value_to_select <= 0) return true;\n+        if (value_to_select <= 0) return std::make_optional(SelectionResult(nTargetValue));",
    "path": "src/wallet/spend.cpp",
    "position": 157,
    "original_position": 153,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "note to self, `std::make_optional` makes sense here to avoid the copy of the temporary `SelectionResult`; it's constructed in place",
    "created_at": "2021-11-14T15:31:34Z",
    "updated_at": "2021-11-14T15:43:35Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748870486",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870486"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748870486"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870486/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 514,
    "original_line": 514,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870890",
    "pull_request_review_id": 805482179,
    "id": 748870890,
    "node_id": "PRRC_kwDOABII584sotzq",
    "diff_hunk": "@@ -373,76 +373,72 @@ std::vector<OutputGroup> GroupOutputs(const CWallet& wallet, const std::vector<C\n     return groups_out;\n }\n \n-bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n-                                 std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n+                               const CoinSelectionParams& coin_selection_params)\n {\n-    setCoinsRet.clear();\n-    nValueRet = 0;\n-    // Vector of results for use with waste calculation\n-    // In order: calculated waste, selected inputs, selected input value (sum of input values)\n-    // TODO: Use a struct representing the selection result\n-    std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n+    // Vector of result and waste pairs. We will choose the best one based on waste.\n+    std::vector<std::pair<SelectionResult, CAmount>> results;\n \n     // Note that unlike KnapsackSolver, we do not include the fee for creating a change output as BnB will not create a change output.\n     std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, true /* positive_only */);\n-    std::set<CInputCoin> bnb_coins;\n-    CAmount bnb_value;\n-    if (SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change, bnb_coins, bnb_value)) {\n-        const auto waste = GetSelectionWaste(bnb_coins, /* cost of change */ CAmount(0), nTargetValue, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(bnb_coins), bnb_value));\n+    std::optional<SelectionResult> bnb_result = SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change);\n+    if (bnb_result) {",
    "path": "src/wallet/spend.cpp",
    "position": null,
    "original_position": 26,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "```suggestion\r\n    if (auto bnb_result{SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change)}) {\r\n```",
    "created_at": "2021-11-14T15:34:24Z",
    "updated_at": "2021-11-14T15:43:35Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748870890",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870890"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748870890"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870890/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 384,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 385,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870994",
    "pull_request_review_id": 805482179,
    "id": 748870994,
    "node_id": "PRRC_kwDOABII584sot1S",
    "diff_hunk": "@@ -373,76 +373,72 @@ std::vector<OutputGroup> GroupOutputs(const CWallet& wallet, const std::vector<C\n     return groups_out;\n }\n \n-bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n-                                 std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n+                               const CoinSelectionParams& coin_selection_params)\n {\n-    setCoinsRet.clear();\n-    nValueRet = 0;\n-    // Vector of results for use with waste calculation\n-    // In order: calculated waste, selected inputs, selected input value (sum of input values)\n-    // TODO: Use a struct representing the selection result\n-    std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n+    // Vector of result and waste pairs. We will choose the best one based on waste.\n+    std::vector<std::pair<SelectionResult, CAmount>> results;\n \n     // Note that unlike KnapsackSolver, we do not include the fee for creating a change output as BnB will not create a change output.\n     std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, true /* positive_only */);\n-    std::set<CInputCoin> bnb_coins;\n-    CAmount bnb_value;\n-    if (SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change, bnb_coins, bnb_value)) {\n-        const auto waste = GetSelectionWaste(bnb_coins, /* cost of change */ CAmount(0), nTargetValue, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(bnb_coins), bnb_value));\n+    std::optional<SelectionResult> bnb_result = SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change);\n+    if (bnb_result) {\n+        results.push_back(std::make_pair(*bnb_result, bnb_result->GetWaste(CAmount(0))));\n     }\n \n     // The knapsack solver has some legacy behavior where it will spend dust outputs. We retain this behavior, so don't filter for positive only here.\n     std::vector<OutputGroup> all_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, false /* positive_only */);\n     // While nTargetValue includes the transaction fees for non-input things, it does not include the fee for creating a change output.\n     // So we need to include that for KnapsackSolver as well, as we are expecting to create a change output.\n-    std::set<CInputCoin> knapsack_coins;\n-    CAmount knapsack_value;\n-    if (KnapsackSolver(nTargetValue + coin_selection_params.m_change_fee, all_groups, knapsack_coins, knapsack_value)) {\n-        const auto waste = GetSelectionWaste(knapsack_coins, coin_selection_params.m_cost_of_change, nTargetValue + coin_selection_params.m_change_fee, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(knapsack_coins), knapsack_value));\n+    std::optional<SelectionResult> knapsack_result = KnapsackSolver(all_groups, nTargetValue + coin_selection_params.m_change_fee);\n+    if (knapsack_result) {\n+        results.push_back(std::make_pair(*knapsack_result, knapsack_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     // We include the minimum final change for SRD as we do want to avoid making really small change.\n     // KnapsackSolver does not need this because it includes MIN_CHANGE internally.\n     const CAmount srd_target = nTargetValue + coin_selection_params.m_change_fee + MIN_FINAL_CHANGE;\n     auto srd_result = SelectCoinsSRD(positive_groups, srd_target);\n     if (srd_result != std::nullopt) {\n-        const auto waste = GetSelectionWaste(srd_result->first, coin_selection_params.m_cost_of_change, srd_target, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(srd_result->first), srd_result->second));\n+        results.push_back(std::make_pair(*srd_result, srd_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     if (results.size() == 0) {\n         // No solution found\n-        return false;\n+        return std::nullopt;\n     }\n \n     // Choose the result with the least waste\n     // If the waste is the same, choose the one which spends more inputs.\n-    const auto& best_result = std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b) {\n-        return std::get<0>(a) < std::get<0>(b) || (std::get<0>(a) == std::get<0>(b) && std::get<1>(a).size() > std::get<1>(b).size());\n+    auto [best_result, waste] = *std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b){\n+        const auto [a_result, a_waste] = a;\n+        const auto [b_result, b_waste] = b;\n+        return a_waste < b_waste || (a_waste == b_waste && a_result.m_selected_inputs.size() > b_result.m_selected_inputs.size());",
    "path": "src/wallet/spend.cpp",
    "position": null,
    "original_position": 67,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
    "user": {
      "login": "glozow",
      "id": 25183001,
      "node_id": "MDQ6VXNlcjI1MTgzMDAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25183001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glozow",
      "html_url": "https://github.com/glozow",
      "followers_url": "https://api.github.com/users/glozow/followers",
      "following_url": "https://api.github.com/users/glozow/following{/other_user}",
      "gists_url": "https://api.github.com/users/glozow/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glozow/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glozow/subscriptions",
      "organizations_url": "https://api.github.com/users/glozow/orgs",
      "repos_url": "https://api.github.com/users/glozow/repos",
      "events_url": "https://api.github.com/users/glozow/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glozow/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Can this be written into a comparison operator for `SelectionResult`? The logic of waste and what makes one selection result better than another is inherent to the `SelectionResult` type; imo it fits better there than within `AttemptSelection`. \r\n\r\nIf you have a `<` operator defined, you can sort and/or just return the min element.",
    "created_at": "2021-11-14T15:35:30Z",
    "updated_at": "2021-11-14T15:43:35Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748870994",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870994"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r748870994"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/748870994/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 413,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 416,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755390185",
    "pull_request_review_id": 814021649,
    "id": 755390185,
    "node_id": "PRRC_kwDOABII584tBlbp",
    "diff_hunk": "@@ -395,3 +387,30 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+CAmount SelectionResult::GetSelectedValue() const\n+{\n+    CAmount ret = 0;\n+    for (const auto& coin : m_selected_inputs) {\n+        ret += coin.txout.nValue;\n+    }\n+    return ret;\n+}\n+\n+void SelectionResult::Clear()\n+{\n+    m_selected_inputs.clear();\n+}\n+\n+void SelectionResult::AddInput(const OutputGroup& group)\n+{\n+    util::insert(m_selected_inputs, group.m_outputs);\n+    m_use_effective = !group.m_subtract_fee_outputs;\n+}\n+\n+std::vector<CInputCoin> SelectionResult::GetInputVector() const\n+{\n+    std::vector<CInputCoin> coins(m_selected_inputs.begin(), m_selected_inputs.end());\n+    Shuffle(coins.begin(), coins.end(), FastRandomContext());",
    "path": "src/wallet/coinselection.cpp",
    "position": 191,
    "original_position": 187,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I think randomizing in a `Get` function is very unexpected. You wouldn't expect it to return a different value every time. I'd prefer to either rename this function to e.g. `RandomizedInputVector()` or, do it at the call site, or do the shuffle somewhere else.",
    "created_at": "2021-11-23T18:09:26Z",
    "updated_at": "2021-11-23T18:12:05Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755390185",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755390185"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755390185"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755390185/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 425,
    "original_line": 425,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755390977",
    "pull_request_review_id": 814022678,
    "id": 755390977,
    "node_id": "PRRC_kwDOABII584tBloB",
    "diff_hunk": "@@ -369,6 +356,11 @@ CAmount OutputGroup::GetSelectionAmount() const\n     return m_subtract_fee_outputs ? m_value : effective_value;\n }\n \n+CAmount SelectionResult::GetWaste(CAmount change_cost) const\n+{\n+    return GetSelectionWaste(m_selected_inputs, change_cost, m_target, m_use_effective);\n+}",
    "path": "src/wallet/coinselection.cpp",
    "position": null,
    "original_position": 154,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Maybe move this under the global `::GetSelectionWaste`? Currently no problem but if you'd ever want to make it static.",
    "created_at": "2021-11-23T18:10:34Z",
    "updated_at": "2021-11-23T18:10:34Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755390977",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755390977"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755390977"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755390977/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 362,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755393639",
    "pull_request_review_id": 814026131,
    "id": 755393639,
    "node_id": "PRRC_kwDOABII584tBmRn",
    "diff_hunk": "@@ -81,10 +84,30 @@ static void add_coin(std::vector<COutput>& coins, CWallet& wallet, const CAmount\n     coins.push_back(output);\n }\n \n-static bool equal_sets(CoinSet a, CoinSet b)\n+/** Check if SelectionResult a is equivalent to SelectionResult b.\n+ * Equivalent means same input values, but maybe different inputs (i.e. same value, different prevout) */\n+bool EquivalentResult(const SelectionResult& a, const SelectionResult& b)",
    "path": "src/wallet/test/coinselector_tests.cpp",
    "position": null,
    "original_position": 46,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Local function, could be static",
    "created_at": "2021-11-23T18:14:24Z",
    "updated_at": "2021-11-23T18:14:24Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755393639",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755393639"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755393639"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755393639/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 89,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755398596",
    "pull_request_review_id": 814032855,
    "id": 755398596,
    "node_id": "PRRC_kwDOABII584tBnfE",
    "diff_hunk": "@@ -395,3 +387,30 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+CAmount SelectionResult::GetSelectedValue() const\n+{\n+    CAmount ret = 0;\n+    for (const auto& coin : m_selected_inputs) {\n+        ret += coin.txout.nValue;\n+    }\n+    return ret;\n+}\n+\n+void SelectionResult::Clear()",
    "path": "src/wallet/coinselection.cpp",
    "position": 172,
    "original_position": 173,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't think this function is ever used. I think I'd prefer to remove it, in general it seems unnecessary to have a `Clear` function instead of replacing the structure with a new, empty one.",
    "created_at": "2021-11-23T18:21:37Z",
    "updated_at": "2021-11-23T18:21:37Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755398596",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755398596"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755398596"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755398596/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 406,
    "original_line": 406,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755419084",
    "pull_request_review_id": 814059944,
    "id": 755419084,
    "node_id": "PRRC_kwDOABII584tBsfM",
    "diff_hunk": "@@ -81,6 +83,23 @@ static void add_coin(std::vector<COutput>& coins, CWallet& wallet, const CAmount\n     coins.push_back(output);\n }\n \n+static bool equivalent_sets(CoinSet a, CoinSet b)",
    "path": "src/wallet/test/coinselector_tests.cpp",
    "position": null,
    "original_position": 35,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "94d851d28cb909a8f1f8ab795f1d9fc74bebfc7f",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "A comment is added when these are later replaced with `EquivalentResuls` and `EqualResults`.",
    "created_at": "2021-11-23T18:51:20Z",
    "updated_at": "2021-11-23T18:51:21Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755419084",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755419084"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755419084"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755419084/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 86,
    "side": "RIGHT",
    "in_reply_to_id": 748866164
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755420991",
    "pull_request_review_id": 814062516,
    "id": 755420991,
    "node_id": "PRRC_kwDOABII584tBs8_",
    "diff_hunk": "@@ -418,6 +413,7 @@ void SelectionResult::Clear()\n void SelectionResult::AddInput(const OutputGroup& group)\n {\n     util::insert(m_selected_inputs, group.m_outputs);\n+    m_use_effective = !group.m_subtract_fee_outputs;",
    "path": "src/wallet/coinselection.cpp",
    "position": 180,
    "original_position": 57,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "cb6507ca5fc2be3d88ad5764185419e0f20a175c",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I did it this way because `SelectionResult`s are constructed by the `SelectCoins*` functions which do not know about `m_subtract_fee_outputs` and didn't feel like adding more parameters to those functions just to have `m_use_effective` be set in the constructor.",
    "created_at": "2021-11-23T18:54:10Z",
    "updated_at": "2021-11-23T18:54:10Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755420991",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755420991"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755420991"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755420991/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 414,
    "original_line": 414,
    "side": "RIGHT",
    "in_reply_to_id": 748867141
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536234",
    "pull_request_review_id": 814216411,
    "id": 755536234,
    "node_id": "PRRC_kwDOABII584tCJFq",
    "diff_hunk": "@@ -197,6 +197,32 @@ struct OutputGroup\n  */\n [[nodiscard]] CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cost, CAmount target, bool use_effective_value = true);\n \n+struct SelectionResult\n+{\n+    /** Set of inputs selected by the algorithm to use in the transaction */\n+    std::set<CInputCoin> m_selected_inputs;",
    "path": "src/wallet/coinselection.h",
    "position": 18,
    "original_position": 7,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "fe4d2eff23f22ec09b71bd4f218a28c66a386f10",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Inserted a commit which makes them private.",
    "created_at": "2021-11-23T22:03:14Z",
    "updated_at": "2021-11-23T22:03:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536234",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536234"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536234"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536234/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 206,
    "original_line": 206,
    "side": "RIGHT",
    "in_reply_to_id": 748866401
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536278",
    "pull_request_review_id": 814216466,
    "id": 755536278,
    "node_id": "PRRC_kwDOABII584tCJGW",
    "diff_hunk": "@@ -197,6 +197,32 @@ struct OutputGroup\n  */\n [[nodiscard]] CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cost, CAmount target, bool use_effective_value = true);\n \n+struct SelectionResult\n+{\n+    /** Set of inputs selected by the algorithm to use in the transaction */\n+    std::set<CInputCoin> m_selected_inputs;\n+    /** The target the algorithm selected for. Note that this may not be equal to the recipient amount as it can include non-input fees */\n+    const CAmount m_target;\n+    /** Whether the input values for calculations should be the effective value (true) or normal value (false) */\n+    bool m_use_effective{false};\n+\n+    explicit SelectionResult(const CAmount target)\n+        : m_target(target) {}",
    "path": "src/wallet/coinselection.h",
    "position": 28,
    "original_position": 14,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "fe4d2eff23f22ec09b71bd4f218a28c66a386f10",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2021-11-23T22:03:20Z",
    "updated_at": "2021-11-23T22:03:20Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536278",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536278"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536278"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536278/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 215,
    "original_start_line": 209,
    "start_side": "RIGHT",
    "line": 216,
    "original_line": 216,
    "side": "RIGHT",
    "in_reply_to_id": 748866526
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536363",
    "pull_request_review_id": 814216597,
    "id": 755536363,
    "node_id": "PRRC_kwDOABII584tCJHr",
    "diff_hunk": "@@ -515,60 +515,60 @@ bool SelectCoins(const CWallet& wallet, const std::vector<COutput>& vAvailableCo\n     // Coin Selection attempts to select inputs from a pool of eligible UTXOs to fund the\n     // transaction at a target feerate. If an attempt fails, more attempts may be made using a more\n     // permissive CoinEligibilityFilter.\n-    const bool res = [&] {\n+    std::optional<SelectionResult> res = [&] {\n         // Pre-selected inputs already cover the target amount.\n-        if (value_to_select <= 0) return true;\n+        if (value_to_select <= 0) return std::make_optional(SelectionResult(nTargetValue));\n \n         // If possible, fund the transaction with confirmed UTXOs only. Prefer at least six\n         // confirmations on outputs received from other wallets and only spend confirmed change.\n-        if (AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 6, 0), vCoins, setCoinsRet, nValueRet, coin_selection_params)) return true;\n-        if (AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 1, 0), vCoins, setCoinsRet, nValueRet, coin_selection_params)) return true;\n+        std::optional<SelectionResult> r1 = AttemptSelection(wallet, value_to_select, CoinEligibilityFilter(1, 6, 0), vCoins, coin_selection_params);\n+        if (r1) return r1;",
    "path": "src/wallet/spend.cpp",
    "position": null,
    "original_position": 160,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done here and elsewhere.",
    "created_at": "2021-11-23T22:03:30Z",
    "updated_at": "2021-11-23T22:03:30Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536363",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536363"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536363"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536363/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 524,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 525,
    "side": "RIGHT",
    "in_reply_to_id": 748868349
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536456",
    "pull_request_review_id": 814216732,
    "id": 755536456,
    "node_id": "PRRC_kwDOABII584tCJJI",
    "diff_hunk": "@@ -156,25 +153,22 @@ bool SelectCoinsBnB(std::vector<OutputGroup>& utxo_pool, const CAmount& selectio\n \n     // Check for solution\n     if (best_selection.empty()) {\n-        return false;\n+        return std::nullopt;\n     }\n \n     // Set output set\n-    value_ret = 0;\n     for (size_t i = 0; i < best_selection.size(); ++i) {\n         if (best_selection.at(i)) {\n-            util::insert(out_set, utxo_pool.at(i).m_outputs);\n-            value_ret += utxo_pool.at(i).m_value;\n+            result.AddInput(utxo_pool.at(i));\n         }\n     }\n \n-    return true;\n+    return std::make_optional(result);",
    "path": "src/wallet/coinselection.cpp",
    "position": null,
    "original_position": 49,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "No, changed to just `return result`.",
    "created_at": "2021-11-23T22:03:41Z",
    "updated_at": "2021-11-23T22:03:41Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536456",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536456"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536456"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536456/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 166,
    "side": "RIGHT",
    "in_reply_to_id": 748870402
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536553",
    "pull_request_review_id": 814216858,
    "id": 755536553,
    "node_id": "PRRC_kwDOABII584tCJKp",
    "diff_hunk": "@@ -373,76 +373,72 @@ std::vector<OutputGroup> GroupOutputs(const CWallet& wallet, const std::vector<C\n     return groups_out;\n }\n \n-bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n-                                 std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n+                               const CoinSelectionParams& coin_selection_params)\n {\n-    setCoinsRet.clear();\n-    nValueRet = 0;\n-    // Vector of results for use with waste calculation\n-    // In order: calculated waste, selected inputs, selected input value (sum of input values)\n-    // TODO: Use a struct representing the selection result\n-    std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n+    // Vector of result and waste pairs. We will choose the best one based on waste.\n+    std::vector<std::pair<SelectionResult, CAmount>> results;\n \n     // Note that unlike KnapsackSolver, we do not include the fee for creating a change output as BnB will not create a change output.\n     std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, true /* positive_only */);\n-    std::set<CInputCoin> bnb_coins;\n-    CAmount bnb_value;\n-    if (SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change, bnb_coins, bnb_value)) {\n-        const auto waste = GetSelectionWaste(bnb_coins, /* cost of change */ CAmount(0), nTargetValue, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(bnb_coins), bnb_value));\n+    std::optional<SelectionResult> bnb_result = SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change);\n+    if (bnb_result) {",
    "path": "src/wallet/spend.cpp",
    "position": null,
    "original_position": 26,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2021-11-23T22:03:52Z",
    "updated_at": "2021-11-23T22:03:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536553",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536553"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755536553"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755536553/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 384,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 385,
    "side": "RIGHT",
    "in_reply_to_id": 748870890
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537255",
    "pull_request_review_id": 814217814,
    "id": 755537255,
    "node_id": "PRRC_kwDOABII584tCJVn",
    "diff_hunk": "@@ -373,76 +373,72 @@ std::vector<OutputGroup> GroupOutputs(const CWallet& wallet, const std::vector<C\n     return groups_out;\n }\n \n-bool AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n-                                 std::set<CInputCoin>& setCoinsRet, CAmount& nValueRet, const CoinSelectionParams& coin_selection_params)\n+std::optional<SelectionResult> AttemptSelection(const CWallet& wallet, const CAmount& nTargetValue, const CoinEligibilityFilter& eligibility_filter, std::vector<COutput> coins,\n+                               const CoinSelectionParams& coin_selection_params)\n {\n-    setCoinsRet.clear();\n-    nValueRet = 0;\n-    // Vector of results for use with waste calculation\n-    // In order: calculated waste, selected inputs, selected input value (sum of input values)\n-    // TODO: Use a struct representing the selection result\n-    std::vector<std::tuple<CAmount, std::set<CInputCoin>, CAmount>> results;\n+    // Vector of result and waste pairs. We will choose the best one based on waste.\n+    std::vector<std::pair<SelectionResult, CAmount>> results;\n \n     // Note that unlike KnapsackSolver, we do not include the fee for creating a change output as BnB will not create a change output.\n     std::vector<OutputGroup> positive_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, true /* positive_only */);\n-    std::set<CInputCoin> bnb_coins;\n-    CAmount bnb_value;\n-    if (SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change, bnb_coins, bnb_value)) {\n-        const auto waste = GetSelectionWaste(bnb_coins, /* cost of change */ CAmount(0), nTargetValue, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(bnb_coins), bnb_value));\n+    std::optional<SelectionResult> bnb_result = SelectCoinsBnB(positive_groups, nTargetValue, coin_selection_params.m_cost_of_change);\n+    if (bnb_result) {\n+        results.push_back(std::make_pair(*bnb_result, bnb_result->GetWaste(CAmount(0))));\n     }\n \n     // The knapsack solver has some legacy behavior where it will spend dust outputs. We retain this behavior, so don't filter for positive only here.\n     std::vector<OutputGroup> all_groups = GroupOutputs(wallet, coins, coin_selection_params, eligibility_filter, false /* positive_only */);\n     // While nTargetValue includes the transaction fees for non-input things, it does not include the fee for creating a change output.\n     // So we need to include that for KnapsackSolver as well, as we are expecting to create a change output.\n-    std::set<CInputCoin> knapsack_coins;\n-    CAmount knapsack_value;\n-    if (KnapsackSolver(nTargetValue + coin_selection_params.m_change_fee, all_groups, knapsack_coins, knapsack_value)) {\n-        const auto waste = GetSelectionWaste(knapsack_coins, coin_selection_params.m_cost_of_change, nTargetValue + coin_selection_params.m_change_fee, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(knapsack_coins), knapsack_value));\n+    std::optional<SelectionResult> knapsack_result = KnapsackSolver(all_groups, nTargetValue + coin_selection_params.m_change_fee);\n+    if (knapsack_result) {\n+        results.push_back(std::make_pair(*knapsack_result, knapsack_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     // We include the minimum final change for SRD as we do want to avoid making really small change.\n     // KnapsackSolver does not need this because it includes MIN_CHANGE internally.\n     const CAmount srd_target = nTargetValue + coin_selection_params.m_change_fee + MIN_FINAL_CHANGE;\n     auto srd_result = SelectCoinsSRD(positive_groups, srd_target);\n     if (srd_result != std::nullopt) {\n-        const auto waste = GetSelectionWaste(srd_result->first, coin_selection_params.m_cost_of_change, srd_target, !coin_selection_params.m_subtract_fee_outputs);\n-        results.emplace_back(std::make_tuple(waste, std::move(srd_result->first), srd_result->second));\n+        results.push_back(std::make_pair(*srd_result, srd_result->GetWaste(coin_selection_params.m_cost_of_change)));\n     }\n \n     if (results.size() == 0) {\n         // No solution found\n-        return false;\n+        return std::nullopt;\n     }\n \n     // Choose the result with the least waste\n     // If the waste is the same, choose the one which spends more inputs.\n-    const auto& best_result = std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b) {\n-        return std::get<0>(a) < std::get<0>(b) || (std::get<0>(a) == std::get<0>(b) && std::get<1>(a).size() > std::get<1>(b).size());\n+    auto [best_result, waste] = *std::min_element(results.begin(), results.end(), [](const auto& a, const auto& b){\n+        const auto [a_result, a_waste] = a;\n+        const auto [b_result, b_waste] = b;\n+        return a_waste < b_waste || (a_waste == b_waste && a_result.m_selected_inputs.size() > b_result.m_selected_inputs.size());",
    "path": "src/wallet/spend.cpp",
    "position": null,
    "original_position": 67,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I didn't want to always be computing waste every time, especially because we may not have access to information such as the cost of change. So the approach I've done for this is to have a function which computes and stores the waste inside of `SelectionResult`, and then `operator<` will use that when doing the comparison.",
    "created_at": "2021-11-23T22:05:17Z",
    "updated_at": "2021-11-23T22:05:17Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537255",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537255"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537255"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537255/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": 413,
    "start_side": "RIGHT",
    "line": null,
    "original_line": 416,
    "side": "RIGHT",
    "in_reply_to_id": 748870994
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537550",
    "pull_request_review_id": 814218152,
    "id": 755537550,
    "node_id": "PRRC_kwDOABII584tCJaO",
    "diff_hunk": "@@ -395,3 +387,30 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+CAmount SelectionResult::GetSelectedValue() const\n+{\n+    CAmount ret = 0;\n+    for (const auto& coin : m_selected_inputs) {\n+        ret += coin.txout.nValue;\n+    }\n+    return ret;\n+}\n+\n+void SelectionResult::Clear()\n+{\n+    m_selected_inputs.clear();\n+}\n+\n+void SelectionResult::AddInput(const OutputGroup& group)\n+{\n+    util::insert(m_selected_inputs, group.m_outputs);\n+    m_use_effective = !group.m_subtract_fee_outputs;\n+}\n+\n+std::vector<CInputCoin> SelectionResult::GetInputVector() const\n+{\n+    std::vector<CInputCoin> coins(m_selected_inputs.begin(), m_selected_inputs.end());\n+    Shuffle(coins.begin(), coins.end(), FastRandomContext());",
    "path": "src/wallet/coinselection.cpp",
    "position": 191,
    "original_position": 187,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I've added `GetInputSet` to just return `m_selected_inputs` and changed this to be `GetShuffledInputVector`.",
    "created_at": "2021-11-23T22:05:44Z",
    "updated_at": "2021-11-23T22:05:45Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537550",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537550"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537550"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537550/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 425,
    "original_line": 425,
    "side": "RIGHT",
    "in_reply_to_id": 755390185
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537591",
    "pull_request_review_id": 814218231,
    "id": 755537591,
    "node_id": "PRRC_kwDOABII584tCJa3",
    "diff_hunk": "@@ -369,6 +356,11 @@ CAmount OutputGroup::GetSelectionAmount() const\n     return m_subtract_fee_outputs ? m_value : effective_value;\n }\n \n+CAmount SelectionResult::GetWaste(CAmount change_cost) const\n+{\n+    return GetSelectionWaste(m_selected_inputs, change_cost, m_target, m_use_effective);\n+}",
    "path": "src/wallet/coinselection.cpp",
    "position": null,
    "original_position": 154,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2021-11-23T22:05:51Z",
    "updated_at": "2021-11-23T22:05:52Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537591",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537591"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537591"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537591/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 362,
    "side": "RIGHT",
    "in_reply_to_id": 755390977
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537641",
    "pull_request_review_id": 814218290,
    "id": 755537641,
    "node_id": "PRRC_kwDOABII584tCJbp",
    "diff_hunk": "@@ -81,10 +84,30 @@ static void add_coin(std::vector<COutput>& coins, CWallet& wallet, const CAmount\n     coins.push_back(output);\n }\n \n-static bool equal_sets(CoinSet a, CoinSet b)\n+/** Check if SelectionResult a is equivalent to SelectionResult b.\n+ * Equivalent means same input values, but maybe different inputs (i.e. same value, different prevout) */\n+bool EquivalentResult(const SelectionResult& a, const SelectionResult& b)",
    "path": "src/wallet/test/coinselector_tests.cpp",
    "position": null,
    "original_position": 46,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done",
    "created_at": "2021-11-23T22:05:57Z",
    "updated_at": "2021-11-23T22:05:57Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537641",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537641"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537641"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537641/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 89,
    "side": "RIGHT",
    "in_reply_to_id": 755393639
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537859",
    "pull_request_review_id": 814218575,
    "id": 755537859,
    "node_id": "PRRC_kwDOABII584tCJfD",
    "diff_hunk": "@@ -395,3 +387,30 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+CAmount SelectionResult::GetSelectedValue() const\n+{\n+    CAmount ret = 0;\n+    for (const auto& coin : m_selected_inputs) {\n+        ret += coin.txout.nValue;\n+    }\n+    return ret;\n+}\n+\n+void SelectionResult::Clear()",
    "path": "src/wallet/coinselection.cpp",
    "position": 172,
    "original_position": 173,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
    "user": {
      "login": "achow101",
      "id": 3782274,
      "node_id": "MDQ6VXNlcjM3ODIyNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3782274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/achow101",
      "html_url": "https://github.com/achow101",
      "followers_url": "https://api.github.com/users/achow101/followers",
      "following_url": "https://api.github.com/users/achow101/following{/other_user}",
      "gists_url": "https://api.github.com/users/achow101/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/achow101/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/achow101/subscriptions",
      "organizations_url": "https://api.github.com/users/achow101/orgs",
      "repos_url": "https://api.github.com/users/achow101/repos",
      "events_url": "https://api.github.com/users/achow101/events{/privacy}",
      "received_events_url": "https://api.github.com/users/achow101/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I had intended to use it in the tests, and with the changes to make `m_selected_inputs` private, it is now being used by those tests.",
    "created_at": "2021-11-23T22:06:22Z",
    "updated_at": "2021-11-23T22:06:23Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537859",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537859"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r755537859"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/755537859/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 406,
    "original_line": 406,
    "side": "RIGHT",
    "in_reply_to_id": 755398596
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756925836",
    "pull_request_review_id": 816037750,
    "id": 756925836,
    "node_id": "PRRC_kwDOABII584tHcWM",
    "diff_hunk": "@@ -395,3 +387,30 @@ CAmount GetSelectionWaste(const std::set<CInputCoin>& inputs, CAmount change_cos\n \n     return waste;\n }\n+\n+CAmount SelectionResult::GetSelectedValue() const\n+{\n+    CAmount ret = 0;\n+    for (const auto& coin : m_selected_inputs) {\n+        ret += coin.txout.nValue;\n+    }\n+    return ret;\n+}\n+\n+void SelectionResult::Clear()\n+{\n+    m_selected_inputs.clear();\n+}\n+\n+void SelectionResult::AddInput(const OutputGroup& group)\n+{\n+    util::insert(m_selected_inputs, group.m_outputs);\n+    m_use_effective = !group.m_subtract_fee_outputs;\n+}\n+\n+std::vector<CInputCoin> SelectionResult::GetInputVector() const\n+{\n+    std::vector<CInputCoin> coins(m_selected_inputs.begin(), m_selected_inputs.end());\n+    Shuffle(coins.begin(), coins.end(), FastRandomContext());",
    "path": "src/wallet/coinselection.cpp",
    "position": 191,
    "original_position": 187,
    "commit_id": "e142d9af81c502a4694565ee6eef7b87ca1c0387",
    "original_commit_id": "c97801c398c7e83ee769b1b6347e2afc9d13cec3",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Thanks!",
    "created_at": "2021-11-25T14:14:03Z",
    "updated_at": "2021-11-25T14:14:03Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r756925836",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756925836"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/22019#discussion_r756925836"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/22019"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/756925836/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 425,
    "original_line": 425,
    "side": "RIGHT",
    "in_reply_to_id": 755390185
  }
]