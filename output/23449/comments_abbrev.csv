RandyMcMillan,2021-11-06 02:41:37,"```\n./contrib/install_db4.sh `pwd`\n```\nfails if  db-4.8.30.NC.tar.gz exists",https://github.com/bitcoin/bitcoin/pull/23449#issuecomment-962378913,962378913,
lsilva01,2021-11-06 04:15:35,Concept ACK,https://github.com/bitcoin/bitcoin/pull/23449#issuecomment-962391594,962391594,
katesalazar,2021-11-06 16:16:26,"> ```\n> ./contrib/install_db4.sh `pwd`\n> ```\n> \n> fails if db-4.8.30.NC.tar.gz exists\n\nThen there is something wrong in lines 54 and 55, right?\n\nhttps://github.com/bitcoin/bitcoin/blob/77a2f5d30c5ecb764b8a7c098492e1f5cdec90f0/contrib/install_db4.sh#L54-L55\n\nThe fix would be in those two lines, not out of the scope of http_get.\n\nHow does it fail exactly?\n",https://github.com/bitcoin/bitcoin/pull/23449#issuecomment-962474158,962474158,
jamesob,2021-11-09 15:22:13,I don't understand - isn't the existing file case already covered in `http_get`? https://github.com/bitcoin/bitcoin/blob/master/contrib/install_db4.sh#L54-L55,https://github.com/bitcoin/bitcoin/pull/23449#issuecomment-964253402,964253402,
katesalazar,2021-11-09 15:50:46,"More generally,\ncould only apply tar extraction unconditionally if http_get performs\nan infinite loop broken when the file is downloaded, not only downloaded but until sha256_check is satisfactory as well, keeping trying new downloads on corrupted download or unexpected content.\n\nOr do http_get and sha256_check abort the whole script when returning unsuccessfully?\n",https://github.com/bitcoin/bitcoin/pull/23449#issuecomment-964280302,964280302,
RandyMcMillan,2021-11-09 17:05:52,Closed - Maybe there was an anomily with MacOS M1 bash shell or the download was being corrupted (thru a vpn). ,https://github.com/bitcoin/bitcoin/pull/23449#issuecomment-964351712,964351712,
MarcoFalke,2021-11-06 08:57:48,So this will skip the BDB_HASH check?,https://github.com/bitcoin/bitcoin/pull/23449#discussion_r744102091,744102091,contrib/install_db4.sh
laanwj,2021-11-08 11:21:40,"For the current logic it would imo be better to write it as a negation so that the `tar` can be factored out:\n```bash\nif [ ! -f ""${BDB_VERSION}.tar.gz"" ]; then\n    http_get ""${BDB_URL}"" ""${BDB_VERSION}.tar.gz"" ""${BDB_HASH}""\nfi\ntar -xzvf ${BDB_VERSION}.tar.gz -C ""$BDB_PREFIX""\n```\nI agree that checking the hash would make (some) sense even if the file exists, though.",https://github.com/bitcoin/bitcoin/pull/23449#discussion_r744630700,744630700,contrib/install_db4.sh
katesalazar,2021-11-08 19:55:13,"> For the current logic it would imo be better to write it as a negation so that the `tar` can be factored out:\n> \n> ```shell\n> if [ ! -f ""${BDB_VERSION}.tar.gz"" ]; then\n>     http_get ""${BDB_URL}"" ""${BDB_VERSION}.tar.gz"" ""${BDB_HASH}""\n> fi\n> tar -xzvf ${BDB_VERSION}.tar.gz -C ""$BDB_PREFIX""\n> ```\n\nThat suggestion is good if http_get exits upon failure.\n\nYou are not proposing ",https://github.com/bitcoin/bitcoin/pull/23449#discussion_r745047345,745047345,contrib/install_db4.sh
RandyMcMillan,2021-11-09 07:43:55,changed to `if not exist` logic,https://github.com/bitcoin/bitcoin/pull/23449#discussion_r745355746,745355746,contrib/install_db4.sh
