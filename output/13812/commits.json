[
  {
    "sha": "23fbbb100f63cb621b4b901dac0c0f16d7d74bc7",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyM2ZiYmIxMDBmNjNjYjYyMWI0YjkwMWRhYzBjMGYxNmQ3ZDc0YmM3",
    "commit": {
      "author": {
        "name": "Karl-Johan Alm",
        "email": "kalle.alm@gmail.com",
        "date": "2018-07-30T19:42:41Z"
      },
      "committer": {
        "name": "Karl-Johan Alm",
        "email": "kalle.alm@gmail.com",
        "date": "2018-07-30T19:54:41Z"
      },
      "message": "wallet: sum ancestors rather than taking max in output groups",
      "tree": {
        "sha": "a0e2a633d738d5f7fd58854fa4342c23fa41e89f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a0e2a633d738d5f7fd58854fa4342c23fa41e89f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/23fbbb100f63cb621b4b901dac0c0f16d7d74bc7",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEErUlxdBTNVHClHtLKVHT79SJ7760FAltfbQEACgkQVHT79SJ7\n761CrxAAw9DRvxdRI05R5rm2k7FVBOuF3/tmLbbbNq+kNWU0vACEy3qxY09lja+s\nQSV3ktFd7N4HR6FM1hfp5PSXPIv8x67Hhw9ZFYmJGKJG+PqjNnmQtZzDUiYNpI2h\ni4uSvkdyYslq/CV3SD4HGM2/m1rMtJqQzRMfkfrHkAyhaAxvFOqrEbeemCVckE0z\nOQ9VhZuggGBcGwkCThyKRo7vzirjyz2LM40z6N2UKsoZmirDFwLEa1r4w3j+zDtG\nflQdASaZm+JmKMmCeRDXaJHdbwPJL/QmMnvmMwoG5yUcTiN9es983Z7B0rLLoDz/\n4TUB+EKbWujfFtD1b2XiuZk64Urx815OVVVjvMQrJ/BoFffQGjh4Pl/c5CbfJx1x\nPLO9PiPrdl5erIARxzkqAnuNuLPkbR1kNmd2Z4IO+pnYwA7Go7GG+X1ztCTJ8Rg+\nRm/WVFhAWoaXP+LOt9tS2K5rNavA6kMeBct6UIg/mWPQb3UgNqRfYLSq6jTIX95f\nZSwnytUl3WByDSN063l8XuAZLAXoDJW8ruQBMEh7/FQ5gmkc3ZCkV/4S5qUImW/6\nDuab6N2UqySDwpOt/OUKxY4ec5Ak8yibC0fvShKafNlo1E3EYngQslhZQr3CVjiV\nO9ZrWVejZY+nf753ehw1AQ6vcXmmbScfa7+VnPHaAyWZXCwdAfc=\n=+R1H\n-----END PGP SIGNATURE-----",
        "payload": "tree a0e2a633d738d5f7fd58854fa4342c23fa41e89f\nparent 4d550ffab64d79a44fcaa76f6e30c28f01614d3f\nauthor Karl-Johan Alm <kalle.alm@gmail.com> 1532979761 +0900\ncommitter Karl-Johan Alm <kalle.alm@gmail.com> 1532980481 +0900\n\nwallet: sum ancestors rather than taking max in output groups\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/23fbbb100f63cb621b4b901dac0c0f16d7d74bc7",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/23fbbb100f63cb621b4b901dac0c0f16d7d74bc7",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/23fbbb100f63cb621b4b901dac0c0f16d7d74bc7/comments",
    "author": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4d550ffab64d79a44fcaa76f6e30c28f01614d3f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4d550ffab64d79a44fcaa76f6e30c28f01614d3f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4d550ffab64d79a44fcaa76f6e30c28f01614d3f"
      }
    ],
    "stats": {
      "total": 12,
      "additions": 6,
      "deletions": 6
    },
    "files": [
      {
        "sha": "710146ef96f0a396ac11332fed921b5baf3389d5",
        "filename": "src/wallet/coinselection.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 6,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/23fbbb100f63cb621b4b901dac0c0f16d7d74bc7/src/wallet/coinselection.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/23fbbb100f63cb621b4b901dac0c0f16d7d74bc7/src/wallet/coinselection.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/coinselection.cpp?ref=23fbbb100f63cb621b4b901dac0c0f16d7d74bc7",
        "patch": "@@ -299,12 +299,12 @@ void OutputGroup::Insert(const CInputCoin& output, int depth, bool from_me, size\n     m_from_me &= from_me;\n     m_value += output.effective_value;\n     m_depth = std::min(m_depth, depth);\n-    // m_ancestors is currently the max ancestor count for all coins in the group; however, this is\n-    // not ideal, as a wallet will consider e.g. thirty 2-ancestor coins as having two ancestors,\n-    // when in reality it has 60 ancestors.\n-    m_ancestors = std::max(m_ancestors, ancestors);\n-    // m_descendants is the count as seen from the top ancestor, not the descendants as seen from the\n-    // coin itself; thus, this value is accurate\n+    // ancestors here express the number of ancestors the new coin will end up having, which is\n+    // the sum, rather than the max; this will overestimate in the cases where multiple inputs\n+    // have common ancestors\n+    m_ancestors += ancestors;\n+    // descendants is the count as seen from the top ancestor, not the descendants as seen from the\n+    // coin itself; thus, this value is counted as the max, not the sum\n     m_descendants = std::max(m_descendants, descendants);\n     effective_value = m_value;\n }"
      }
    ]
  }
]