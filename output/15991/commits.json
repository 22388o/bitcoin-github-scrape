[
  {
    "sha": "97f517dd851450b1ede1eb6b20f77691883a7737",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5N2Y1MTdkZDg1MTQ1MGIxZWRlMWViNmIyMGY3NzY5MTg4M2E3NzM3",
    "commit": {
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2019-05-09T11:56:01Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2019-06-11T08:21:40Z"
      },
      "message": "Fix RPC/pruneblockchain returned prune height",
      "tree": {
        "sha": "2506286631d845dcd13f7a04f011e6df91d4b5f7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2506286631d845dcd13f7a04f011e6df91d4b5f7"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/97f517dd851450b1ede1eb6b20f77691883a7737",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEyhopCNzi8TB0xizeHrd2uwPHki0FAlz/ZJQACgkQHrd2uwPH\nki2wTA/+MVvpkKQpvqGO6LiuRijcV3mVo0nKZzMgQOfczgH6el7Rm6lq7jZ/trzK\nz6HbhCWsVCLIaeN4ASJUp6qH5DOVUw9vtV93EDGW/zJjMUkNTcjC3QKqpCZq/VZ9\nR/V3UAdVCQnW1PzgEOum71Ruh+S7M8W/6mMKLsaQCcOFmJPjTCmRKu5RJNjAFzYH\nxILAFdKsEJDkg5nztFJcl4iftH0UoqHdVoSe7RU96qConqzQAPid8RZP6R2I9LOK\nazZfGDIJN356HY43fhdV+ez5D2lAzFD95hU91cVx+hEhZwopsds5WaGClOJ0YGWv\n8yjUmpkhD5ZIQF4451w7VN8agjZo+Ga+qeytI22nvRcno6sqMMIFi6BhoTPnLawX\nUgroboD1CWFADCihoGeP9wUis7nfsp+v0gYPrBBlTZWxvqzPkk/Omm69NRg5NxbS\nrDy/OK9LVupMh/gaf16Rb7yNSxezDmR+cdikKd0uiOmr38CYrGJsSU6+sIrzeutQ\noI8mBnVcq7GFPO+nkjFsEzJAN7lowIEGSPJdKzVvF+flm+SgHKCYil4pcvf6vjal\nVVbh5OMxXPnFIEK2bWGxHynUBGQAaQbCuoZOA1AcrsuniiHEJhOwg3bxQ/nuwWeE\nsdTi/U8gOVCOYN0oLc59nlRp+Q0CGsGqAhdC88djOzAxq+Fe8NA=\n=zUt+\n-----END PGP SIGNATURE-----",
        "payload": "tree 2506286631d845dcd13f7a04f011e6df91d4b5f7\nparent 8a503a6c6dd419921373f45d7aa6f1787c9b8884\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1557402961 +0200\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1560241300 +0200\n\nFix RPC/pruneblockchain returned prune height\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/97f517dd851450b1ede1eb6b20f77691883a7737",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/97f517dd851450b1ede1eb6b20f77691883a7737",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/97f517dd851450b1ede1eb6b20f77691883a7737/comments",
    "author": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "8a503a6c6dd419921373f45d7aa6f1787c9b8884",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8a503a6c6dd419921373f45d7aa6f1787c9b8884",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/8a503a6c6dd419921373f45d7aa6f1787c9b8884"
      }
    ],
    "stats": {
      "total": 7,
      "additions": 6,
      "deletions": 1
    },
    "files": [
      {
        "sha": "50c4589d9f9d82a5eaf241502f10aae9c69e2296",
        "filename": "src/rpc/blockchain.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 1,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/97f517dd851450b1ede1eb6b20f77691883a7737/src/rpc/blockchain.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/97f517dd851450b1ede1eb6b20f77691883a7737/src/rpc/blockchain.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/blockchain.cpp?ref=97f517dd851450b1ede1eb6b20f77691883a7737",
        "patch": "@@ -1061,7 +1061,12 @@ static UniValue pruneblockchain(const JSONRPCRequest& request)\n     }\n \n     PruneBlockFilesManual(height);\n-    return uint64_t(height);\n+    const CBlockIndex* block = ::ChainActive().Tip();\n+    assert(block);\n+    while (block->pprev && (block->pprev->nStatus & BLOCK_HAVE_DATA)) {\n+        block = block->pprev;\n+    }\n+    return uint64_t(block->nHeight);\n }\n \n static UniValue gettxoutsetinfo(const JSONRPCRequest& request)"
      }
    ]
  },
  {
    "sha": "f402012ccfc596d7d94851dabbf386c278ff5335",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmNDAyMDEyY2NmYzU5NmQ3ZDk0ODUxZGFiYmYzODZjMjc4ZmY1MzM1",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-05-25T09:59:52Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2019-06-11T08:21:52Z"
      },
      "message": "fixup: Fix prunning test",
      "tree": {
        "sha": "84ad87e15bbfb7f05f26dad88ce27c601b54cfdb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/84ad87e15bbfb7f05f26dad88ce27c601b54cfdb"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f402012ccfc596d7d94851dabbf386c278ff5335",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEyhopCNzi8TB0xizeHrd2uwPHki0FAlz/ZKAACgkQHrd2uwPH\nki1bFhAAn1uDKtE1mNUjPuWWCBkHBOX6vp8OB9DAzpq0Z/sPCp3ISQo9lyPLeQuK\nNnV8JV0yO6UHH08BGtLZQkPdYSg9ZJU75Wj1tO+bgAUw8vqdMuZ8R8xpGtITtn+E\nT68vqwjjV76ZlkjLV+WvFO1A5SyOI4G6VEImsInWL0/1qd2Wov5KrVuehfv0Ju1P\nRwFz/VEJVCkGbyvldkEW4DAjYUY2Kz4t+90h4sRm+rBv9U0TCFU+JB6qvDT5CWPH\nIw47gC7IQYl1ravE7aQlh/Eu0cUsx3TScOmAlTu8hVXcMAOdqsX2dGCZPagEbsQb\nyITD0DwVr/0mxN+97tB1NcigPRm4JOL6kIr/7qgaQ/P6PAfwVrA91v9u8VTqkwou\nvOGqTOG5gWrlCLoRwg6KMD9PvUFijDTqbNWQtmJQwTVB2K2KW7sCzbsmgIxguRds\nZYiYYFGlzp6XhfTehoiLtE46Sf9oiw8cfSMLolB3aQFtPdd5loLlLN1QvOljc2JQ\nFbfHyJX77Hyf2RR/cchBnwFC0Er0h9Zlaialb1owdynXkd4+v1kikD12jPhs9bvL\nOiT2xgWp9UsyBr03DQF8MESSR2B8crgDnbVcKnQimLxvg7tJFjWuKfpRTXLXM4Di\nGwyRrg7At66MUt3FuFAPtbg1NFbkp6qtDCh5HilhRlVQdSfjiqo=\n=B0Ga\n-----END PGP SIGNATURE-----",
        "payload": "tree 84ad87e15bbfb7f05f26dad88ce27c601b54cfdb\nparent 97f517dd851450b1ede1eb6b20f77691883a7737\nauthor Jo\u00e3o Barbosa <joao.paulo.barbosa@gmail.com> 1558778392 +0100\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1560241312 +0200\n\nfixup: Fix prunning test\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f402012ccfc596d7d94851dabbf386c278ff5335",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f402012ccfc596d7d94851dabbf386c278ff5335",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f402012ccfc596d7d94851dabbf386c278ff5335/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "97f517dd851450b1ede1eb6b20f77691883a7737",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/97f517dd851450b1ede1eb6b20f77691883a7737",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/97f517dd851450b1ede1eb6b20f77691883a7737"
      }
    ],
    "stats": {
      "total": 19,
      "additions": 3,
      "deletions": 16
    },
    "files": [
      {
        "sha": "66c395d7a2e09d74ef78400f2cd3749f842f2bd2",
        "filename": "test/functional/feature_pruning.py",
        "status": "modified",
        "additions": 3,
        "deletions": 16,
        "changes": 19,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f402012ccfc596d7d94851dabbf386c278ff5335/test/functional/feature_pruning.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f402012ccfc596d7d94851dabbf386c278ff5335/test/functional/feature_pruning.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_pruning.py?ref=f402012ccfc596d7d94851dabbf386c278ff5335",
        "patch": "@@ -23,8 +23,6 @@\n     wait_until,\n )\n \n-MIN_BLOCKS_TO_KEEP = 288\n-\n # Rescans start at the earliest block up to 2 hours before a key timestamp, so\n # the manual prune RPC avoids pruning blocks in the same window to be\n # compatible with pruning based on key creation time.\n@@ -273,20 +271,9 @@ def height(index):\n             else:\n                 return index\n \n-        def prune(index, expected_ret=None):\n+        def prune(index):\n             ret = node.pruneblockchain(height=height(index))\n-            # Check the return value. When use_timestamp is True, just check\n-            # that the return value is less than or equal to the expected\n-            # value, because when more than one block is generated per second,\n-            # a timestamp will not be granular enough to uniquely identify an\n-            # individual block.\n-            if expected_ret is None:\n-                expected_ret = index\n-            if use_timestamp:\n-                assert_greater_than(ret, 0)\n-                assert_greater_than(expected_ret + 1, ret)\n-            else:\n-                assert_equal(ret, expected_ret)\n+            assert_equal(ret, node.getblockchaininfo()['pruneheight'])\n \n         def has_block(index):\n             return os.path.isfile(os.path.join(self.nodes[node_number].datadir, \"regtest\", \"blocks\", \"blk{:05}.dat\".format(index)))\n@@ -326,7 +313,7 @@ def has_block(index):\n         assert not has_block(1), \"blk00001.dat is still there, should be pruned by now\"\n \n         # height=1000 should not prune anything more, because tip-288 is in blk00002.dat.\n-        prune(1000, 1001 - MIN_BLOCKS_TO_KEEP)\n+        prune(1000)\n         assert has_block(2), \"blk00002.dat is still there, should be pruned by now\"\n \n         # advance the tip so blk00002.dat and blk00003.dat can be pruned (the last 288 blocks should now be in blk00004.dat)"
      }
    ]
  }
]