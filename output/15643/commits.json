[
  {
    "sha": "fa1c073154c6a39dca878f5c9a37abee8af0fd30",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTFjMDczMTU0YzZhMzlkY2E4NzhmNWM5YTM3YWJlZThhZjBmZDMw",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-03-22T16:15:04Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-03-22T16:03:04Z"
      },
      "message": "contrib: gh-merge: Include review comments in merge commit",
      "tree": {
        "sha": "5c97f0c4ad1afe8b254cc0a2a84f50f7df955b59",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5c97f0c4ad1afe8b254cc0a2a84f50f7df955b59"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa1c073154c6a39dca878f5c9a37abee8af0fd30",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGcBAABCgAGBQJcKq2AAAoJEM4rdWl+aaVIkxQL/iLC+FohJDVUcvm8jACqIkYw\nFhlZ3VOhGGH3rJihyyoa15aRQeMh0edNyDSjaigjm7fTwWHndbfeRjpYY5wIvVom\nwDPAz7S2tlrrd6jhT19xrTp5K0MHpKCGGQz0K9MUehQYEJASEv6EiGcnQoeVv9SL\nRbOd3moeUMSejJNm0ete2hTVVDSIeyL4lGSUsmbYf7dw+v2pmgIFTkIvuooNblGd\nMEJbIGKb+Zj0oftCTli5UTmDvin0LmDK0+sM6802NMWZbENv4r5eFIKYvhG3xsLR\nhV+JCNw4Fkk9jjj/5D0Mo7bANJ5Rvj2ROg9U3fgIxOt9uXej2Oy4SyaD4RrwSJga\n7egDgtIg980ED8UAU/hZDCtU+pP/4yk+RZiYBTN5wn+0kS5PWKXbi3rtNbosfTLT\nmr4POh+8CnE5pJND5ykDh6kaAtnztLzt/riNOBTvx1fU+EcXJwU4ixoSMcuH7QEP\nE6za7dBdAHP3Tql1d2vwPIzpznHqx8Cs96JZeC3NLQ==\n=waUO\n-----END PGP SIGNATURE-----",
        "payload": "tree 5c97f0c4ad1afe8b254cc0a2a84f50f7df955b59\nparent c033c4b5cef89a654e4d9d5c5f9bd823871b068b\nauthor MarcoFalke <falke.marco@gmail.com> 1553271304 -0400\ncommitter MarcoFalke <falke.marco@gmail.com> 1553270584 -0400\n\ncontrib: gh-merge: Include review comments in merge commit\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa1c073154c6a39dca878f5c9a37abee8af0fd30",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa1c073154c6a39dca878f5c9a37abee8af0fd30",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa1c073154c6a39dca878f5c9a37abee8af0fd30/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "c033c4b5cef89a654e4d9d5c5f9bd823871b068b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c033c4b5cef89a654e4d9d5c5f9bd823871b068b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/c033c4b5cef89a654e4d9d5c5f9bd823871b068b"
      }
    ],
    "stats": {
      "total": 33,
      "additions": 29,
      "deletions": 4
    },
    "files": [
      {
        "sha": "41a640b4643381bd776c08f15a7c0e88ae624764",
        "filename": "contrib/devtools/github-merge.py",
        "status": "modified",
        "additions": 29,
        "deletions": 4,
        "changes": 33,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa1c073154c6a39dca878f5c9a37abee8af0fd30/contrib/devtools/github-merge.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa1c073154c6a39dca878f5c9a37abee8af0fd30/contrib/devtools/github-merge.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/devtools/github-merge.py?ref=fa1c073154c6a39dca878f5c9a37abee8af0fd30",
        "patch": "@@ -47,13 +47,12 @@ def git_config_get(option, default=None):\n     except subprocess.CalledProcessError:\n         return default\n \n-def retrieve_pr_info(repo,pull,ghtoken):\n+def retrieve_json(req, ghtoken):\n     '''\n-    Retrieve pull request information from github.\n-    Return None if no title can be found, or an error happens.\n+    Retrieve json from github.\n+    Return None if an error happens.\n     '''\n     try:\n-        req = Request(\"https://api.github.com/repos/\"+repo+\"/pulls/\"+pull)\n         if ghtoken is not None:\n             req.add_header('Authorization', 'token ' + ghtoken)\n         result = urlopen(req)\n@@ -69,6 +68,18 @@ def retrieve_pr_info(repo,pull,ghtoken):\n         print('Warning: unable to retrieve pull information from github: %s' % e)\n         return None\n \n+def retrieve_pr_info(repo,pull,ghtoken):\n+    req = Request(\"https://api.github.com/repos/\"+repo+\"/pulls/\"+pull)\n+    return retrieve_json(req,ghtoken)\n+\n+def retrieve_pr_comments(repo,pull,ghtoken):\n+    req = Request(\"https://api.github.com/repos/\"+repo+\"/issues/\"+pull+\"/comments\")\n+    return retrieve_json(req,ghtoken)\n+\n+def retrieve_pr_reviews(repo,pull,ghtoken):\n+    req = Request(\"https://api.github.com/repos/\"+repo+\"/pulls/\"+pull+\"/reviews\")\n+    return retrieve_json(req,ghtoken)\n+\n def ask_prompt(text):\n     print(text,end=\" \",file=stderr)\n     stderr.flush()\n@@ -133,6 +144,16 @@ def tree_sha512sum(commit='HEAD'):\n         raise IOError('Non-zero return value executing git cat-file')\n     return overall.hexdigest()\n \n+def get_acks_from_comments(head_commit, comments):\n+    assert len(head_commit) == 6\n+    ack_str ='\\n\\nACKs for commit {}:\\n'.format(head_commit)\n+    for c in comments:\n+        review = [l for l in c['body'].split('\\r\\n') if 'ACK' in l and head_commit in l]\n+        if review:\n+            ack_str += '  {}:\\n'.format(c['user']['login'])\n+            ack_str += '    {}\\n'.format(review[0])\n+    return ack_str\n+\n def print_merge_details(pull, title, branch, base_branch, head_branch):\n     print('%s#%s%s %s %sinto %s%s' % (ATTR_RESET+ATTR_PR,pull,ATTR_RESET,title,ATTR_RESET+ATTR_PR,branch,ATTR_RESET))\n     subprocess.check_call([GIT,'log','--graph','--topo-order','--pretty=format:'+COMMIT_FORMAT,base_branch+'..'+head_branch])\n@@ -185,6 +206,9 @@ def main():\n     info = retrieve_pr_info(repo,pull,ghtoken)\n     if info is None:\n         sys.exit(1)\n+    comments = retrieve_pr_comments(repo,pull,ghtoken) + retrieve_pr_reviews(repo,pull,ghtoken)\n+    if comments is None:\n+        sys.exit(1)\n     title = info['title'].strip()\n     body = info['body'].strip()\n     # precedence order for destination branch argument:\n@@ -238,6 +262,7 @@ def main():\n         message = firstline + '\\n\\n'\n         message += subprocess.check_output([GIT,'log','--no-merges','--topo-order','--pretty=format:%h %s (%an)',base_branch+'..'+head_branch]).decode('utf-8')\n         message += '\\n\\nPull request description:\\n\\n  ' + body.replace('\\n', '\\n  ') + '\\n'\n+        message += get_acks_from_comments(head_commit=subprocess.check_output([GIT,'log','-1','--pretty=format:%H',head_branch]).decode('utf-8')[:6], comments=comments)\n         try:\n             subprocess.check_call([GIT,'merge','-q','--commit','--no-edit','--no-ff','-m',message.encode('utf-8'),head_branch])\n         except subprocess.CalledProcessError:"
      }
    ]
  }
]