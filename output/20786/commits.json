[
  {
    "sha": "faecb74562d012a336837d3b39572c235ad2eb9d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYWVjYjc0NTYyZDAxMmEzMzY4MzdkM2IzOTU3MmMyMzVhZDJlYjlk",
    "commit": {
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2021-01-02T09:44:03Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-01-07T14:18:44Z"
      },
      "message": "Expose integral m_conn_type in CNodeStats, remove m_conn_type_string",
      "tree": {
        "sha": "9921c0a213a77cff964a02d084b2ca67513fee7c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9921c0a213a77cff964a02d084b2ca67513fee7c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/faecb74562d012a336837d3b39572c235ad2eb9d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUj8rQv8CKrS19k/M2iJk48NfnKWqFIWcG8MMRESe533O+QDCf3YX5aXv49qkY9C\npbX2TlEAxnUffGm94EVQr3mAgFVI0ObMSMpih4lnqqNnn+PW+xW6aT4u8oV0GNGX\ngSmWXm3eVYZI1PTtJEUrONYfuY34a2eiZfE0R7zEqDBOJUOhRvkkP05/RHtKplw4\n/QHbv8vU2A481G0fKYVacptpCL6oZu7vzz2bjKbx8hjKKJN2128h6f8OyYFfMbRW\ngMhFCRkpn6ctMw5e7hyAURXT665Z6zvfUd4I0et1t9t41ReptvgInHCPJGUs5SYT\nBN9sFN1u379qYLlmPCBEbHxeKbBFDLwMBqM7FzrHtOLEnaoveg9Gis8xyYQD2Z3V\npMnZuR+1JodT2sp/gGiMarwasdQ/sQCZNNGXvtKzWrCb34IYAa6IcT/+9IfQMjgR\nl8dWYQ5LKAssyl0LRikxgNtJMwy1cJNsDjO1pUys5ai2b1iH0K8i+SwXFMv50IiU\nfgbsLeaU\n=SkYf\n-----END PGP SIGNATURE-----",
        "payload": "tree 9921c0a213a77cff964a02d084b2ca67513fee7c\nparent 4b8b71e630415647c75fa95d5407690b372bceff\nauthor Jon Atack <jon@atack.com> 1609580643 +0100\ncommitter MarcoFalke <falke.marco@gmail.com> 1610029124 +0100\n\nExpose integral m_conn_type in CNodeStats, remove m_conn_type_string\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/faecb74562d012a336837d3b39572c235ad2eb9d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/faecb74562d012a336837d3b39572c235ad2eb9d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/faecb74562d012a336837d3b39572c235ad2eb9d/comments",
    "author": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "4b8b71e630415647c75fa95d5407690b372bceff",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4b8b71e630415647c75fa95d5407690b372bceff",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4b8b71e630415647c75fa95d5407690b372bceff"
      }
    ],
    "stats": {
      "total": 15,
      "additions": 8,
      "deletions": 7
    },
    "files": [
      {
        "sha": "6c099306ebd01cae71436f35a45cccf1be6e9d4f",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 3,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/faecb74562d012a336837d3b39572c235ad2eb9d/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/faecb74562d012a336837d3b39572c235ad2eb9d/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=faecb74562d012a336837d3b39572c235ad2eb9d",
        "patch": "@@ -507,9 +507,9 @@ void CConnman::AddWhitelistPermissionFlags(NetPermissionFlags& flags, const CNet\n     }\n }\n \n-std::string CNode::ConnectionTypeAsString() const\n+std::string ConnectionTypeAsString(ConnectionType conn_type)\n {\n-    switch (m_conn_type) {\n+    switch (conn_type) {\n     case ConnectionType::INBOUND:\n         return \"inbound\";\n     case ConnectionType::MANUAL:\n@@ -627,7 +627,7 @@ void CNode::copyStats(CNodeStats &stats, const std::vector<bool> &m_asmap)\n     CService addrLocalUnlocked = GetAddrLocal();\n     stats.addrLocal = addrLocalUnlocked.IsValid() ? addrLocalUnlocked.ToString() : \"\";\n \n-    stats.m_conn_type_string = ConnectionTypeAsString();\n+    X(m_conn_type);\n }\n #undef X\n "
      },
      {
        "sha": "83fdb7f3e5505f82f012a15756c38935caeaa3a0",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 4,
        "deletions": 3,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/faecb74562d012a336837d3b39572c235ad2eb9d/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/faecb74562d012a336837d3b39572c235ad2eb9d/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=faecb74562d012a336837d3b39572c235ad2eb9d",
        "patch": "@@ -180,6 +180,8 @@ enum class ConnectionType {\n     ADDR_FETCH,\n };\n \n+/** Convert ConnectionType enum to a string value */\n+std::string ConnectionTypeAsString(ConnectionType conn_type);\n void Discover();\n void StartMapPort();\n void InterruptMapPort();\n@@ -273,11 +275,10 @@ class CNodeStats\n     // Network the peer connected through\n     Network m_network;\n     uint32_t m_mapped_as;\n-    std::string m_conn_type_string;\n+    ConnectionType m_conn_type;\n };\n \n \n-\n /** Transport protocol agnostic message container.\n  * Ideally it should only contain receive time, payload,\n  * command and size.\n@@ -765,7 +766,7 @@ class CNode\n     //! Sets the addrName only if it was not previously set\n     void MaybeSetAddrName(const std::string& addrNameIn);\n \n-    std::string ConnectionTypeAsString() const;\n+    std::string ConnectionTypeAsString() const { return ::ConnectionTypeAsString(m_conn_type); }\n \n     /** Whether this peer is an inbound onion, e.g. connected via our Tor onion service. */\n     bool IsInboundOnion() const { return m_inbound_onion; }"
      },
      {
        "sha": "ddbd7e9142826c966f09d02cb97fa038cdf82461",
        "filename": "src/rpc/net.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/faecb74562d012a336837d3b39572c235ad2eb9d/src/rpc/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/faecb74562d012a336837d3b39572c235ad2eb9d/src/rpc/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/net.cpp?ref=faecb74562d012a336837d3b39572c235ad2eb9d",
        "patch": "@@ -249,7 +249,7 @@ static RPCHelpMan getpeerinfo()\n                 recvPerMsgCmd.pushKV(i.first, i.second);\n         }\n         obj.pushKV(\"bytesrecv_per_msg\", recvPerMsgCmd);\n-        obj.pushKV(\"connection_type\", stats.m_conn_type_string);\n+        obj.pushKV(\"connection_type\", ConnectionTypeAsString(stats.m_conn_type));\n \n         ret.push_back(obj);\n     }"
      }
    ]
  }
]