[
  {
    "sha": "3fe836b78d504942e8850b607453886969f57e27",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozZmU4MzZiNzhkNTA0OTQyZTg4NTBiNjA3NDUzODg2OTY5ZjU3ZTI3",
    "commit": {
      "author": {
        "name": "Ben Woosley",
        "email": "ben.woosley@gmail.com",
        "date": "2018-07-13T15:49:24Z"
      },
      "committer": {
        "name": "Ben Woosley",
        "email": "ben.woosley@gmail.com",
        "date": "2018-07-14T16:42:28Z"
      },
      "message": "[moveonly] Extract RescanWallet to handle a simple rescan\n\nWhere the outcome does not depend on the result, apart from a simple\nsuccess check.",
      "tree": {
        "sha": "908ed2b2e53c8a2ec6a28bb0b1eafcbbee28f02c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/908ed2b2e53c8a2ec6a28bb0b1eafcbbee28f02c"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3fe836b78d504942e8850b607453886969f57e27",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\nComment: GPGTools - https://gpgtools.org\n\niQEcBAABCgAGBQJbSif2AAoJEG7l83hfeLNFRvQH/0G8C3YBdX6agAL0omxL9ZkC\nfyYXxFtZUs6FF+qEUujC85T+gn+ijhGSffvV8yKV/oHeVzOiTnRFYO1Ovk80oUwT\nH2dVVv2LD6bDCL6rUPktJwumTM6ASwzrwLoadJuYK+LedwpQf3p0MDCdrH+h20vI\nDI6/UZ8f+TyOHnqe14yOI6LpBYrNE/ZHBE99aL5t5tiIjJUSD3Lm87/MI7irJkTF\nrnBuR6baszRU/4hwK15lIcc9rIUVPhwxJK/L5MJ5Ql68ql28UCnS1obhKWmlVq16\njihWcvk1ZVoNY9qZ4ojKdMNVW/iAfQLWI4eIrDdNgYAnER/4BKSZ9uKTAvDECNo=\n=hMYW\n-----END PGP SIGNATURE-----",
        "payload": "tree 908ed2b2e53c8a2ec6a28bb0b1eafcbbee28f02c\nparent b25a4c2284babdf1e8cf0ec3b1402200dd25f33f\nauthor Ben Woosley <ben.woosley@gmail.com> 1531496964 -0400\ncommitter Ben Woosley <ben.woosley@gmail.com> 1531586548 -0400\n\n[moveonly] Extract RescanWallet to handle a simple rescan\n\nWhere the outcome does not depend on the result, apart from a simple\nsuccess check.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3fe836b78d504942e8850b607453886969f57e27",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3fe836b78d504942e8850b607453886969f57e27",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3fe836b78d504942e8850b607453886969f57e27/comments",
    "author": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b25a4c2284babdf1e8cf0ec3b1402200dd25f33f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b25a4c2284babdf1e8cf0ec3b1402200dd25f33f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b25a4c2284babdf1e8cf0ec3b1402200dd25f33f"
      }
    ],
    "stats": {
      "total": 45,
      "additions": 15,
      "deletions": 30
    },
    "files": [
      {
        "sha": "c8e04b35bd2ae62208dc0235037722939c5d0092",
        "filename": "src/wallet/rpcdump.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 28,
        "changes": 43,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3fe836b78d504942e8850b607453886969f57e27/src/wallet/rpcdump.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3fe836b78d504942e8850b607453886969f57e27/src/wallet/rpcdump.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcdump.cpp?ref=3fe836b78d504942e8850b607453886969f57e27",
        "patch": "@@ -86,6 +86,17 @@ static bool GetWalletAddressesForKey(CWallet * const pwallet, const CKeyID &keyi\n     return fLabelFound;\n }\n \n+static const int64_t TIMESTAMP_MIN = 0;\n+\n+static void RescanWallet(CWallet& wallet, const WalletRescanReserver& reserver, int64_t time_begin = TIMESTAMP_MIN, bool update = true)\n+{\n+    int64_t scanned_time = wallet.RescanFromTime(time_begin, reserver, update);\n+    if (wallet.IsAbortingRescan()) {\n+        throw JSONRPCError(RPC_MISC_ERROR, \"Rescan aborted by user.\");\n+    } else if (scanned_time > time_begin) {\n+        throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan was unable to fully rescan the blockchain. Some transactions may be missing.\");\n+    }\n+}\n \n UniValue importprivkey(const JSONRPCRequest& request)\n {\n@@ -172,13 +183,7 @@ UniValue importprivkey(const JSONRPCRequest& request)\n         }\n     }\n     if (fRescan) {\n-        int64_t scanned_time = pwallet->RescanFromTime(TIMESTAMP_MIN, reserver, true /* update */);\n-        if (pwallet->IsAbortingRescan()) {\n-            throw JSONRPCError(RPC_MISC_ERROR, \"Rescan aborted by user.\");\n-        }\n-        if (scanned_time > TIMESTAMP_MIN) {\n-            throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan was unable to fully rescan the blockchain. Some transactions may be missing.\");\n-        }\n+        RescanWallet(*pwallet, reserver);\n     }\n \n     return NullUniValue;\n@@ -318,13 +323,7 @@ UniValue importaddress(const JSONRPCRequest& request)\n     }\n     if (fRescan)\n     {\n-        int64_t scanned_time = pwallet->RescanFromTime(TIMESTAMP_MIN, reserver, true /* update */);\n-        if (pwallet->IsAbortingRescan()) {\n-            throw JSONRPCError(RPC_MISC_ERROR, \"Rescan aborted by user.\");\n-        }\n-        if (scanned_time > TIMESTAMP_MIN) {\n-            throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan was unable to fully rescan the blockchain. Some transactions may be missing.\");\n-        }\n+        RescanWallet(*pwallet, reserver);\n         pwallet->ReacceptWalletTransactions();\n     }\n \n@@ -496,13 +495,7 @@ UniValue importpubkey(const JSONRPCRequest& request)\n     }\n     if (fRescan)\n     {\n-        int64_t scanned_time = pwallet->RescanFromTime(TIMESTAMP_MIN, reserver, true /* update */);\n-        if (pwallet->IsAbortingRescan()) {\n-            throw JSONRPCError(RPC_MISC_ERROR, \"Rescan aborted by user.\");\n-        }\n-        if (scanned_time > TIMESTAMP_MIN) {\n-            throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan was unable to fully rescan the blockchain. Some transactions may be missing.\");\n-        }\n+        RescanWallet(*pwallet, reserver);\n         pwallet->ReacceptWalletTransactions();\n     }\n \n@@ -630,13 +623,7 @@ UniValue importwallet(const JSONRPCRequest& request)\n         pwallet->UpdateTimeFirstKey(nTimeBegin);\n     }\n     uiInterface.ShowProgress(\"\", 100, false); // hide progress dialog in GUI\n-    int64_t scanned_time = pwallet->RescanFromTime(nTimeBegin, reserver, false /* update */);\n-    if (pwallet->IsAbortingRescan()) {\n-        throw JSONRPCError(RPC_MISC_ERROR, \"Rescan aborted by user.\");\n-    }\n-    if (scanned_time > nTimeBegin) {\n-        throw JSONRPCError(RPC_WALLET_ERROR, \"Rescan was unable to fully rescan the blockchain. Some transactions may be missing.\");\n-    }\n+    RescanWallet(*pwallet, reserver, nTimeBegin, false /* update */);\n     pwallet->MarkDirty();\n \n     if (!fGood)"
      },
      {
        "sha": "6394ce1c23eaccc7086333c18665dede0133c2a0",
        "filename": "src/wallet/wallet.h",
        "status": "modified",
        "additions": 0,
        "deletions": 2,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3fe836b78d504942e8850b607453886969f57e27/src/wallet/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3fe836b78d504942e8850b607453886969f57e27/src/wallet/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.h?ref=3fe836b78d504942e8850b607453886969f57e27",
        "patch": "@@ -62,8 +62,6 @@ static const bool DEFAULT_WALLET_RBF = false;\n static const bool DEFAULT_WALLETBROADCAST = true;\n static const bool DEFAULT_DISABLE_WALLET = false;\n \n-static const int64_t TIMESTAMP_MIN = 0;\n-\n class CBlockIndex;\n class CCoinControl;\n class COutput;"
      }
    ]
  }
]