laanwj,2013-12-11T06:18:05Z,"I've synced both the testnet and mainnet chain with this patch applied (from the network), I've had no problems, and no apparent difference in speed.\n",https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-30297438,30297438,
sipa,2013-12-11T10:49:02Z,@laanwj It's not being able to sync I'm worried about. It must however also deal well with invalid blocks and orphans. I'll do a local pulltester run next weekend to see what goes wrong.\n,https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-30310472,30310472,
sipa,2013-12-14T14:38:19Z,"Rebased, and fixed two bugs that PullTester found (thanks, @TheBlueMatt!):\n- Blocks with potential corruption weren't removed from mapAlreadyAskedFor, so they weren't downloaded again.\n- When checking for a new most-work chain, only blocks that weren't in the previous most-work chain were checked for errors, instead of all blocks that weren't already active.\n",https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-30574859,30574859,
sipa,2013-12-20T21:39:50Z,Can I have some reviews? @gavinandresen @laanwj @gmaxwell @jgarzik \n,https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-31043791,31043791,
sipa,2013-12-22T16:48:02Z,"Update: mapBlockSource now also stores source information for orphan blocks. That means that we can potentially assign them a DoS score if their block is found to be invalid later on. It also means we can potentially send them a ""reject"" message for it.\n",https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-31090837,31090837,
sipa,2013-12-23T22:43:20Z,Reverted to an older version... let's see if pulltester likes it again :(\n,https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-31148397,31148397,
TheBlueMatt,2013-12-23T23:09:11Z,Are you sure it's not pull testers  fault?\n,https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-31149370,31149370,
sipa,2013-12-23T23:14:04Z,"I think it is indeterminism. I've seen report 1, 6 and 8 blocks which differ. Maybe I was just lucky the first time that it worked as expected.\n",https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-31149538,31149538,
TheBlueMatt,2013-12-23T23:15:57Z,doesn't mean it's not pull testers not broken... It certainly doesn't take kindly to changing the download algorithm.\n,https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-31149600,31149600,
sipa,2013-12-23T23:19:01Z,"Right the now, the rule this branch should be following is that in case of multiple valid equal-work chains, the one where the tip block was received first is chosen.\n",https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-31149728,31149728,
TheBlueMatt,2013-12-23T23:26:07Z,I'm not sure that that's the same as master in all cases? though I doubt pull tester would identify the difference.\n,https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-31149982,31149982,
sipa,2013-12-23T23:30:10Z,"I'm not sure that's the same as master either, though I can't immediately comeup with a scenario where it differs.\n\nThe question is first: is this rule acceptable (imho, if it differs with the current behaviour, i prefer this clearer rule). If so, can we have pulltester tolerate it? :)\n",https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-31150138,31150138,
TheBlueMatt,2013-12-23T23:34:44Z,If the rule is different on any more than non existent cases it's a different network consensus which could be problematic. Ideally pull tester should identify any difference in network consensus unless we can come up with a proof that it can never matter.\n,https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-31150339,31150339,
sipa,2013-12-23T23:43:55Z,"Right, agree. Though it feels like we're not actually understanding well enough what the behaviour of the current code is, in non-trivial reorganization cases. My intuition says that as long as you select one of the valid highest-pow chains, and there is no way to make a node switch to an equal-work chain when it already has one, we should always converge - but perhaps we need to think harder abou",https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-31150656,31150656,
TheBlueMatt,2013-12-24T00:03:06Z,"Yes, no question this needs simulation and study. Until then, I'm not comfortable with any, even subtle, changes to the best chain selection.\n",https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-31151317,31151317,
laanwj,2013-12-24T07:52:34Z,"Does headers-first download need a behavior change there, or is it just by accident and can it be corrected?\n",https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-31162392,31162392,
sipa,2013-12-25T20:04:49Z,"@laanwj I'm pretty sure it's possible to recreate the old behavior in a headers-first compatible implementation, but I'd rather not. I like having a clear rule about what the intended behavior is, and have that implemented.\n\nAfter having thought a bit about this, this is a case where the old and new implementation differ, IIRC:\n- The following setup exists: A->B and A->C. Now an orphan E is ann",https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-31204554,31204554,
TheBlueMatt,2013-12-25T20:26:21Z,"Yes, actually I believe this (and similar cases) are what pull tester is tickling. The latest run tickles a few cases:\n- b8 is an invalid block built on an equal-work fork (b7). pull-tester expects to stay on b6 (the previous best chain), but this pull appears to switch to b7.\n- b11 is the same case with b11 being invalid in a different way (too much fee vs double-spend).\n- b13/b14 is:\n\n```\n",https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-31204808,31204808,
sipa,2013-12-25T22:41:10Z,Seems there was a bug in my code - the Comparator for CBlockIndex objects compared pb->nSequenceId with itself rather than with pa->nSequenceId. I remember fixing this bug before - perhaps I lost some git commit. Let's see.\n,https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-31206453,31206453,
sipa,2013-12-25T22:56:18Z,Ha...\n,https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-31206622,31206622,
TheBlueMatt,2013-12-25T23:05:44Z,Works for me\n,https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-31206735,31206735,
sipa,2013-12-27T15:40:38Z,"Merged two commits, and added some comments.\n\nAlso some earlier changes, which got lost because they were commented on by @mikehearn in commits that have since been rebased:\n- Changed to a global sequence number for received blocks instead of a timestamp.\n- Removed interruption points that could result in a non-best-known-chain to be observed externally.\n",https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-31267042,31267042,
BitcoinPullTester,2014-01-27T21:35:36Z,"Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/75f51f2a63e0ebe34ab290c2b7141dd240b98c3b for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/cu",https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-33425574,33425574,
gavinandresen,2014-01-29T21:48:44Z,ACK.\n,https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-33634972,33634972,
gavinandresen,2014-01-29T21:49:12Z,Merging; got ACKs from me and @jgarzik in #3514 \n,https://github.com/bitcoin/bitcoin/pull/3370#issuecomment-33635032,33635032,
laanwj,2013-12-21T09:45:18Z,"You're dereferencing a pointer and putting it into a reference, making it impossible to check for NULL, which can be returned from State(). Could this ever be an issue?\n",https://github.com/bitcoin/bitcoin/pull/3370#discussion_r8516992,8516992,src/main.cpp
sipa,2013-12-22T16:46:28Z,"The main-specific node state is created when a CNode is created, and destroyed when it is deleted (called from constructor and destructor). This means that for an existing CNode (pto in this case), state will always exist. When using a stored NodeId, the chance exists that it has been deleted in the mean time.\n",https://github.com/bitcoin/bitcoin/pull/3370#discussion_r8520442,8520442,src/main.cpp
