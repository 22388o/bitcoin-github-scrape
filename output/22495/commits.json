[
  {
    "sha": "8858e88c840197cdcabea07dd1380ef2aa4ece02",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4ODU4ZTg4Yzg0MDE5N2NkY2FiZWEwN2RkMTM4MGVmMmFhNGVjZTAy",
    "commit": {
      "author": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2021-07-12T21:53:45Z"
      },
      "committer": {
        "name": "Sebastian Falbesoner",
        "email": "sebastian.falbesoner@gmail.com",
        "date": "2021-07-26T13:51:14Z"
      },
      "message": "p2p: refactor: tidy up `PeerManagerImpl::Misbehaving(...)`\n\n- introduce constant variables `score_before` and\n  `score_after` in order to improve readability\n- deduplicate calls to LogPrint(), eliminates else-branch",
      "tree": {
        "sha": "3c669edaf7abc59a193d67a832f94c004c7c4987",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3c669edaf7abc59a193d67a832f94c004c7c4987"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8858e88c840197cdcabea07dd1380ef2aa4ece02",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8858e88c840197cdcabea07dd1380ef2aa4ece02",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/8858e88c840197cdcabea07dd1380ef2aa4ece02",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8858e88c840197cdcabea07dd1380ef2aa4ece02/comments",
    "author": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "theStack",
      "id": 91535,
      "node_id": "MDQ6VXNlcjkxNTM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/91535?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theStack",
      "html_url": "https://github.com/theStack",
      "followers_url": "https://api.github.com/users/theStack/followers",
      "following_url": "https://api.github.com/users/theStack/following{/other_user}",
      "gists_url": "https://api.github.com/users/theStack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theStack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theStack/subscriptions",
      "organizations_url": "https://api.github.com/users/theStack/orgs",
      "repos_url": "https://api.github.com/users/theStack/repos",
      "events_url": "https://api.github.com/users/theStack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theStack/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "d3474b8df2f973e9b9142c0b64505a8a78bcb292",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d3474b8df2f973e9b9142c0b64505a8a78bcb292",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/d3474b8df2f973e9b9142c0b64505a8a78bcb292"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 10,
      "deletions": 4
    },
    "files": [
      {
        "sha": "d23e546330cefef104a2fb2c81abd7b4720572bc",
        "filename": "src/net_processing.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 4,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8858e88c840197cdcabea07dd1380ef2aa4ece02/src/net_processing.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8858e88c840197cdcabea07dd1380ef2aa4ece02/src/net_processing.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net_processing.cpp?ref=8858e88c840197cdcabea07dd1380ef2aa4ece02",
        "patch": "@@ -1280,14 +1280,20 @@ void PeerManagerImpl::Misbehaving(const NodeId pnode, const int howmuch, const s\n     if (peer == nullptr) return;\n \n     LOCK(peer->m_misbehavior_mutex);\n+    const int score_before{peer->m_misbehavior_score};\n     peer->m_misbehavior_score += howmuch;\n+    const int score_now{peer->m_misbehavior_score};\n+\n     const std::string message_prefixed = message.empty() ? \"\" : (\": \" + message);\n-    if (peer->m_misbehavior_score >= DISCOURAGEMENT_THRESHOLD && peer->m_misbehavior_score - howmuch < DISCOURAGEMENT_THRESHOLD) {\n-        LogPrint(BCLog::NET, \"Misbehaving: peer=%d (%d -> %d) DISCOURAGE THRESHOLD EXCEEDED%s\\n\", pnode, peer->m_misbehavior_score - howmuch, peer->m_misbehavior_score, message_prefixed);\n+    std::string warning;\n+\n+    if (score_now >= DISCOURAGEMENT_THRESHOLD && score_before < DISCOURAGEMENT_THRESHOLD) {\n+        warning = \" DISCOURAGE THRESHOLD EXCEEDED\";\n         peer->m_should_discourage = true;\n-    } else {\n-        LogPrint(BCLog::NET, \"Misbehaving: peer=%d (%d -> %d)%s\\n\", pnode, peer->m_misbehavior_score - howmuch, peer->m_misbehavior_score, message_prefixed);\n     }\n+\n+    LogPrint(BCLog::NET, \"Misbehaving: peer=%d (%d -> %d)%s%s\\n\",\n+             pnode, score_before, score_now, warning, message_prefixed);\n }\n \n bool PeerManagerImpl::MaybePunishNodeForBlock(NodeId nodeid, const BlockValidationState& state,"
      }
    ]
  }
]