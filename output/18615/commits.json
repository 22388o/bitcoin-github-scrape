[
  {
    "sha": "fa176e253fb473767c61d4d8cd2d93e87d71a015",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTE3NmUyNTNmYjQ3Mzc2N2M2MWQ0ZDhjZDJkOTNlODdkNzFhMDE1",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2020-04-13T00:22:38Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2020-04-15T15:46:24Z"
      },
      "message": "test: Avoid accessing free'd memory in validation_chainstatemanager_tests",
      "tree": {
        "sha": "e204ffd3fb7942d276afdd1f915180cc395498de",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/e204ffd3fb7942d276afdd1f915180cc395498de"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa176e253fb473767c61d4d8cd2d93e87d71a015",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUhasgv9Gux30hfF2r82K9IMC/eAlkiWUoTfuDgsyslHtna/Q/lZzb6kCmJ111S4\nw4Jc4BV6diKjFVmt5hEEEQ+6mIpFeTdv8lfbHAQ7bxzfkRPYm2mGQlKkOXgyry3S\nCnJlUaAQicPhzI+B/o6m1ToBMOi1SGjBzDaiNdVjGIvZawX4iWeWjo3BmLOXttsX\nZtCbZ0X3cYDNAu03QHm28xutEEmKydLyjWWYAHCZfyYVYIp/i9c6Pf+ofE5peAm+\n0XPa9nKKvO0jnXoPcNTpY7SB7P9eckpQT+vM0zk0ob0D4GCN0R9edaOvuwVW2rPq\n82+YN1coqNbJjM2XRvrPB4vCbd0ITRwK+h2cCZfuFMUF+wC+Dpju6573i+Z1MK0g\nM2EbtuXPuQDWCQlr1dN1KL7neUKuD10lGx5P2vz2oclV+tdye0p4Tdc+1F+3Wx8+\nNC8Z5zXnYeQ+w8t0IvXAVOD48XAZU1EwZks2PUJF2iXI4fP15Ya1132Dm9hJjoQZ\njLopt0px\n=Hq9H\n-----END PGP SIGNATURE-----",
        "payload": "tree e204ffd3fb7942d276afdd1f915180cc395498de\nparent a2b282c9d05843e5729e1a597ab764d912a6343e\nauthor MarcoFalke <falke.marco@gmail.com> 1586737358 -0400\ncommitter MarcoFalke <falke.marco@gmail.com> 1586965584 -0400\n\ntest: Avoid accessing free'd memory in validation_chainstatemanager_tests\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa176e253fb473767c61d4d8cd2d93e87d71a015",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa176e253fb473767c61d4d8cd2d93e87d71a015",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa176e253fb473767c61d4d8cd2d93e87d71a015/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "a2b282c9d05843e5729e1a597ab764d912a6343e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a2b282c9d05843e5729e1a597ab764d912a6343e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/a2b282c9d05843e5729e1a597ab764d912a6343e"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 8,
      "deletions": 9
    },
    "files": [
      {
        "sha": "721e3498e6b948dfcf28f0e88b80d242672e58aa",
        "filename": "src/test/txindex_tests.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 6,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa176e253fb473767c61d4d8cd2d93e87d71a015/src/test/txindex_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa176e253fb473767c61d4d8cd2d93e87d71a015/src/test/txindex_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/txindex_tests.cpp?ref=fa176e253fb473767c61d4d8cd2d93e87d71a015",
        "patch": "@@ -70,12 +70,8 @@ BOOST_FIXTURE_TEST_CASE(txindex_initial_sync, TestChain100Setup)\n     // shutdown sequence (c.f. Shutdown() in init.cpp)\n     txindex.Stop();\n \n-    // txindex job may be scheduled, so stop scheduler before destructing\n-    m_node.scheduler->stop();\n-    threadGroup.interrupt_all();\n-    threadGroup.join_all();\n-\n-    // Rest of shutdown sequence and destructors happen in ~TestingSetup()\n+    // Let scheduler events finish running to avoid accessing any memory related to txindex after it is destructed\n+    SyncWithValidationInterfaceQueue();\n }\n \n BOOST_AUTO_TEST_SUITE_END()"
      },
      {
        "sha": "e79ae1f4d56c2f1d99fec64db404191fe47860e8",
        "filename": "src/test/validation_chainstatemanager_tests.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 3,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa176e253fb473767c61d4d8cd2d93e87d71a015/src/test/validation_chainstatemanager_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa176e253fb473767c61d4d8cd2d93e87d71a015/src/test/validation_chainstatemanager_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/validation_chainstatemanager_tests.cpp?ref=fa176e253fb473767c61d4d8cd2d93e87d71a015",
        "patch": "@@ -3,12 +3,13 @@\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n //\n #include <chainparams.h>\n-#include <random.h>\n-#include <uint256.h>\n #include <consensus/validation.h>\n+#include <random.h>\n #include <sync.h>\n #include <test/util/setup_common.h>\n+#include <uint256.h>\n #include <validation.h>\n+#include <validationinterface.h>\n \n #include <vector>\n \n@@ -97,7 +98,9 @@ BOOST_AUTO_TEST_CASE(chainstatemanager)\n     exp_tip = c1.m_chain.Tip();\n     BOOST_CHECK_EQUAL(validated_tip, exp_tip);\n \n-    // Avoid triggering the address sanitizer.\n+    // Let scheduler events finish running to avoid accessing memory that is going to be unloaded\n+    SyncWithValidationInterfaceQueue();\n+\n     WITH_LOCK(::cs_main, manager.Unload());\n }\n "
      }
    ]
  }
]