practicalswift,2020-04-13 17:17:30,"Concept ACK\n\nDid any of the sanitizers find this issue?",https://github.com/bitcoin/bitcoin/pull/18615#issuecomment-612996574,612996574,
MarcoFalke,2020-04-13 17:50:28,"Yes, this should be hit in sanitizers when additionally the validationinterface debug log category is enabled.",https://github.com/bitcoin/bitcoin/pull/18615#issuecomment-613011734,613011734,
jamesob,2020-04-14 17:14:18,"ACK https://github.com/bitcoin/bitcoin/pull/18615/commits/fac4a9757b3bfd131a78570866c349b590f492ca\n\nThanks for fixing this.",https://github.com/bitcoin/bitcoin/pull/18615#issuecomment-613568775,613568775,
MarcoFalke,2020-04-15 16:52:43,"> Also to clean up the txindex test it might make sense to call SyncWithValidationInterfaceQueue in the test destructor to prevent nondeterminism in other tests\n\nIt needs to happen before the `TestingSetup` is destructed, because txindex is scoped inside the test case.",https://github.com/bitcoin/bitcoin/pull/18615#issuecomment-614155358,614155358,
ryanofsky,2020-04-15 17:26:02,"> It needs to happen before the `TestingSetup` is destructed, because txindex is scoped inside the test case.\n\nMissed that, thanks.",https://github.com/bitcoin/bitcoin/pull/18615#issuecomment-614173025,614173025,
ryanofsky,2020-04-14 17:22:11,"Could be wrong, but I'd think FlushBackgroundCallbacks should be called before scheduler->stop because flushing uses the scheduler",https://github.com/bitcoin/bitcoin/pull/18615#discussion_r408306781,408306781,src/test/validation_chainstatemanager_tests.cpp
ryanofsky,2020-04-14 17:24:15,"Never mind, I confused FlushBackgroundCallbacks with SyncWithValidationInterfaceQueue",https://github.com/bitcoin/bitcoin/pull/18615#discussion_r408308126,408308126,src/test/validation_chainstatemanager_tests.cpp
ryanofsky,2020-04-14 18:33:25,"Would just calling `SyncWithValidationInterfaceQueue` here instead of dropping notifications and cleaning everything up work?\n\nIf I'm understanding the bug correctly, the problem is a race condition where scheduled notifications from code above are racing to finish before manager.Unload() below. If this is the case, calling Sync should be a better fix because it would remove nondeterminism fro",https://github.com/bitcoin/bitcoin/pull/18615#discussion_r408350338,408350338,src/test/validation_chainstatemanager_tests.cpp
MarcoFalke,2020-04-15 15:06:01,Thanks. Done,https://github.com/bitcoin/bitcoin/pull/18615#discussion_r408915650,408915650,src/test/validation_chainstatemanager_tests.cpp
ryanofsky,2020-04-15 15:32:48,"Would say ""Let scheduler events finish running to avoid..."" instead of ""Drop any events from the scheduler to avoid...""",https://github.com/bitcoin/bitcoin/pull/18615#discussion_r408936263,408936263,src/test/validation_chainstatemanager_tests.cpp
MarcoFalke,2020-04-15 15:46:57,"Thanks, done",https://github.com/bitcoin/bitcoin/pull/18615#discussion_r408946523,408946523,src/test/validation_chainstatemanager_tests.cpp
