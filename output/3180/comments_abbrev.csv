gmaxwell,2013-10-28T23:44:40Z,"I'd really rather be never sleeping (except when waiting for IO, then event driven).  Otherwise the delay will still delay block propagation.\n",https://github.com/bitcoin/bitcoin/pull/3180#issuecomment-27267607,27267607,
pstratem,2013-10-28T23:52:04Z,The problem is this isn't entirely about IO.\n\nSendMessages is actually largely a polling function with timers and other logic not dependent on IO.\n,https://github.com/bitcoin/bitcoin/pull/3180#issuecomment-27267970,27267970,
cjdelisle,2013-10-29T07:05:45Z,"I understand this is important and it should be validated and pulled. I took a look at the code and as I understand it, it does the following:\n1. If a single getdata contains multiple requests, only the first those up to and including the first request for a block will be serviced.\n2. ProcessMessages will only process one message at a time so one message will be parsed from each node with outsta",https://github.com/bitcoin/bitcoin/pull/3180#issuecomment-27282153,27282153,
cjdelisle,2013-10-29T09:05:06Z,My assumption 1. turns out to have been wrong. This does not actually change the behavior of the node WRT how it handles requests with multiple getdata(block) in them. It simply drops out and leaves the balance of the requests till later which will be at most 100ms later when ProcessMessages() is next called.\n\nIn https://github.com/pstratem/bitcoin/blob/3c08b7a23fe3afc8025658316b99f750c9a90fbf/s,https://github.com/bitcoin/bitcoin/pull/3180#issuecomment-27287037,27287037,
pstratem,2013-10-29T21:43:18Z,"The goal here is for the loop to process 1 item from vRecvGetData and/or 1 item from vRecvMsg per peer.\n\nProbably ProcessGetData should be moved outside of ProcessMessages entirely, but that is outside the scope of this patch (I think).\n",https://github.com/bitcoin/bitcoin/pull/3180#issuecomment-27346328,27346328,
pstratem,2013-10-29T23:24:57Z,"I see what you're getting at, I have made the suggested change.\n",https://github.com/bitcoin/bitcoin/pull/3180#issuecomment-27353282,27353282,
gavinandresen,2013-10-29T23:32:22Z,ACK on the general idea of round-robin-processing requests. I haven't had time to code review or test.\n,https://github.com/bitcoin/bitcoin/pull/3180#issuecomment-27353668,27353668,
sipa,2013-10-30T00:36:30Z,"ACK on approach and implementation. Haven't tested.\n\nSome commits can be squashed together. In particular 3rd, which is a bugfix for the second.\n",https://github.com/bitcoin/bitcoin/pull/3180#issuecomment-27356634,27356634,
cjdelisle,2013-10-30T10:23:27Z,"Tested the patched version, still getting occasional 100% CPU. I think perhaps we should return a different value from ProcessMessages() if we do not want the calling routine to sleep, that allows us to be more explicit than checking that the queues are not empty. It's just difficult to reliably prove that there is no other way out of ProcessMessages() which leaves non-empty queues.\n",https://github.com/bitcoin/bitcoin/pull/3180#issuecomment-27378066,27378066,
pstratem,2013-10-30T23:05:50Z,"There are only 2 paths where ProcessMessages can run without consuming a message in vRecvMsg.\n\nEither the send buffer is full or the next message in the queue is not complete.\n\nI agree that a more general solution should be applied, but probably later as part of a larger reorganization of the networking code.\n",https://github.com/bitcoin/bitcoin/pull/3180#issuecomment-27447743,27447743,
sipa,2013-11-02T14:02:55Z,Rebase please?\n,https://github.com/bitcoin/bitcoin/pull/3180#issuecomment-27622551,27622551,
BitcoinPullTester,2013-11-04T05:11:30Z,"Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/75ef87dd936cd9c84d9a9fd3afce6198409636c4 for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/cu",https://github.com/bitcoin/bitcoin/pull/3180#issuecomment-27664928,27664928,
gavinandresen,2013-11-04T05:52:21Z,"Tested on OSX, behaves properly.\n\nMessage-handling should be eventually be reworked to use boost:asio (never sleep, be I/O event driven as @gmaxwell suggests) and to use some sort of active queue management to mitigate denial-of-service attacks.\n\nBut this code is better than what we've got, so I am going to merge.\n",https://github.com/bitcoin/bitcoin/pull/3180#issuecomment-27665608,27665608,
darkhosis,2013-11-04T12:34:11Z,"Ah, I already had a similar change in my bitcoind for a year or so (though in my case, I simply reduced this 100ms to 10ms).  I guess that's why blockchain.info always picked up so much stuff.  I thought it may be because of the 20ms latency..\n\nIt would explain the four blocks picked up by blockchain.info from 198.12.127.2, which I'm running w/ similar settings (just sending out far fewer transa",https://github.com/bitcoin/bitcoin/pull/3180#issuecomment-27681800,27681800,
rebroad,2014-02-17T00:29:46Z,#2125 was raised ages ago to address this. Glad to see it finally implemented!\n,https://github.com/bitcoin/bitcoin/pull/3180#issuecomment-35221330,35221330,
cjdelisle,2013-10-29T08:32:33Z,I suspect that this is being set erroneously given I'm getting 100% CPU pretty reliably and not when the patch is removed.\nhttps://github.com/pstratem/bitcoin/blob/3c08b7a23fe3afc8025658316b99f750c9a90fbf/src/main.cpp#L3980\nleaves vRecvMsg non-empty if the send buffer is full which will cause an infiniloop condition when a buffer fills up.\n,https://github.com/bitcoin/bitcoin/pull/3180#discussion_r7273350,7273350,src/net.cpp
rebroad,2017-01-03T16:35:15Z,We don't really need this while loop any longer since we break out after the first iteration of it....,https://github.com/bitcoin/bitcoin/pull/3180#discussion_r94436287,94436287,src/main.cpp
