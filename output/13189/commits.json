[
  {
    "sha": "9266c29ae8ad2c29df5eb42507771f3eeedaefad",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5MjY2YzI5YWU4YWQyYzI5ZGY1ZWI0MjUwNzc3MWYzZWVlZGFlZmFk",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2018-05-08T17:29:56Z"
      },
      "committer": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2018-07-01T07:06:23Z"
      },
      "message": "trivial: Add const to first argument of CTxMemPool::RemoveStaged",
      "tree": {
        "sha": "4b1f94354df24a5224b2aa39e186c829c33cbfde",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4b1f94354df24a5224b2aa39e186c829c33cbfde"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9266c29ae8ad2c29df5eb42507771f3eeedaefad",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9266c29ae8ad2c29df5eb42507771f3eeedaefad",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9266c29ae8ad2c29df5eb42507771f3eeedaefad",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9266c29ae8ad2c29df5eb42507771f3eeedaefad/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "a6ed99a1e6facd38913711106bce6fb65bd14862",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a6ed99a1e6facd38913711106bce6fb65bd14862",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/a6ed99a1e6facd38913711106bce6fb65bd14862"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 2,
      "deletions": 2
    },
    "files": [
      {
        "sha": "a40fee6cee8a06d3c7bd8808b4a8b40f796e66c5",
        "filename": "src/txmempool.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9266c29ae8ad2c29df5eb42507771f3eeedaefad/src/txmempool.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9266c29ae8ad2c29df5eb42507771f3eeedaefad/src/txmempool.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/txmempool.cpp?ref=9266c29ae8ad2c29df5eb42507771f3eeedaefad",
        "patch": "@@ -910,7 +910,7 @@ size_t CTxMemPool::DynamicMemoryUsage() const {\n     return memusage::MallocUsage(sizeof(CTxMemPoolEntry) + 12 * sizeof(void*)) * mapTx.size() + memusage::DynamicUsage(mapNextTx) + memusage::DynamicUsage(mapDeltas) + memusage::DynamicUsage(mapLinks) + memusage::DynamicUsage(vTxHashes) + cachedInnerUsage;\n }\n \n-void CTxMemPool::RemoveStaged(setEntries &stage, bool updateDescendants, MemPoolRemovalReason reason) {\n+void CTxMemPool::RemoveStaged(const setEntries& stage, bool updateDescendants, MemPoolRemovalReason reason) {\n     AssertLockHeld(cs);\n     UpdateForRemoveFromMempool(stage, updateDescendants);\n     for (const txiter& it : stage) {"
      },
      {
        "sha": "fe21df20843adba7e7a5073c19c8402c755c1a7c",
        "filename": "src/txmempool.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9266c29ae8ad2c29df5eb42507771f3eeedaefad/src/txmempool.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9266c29ae8ad2c29df5eb42507771f3eeedaefad/src/txmempool.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/txmempool.h?ref=9266c29ae8ad2c29df5eb42507771f3eeedaefad",
        "patch": "@@ -573,7 +573,7 @@ class CTxMemPool\n      *  Set updateDescendants to true when removing a tx that was in a block, so\n      *  that any in-mempool descendants have their ancestor state updated.\n      */\n-    void RemoveStaged(setEntries &stage, bool updateDescendants, MemPoolRemovalReason reason = MemPoolRemovalReason::UNKNOWN) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+    void RemoveStaged(const setEntries &stage, bool updateDescendants, MemPoolRemovalReason reason = MemPoolRemovalReason::UNKNOWN) EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n     /** When adding transactions from a disconnected block back to the mempool,\n      *  new mempool entries may have children in the mempool (which is generally"
      }
    ]
  },
  {
    "sha": "e5af27e92c4e80d2147d682553a52aed937c5535",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplNWFmMjdlOTJjNGU4MGQyMTQ3ZDY4MjU1M2E1MmFlZDkzN2M1NTM1",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2018-05-08T21:39:28Z"
      },
      "committer": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2018-07-01T07:06:23Z"
      },
      "message": "mempool: Remove 2nd mapTx lookup in CTxMemPool::removeForBlock",
      "tree": {
        "sha": "b66690025b4be8b8345278368a9dcca7faec64d2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b66690025b4be8b8345278368a9dcca7faec64d2"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e5af27e92c4e80d2147d682553a52aed937c5535",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e5af27e92c4e80d2147d682553a52aed937c5535",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e5af27e92c4e80d2147d682553a52aed937c5535",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e5af27e92c4e80d2147d682553a52aed937c5535/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "9266c29ae8ad2c29df5eb42507771f3eeedaefad",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9266c29ae8ad2c29df5eb42507771f3eeedaefad",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9266c29ae8ad2c29df5eb42507771f3eeedaefad"
      }
    ],
    "stats": {
      "total": 12,
      "additions": 5,
      "deletions": 7
    },
    "files": [
      {
        "sha": "6336783d982a64389759fa3c9e28c27d34ab7917",
        "filename": "src/txmempool.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 7,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e5af27e92c4e80d2147d682553a52aed937c5535/src/txmempool.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e5af27e92c4e80d2147d682553a52aed937c5535/src/txmempool.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/txmempool.cpp?ref=e5af27e92c4e80d2147d682553a52aed937c5535",
        "patch": "@@ -563,24 +563,22 @@ void CTxMemPool::removeForBlock(const std::vector<CTransactionRef>& vtx, unsigne\n {\n     LOCK(cs);\n     std::vector<const CTxMemPoolEntry*> entries;\n+    setEntries stage;\n     for (const auto& tx : vtx)\n     {\n         uint256 hash = tx->GetHash();\n \n         indexed_transaction_set::iterator i = mapTx.find(hash);\n-        if (i != mapTx.end())\n+        if (i != mapTx.end()) {\n             entries.push_back(&*i);\n+            stage.insert(i);\n+        }\n     }\n     // Before the txs in the new block have been removed from the mempool, update policy estimates\n     if (minerPolicyEstimator) {minerPolicyEstimator->processBlock(nBlockHeight, entries);}\n+    RemoveStaged(stage, true, MemPoolRemovalReason::BLOCK);\n     for (const auto& tx : vtx)\n     {\n-        txiter it = mapTx.find(tx->GetHash());\n-        if (it != mapTx.end()) {\n-            setEntries stage;\n-            stage.insert(it);\n-            RemoveStaged(stage, true, MemPoolRemovalReason::BLOCK);\n-        }\n         removeConflicts(*tx);\n         ClearPrioritisation(tx->GetHash());\n     }"
      }
    ]
  }
]