laanwj,2020-03-12 12:33:50,"Thank you for picking this up.\n\nIt's nice that this mostly removes lines, it's a cleanup too.\nAdding a `.zip` source archive for Windows users is nice, probably, though I'm not sure if we can accomodate this in the website easily.",https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-598160946,598160946,
laanwj,2020-03-12 15:31:31,"> Also this PR provides Windows users with ZIP archives of the sources. Additionally the commit ID is stored in these ZIP files as a file comment:\n\nIt looks like the generated `.tar` archive also has a comment embedded with the commit ID. I do not know any way (besides hexdump) of getting this information.\n\n```\n00000200  35 32 20 63 6f 6d 6d 65  6e 74 3d 32 34 61 37 32  |52 comment=24a72",https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-598253167,598253167,
hebasto,2020-03-12 15:42:22,"> It looks like the generated `.tar` archive also has a comment embedded with the commit ID. I do not know any way (besides hexdump) of getting this information.\n\nYes. From [`git archive` docs](https://git-scm.com/docs/git-archive):\n> Additionally the commit ID is stored in a global extended pax header if the tar format is used; it can be extracted using `git get-tar-commit-id`.\n\nEDIT: S",https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-598258969,598258969,
MarcoFalke,2020-03-14 16:17:54,"ACK 86d9fae2943ad0d65ced2737f205db33f0bdc324 ðŸ¤ž\n\n<details><summary>Show signature and timestamp</summary>\n\nSignature:\n\n```\n-----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA512\n\nACK 86d9fae2943ad0d65ced2737f205db33f0bdc324 ðŸ¤ž\n-----BEGIN PGP SIGNATURE-----\n\niQGzBAEBCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUgJ3Av+JDgUre1dSaM2RmQQMxS3Qs1MeW1A2byPrGwosk53SkUWU/Pbxl",https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-599089299,599089299,
hebasto,2020-03-14 16:58:42,"Updated f05f8a49e02b49b6bcbdb82681b4c67509e8db73 -> 86d9fae2943ad0d65ced2737f205db33f0bdc324 ([pr18331.01](https://github.com/hebasto/bitcoin/commits/pr18331.01) -> [pr18331.02](https://github.com/hebasto/bitcoin/commits/pr18331.02), [compare](https://github.com/hebasto/bitcoin/compare/pr18331.01..pr18331.02)):\n\n- dropped ""build: Suggest source as zip archive for Windows"" commit",https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-599098374,599098374,
DrahtBot,2020-03-15 03:50:39,<!--a722867cd34abeea1fadc8d60700f111-->\n### Gitian builds\n\n| File | commit 7f8176a1ebd00679596971fd01012cf61743b826<br>(master) | commit 6391f76132f23ee87e90a496270ee21333ffc928<br>(master and this pull) |\n|--|--|--|\n| bitcoin-0.19.99-aarch64-linux-gnu-debug.tar.gz | [`4c336065e794b9e1...`](https://drahtbot.space/gitian/bitcoin/bitcoin/7f8176a1ebd00679596971fd01012cf61743b826/bitcoin-0.19.99-,https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-599164305,599164305,
hebasto,2020-03-15 10:55:59,"Updated 86d9fae2943ad0d65ced2737f205db33f0bdc324 -> c3c8d3cb06c72e14b5e264ca1492ce8a758814c7 ([pr18331.02](https://github.com/hebasto/bitcoin/commits/pr18331.02) -> [pr18331.03](https://github.com/hebasto/bitcoin/commits/pr18331.03), [compare](https://github.com/hebasto/bitcoin/compare/pr18331.02..pr18331.03)):\n\n- reworked docs processing",https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-599194633,599194633,
hebasto,2020-03-15 17:14:13,"Updated c3c8d3cb06c72e14b5e264ca1492ce8a758814c7 -> e4d366788bc2e8dce8e6ca572fce08d913d15d6b ([pr18331.03](https://github.com/hebasto/bitcoin/commits/pr18331.03) -> [pr18331.04](https://github.com/hebasto/bitcoin/commits/pr18331.04), [diff](https://github.com/hebasto/bitcoin/compare/pr18331.03..pr18331.04); diff [18331.02..pr18331.04](https://github.com/hebasto/bitcoin/compare/pr18331.02..pr18331.",https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-599238319,599238319,
DrahtBot,2020-03-16 13:07:24,<!--a722867cd34abeea1fadc8d60700f111-->\n### Gitian builds\n\n| File | commit d402c1e4d3e812341176e0948d64ff126f9ec3c1<br>(master) | commit 31681d5bff526f2b765bbfb45e63707a108fab79<br>(master and this pull) |\n|--|--|--|\n| bitcoin-0.19.99-aarch64-linux-gnu-debug.tar.gz | [`957b5705c1a66fa5...`](https://drahtbot.space/gitian/bitcoin/bitcoin/d402c1e4d3e812341176e0948d64ff126f9ec3c1/bitcoin-0.19.99-,https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-599525801,599525801,
MarcoFalke,2020-03-16 14:28:58,"For archival purposes, since DrahtBot wipes the builds after a while:\n\n[bitcoin-0.19.99.tar.gz](https://github.com/bitcoin/bitcoin/files/4338567/bitcoin-0.19.99.tar.gz)\n\n[bitcoin-0.19.99_new.tar.gz](https://github.com/bitcoin/bitcoin/files/4338570/bitcoin-0.19.99_new.tar.gz)\n\n\n\nre-ACK e4d366788bc2e8dce8e6ca572fce08d913d15d6b, only change is adding two dots in a the path ðŸ›³\n\n<det",https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-599567644,599567644,
MarcoFalke,2020-03-16 14:38:59,Why is `GIT_ARCHIVE` set in `src/clientversion.cpp` even on current master? I thought we don't use `git archive` yet?!,https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-599572804,599572804,
MarcoFalke,2020-03-16 15:45:56,"To answer my own question, we do use `git archive`:\n\n```\n$ git grep -W 'GIT) archive'\nMakefile.am=dist-hook:\nMakefile.am:    -$(GIT) archive --format=tar HEAD -- src/clientversion.cpp | $(AMTAR) -C $(top_distdir) -xf -\n",https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-599609246,599609246,
MarcoFalke,2020-03-16 15:46:15,@fanquake @laanwj Anything left to do here? I think this is ready,https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-599609410,599609410,
hebasto,2020-03-16 15:48:40,"@MarcoFalke \n> Why is `GIT_ARCHIVE` set in `src/clientversion.cpp` even on current master? I thought we don't use `git archive` yet?!\n\nThis is the way to define `GIT_ARCHIVE`, `GIT_COMMIT_ID`, and `GIT_COMMIT_DATE` macros:\nhttps://github.com/bitcoin/bitcoin/blob/86623873095f8d73fd28ad323ed3d06e20433176/src/clientversion.cpp#L44-L48\n\nusing git `export-subst` attribute.\n\nhttps://gith",https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-599610812,599610812,
laanwj,2020-03-25 13:46:15,ACK e4d366788bc2e8dce8e6ca572fce08d913d15d6b,https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-603848283,603848283,
theuni,2020-03-25 21:42:56,"Sorry I got to this too late, but... I think this is a bad idea.\n\nRequiring autogen essentially defeats the point of using autotools, which is to generate a portable configure script. This will likely be a painful move for downstream maintainers and packagers, who will now have to adjust their build dependencies.\n\nEnumerating each file seems like a perfectly reasonable ask for a project wi",https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-604103453,604103453,
ryanofsky,2020-03-25 22:45:33,"> Requiring autogen essentially defeats the point of using autotools\n\nThis seems like a real concern. Does this PR now require running autogen when it wasn't required before? If so, it seems like it should have release notes and documentation updates.",https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-604126354,604126354,
MarcoFalke,2020-03-26 13:57:00,"> painful move for downstream maintainers and packagers, who will now have to adjust their build dependencies.\n\nFor a major version bump they'd need to adjust the build dependencies anyway (e.g. remove openssl and boost chrono, ...). I don't really see how adding autotools is going to be painful. Though, if it really is that painful, we could run it in the gitian vm and append the resulting co",https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-604445540,604445540,
ryanofsky,2020-03-26 14:23:28,"> We don't really have any documentation about our release tarball, so there is nothing to update I think. I am happy to leave a note in the release notes.\n\nI probably should familiarize myself with documentation more. I wrote my comment above assuming this PR required a new install step that was optional before, so installation instructions would be updated.\n\nI don't think we should hesit",https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-604459751,604459751,
theuni,2020-03-26 14:33:19," > For a major version bump they'd need to adjust the build dependencies anyway (e.g. remove openssl and boost chrono, ...). I don't really see how adding autotools is going to be painful.\n\nI'm not complaining about forcing downstreams to update. I'm complaining about the _contents_ of that update. They're going to have to add a pile of new build-time dependencies (autotools dev packages), whi",https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-604465242,604465242,
hebasto,2020-03-26 14:41:21,Release notes added in #18439.,https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-604469593,604469593,
MarcoFalke,2020-03-26 14:51:19,@ryanofsky Our only instruction of building are here: https://github.com/bitcoin/bitcoin/blob/master/doc/build-unix.md#to-build . The first step for them is ./autogen.sh (so nothing changed for them). There is also a source code download link on https://bitcoincore.org/en/download/ . This is what is going to change after this pull request. None of our own packaging scripts should change as an effe,https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-604475130,604475130,
ryanofsky,2020-03-26 14:57:13,"> I'm not complaining about forcing downstreams to update. I'm complaining about the _contents_ of that update. They're going to have to add a pile of new build-time dependencies (autotools dev packages), which may or may not pose further complications.\n\nAre there particular operating systems / distros you're concerned about here? I haven't had the most autotools experience in the world, but I",https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-604478365,604478365,
theuni,2020-03-26 15:12:05,"I'm not aware of any. Practically, this will likely simply mean that maintainers add deps to a list and move on.\n\nBut at a higher level, we can offer a pre-processed source tarball which eases the burden on the builder (as well as adding improving determinism by pegging build tools at tag time) or we could not.\n\nAfter this change, our source tarball is simply a shortcut to a git clone and ",https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-604486787,604486787,
MarcoFalke,2020-03-26 15:17:49,"We couldn't keep up listing all needed files (or even establish guidelines about what files are needed) reliably, so this was the primary reason to change the source tarball. If the missing configure script is a burden or causes issues otherwise, what about appending it to the git archive after running autogen in the gitian vm?\n\nThis seems to solve both concerns?",https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-604490033,604490033,
theuni,2020-03-26 15:22:51,"> We couldn't keep up listing all needed files (or even establish guidelines about what files are needed) reliably, so this was the primary reason to change the source tarball. If the missing configure script is a burden or causes issues otherwise, what about appending it to the git archive after running autogen in the gitian vm?\n> \n> This seems to solve both concerns?\n\nThis is exactly wha",https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-604492718,604492718,
laanwj,2020-03-12 15:02:57,"So this is not needed for the `git archive` output?\nThat's nice!\n\nOh, you mention this in the OP. I cannot find anything about this in the documentation, but looking at the output of `git archive`:\n- Files are sorted in alphabetic order\n- Files are owned by root/root\n- Permissions seem to be consistent:\n```\n-rw-rw-r--  for normal files\ndrwxrwxr-x  for directories\n-rwxrwxr-x  fo",https://github.com/bitcoin/bitcoin/pull/18331#discussion_r391683564,391683564,contrib/gitian-descriptors/gitian-linux.yml
hebasto,2020-03-12 15:22:26,">    * The timestamp seems to be the same for all the files, but I don't know where it comes from. Oh it's the ""CommitDate"" of the last commit!\n\nYes. From [`git archive` docs](https://git-scm.com/docs/git-archive):\n> `git archive` behaves differently when given a tree ID versus when given a **commit ID** or tag ID. In the first case the current time is used as the modification time of each f",https://github.com/bitcoin/bitcoin/pull/18331#discussion_r391697107,391697107,contrib/gitian-descriptors/gitian-linux.yml
laanwj,2020-03-12 15:40:29,Seems this is the same for the `mtime` in the global header.,https://github.com/bitcoin/bitcoin/pull/18331#discussion_r391709200,391709200,contrib/gitian-descriptors/gitian-linux.yml
MarcoFalke,2020-03-14 16:20:29,"Why?\n\nThe tar is provided so that users can compile from source (without having to clone from GitHub and checkout the tag). I don't think we really support compiling on Windows. And when we do, the extra dependency to extract a tar file is probably not too much to ask for from a windows user.\n\nFinally, as pointed out by @laanwj, this probably does need adjustment on the Website. Not sure i",https://github.com/bitcoin/bitcoin/pull/18331#discussion_r392600040,392600040,contrib/gitian-descriptors/gitian-win.yml
hebasto,2020-03-14 16:59:34,Commit dropped (https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-599098374).,https://github.com/bitcoin/bitcoin/pull/18331#discussion_r392602825,392602825,contrib/gitian-descriptors/gitian-win.yml
MarcoFalke,2020-03-15 05:01:52,"3 lines up:\n\n\n```\n+ cp ../README.md bitcoin-0.19.99/\ncp: cannot stat '../README.md': No such file or directory",https://github.com/bitcoin/bitcoin/pull/18331#discussion_r392641904,392641904,contrib/gitian-descriptors/gitian-linux.yml
hebasto,2020-03-15 10:56:27,Fixed: https://github.com/bitcoin/bitcoin/pull/18331#issuecomment-599194633,https://github.com/bitcoin/bitcoin/pull/18331#discussion_r392662287,392662287,contrib/gitian-descriptors/gitian-linux.yml
