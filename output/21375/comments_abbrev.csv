DrahtBot,2021-03-14 00:50:58,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #21591 (build, qt: Fix wrong cross-compiling detection on macOS by hebasto)\n* #21589 (build, qt: Do not require xml modul",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-798809595,798809595,
sipa,2021-03-18 00:43:53,"My outdirt:\n\n```\n$ sha256sum $(find -type f | LANG=C sort)\n54f46bc056b2d38160d5fde32590a76148e15c37d67d34fc65390ba3f371ea97  ./aarch64-linux-gnu/bitcoin-61194db48c87-aarch64-linux-gnu-debug.tar.gz\n9d23600991e1b40aeee8df638e8140183b310ea8fc9a4b080fe1c0a895c173f7  ./aarch64-linux-gnu/bitcoin-61194db48c87-aarch64-linux-gnu.tar.gz\nf92f44566ebd3b315d4fbac110b5583d38258d90243bb0690046cebcbd6",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-801532984,801532984,
fanquake,2021-03-18 02:55:56,"My outdirt. Looks like there's still a diff in the osx  unsigned tarball:\n```bash\nfind output -type f -name *$(git rev-parse --short HEAD)*.* -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\n54f46bc056b2d38160d5fde32590a76148e15c37d67d34fc65390ba3f371ea97  output/aarch64-linux-gnu/bitcoin-61194db48c87-aarch64-linux-gnu-debug.tar.gz\n9d23600991e1b40aeee8df638e8140183b310ea8fc9a4b080fe1c0",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-801578567,801578567,
dongcarl,2021-03-18 03:06:33,"Mine!\n```\n$ find guix-build-61194db48c87/output/ -type f -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\n54f46bc056b2d38160d5fde32590a76148e15c37d67d34fc65390ba3f371ea97  guix-build-61194db48c87/output/aarch64-linux-gnu/bitcoin-61194db48c87-aarch64-linux-gnu-debug.tar.gz\n9d23600991e1b40aeee8df638e8140183b310ea8fc9a4b080fe1c0a895c173f7  guix-build-61194db48c87/output/aarch64-linux-gnu/",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-801582498,801582498,
fanquake,2021-03-18 03:26:59,"> If one of you can upload I'm going to get to the bottom of this.\n\nUploaded here: https://github.com/fanquake/build_artifacts/releases/tag/guix_21375",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-801590696,801590696,
dongcarl,2021-03-18 20:27:45,"Testing a hypothesis: @sipa @fanquake could one of you build 8170456b5b0b5f20e869e9a59b694383c57de28e with HOSTS='x86_64-apple-darwin18'?\n\nI got:\n```\n1bbdaaeda79420b5d4b33de5490344e9526783ca43dbf31e11c02b34a4761685  guix-build-8170456b5b0b/output/dist-archive/bitcoin-8170456b5b0b.tar.gz\n417cd25618d10ec7efe6575ac79cf5265dfe689219113cd19a834b61deeb275e  guix-build-8170456b5b0b/output/x86_6",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-802269006,802269006,
sipa,2021-03-18 22:34:46,"@dongcarl I got:\n\n```\n1bbdaaeda79420b5d4b33de5490344e9526783ca43dbf31e11c02b34a4761685  ./dist-archive/bitcoin-8170456b5b0b.tar.gz\n417cd25618d10ec7efe6575ac79cf5265dfe689219113cd19a834b61deeb275e  ./x86_64-apple-darwin18/bitcoin-8170456b5b0b-osx-unsigned.dmg\nf549b232b3eb6d45fcd4f8939b2ad3e80033c470d907a119ea8ec165dafa43f2  ./x86_64-apple-darwin18/bitcoin-8170456b5b0b-osx-unsigned.tar.gz",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-802354818,802354818,
dongcarl,2021-03-18 22:42:29,"Great! Looks like we have reproducibility. I'm experimenting a bit with building `dmg` as a static executable right now, which I think is the right move. Any binary we put in our output should ""err on the side on portability,"" and in this case, since `dmg` doesn't need NSS or any networking, we can just make it fully static.",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-802359380,802359380,
hebasto,2021-03-18 23:04:14,"```\n$ find guix-build-8170456b5b0b/output -type f -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\n1bbdaaeda79420b5d4b33de5490344e9526783ca43dbf31e11c02b34a4761685  guix-build-8170456b5b0b/output/dist-archive/bitcoin-8170456b5b0b.tar.gz\n417cd25618d10ec7efe6575ac79cf5265dfe689219113cd19a834b61deeb275e  guix-build-8170456b5b0b/output/x86_64-apple-darwin18/bitcoin-8170456b5b0b-osx-unsigned.",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-802370450,802370450,
laanwj,2021-03-19 13:21:41,"What is the rationale for removing the `.sh` from the build script filename?\n\nIt seems to me that the convention in the rest of the repository is to keep the .py/.sh extension for scripts, even the main units.",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-802828455,802828455,
dongcarl,2021-03-19 14:19:16,"> What is the rationale for removing the `.sh` from the build script filename?\n\nI was thinking that we might change the scripting language for these scripts in the future, or perhaps just have a python wrapper which interprets arguments. I that case, I wouldn't want to have everyone change their invocation again, therefore I omitted the `.sh`. I'm happy to do either way though!\n\n\n\n",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-802867228,802867228,
laanwj,2021-03-22 12:35:42,"My output is:\n```\n$ cd guix-build-*/output/ && find * -type f -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\nfa28462f5c23413fd8c984f46a36238e69cd3e33871cedeae70c54f9a5977363  aarch64-linux-gnu/bitcoin-8170456b5b0b-aarch64-linux-gnu-debug.tar.gz\n14d40d7faa2775a7cf91a90d1da83d0928e75d44728f1e2b7e7164708a6be9c8  aarch64-linux-gnu/bitcoin-8170456b5b0b-aarch64-linux-gnu.tar.gz\n1c98c9fb4",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-804027362,804027362,
dongcarl,2021-03-23 20:38:18,"Pushed 8170456b5b0b5f20e869e9a59b694383c57de28e -> e7e778bd13e6c696369ffdf317054f10679e8ac2\n- Supply `--fallback` to `guix time-machine` as well\n- Add notes w/re CMake RPATH patching in commit message\n- Add commit to build `dmg` as a static binary\n\n```sh\n$ find guix-build-$(git rev-parse --short=12 HEAD)/output/ -type f -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\n27cfd548cff",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-805235583,805235583,
sipa,2021-03-26 06:46:37,"```\n$ sha256sum $(find -type f | LANG=C sort)\n27cfd548cffca972b1efb4e9e8063eb20935420e0d24cac1ca4b1816d5c14e15  ./aarch64-linux-gnu/bitcoin-e7e778bd13e6-aarch64-linux-gnu-debug.tar.gz\n806c1532a9329507442bc07d142ca520523cde9caa813587620d77a6427c3ec1  ./aarch64-linux-gnu/bitcoin-e7e778bd13e6-aarch64-linux-gnu.tar.gz\nede546c8bf428c59b201b95b0063c0740bd1926ef7d5b0c51481250dc616bd9e  ./arm-linu",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-807980926,807980926,
hebasto,2021-03-28 05:48:30,"I'd suggest to split this PR in two separated parts:\n1) bash scripts optimizations and fixes, dir structure change, docs\n2) dependencies build stuff, patches etc\n\nIt would make each part more focused, and easier to review and test, no?",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-808851612,808851612,
dongcarl,2021-03-30 17:20:34,"> It would make each part more focused, and easier to review and test, no?\n\nThat may be true, but I think a lot of people have already tested the whole bundle here, so I want to keep it this way if possible :-)\n\nIf there are parts that you find especially hard to parse/review, I'd be happy to explain more!",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-810437688,810437688,
dongcarl,2021-04-02 19:59:26,"Pushed e7e778bd13e6c696369ffdf317054f10679e8ac2 -> edf5c8a8182e30862c7d62f11147ead31e029f04\n- Rebased over master\n\n```sh\n$ find guix-build-$(git rev-parse --short=12 HEAD)/output/ -type f -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\n4f75b7e4f4037d47b405025a23f7ec762a6b16645858c9f547f95ea22651b9fa  guix-build-edf5c8a8182e/output/aarch64-linux-gnu/bitcoin-edf5c8a8182e-aarch64-linux",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-812687883,812687883,
sipa,2021-04-02 23:10:06,"```\n$ find guix-build-$(git rev-parse --short=12 HEAD)/output/ -type f -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\n4f75b7e4f4037d47b405025a23f7ec762a6b16645858c9f547f95ea22651b9fa  guix-build-edf5c8a8182e/output/aarch64-linux-gnu/bitcoin-edf5c8a8182e-aarch64-linux-gnu-debug.tar.gz\nd56a231299ee283faa69044264a40673095817bf6591e260baa317684b093af1  guix-build-edf5c8a8182e/output/aarch6",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-812749469,812749469,
dongcarl,2021-04-05 15:02:53,"Pushed edf5c8a8182e30862c7d62f11147ead31e029f04 -> 7476b46f1893a4858616d2a8456a7c43238851ed\n- Addressed https://github.com/bitcoin/bitcoin/pull/21375#discussion_r606498865, https://github.com/bitcoin/bitcoin/pull/21375#discussion_r606502338\n\n```sh\n$ find guix-build-$(git rev-parse --short=12 HEAD)/output/ -type f -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\n95c20e95a7fac6e0a1d2fe",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-813440925,813440925,
sipa,2021-04-05 20:46:35,ACK 7476b46f1893a4858616d2a8456a7c43238851ed,https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-813639801,813639801,
sipa,2021-04-05 22:30:56,"```\n$ find guix-build-$(git rev-parse --short=12 HEAD)/output/ -type f -print0 | env LC_ALL=C sort -z | xargs -r0 sha256sum\n95c20e95a7fac6e0a1d2fe8ab39f882a7b92dce457bcf617beb7885608ce6d4b  guix-build-7476b46f1893/output/aarch64-linux-gnu/bitcoin-7476b46f1893-aarch64-linux-gnu-debug.tar.gz\nd1da31d62a5eb8b7bd5757994b3fed344774554a5db420a9e0126717abc1a0e0  guix-build-7476b46f1893/output/aarch6",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-813687407,813687407,
laanwj,2021-04-05 22:59:54,"ACK 7476b46f1893a4858616d2a8456a7c43238851ed\nMy output (built in a GUIX VM) matches @sipa's 100%.",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-813697897,813697897,
hebasto,2021-04-09 15:03:17,"> Finally, we restructure the guix building hierarchy such that it looks something like:\n\nAlso see #21643.",https://github.com/bitcoin/bitcoin/pull/21375#issuecomment-816747343,816747343,
sipa,2021-03-17 21:57:11,"What is ""outdirting""?",https://github.com/bitcoin/bitcoin/pull/21375#discussion_r596410682,596410682,contrib/guix/guix-build
dongcarl,2021-03-18 00:49:48,😬 Uhh... Over-eager find-and-replace strikes again...,https://github.com/bitcoin/bitcoin/pull/21375#discussion_r596478363,596478363,contrib/guix/guix-build
hebasto,2021-03-28 05:23:09,"`cat` and `git` already checked in the sourced `libexec/prelude.bash`.\nMaybe combine both `check_tools` into one?",https://github.com/bitcoin/bitcoin/pull/21375#discussion_r602833278,602833278,contrib/guix/guix-build
hebasto,2021-03-28 05:31:44,"Maybe inline with the previous ""Derivation failed to build"" item\n```suggestion\n### python(-minimal): [Errno 84] Invalid or incomplete multibyte or wide character\n```\n?",https://github.com/bitcoin/bitcoin/pull/21375#discussion_r602833999,602833999,contrib/guix/README.md
dongcarl,2021-03-30 17:17:41,"The check is quite cheap, and only attest to the tools being used in the current script. Instead of trying to figure out how to optimize it, I think we can just leave it be if it's redundant. 😄 ",https://github.com/bitcoin/bitcoin/pull/21375#discussion_r604287623,604287623,contrib/guix/guix-build
dongcarl,2021-03-30 17:18:17,"This is a common ""Derivation failed to build"" error, which is why I made it underneath it hierarchically",https://github.com/bitcoin/bitcoin/pull/21375#discussion_r604288084,604288084,contrib/guix/README.md
sipa,2021-04-02 23:31:19,"In commit ""guix: Add troubleshooting documentation entries""\n\nNit: distribution**s**.\n\nAlso, and equally a nit... do you have any evidence for that statement? I don't think it's the default on any of the distributions I've used in the past (Debian, Gentoo, Ubuntu).",https://github.com/bitcoin/bitcoin/pull/21375#discussion_r606498865,606498865,contrib/guix/README.md
sipa,2021-04-02 23:37:14,"In commit ""guix: Add souce-able bash prelude and utils""\n\nNit: commit title contains a typo",https://github.com/bitcoin/bitcoin/pull/21375#discussion_r606502338,606502338,contrib/guix/libexec/prelude.bash
laanwj,2021-04-03 14:43:19,"From what I remember, using `tmpfs` for `/tmp` is uncommon for non-embedded / non-minimal distros, because some software like *cough* bitcoin tests *cough* like to drop large amount of files there filling up memory.\n\nIt looks like stock Fedora (RISC-V, but that shouldn't matter) does do it:\n```\ntmpfs on /tmp type tmpfs (rw,nosuid,nodev,nr_inodes=409600)\n```",https://github.com/bitcoin/bitcoin/pull/21375#discussion_r606672356,606672356,contrib/guix/README.md
dongcarl,2021-04-05 15:03:15,My bad! Fixed in latest push :-),https://github.com/bitcoin/bitcoin/pull/21375#discussion_r607138601,607138601,contrib/guix/README.md
dongcarl,2021-04-05 15:03:23,"Fixed, thanks!",https://github.com/bitcoin/bitcoin/pull/21375#discussion_r607138672,607138672,contrib/guix/libexec/prelude.bash
sipa,2021-04-05 20:43:32,"This is still not fixed, FWIW.",https://github.com/bitcoin/bitcoin/pull/21375#discussion_r607321877,607321877,contrib/guix/guix-build
