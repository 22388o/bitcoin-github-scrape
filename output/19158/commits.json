[
  {
    "sha": "d69a99ab0af1081967a1ca556bffcfb28b81e9a5",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkNjlhOTlhYjBhZjEwODE5NjdhMWNhNTU2YmZmY2ZiMjhiODFlOWE1",
    "commit": {
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2020-06-03T14:28:12Z"
      },
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2020-06-03T14:28:12Z"
      },
      "message": "sync: remove unneeded LockData::invlockorders\n\nJust `LockData::lockorders` suffices to perform the lock ordering\nchecks.",
      "tree": {
        "sha": "3aa2314f2070d1a04657c48ea919e1050b170996",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3aa2314f2070d1a04657c48ea919e1050b170996"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d69a99ab0af1081967a1ca556bffcfb28b81e9a5",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAl7XtB0ACgkQVN8G9ktV\ny78iXR/+LxUdhFBzzmmB5WrPmsSPZcR49Dyy1U4RR3oavyMEbdNbgTIakE/PHdne\nKyikbIzfwafe73ilNDqvZgswyKe8mqzY+xDeIhZfAug0+Zp2OQeGJXXFa71y76BR\nqtClJ0FUPRmyP7sY46AGeSXD9kbeIf9RuWlyKn9z0Xbl2ROG4W1kOLfCRRzutvJ5\nC6NoiqowsuMg8DYxR9mv27EmcDxOkHmUgH7wRTl+8KEMZNhNm4DfbSETMPaRkfj4\nLqiygDrScUiUuUtvS/WphpXE+IJ4uXzOp8y14gV9SYyrF44WaPP8cWMJwvX0IjlN\nS1fvUFxrtWM/JMP1fpZhKLOnXcxHP23hQlG/G6Us+GQeV0Y5xw2Ls5dxxmjrh6qg\nOz/lbMAc0EfG8kXORvC5btZ7A+gn0UgIwy48OrY9+K9253oCwOdpNHh4J9pHBuAS\nKTJLE9wMewo+Lr55tKjcRJ/apnhLv+t8GFy/5sfZRVZYx9AhZLxceKV/9LbmTtHK\n1FFxTMCDTBOYgx1Wdsm6hvd+UkHklCtbyi2Hp6HtAeuCZ5ceDcLHsXU7+WThTI+w\niRZ4zEWoTta43j1PvIH+EA8ExUqsd6/uyaGhfqPu3J0Jxxly33zIYYd3uQDfjFLq\nrfL9E7cMgpveRjOZHoUXjtX4N8HFGwpUixpmasLzeK8tqHrYyxnkB9NegoEo60Il\n+1jEqaIsuZtYJ5sstPrz//odMCdzCoCl0A+Bl7o7Gf3TshJOKS7lZvfyrJ/qBOyX\nnU/y6A7gSbuXnQD95owBHeP9CS85bxUjRd4KKKT3b32KsNCgAyzV4OU4iLfsSE5W\nGV930tcXGmtTEZ9kc2TlAc7tF2lKPqFyjRYaLDA8wBH/gJ3xZje6r42FKGgQJ1XR\nCshgrI9CAhB76bi8BslrzJLJvcY44CzLafeXHcVfBFR176PPVU7rIrdedNcXHJdb\ncNHdJIu4IF2NAB5MiSp8yksoU4Oj/hAk8vDKaSrsfQXIxgiKxqD7fC1cZlmeUpyY\n7BtbVKHhRkajeaBEXlHGvCKty9k5KW9pVvvEGZgO3ZDQ259igBT3kiEvu7LrjilK\n3A4vKc59KisrWkdzOuWbxuAyFAMf0Yks+mc2TdUTMTYBoaWnHKqy68BpN1KeAcUU\n1IFhdXApcU5uDzjIuNE5w+LUoM52Xb9M6CvnffJaKU+hUP/0BjIidJeQIEiNhNFP\nsHoEsD8Sc+DVFzFc/hPike8E6GQgrWyD8OXb6Xe+cmqUJ2N7RGz+TP2iq8wOMiqa\n7D0q1WxB6JnL7r8/R6gJf/P5y13hPeFVSc+MR5XHrZ31irED4zw2ibFR+VTFNicH\n5sQhVFA8YUnzjecMHaUwbEvzI1xWnQ==\n=QH58\n-----END PGP SIGNATURE-----",
        "payload": "tree 3aa2314f2070d1a04657c48ea919e1050b170996\nparent 575589a62e39520f7210f58bdef731933a3b88ab\nauthor Vasil Dimov <vd@FreeBSD.org> 1591194492 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1591194492 +0200\n\nsync: remove unneeded LockData::invlockorders\n\nJust `LockData::lockorders` suffices to perform the lock ordering\nchecks.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d69a99ab0af1081967a1ca556bffcfb28b81e9a5",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/d69a99ab0af1081967a1ca556bffcfb28b81e9a5",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d69a99ab0af1081967a1ca556bffcfb28b81e9a5/comments",
    "author": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "575589a62e39520f7210f58bdef731933a3b88ab",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/575589a62e39520f7210f58bdef731933a3b88ab",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/575589a62e39520f7210f58bdef731933a3b88ab"
      }
    ],
    "stats": {
      "total": 11,
      "additions": 0,
      "deletions": 11
    },
    "files": [
      {
        "sha": "06c4c4898a2b24afca867f4dd6133abe2fe7cdbe",
        "filename": "src/sync.cpp",
        "status": "modified",
        "additions": 0,
        "deletions": 11,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d69a99ab0af1081967a1ca556bffcfb28b81e9a5/src/sync.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d69a99ab0af1081967a1ca556bffcfb28b81e9a5/src/sync.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/sync.cpp?ref=d69a99ab0af1081967a1ca556bffcfb28b81e9a5",
        "patch": "@@ -83,12 +83,10 @@ using LockStacks = std::unordered_map<std::thread::id, LockStack>;\n \n using LockPair = std::pair<void*, void*>;\n using LockOrders = std::map<LockPair, LockStack>;\n-using InvLockOrders = std::set<LockPair>;\n \n struct LockData {\n     LockStacks m_lock_stacks;\n     LockOrders lockorders;\n-    InvLockOrders invlockorders;\n     std::mutex dd_mutex;\n };\n \n@@ -148,7 +146,6 @@ static void push_lock(void* c, const CLockLocation& locklocation)\n         lockdata.lockorders.emplace(p1, lock_stack);\n \n         const LockPair p2 = std::make_pair(c, i.first);\n-        lockdata.invlockorders.insert(p2);\n         if (lockdata.lockorders.count(p2))\n             potential_deadlock_detected(p1, lockdata.lockorders[p2], lockdata.lockorders[p1]);\n     }\n@@ -243,16 +240,8 @@ void DeleteLock(void* cs)\n     const LockPair item = std::make_pair(cs, nullptr);\n     LockOrders::iterator it = lockdata.lockorders.lower_bound(item);\n     while (it != lockdata.lockorders.end() && it->first.first == cs) {\n-        const LockPair invitem = std::make_pair(it->first.second, it->first.first);\n-        lockdata.invlockorders.erase(invitem);\n         lockdata.lockorders.erase(it++);\n     }\n-    InvLockOrders::iterator invit = lockdata.invlockorders.lower_bound(item);\n-    while (invit != lockdata.invlockorders.end() && invit->first == cs) {\n-        const LockPair invinvitem = std::make_pair(invit->second, invit->first);\n-        lockdata.lockorders.erase(invinvitem);\n-        lockdata.invlockorders.erase(invit++);\n-    }\n }\n \n bool g_debug_lockorder_abort = true;"
      }
    ]
  }
]