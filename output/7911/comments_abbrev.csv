laanwj,2016-04-20T07:02:13Z,"utACK (will test later). \n\nMore info: this should fix both issues from ""Out-of-tree builds don't currently work #7466"": out-of-tree builds and LLVM lto ar.\n",https://github.com/bitcoin/bitcoin/pull/7911#issuecomment-212288920,212288920,
luke-jr,2016-04-20T07:27:09Z,Why not just autotools-ify our LevelDB fork?\n,https://github.com/bitcoin/bitcoin/pull/7911#issuecomment-212297741,212297741,
theuni,2016-04-20T07:54:45Z,"@luke-jr That's exactly what this is. Upstream is dormant enough that there's no need to add an abstraction layer. We were already overriding their entire buildsystem, all we were missing was file enumeration.\n",https://github.com/bitcoin/bitcoin/pull/7911#issuecomment-212309868,212309868,
sipa,2016-04-20T08:44:10Z,utACK\n,https://github.com/bitcoin/bitcoin/pull/7911#issuecomment-212332618,212332618,
laanwj,2016-04-20T09:19:31Z,"> Why not just autotools-ify our LevelDB fork?\n\nThere's a (quite succesful) attempt by @kleetus here: https://github.com/bitcoin/leveldb/pull/11\n\nIf you manage to get upstream to merge and maintain that in favor of their current bag of hacks, that'd be an excellent option. We can switch to that if that happens. However the chances of that are thought to be slim, so the most efficient and least",https://github.com/bitcoin/bitcoin/pull/7911#issuecomment-212343221,212343221,
luke-jr,2016-04-20T09:19:37Z,src/Makefile.leveldb.include isn't inside src/leveldb...\n,https://github.com/bitcoin/bitcoin/pull/7911#issuecomment-212343247,212343247,
laanwj,2016-04-20T09:20:56Z,"> src/Makefile.leveldb.include isn't inside src/leveldb...\n\nThat's on purpose.\nYou are basically repeating the discussion done months ago in https://github.com/bitcoin/leveldb/pull/11 and https://github.com/bitcoin/bitcoin/issues/7466.\n`src/leveldb` is still a subtree containing the upstream repository, we shouldn't add files private to ourselves (which aren't useful on their own) there.\n",https://github.com/bitcoin/bitcoin/pull/7911#issuecomment-212343571,212343571,
sipa,2016-04-20T09:49:43Z,"I think both things can be done in parallel: we could try to get an autotoolsification of leveldb accepted upstream (so it benefits more people than just Bitcoin-related projects), and switch to an overridden build system like this PR in the mean time. If the autotoolsification gets upstreamed, we can always switch back.\n",https://github.com/bitcoin/bitcoin/pull/7911#issuecomment-212355169,212355169,
laanwj,2016-04-20T10:02:55Z,@sipa Indeed\n,https://github.com/bitcoin/bitcoin/pull/7911#issuecomment-212361948,212361948,
laanwj,2016-04-20T12:15:38Z,"Tested ACK https://github.com/bitcoin/bitcoin/pull/7911/commits/a4625acbf8afbe3f698e8dc7936312c9d2b65d22 using both gcc and llvm (+flto).\n(but this reveals another problem, see below)\n",https://github.com/bitcoin/bitcoin/pull/7911#issuecomment-212401791,212401791,
laanwj,2016-04-20T12:58:37Z,"OK this is really, really strange. With this patch:\n- When I compile the GUI from the bitcoin directory itself, it works as expected.\n- When I build the GUI in an out-of-tree build, I cannot get it to select tabs. When I click, say the ""Receive"" tab nothing happens, the button selects but it doesn't switch the page. The rest - even the debug window - seems to work.\n\nI first thought I had found",https://github.com/bitcoin/bitcoin/pull/7911#issuecomment-212413442,212413442,
laanwj,2016-04-20T13:41:00Z,"@cfields I think I found the issue, or at least one symptom - the .moc file is different between the out-of-tree and normal builds:\n\n``` patch\n--- bitcoin/src/qt/moc_bitcoingui.cpp   2016-04-20 15:31:42.627847820 +0200\n+++ bitcoin-build/src/qt/moc_bitcoingui.cpp 2016-04-20 15:17:04.295881358 +0200\n@@ -5,7 +5,7 @@\n ** WARNING! All changes made in this file will be lost!\n ********************",https://github.com/bitcoin/bitcoin/pull/7911#issuecomment-212427951,212427951,
laanwj,2016-04-20T14:04:58Z,"@theuni The following solved it for me:\n\n``` diff\ndiff --git a/src/Makefile.qt.include b/src/Makefile.qt.include\nindex 8443fe6..3b39919 100644\n--- a/src/Makefile.qt.include\n+++ b/src/Makefile.qt.include\n@@ -424,11 +424,11 @@ ui_%.h: %.ui\n        $(AM_V_GEN) QT_SELECT=$(QT_SELECT) $(UIC) -o $@ $< || (echo ""Error creating $@""; false)\n\n %.moc: %.cpp\n-       $(AM_V_GEN) QT_SELECT=$(QT_SELEC",https://github.com/bitcoin/bitcoin/pull/7911#issuecomment-212439612,212439612,
theuni,2016-04-20T15:46:29Z,"@sipa Fine by me.\n\n@laanwj Thanks for tracking that down! Yes, that must've been a very confusing result :)\n\nThere are a few other fixes needed for out-of-tree builds.\n- RCC is particularly unhappy with separate paths, so we have a hackish copy in there right now. I'm sure there's a better way.\n- We do some leveldb copying at the top-level make that should no longer be necessary.\n- Travis a",https://github.com/bitcoin/bitcoin/pull/7911#issuecomment-212484161,212484161,
laanwj,2016-04-21T09:39:14Z,"I'd prefer including the changes that get out-of-tree build working here (so that we don't have an intermediate state with known brokenness). I agree with doing optimizations and improvements, as well as using it in gitian separately.\n",https://github.com/bitcoin/bitcoin/pull/7911#issuecomment-212832107,212832107,
laanwj,2016-04-22T07:15:45Z,"Ok, just going ahead and merging this. I'll submit the qt fix myself.\n",https://github.com/bitcoin/bitcoin/pull/7911#issuecomment-213297217,213297217,
