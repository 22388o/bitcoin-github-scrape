promag,2018-06-14T00:49:21Z,"Weird, travis failed with\n```\n/home/travis/build/bitcoin/bitcoin/build/bitcoin-x86_64-apple-darwin11/build-aux/install-sh: src/qt/bitcoin-qt does not exist.\nMakefile:1214: recipe for target 'Bitcoin-Qt.app/Contents/MacOS/Bitcoin-Qt' failed\nmake: *** [Bitcoin-Qt.app/Contents/MacOS/Bitcoin-Qt] Error 1\nmake: *** Waiting for unfinished jobs....\n```\nrestarted job.",https://github.com/bitcoin/bitcoin/pull/13461#issuecomment-397132232,397132232,
laanwj,2018-06-14T11:18:11Z,Concept ACK - added 0.17 tag to avoid API breakage in major version,https://github.com/bitcoin/bitcoin/pull/13461#issuecomment-397259875,397259875,
jnewbery,2018-06-14T20:00:54Z,"I don't understand. `min-conf` and `watch_only` have never been supported when `account` is not specified:\n\n```\n     if (request.params.size() == 0)\n         return  ValueFromAmount(pwallet->GetBalance());\n```",https://github.com/bitcoin/bitcoin/pull/13461#issuecomment-397420474,397420474,
DrahtBot,2018-06-14T20:10:45Z,"<!--e57a25ab6845829454e8d69fc972939a-->Note to reviewers: This pull request conflicts with the following ones:\n\n* #11020 ([wallet] getbalance: Add option to include non-mempool UTXOs by kallewoof)\n* #10973 (Refactor: separate wallet from node by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that s",https://github.com/bitcoin/bitcoin/pull/13461#issuecomment-397423107,397423107,
jonasschnelli,2018-06-14T20:15:41Z,"> I don't understand. min-conf and watch_only have never been supported when account is not specified:\n\n@jnewbery:\nAFAIK, before #9614, one you get the watch-only balance of a wallet by calling `getbalance ""*"" 0 true` which is no longer possible in master.",https://github.com/bitcoin/bitcoin/pull/13461#issuecomment-397424397,397424397,
jnewbery,2018-06-18T22:22:02Z,"I've taken another look at this and I don't think that #9614 removed the ability to call `getbalance ""*"" 0 true`. I think it was accidentally removed by #12953 here: https://github.com/bitcoin/bitcoin/commit/109e05dcd163b8ddb7f4b3550db6b9ab833b2c04#diff-df7d84ff2f53fcb2a0dc15a3a51e55ceR891.\n\nConcept ACK fixing that regression and restoring the functionality to call `getbalance ""*"" 0 true`.\n",https://github.com/bitcoin/bitcoin/pull/13461#issuecomment-398214153,398214153,
jonasschnelli,2018-06-19T07:14:28Z,"@jnewbery AFAIK there is currently no ""better"" balance calculation if one wants to filter with watch-only & min-confirmation-count,... and I think keeping the old behaviour rather then removing it is preferable.\n\nBut obviously the whole balance calculation and caching system is inefficient (I guess it's not buggy?) and needs probably a complete overhaul.",https://github.com/bitcoin/bitcoin/pull/13461#issuecomment-398298667,398298667,
jnewbery,2018-06-22T13:58:28Z,"I think it's ok to change the API so that `getbalance include_watchonly=true` works, otherwise there's no way to get the watchonly balance if not using the `-deprecatedrpc=accounts` argument. However, the help text needs to be updated to explain that the balance is calculated in a different way if the `include_watchonly` parameter is used.",https://github.com/bitcoin/bitcoin/pull/13461#issuecomment-399451677,399451677,
ryanofsky,2018-06-22T16:22:25Z,"> However, the help text needs to be updated to explain that the balance is calculated in a different way if the include_watchonly parameter is used.\n\nI don't think there's a technical reason why CWallet::GetBalance couldn't support the same `isminefilter filter` and `int minDepth` options that `CWallet::GetLegacyBalance` takes. It should just be matter of forwarding the arguments down to `CWa",https://github.com/bitcoin/bitcoin/pull/13461#issuecomment-399499483,399499483,
sipa,2018-06-22T16:23:39Z,There is also CWallet::GetWatchOnlyBalance,https://github.com/bitcoin/bitcoin/pull/13461#issuecomment-399499877,399499877,
jonasschnelli,2018-06-27T07:07:00Z,"Added min/max conf filter for `GetWatchOnlyBalance()` and started to use this method for getbalance in conjunction with watchonly. Refactored `GetUnconfirmedWatchOnlyBalance()`.\n\nNot sure if this is better since the main goal of this PR is to avoid an API break in 0.17.\nThe balance methods probably need refactoring which is not the main intention here.\n\nPing @sipa @ryanofsky ",https://github.com/bitcoin/bitcoin/pull/13461#issuecomment-400565896,400565896,
ryanofsky,2018-06-27T14:03:33Z,"Didn't look extremely close but it seems like 9bbd407936f399c706bbc70c8b5ffa0bba0cfec9 has a few issues:\n\n* It pretends both minconf and watchonly arguments are null if only one of them is null, instead of warning the user about the ignored option (or simply handling it).\n* It interprets ""include_watchonly"" as just GetWatchOnlyBalance instead of GetWatchOnlyBalance + GetBalance?\n* Seems to",https://github.com/bitcoin/bitcoin/pull/13461#issuecomment-400683096,400683096,
jnewbery,2018-06-27T18:45:35Z,"I think https://github.com/jnewbery/bitcoin/tree/fix_get_balance does what's required:\n\n- minconf and watchonly can be set/unset independently\n- if `-deprecatedrpc=accounts` is set and `getbalance ""*"" <int> <bool>` is called, then `GetLegacyBalance()` is used (unchanged behaviour)\n- if `getbalance minconf=<int> include_watchonly=<bool>` is called without an account, then `GetBalance()` is ",https://github.com/bitcoin/bitcoin/pull/13461#issuecomment-400789342,400789342,
ryanofsky,2018-06-27T19:17:56Z,"> @ryanofsky - is that what you had in mind?\n\nYes, changes from https://github.com/bitcoin/bitcoin/compare/master...jnewbery:fix_get_balance are what I was suggesting. Some thoughts looking at code:\n\n- It seems like it would be good to raise an error if `IsDeprecatedRPCEnabled(""accounts"")` and the account argument is not null or ""*"". Otherwise the argument would be silently ignored.\n- Do",https://github.com/bitcoin/bitcoin/pull/13461#issuecomment-400798504,400798504,
jnewbery,2018-06-27T19:30:37Z,"Thanks @ryanofsky . @jonasschnelli - if you're amenable, I'm happy to open a new PR for this. Also feel free to take my commits and address Russ's comments if you'd prefer.",https://github.com/bitcoin/bitcoin/pull/13461#issuecomment-400801908,400801908,
jonasschnelli,2018-06-28T18:40:29Z,Closing in favour of https://github.com/jnewbery/bitcoin/commits/fix_get_balance,https://github.com/bitcoin/bitcoin/pull/13461#issuecomment-401133465,401133465,
