DrahtBot,2020-07-23 01:41:56,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19673 (Move cs_vSend into SocketSendData and resolve RecordBytesSent lock inconsistency by troygiorshev)\n* #19509 (Per-P",https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-662780381,662780381,
troygiorshev,2020-07-24 12:51:39,"~ACK faae6ca9e8a3f67c737c03e122fd315cef5e66d7~\n\n~Reviewed, ran tests.~\n\n~This is a nice readability improvement too ðŸ“–~\n\nChanged my mind, see below.",https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-663522773,663522773,
jnewbery,2020-07-31 16:36:30,"> getnettotals returns ""stale"" values or values that don't add up\n\nCan you explain this a bit? What do the values not add up to? As far as I can tell, `getnettotals` simply returns the totalbytessent and totalbytesreceived at some point in time. There are not consistency guarantees with subsequent calls to the `getpeerinfo` values.",https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-667217798,667217798,
troygiorshev,2020-08-05 21:44:58,"I've changed my mind on this one.  `getnettotals` and `getpeerinfo` are two separate rpcs, we shouldn't try and make them sync up.  `nTotalBytesSent` is separate from a node's `nSendBytes`.  Looking at the analogous structures on the receiving side, `nTotalBytesRecv` is clearly separate from `nRecvBytes`.\n\nHowever, I think a PR like this is needed to bring consistency between the two calls to ",https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-669529191,669529191,
MarcoFalke,2020-08-27 15:09:10,"> I've changed my mind on this one. getnettotals and getpeerinfo are two separate rpcs, we shouldn't try and make them sync up. nTotalBytesSent is separate from a node's nSendBytes. Looking at the analogous structures on the receiving side, nTotalBytesRecv is clearly separate from nRecvBytes.\n\nWhy are they separate? Let's assume we connect to a peer, send 100 bytes, disconnect. Send 100 bytes ",https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-682009846,682009846,
troygiorshev,2020-08-27 15:35:35,"> Why are they separate? Let's assume we connect to a peer, send 100 bytes, disconnect. Send 100 bytes to another peer, then the total bytes sent should simply equal 200 bytes.\n\nMaybe I'm completely off-base here, I'm not trying to make a big statement.\n\nIsn't it impossible to keep these RPCs synced?  They are two separate calls, something might happen in between them.\n\n1. Call `getnet",https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-682025637,682025637,
MarcoFalke,2020-08-27 15:51:32,"Ok, I see. The reason I created this pull was that a call to\n\n```\n        net_totals_before = self.nodes[0].getnettotals()\n        peer_info = self.nodes[0].getpeerinfo()\n        net_totals_after = self.nodes[0].getnettotals()\n```\n\nand then asserting that `before <= sum <= after` would sometimes fail.\n\nI haven't looked into #19673 so I am wondering if #19673 also fixes that iss",https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-682034739,682034739,
troygiorshev,2020-08-27 15:57:41,"^\n\nWoah that shouldn't happen.  Will investigate.",https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-682038152,682038152,
MarcoFalke,2020-08-27 16:14:23,#17107 ,https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-682047653,682047653,
jnewbery,2020-10-28 09:00:25,"> a call to\n>\n>        net_totals_before = self.nodes[0].getnettotals()\n>        peer_info = self.nodes[0].getpeerinfo()\n>        net_totals_after = self.nodes[0].getnettotals()\n>\n> and then asserting that before <= sum <= after would sometimes fail.`\n\nWhat is `sum` here? Are you saying that `getnettotals.totalbytessent` can go down?\n\nI don't understand the problem you're tryin",https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-717793951,717793951,
MarcoFalke,2020-10-28 09:19:55,"> Are you saying that getnettotals.totalbytessent can go down?\n\nNo, it is returning the value it returned in a previous call. But getpeerinfo already returned the new correct value.\n\nhttps://github.com/bitcoin/bitcoin/issues/17107#issuecomment-541081114\n\n",https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-717804650,717804650,
jnewbery,2020-10-28 09:34:43,"I agree with Wlad's assessment in that issue:\n\n> these are meant to be overall statistics, it doesn't seem super important that the net totals are immediately up to date.",https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-717812591,717812591,
MarcoFalke,2020-10-28 09:42:05,"Ok, then the test is wrong and should be removed:\n\n```diff\ndiff --git a/test/functional/rpc_net.py b/test/functional/rpc_net.py\nindex 03c858c694..afb67891af 100755\n--- a/test/functional/rpc_net.py\n+++ b/test/functional/rpc_net.py\n@@ -104,29 +104,15 @@ class NetTest(BitcoinTestFramework):\n \n     def test_getnettotals(self):\n         self.log.info(""Test getnettotals"")\n-        ",https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-717816363,717816363,
jnewbery,2020-10-28 10:19:13,"> the test is wrong and should be removed:\n\nDone: #20258",https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-717836357,717836357,
MarcoFalke,2020-10-28 10:21:53,thanks,https://github.com/bitcoin/bitcoin/pull/18784#issuecomment-717837760,717837760,
