[
  {
    "sha": "f996ff8bbede9168ec2dfef93d307628953a1441",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmOTk2ZmY4YmJlZGU5MTY4ZWMyZGZlZjkzZDMwNzYyODk1M2ExNDQx",
    "commit": {
      "author": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2020-03-02T18:06:18Z"
      },
      "committer": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2020-03-02T18:06:18Z"
      },
      "message": "assert_fee_amount should round down",
      "tree": {
        "sha": "1e2c49b9dc13125274bc8b4479a1629cfcfd2726",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1e2c49b9dc13125274bc8b4479a1629cfcfd2726"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/f996ff8bbede9168ec2dfef93d307628953a1441",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f996ff8bbede9168ec2dfef93d307628953a1441",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/f996ff8bbede9168ec2dfef93d307628953a1441",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f996ff8bbede9168ec2dfef93d307628953a1441/comments",
    "author": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "1f886243e464032123045cbf70ff2a72de9b9c80",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1f886243e464032123045cbf70ff2a72de9b9c80",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/1f886243e464032123045cbf70ff2a72de9b9c80"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "e68170c62332801db97ed7a79472cd64e3a60023",
        "filename": "test/functional/test_framework/util.py",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/f996ff8bbede9168ec2dfef93d307628953a1441/test/functional/test_framework/util.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/f996ff8bbede9168ec2dfef93d307628953a1441/test/functional/test_framework/util.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/test_framework/util.py?ref=f996ff8bbede9168ec2dfef93d307628953a1441",
        "patch": "@@ -34,7 +34,7 @@ def assert_approx(v, vexp, vspan=0.00001):\n \n def assert_fee_amount(fee, tx_size, fee_per_kB):\n     \"\"\"Assert the fee was in range\"\"\"\n-    target_fee = round(tx_size * fee_per_kB / 1000, 8)\n+    target_fee = Decimal(tx_size * fee_per_kB / 1000).quantize(Decimal('.00000001'), rounding=ROUND_DOWN)\n     if fee < target_fee:\n         raise AssertionError(\"Fee of %s BTC too low! (Should be %s BTC)\" % (str(fee), str(target_fee)))\n     # allow the wallet's estimation to be at most 2 bytes off"
      }
    ]
  },
  {
    "sha": "64eca91294608353759844a65b0e260bc3917509",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2NGVjYTkxMjk0NjA4MzUzNzU5ODQ0YTY1YjBlMjYwYmMzOTE3NTA5",
    "commit": {
      "author": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2020-03-02T18:07:04Z"
      },
      "committer": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2020-03-02T18:10:00Z"
      },
      "message": "0 < conf_target < 1008 for RPC",
      "tree": {
        "sha": "a51b652fe8590cc6d32982da628bef62c39bcbe4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a51b652fe8590cc6d32982da628bef62c39bcbe4"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/64eca91294608353759844a65b0e260bc3917509",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/64eca91294608353759844a65b0e260bc3917509",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/64eca91294608353759844a65b0e260bc3917509",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/64eca91294608353759844a65b0e260bc3917509/comments",
    "author": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f996ff8bbede9168ec2dfef93d307628953a1441",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f996ff8bbede9168ec2dfef93d307628953a1441",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f996ff8bbede9168ec2dfef93d307628953a1441"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 5,
      "deletions": 0
    },
    "files": [
      {
        "sha": "3b50ba4a5b6ba629d359a7252389dccdd2cf80de",
        "filename": "test/functional/feature_fee_estimation.py",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/64eca91294608353759844a65b0e260bc3917509/test/functional/feature_fee_estimation.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/64eca91294608353759844a65b0e260bc3917509/test/functional/feature_fee_estimation.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_fee_estimation.py?ref=64eca91294608353759844a65b0e260bc3917509",
        "patch": "@@ -13,6 +13,7 @@\n     assert_equal,\n     assert_greater_than,\n     assert_greater_than_or_equal,\n+    assert_raises_rpc_error,\n     connect_nodes,\n     satoshi_round,\n )\n@@ -226,6 +227,10 @@ def run_test(self):\n         self.fees_per_kb = []\n         self.memutxo = []\n         self.confutxo = self.txouts  # Start with the set of confirmed txouts after splitting\n+\n+        assert_raises_rpc_error(-8, \"Invalid conf_target, must be between 1 - 1008\", self.nodes[0].estimatesmartfee, 0)\n+        assert_raises_rpc_error(-8, \"Invalid conf_target, must be between 1 - 1008\", self.nodes[0].estimatesmartfee, 1009)\n+\n         self.log.info(\"Will output estimates for 1/2/3/6/15/25 blocks\")\n \n         for i in range(2):"
      }
    ]
  },
  {
    "sha": "31bdc33baadaf73898e383517d8e269c920d235b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozMWJkYzMzYmFhZGFmNzM4OThlMzgzNTE3ZDhlMjY5YzkyMGQyMzVi",
    "commit": {
      "author": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2020-03-02T18:07:50Z"
      },
      "committer": {
        "name": "Gregory Sanders",
        "email": "gsanders87@gmail.com",
        "date": "2020-03-02T18:13:19Z"
      },
      "message": "Test that wallet is using correct conf_target feerates when prescribed",
      "tree": {
        "sha": "a38b7ed5f56a8dff831bdcf9b9da78c8400054cb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a38b7ed5f56a8dff831bdcf9b9da78c8400054cb"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/31bdc33baadaf73898e383517d8e269c920d235b",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/31bdc33baadaf73898e383517d8e269c920d235b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/31bdc33baadaf73898e383517d8e269c920d235b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/31bdc33baadaf73898e383517d8e269c920d235b/comments",
    "author": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "instagibbs",
      "id": 5767891,
      "node_id": "MDQ6VXNlcjU3Njc4OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5767891?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/instagibbs",
      "html_url": "https://github.com/instagibbs",
      "followers_url": "https://api.github.com/users/instagibbs/followers",
      "following_url": "https://api.github.com/users/instagibbs/following{/other_user}",
      "gists_url": "https://api.github.com/users/instagibbs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/instagibbs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/instagibbs/subscriptions",
      "organizations_url": "https://api.github.com/users/instagibbs/orgs",
      "repos_url": "https://api.github.com/users/instagibbs/repos",
      "events_url": "https://api.github.com/users/instagibbs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/instagibbs/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "64eca91294608353759844a65b0e260bc3917509",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/64eca91294608353759844a65b0e260bc3917509",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/64eca91294608353759844a65b0e260bc3917509"
      }
    ],
    "stats": {
      "total": 32,
      "additions": 32,
      "deletions": 0
    },
    "files": [
      {
        "sha": "86b35cde8e229054dfe9b4aeb66c447c42c4d843",
        "filename": "test/functional/feature_fee_estimation.py",
        "status": "modified",
        "additions": 32,
        "deletions": 0,
        "changes": 32,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/31bdc33baadaf73898e383517d8e269c920d235b/test/functional/feature_fee_estimation.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/31bdc33baadaf73898e383517d8e269c920d235b/test/functional/feature_fee_estimation.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_fee_estimation.py?ref=31bdc33baadaf73898e383517d8e269c920d235b",
        "patch": "@@ -11,6 +11,7 @@\n from test_framework.test_framework import BitcoinTestFramework\n from test_framework.util import (\n     assert_equal,\n+    assert_fee_amount,\n     assert_greater_than,\n     assert_greater_than_or_equal,\n     assert_raises_rpc_error,\n@@ -253,6 +254,37 @@ def run_test(self):\n         self.log.info(\"Final estimates after emptying mempools\")\n         check_estimates(self.nodes[1], self.fees_per_kb)\n \n+        # TODO Move these tests to wallet_bumpfee.py once feerates\n+        # are mock-able. See issue https://github.com/bitcoin/bitcoin/issues/18243\n+        self.log.info(\"Testing conf_target transactions and bumps when estimator isn't 'blank'\")\n+\n+        # Gather 3 key estimates that should significantly differ\n+        slow_conf = 100\n+        med_conf = 5\n+        fast_conf = 1\n+        slow_fee = self.nodes[0].estimatesmartfee(slow_conf)[\"feerate\"]\n+        med_fee = self.nodes[0].estimatesmartfee(med_conf)[\"feerate\"]\n+        fast_fee = self.nodes[0].estimatesmartfee(fast_conf)[\"feerate\"]\n+\n+        assert slow_fee < med_fee\n+        assert med_fee < fast_fee\n+\n+        # Send and bump twice with varying confTarget\n+        txid1 = self.nodes[0].sendtoaddress(self.nodes[0].getnewaddress(), 1, \"\", \"\", False, True, slow_conf)\n+        tx1_info = self.nodes[0].getmempoolentry(txid1)\n+        assert_fee_amount(tx1_info[\"fee\"], tx1_info[\"vsize\"], slow_fee)\n+\n+        txid2 =  self.nodes[0].bumpfee(txid1, {\"confTarget\":med_conf})[\"txid\"]\n+        tx2_info = self.nodes[0].getmempoolentry(txid2)\n+        assert_fee_amount(tx2_info[\"fee\"], tx2_info[\"vsize\"], med_fee)\n+        assert txid2 in self.nodes[0].getrawmempool()\n+        assert txid1 not in self.nodes[0].getrawmempool()\n+\n+        txid3 =  self.nodes[0].bumpfee(txid2, {\"confTarget\":fast_conf})[\"txid\"]\n+        tx3_info = self.nodes[0].getmempoolentry(txid3)\n+        assert_fee_amount(tx3_info[\"fee\"], tx3_info[\"vsize\"], fast_fee)\n+        assert txid3 in self.nodes[0].getrawmempool()\n+        assert txid2 not in self.nodes[0].getrawmempool()\n \n if __name__ == '__main__':\n     EstimateFeeTest().main()"
      }
    ]
  }
]