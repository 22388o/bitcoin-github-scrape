[
  {
    "sha": "2f6b466aeb6d4c88ab2e0e8b2a402be0743608b5",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyZjZiNDY2YWViNmQ0Yzg4YWIyZTBlOGIyYTQwMmJlMDc0MzYwOGI1",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2018-10-06T10:33:24Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2018-10-08T05:15:27Z"
      },
      "message": "Stop requiring imported pubkey to sign non-PKH schemes",
      "tree": {
        "sha": "541dcf9a99d23943d0c539b3b40ba3c521494049",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/541dcf9a99d23943d0c539b3b40ba3c521494049"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2f6b466aeb6d4c88ab2e0e8b2a402be0743608b5",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2f6b466aeb6d4c88ab2e0e8b2a402be0743608b5",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2f6b466aeb6d4c88ab2e0e8b2a402be0743608b5",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2f6b466aeb6d4c88ab2e0e8b2a402be0743608b5/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f504a1402afd0760e9d348ecc8bad0094aa7d705",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f504a1402afd0760e9d348ecc8bad0094aa7d705",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f504a1402afd0760e9d348ecc8bad0094aa7d705"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 10,
      "deletions": 7
    },
    "files": [
      {
        "sha": "0042f35e2ef34f0123c88230b9dd6bf638ded231",
        "filename": "src/script/sign.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 7,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2f6b466aeb6d4c88ab2e0e8b2a402be0743608b5/src/script/sign.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2f6b466aeb6d4c88ab2e0e8b2a402be0743608b5/src/script/sign.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/sign.cpp?ref=2f6b466aeb6d4c88ab2e0e8b2a402be0743608b5",
        "patch": "@@ -73,15 +73,18 @@ static bool GetPubKey(const SigningProvider& provider, SignatureData& sigdata, c\n     return false;\n }\n \n-static bool CreateSig(const BaseSignatureCreator& creator, SignatureData& sigdata, const SigningProvider& provider, std::vector<unsigned char>& sig_out, const CKeyID& keyid, const CScript& scriptcode, SigVersion sigversion)\n+static bool CreateSig(const BaseSignatureCreator& creator, SignatureData& sigdata, const SigningProvider& provider, std::vector<unsigned char>& sig_out, const CPubKey& pubkey, const CScript& scriptcode, SigVersion sigversion)\n {\n+    CKeyID keyid = pubkey.GetID();\n     const auto it = sigdata.signatures.find(keyid);\n     if (it != sigdata.signatures.end()) {\n         sig_out = it->second.second;\n         return true;\n     }\n-    CPubKey pubkey;\n-    GetPubKey(provider, sigdata, keyid, pubkey);\n+    KeyOriginInfo info;\n+    if (provider.GetKeyOrigin(keyid, info)) {\n+        sigdata.misc_pubkeys.emplace(keyid, std::make_pair(pubkey, std::move(info)));\n+    }\n     if (creator.CreateSig(provider, sig_out, keyid, scriptcode, sigversion)) {\n         auto i = sigdata.signatures.emplace(keyid, SigPair(pubkey, sig_out));\n         assert(i.second);\n@@ -114,15 +117,15 @@ static bool SignStep(const SigningProvider& provider, const BaseSignatureCreator\n     case TX_WITNESS_UNKNOWN:\n         return false;\n     case TX_PUBKEY:\n-        if (!CreateSig(creator, sigdata, provider, sig, CPubKey(vSolutions[0]).GetID(), scriptPubKey, sigversion)) return false;\n+        if (!CreateSig(creator, sigdata, provider, sig, CPubKey(vSolutions[0]), scriptPubKey, sigversion)) return false;\n         ret.push_back(std::move(sig));\n         return true;\n     case TX_PUBKEYHASH: {\n         CKeyID keyID = CKeyID(uint160(vSolutions[0]));\n-        if (!CreateSig(creator, sigdata, provider, sig, keyID, scriptPubKey, sigversion)) return false;\n-        ret.push_back(std::move(sig));\n         CPubKey pubkey;\n         GetPubKey(provider, sigdata, keyID, pubkey);\n+        if (!CreateSig(creator, sigdata, provider, sig, pubkey, scriptPubKey, sigversion)) return false;\n+        ret.push_back(std::move(sig));\n         ret.push_back(ToByteVector(pubkey));\n         return true;\n     }\n@@ -138,7 +141,7 @@ static bool SignStep(const SigningProvider& provider, const BaseSignatureCreator\n         ret.push_back(valtype()); // workaround CHECKMULTISIG bug\n         for (size_t i = 1; i < vSolutions.size() - 1; ++i) {\n             CPubKey pubkey = CPubKey(vSolutions[i]);\n-            if (ret.size() < required + 1 && CreateSig(creator, sigdata, provider, sig, pubkey.GetID(), scriptPubKey, sigversion)) {\n+            if (ret.size() < required + 1 && CreateSig(creator, sigdata, provider, sig, pubkey, scriptPubKey, sigversion)) {\n                 ret.push_back(std::move(sig));\n             }\n         }"
      }
    ]
  }
]