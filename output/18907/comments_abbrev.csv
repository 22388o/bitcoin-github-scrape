ryanofsky,2020-05-07 19:39:52,"Concept ACK c1029c6ff3e58a64d0b07515f92938a717a42a02. This removes [database loading with no logs](https://www.youtube.com/watch?v=eUFY8Zw0Bag) behavior implemented in #2558 1859aafef0a273e27e886646e36140cc5e375ee1, which hopefully should be unnecessary now that the wallet flushes very frequently.\n\nThis change should reduce chances for data loss and provide better error feedback if there's an ",https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-625456981,625456981,
DrahtBot,2020-05-14 03:49:06,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19457 (wallet: Cleanup wallettool salvage and walletdb extraneous declarations by achow101)\n* #19335 (wallet: Cleanup an",https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-628369770,628369770,
ryanofsky,2020-05-19 19:14:37,"Some travis failures here. One in rpc_rawtransaction appears to be spurious https://travis-ci.org/github/bitcoin/bitcoin/jobs/684393890#L5036:\n\n```\n2020-05-07T18:54:10.222000Z TestFramework (ERROR): Unexpected exception caught during testing\nTraceback (most recent call last):\n  File ""/home/travis/build/bitcoin/bitcoin/ci/scratch/build/bitcoin-x86_64-pc-linux-gnu/test/functional/test_fram",https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-631027177,631027177,
achow101,2020-05-19 19:18:33,Cherrypicked the test and I think I've fixed the other test failures.,https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-631029099,631029099,
achow101,2020-05-19 21:49:45,"> Travis is failing again currently because test_runner test list is o\n\nFixed",https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-631102297,631102297,
MarcoFalke,2020-05-20 00:00:07,ci is failing. You might have to add a suppression to `./test/sanitizer_suppressions/lsan`,https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-631152346,631152346,
ryanofsky,2020-05-20 00:02:54,"Apparently the new wallet_db.py test exposes a memory leak that happens when BerkeleyEnvironment::Open fails: https://travis-ci.org/github/bitcoin/bitcoin/jobs/689013660#L4659\n\nI didn't look closely, but in case the leak does not seem to be something obvious, I'd forgive you if you just want to drop the test here and pretend the leak isn't happening. (I'm assuming it is pre-existing.) I can fo",https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-631153346,631153346,
achow101,2020-05-20 17:31:09,I think I've fixed the memory leak.,https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-631618171,631618171,
achow101,2020-05-20 20:03:23,"Hmm. Guess that didn't fix it. I think I'll just ignore this leak for now. I think this leak also exists on master, so it's not a regression.",https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-631696053,631696053,
ryanofsky,2020-05-20 22:39:36,"re: https://github.com/bitcoin/bitcoin/pull/18907#pullrequestreview-415756008\n\n> I'll file an issue for fixing the memory leak and adding back the test\n\nFiled #19034",https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-631766158,631766158,
achow101,2020-06-29 15:13:51,"> Same error with or without this commit; bdb 18 is probably just too new.\n\nIt is. The best version to test with is probably 5.x as it will produce compatible/identical wallet.dat files but incompatible logs.",https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-651185501,651185501,
achow101,2020-07-11 15:19:11,Had to rebase. Fixed the typo and added a bit to the commit message.,https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-657079713,657079713,
Sjors,2020-07-14 19:00:13,re-utACK d0ea9bab2804928c9f40def61fd99064d2d8f9b8,https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-658355692,658355692,
MarcoFalke,2020-07-22 06:56:58,"Tested:\n\n```\n$  ./src/bitcoin-cli -regtest getnewaddress\n2020-07-22T06:50:11Z [default wallet] keypool reserve 2\n2020-07-22T06:50:11Z [default wallet] keypool keep 2\nbitcoind: wallet/rpcwallet.cpp:278: UniValue getnewaddress(const JSONRPCRequest&): Assertion `false' failed.\nerror: Could not connect to the server 127.0.0.1:18443 (error code 1 - ""EOF reached"")\n\nMake sure the bitcoi",https://github.com/bitcoin/bitcoin/pull/18907#issuecomment-662278993,662278993,
MarcoFalke,2020-05-21 12:56:12,"```suggestion\n            err += Untranslated("" "") + _(""This error could occur if this wallet was not shutdown cleanly and was last loaded using a build with a newer version of Berkeley DB. If so, please use the software that last loaded this wallet"");\n```\n\nThere is a typo in the translation message. Also, this can be written shorter by just appending the more precise reason. (You might ha",https://github.com/bitcoin/bitcoin/pull/18907#discussion_r428633987,428633987,src/wallet/db.cpp
achow101,2020-05-21 17:16:04,Will fix if I have to push another change.,https://github.com/bitcoin/bitcoin/pull/18907#discussion_r428794856,428794856,src/wallet/db.cpp
achow101,2020-06-17 14:49:10,Done,https://github.com/bitcoin/bitcoin/pull/18907#discussion_r441604742,441604742,src/wallet/db.cpp
Sjors,2020-06-29 08:56:52,nit: `newver` typo,https://github.com/bitcoin/bitcoin/pull/18907#discussion_r446873740,446873740,src/wallet/bdb.cpp
achow101,2020-07-11 15:18:53,Fixed.,https://github.com/bitcoin/bitcoin/pull/18907#discussion_r453204758,453204758,src/wallet/bdb.cpp
MarcoFalke,2020-07-22 06:59:38,"style-nit: Could upgrade to the new style while touching the line\n```suggestion\n        if (!env->Open(open_err)) {\n```",https://github.com/bitcoin/bitcoin/pull/18907#discussion_r458576029,458576029,src/wallet/bdb.cpp
