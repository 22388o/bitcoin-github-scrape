gmaxwell,2016-11-01T06:01:39Z,"I believe that with this change if a whitelisted peer gives us a transaction with internally duplicated inputs, we will relay it (CheckTransaction will pass, conflict with the mempool will not set DoS.) and then our peers running without this change will ban us (Their CheckTransaction will fail). Less critically, this change results in txn with internal doublespends getting a misleading log entry ",https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-257495287,257495287,
TheBlueMatt,2016-11-01T17:35:43Z,Simplified diff and fixed.\n,https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-257634590,257634590,
gmaxwell,2016-11-02T04:21:05Z,utACK +/- comment nit.\n,https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-257768800,257768800,
TheBlueMatt,2016-11-02T11:32:32Z,"Eek, license change was a mistake, sorry.\n\nOn November 2, 2016 5:29:28 AM EDT, ""Wladimir J. van der Laan"" notifications@github.com wrote:\n\n> laanwj requested changes on this pull request.\n> \n> > @@ -0,0 +1,53 @@\n> > +// Copyright (c) 2016 Matt Corallo\n> > +// Unlike the rest of Bitcoin Core, this file is\n> > +// distributed under the Affero General Public License (AGPL v3)\n> \n> Code und",https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-257839954,257839954,
TheBlueMatt,2016-11-02T14:06:43Z,Fixed the broken license header.\n,https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-257874175,257874175,
sipa,2016-11-03T07:25:13Z,"A very interesting duplication of the word ""duplicate"" in the PR title.\n",https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-258077573,258077573,
sipa,2016-11-07T22:27:40Z,@laanwj I believe you need to dismiss the requested changes (as they're addressed).\n,https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-258983712,258983712,
laanwj,2016-11-08T09:08:21Z,Approved the requested change.\nBTW: `block413567.hex.h` is a 6MB file - I'd prefer generating this on the fly as we do with the other .X.h files.\nEdit: working on build system change for this...\n,https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-259083061,259083061,
laanwj,2016-11-08T09:29:07Z,"Can you please squash the top commit of https://github.com/laanwj/bitcoin/tree/2016_11_generate_bench_file into the benchmark commit?\n\nThis has the necessary build system change to generate the block.hex file on the fly from the raw data, like with the tests.\n\n@theuni can you have take a look too perhaps?\n",https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-259087570,259087570,
theuni,2016-11-08T20:22:51Z,"@laanwj looks good to me. Only slight criticism is that we may want to generate .h/.cpp pairs for blocks to ensure that they end up in separate compilation units, but we can always address that later if it becomes an issue.\n",https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-259248755,259248755,
laanwj,2016-11-09T06:36:29Z,"> @laanwj looks good to me. Only slight criticism is that we may want to generate .h/.cpp pairs for blocks to ensure that they end up in separate compilation units, but we can always address that later if it becomes an issue.\n\nFully agree. On the long run, I'd like to forego the conversion to hex and subsequent compilation entirely on build chains that supports this, by embedding the binary dire",https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-259343753,259343753,
TheBlueMatt,2016-11-09T19:30:28Z,Picked up (and squashed) @laanwj's changes and went ahead and remove the duplicate-lookup for ATMP uses.\n,https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-259503632,259503632,
ripper234,2018-09-22T05:32:34Z,"So, if I understand correctly, this caused [CVE-2018-17144](https://bitcoincore.org/en/2018/09/20/notice/).\n\nCan we do a root cause analysis / [5 whys](https://en.wikipedia.org/wiki/5_Whys) explaining how this was introduced?",https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-423718320,423718320,
thijstriemstra,2018-09-22T16:00:26Z,"It's scary to see how this code was merged with so much confidence. The fact there wasn't a unit test covering this piece of code makes me feel little better though, a bad unit test would be even worse. I hope btc core will never accept contributions without tests again.",https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-423753967,423753967,
dfoderick,2018-09-22T20:14:16Z,"> \n> Can we do a root cause analysis / [5 whys](https://en.wikipedia.org/wiki/5_Whys) explaining how this was introduced?\n\nShort version.\nThis pull request added a boolean parameter to CheckTransaction method  \n`bool CheckTransaction(const CTransaction& tx, CValidationState &state, bool fCheckDuplicateInputs)`\n\nThen in CheckBlock method the flag was passed in as false bypassing the c",https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-423770220,423770220,
ripper234,2018-09-23T05:13:09Z,Why this passed code review? (How many people reviewed it?),https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-423792528,423792528,
adlai,2018-09-23T10:22:15Z,"@ripper234 commented [5 hours ago](https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-423792528)\n> Why this passed code review? (How many people reviewed it?) [sic]\n\nI'm sure Microsoft is the right corporate person to ask.",https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-423806031,423806031,
ripper234,2018-09-23T18:41:26Z,?,https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-423837854,423837854,
scravy,2018-09-24T10:31:07Z,"@dfoderick I question that these questions are in the spirit of a 5 whys root-cause analysis. You are supposed to go deeper, not wider as you do.\n\nAnyhow, the PR merged here was a refactoring and performance improvement, and there already was no test that could have been broken by this; which I believe to be the real culprit.",https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-423932834,423932834,
dfoderick,2018-09-24T15:36:44Z,"> Anyhow, the PR merged here was a refactoring and performance improvement, and there already was no test that could have been broken by this; which I believe to be the real culprit.\n\nCorrect. The test for this bug did not exist at the time and was only recently added.\nhttps://github.com/bitcoin/bitcoin/commit/9b4a36effcf642f3844c6696b757266686ece11a\n\nThere was a bench test to prove the ",https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-424019786,424019786,
adlai,2018-09-25T09:46:01Z,"@ripper234 commented [2 days ago](https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-423837854)\n> ?\n\nI'm gonna assume your eloquence was directed at me; if you're not the antecedent of that pronoun, or my assumption was asinine, please ignore this message!\n\n@ripper234, if you truly care about ""why this passed code review"" (See how here the grammar is correct, and there's no need f",https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-424276740,424276740,
jnewbery,2018-09-25T16:13:42Z,"I suggest we lock this PR. For all the drive-by commenters two years after the fact: if you're serious about wanting to improve security and code quality in Bitcoin Core, you can start by:\n- testing release candidates\n- reviewing open PRs\n- contributing code",https://github.com/bitcoin/bitcoin/pull/9049#issuecomment-424407334,424407334,
gmaxwell,2016-11-02T04:20:53Z,point out that it's also redundant there please!\n,https://github.com/bitcoin/bitcoin/pull/9049#discussion_r86071279,86071279,src/main.cpp
laanwj,2016-11-02T09:29:11Z,"Code under this license cannot be accepted, sorry\n",https://github.com/bitcoin/bitcoin/pull/9049#discussion_r86101018,86101018,src/bench/checkblock.cpp
gmaxwell,2016-11-03T19:52:05Z,lol. I didn't notice that.\n,https://github.com/bitcoin/bitcoin/pull/9049#discussion_r86428610,86428610,src/bench/checkblock.cpp
theuni,2016-11-08T21:58:34Z,"Also worth noting (though not really related here), I measure a ~20%-25% time reduction by avoiding doing 2 lookups:\n\n``` c++\nstd::set<COutPoint> vInOutPoints;\nfor (const auto& txin : tx.vin)\n{\n    if (!vInOutPoints.insert(txin.prevout).second)\n        return state.DoS(100, false, REJECT_INVALID, ""bad-txns-inputs-duplicate"");\n}\n```\n",https://github.com/bitcoin/bitcoin/pull/9049#discussion_r87093282,87093282,src/main.cpp
dexX7,2018-09-19T06:21:41Z,How is it redundant? Can you point to the case where it's checked a second time?,https://github.com/bitcoin/bitcoin/pull/9049#discussion_r218679843,218679843,src/main.cpp
