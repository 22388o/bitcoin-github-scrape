MarcoFalke,2018-09-28T16:05:38Z,"You accidentally removed a circular dependency:\n\n```\nGood job! The circular dependency ""wallet/rpcwallet -> wallet/wallet -> wallet/rpcwallet"" is no longer present.",https://github.com/bitcoin/bitcoin/pull/14350#issuecomment-425484809,425484809,
practicalswift,2018-09-28T16:33:46Z,"Concept ACK\n\nNice bonus with the removed circular dependency!",https://github.com/bitcoin/bitcoin/pull/14350#issuecomment-425493120,425493120,
DrahtBot,2018-09-28T17:32:11Z,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14552](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14552.html) (wallet: detecting duplicate wallet by compa",https://github.com/bitcoin/bitcoin/pull/14350#issuecomment-425510021,425510021,
promag,2018-10-09T21:51:08Z,I've rebase this with #14291 to avoid conflicts. Please review that one first.,https://github.com/bitcoin/bitcoin/pull/14350#issuecomment-428365420,428365420,
ryanofsky,2018-10-18T21:09:37Z,"This PR is doing two different things:\n\n1. Adding a `WalletInfo` class to hold information about a wallet's location.\n2. Introducing a filesystem heuristic to determine whether or not a wallet is ""external"" and exposing this property over RPC.\n\nI like the first thing, but don't think I like or understand the second thing and would prefer to see all of the `m_external`/`IsExternal`/`""exte",https://github.com/bitcoin/bitcoin/pull/14350#issuecomment-431164396,431164396,
promag,2018-10-18T21:28:17Z,"Thanks @ryanofsky: \n\n 1. `WalletInfo` comes from `QFileInfo`, but I agree the name is not clear. `WalletLocation` is too specific to paths? \n 2. Sure I can move to other PR, but the idea is to separate internal wallets and external wallets in the UI.\n\n> filesystem heuristic\n\nIIUC wallets inside `-walletdir` are internal, the others are external?",https://github.com/bitcoin/bitcoin/pull/14350#issuecomment-431170255,431170255,
ryanofsky,2018-10-18T21:45:36Z,"I hope you will move the external stuff to a separate PR with a justification about why it is useful, so reviewers don't need to guess and speculate about what it's for (I don't have an idea), and so we can talk about it separately from this refactoring stuff.\n\nAlso, could you be clearer about what the problem is with WalletLocation? For example, does it imply something about the class which i",https://github.com/bitcoin/bitcoin/pull/14350#issuecomment-431174907,431174907,
promag,2018-10-18T22:04:03Z,"> For example, does it imply something about the class which isn't true?\n\nIf `GetName()`, `GetDisplayName()` and eventually other attributes like `IsExternal` fit `WalletLocation` then I'm fine with that.",https://github.com/bitcoin/bitcoin/pull/14350#issuecomment-431179693,431179693,
promag,2018-10-18T23:15:56Z,"Took both suggestions from @ryanofsky and rebased.\n\nThis is a dependency for full multi wallet support in the UI â€” there was a lot of duplicate code in #13100.",https://github.com/bitcoin/bitcoin/pull/14350#issuecomment-431194916,431194916,
promag,2018-10-19T21:40:30Z,@ryanofsky ok. The problem I had was when I opened an external wallet (with the file dialog) that was in the wallet dir. Whatever the user chooses it should be resolved. I can leave this problem for a later PR though.,https://github.com/bitcoin/bitcoin/pull/14350#issuecomment-431507367,431507367,
ryanofsky,2018-10-22T17:55:24Z,"> The problem I had was when I opened an external wallet (with the file dialog) that was in the wallet dir. Whatever the user chooses it should be resolved.\n\nI think loading a wallet from the gui can basically work the same as calling the `loadwallet` RPC except if a user browsed for a wallet path, and the path is literally underneath `<walletdir>`, then the `<walletdir>` prefix should get str",https://github.com/bitcoin/bitcoin/pull/14350#issuecomment-431915078,431915078,
ken2812221,2018-10-30T09:15:51Z,utACK 65f3672f3b82a6fa30e5171f85bc8d8a29e0797e,https://github.com/bitcoin/bitcoin/pull/14350#issuecomment-434225691,434225691,
laanwj,2018-11-01T16:01:15Z,"utACK 65f3672f3b82a6fa30e5171f85bc8d8a29e0797e\n\n> It's not terrible, but I think it'd be better not to have berkeley stuff baked into the WalletLocation interface. \n\nI tend to agree, it's best to keep it more or less database independent. No matter the rest of the change it should at least not become *more difficult* to swap for another database.\n",https://github.com/bitcoin/bitcoin/pull/14350#issuecomment-435089775,435089775,
meshcollider,2018-11-04T18:49:58Z,re-utACK https://github.com/bitcoin/bitcoin/commit/65f3672f3b82a6fa30e5171f85bc8d8a29e0797e,https://github.com/bitcoin/bitcoin/pull/14350#issuecomment-435695310,435695310,
practicalswift,2018-09-29T06:55:50Z,Remove trailing semi-colon :-),https://github.com/bitcoin/bitcoin/pull/14350#discussion_r221418680,221418680,src/wallet/walletutil.h
practicalswift,2018-09-29T06:59:51Z,Make this `const` ref? :-),https://github.com/bitcoin/bitcoin/pull/14350#discussion_r221418793,221418793,src/wallet/wallet.cpp
practicalswift,2018-09-29T07:01:38Z,`IsExternal()` and `m_external` seem unused?,https://github.com/bitcoin/bitcoin/pull/14350#discussion_r221418836,221418836,src/wallet/walletutil.h
promag,2018-09-29T09:35:03Z,"Now it's used, I was going to push it in another PR.",https://github.com/bitcoin/bitcoin/pull/14350#discussion_r221422545,221422545,src/wallet/walletutil.h
promag,2018-10-09T21:56:52Z,"Self review, I have to update this comment and move to WalletInfo.",https://github.com/bitcoin/bitcoin/pull/14350#discussion_r223877658,223877658,src/wallet/wallet.h
meshcollider,2018-10-18T23:36:58Z,This no longer puts brackets around the filename if it isn't the default wallet?,https://github.com/bitcoin/bitcoin/pull/14350#discussion_r226497583,226497583,src/wallet/walletutil.cpp
meshcollider,2018-10-18T23:39:33Z,"Why does this mock wallet have a name, where all the other replacements you made don't?",https://github.com/bitcoin/bitcoin/pull/14350#discussion_r226497970,226497970,src/qt/test/wallettests.cpp
ryanofsky,2018-10-19T21:16:05Z,"This code added here is more complicated than it needs to be and it is not a refactoring because it would change behavior, and in bad ways for windows and case insensitive filesystems. If the intention is to change behavior, this should be done in separate, smaller PR and accompanied by tests so it can be better understood and discussed. For a clean refactoring in this PR, this entire function sho",https://github.com/bitcoin/bitcoin/pull/14350#discussion_r226784073,226784073,src/wallet/walletutil.cpp
ryanofsky,2018-10-19T21:20:45Z,I think you could drop this and just rely on the default copy constructor.,https://github.com/bitcoin/bitcoin/pull/14350#discussion_r226785016,226785016,src/wallet/walletutil.h
ryanofsky,2018-10-19T21:28:21Z,"Having both `GetName` and `GetFileName` in this class is unnecessarily confusing, and how these functions are called breaks current behavior. I can see why it'd be useful to use canonicalized wallet names in the gui in the future, but I think that functionality should be added separately when it's actually ready to be used.",https://github.com/bitcoin/bitcoin/pull/14350#discussion_r226786643,226786643,src/wallet/walletutil.h
ryanofsky,2018-10-25T15:42:11Z,"Possible future improvement: It might be nice to add a `WalletLocation` method to hold directory checking logic below. Maybe `WalletLocation::HasData`, or `WalletLocation::IsEmpty`, or something like that. After #14552 (aef19be5851ceb3b324fd80756060a00aad8e61c) this could also use `SplitWalletPath`.",https://github.com/bitcoin/bitcoin/pull/14350#discussion_r228228351,228228351,src/wallet/rpcwallet.cpp
promag,2018-10-26T21:48:02Z,Is it bad to add `WalletLocation::GetEnvironmentPath()` and `WalletLocation::GetDatabasePath()`?,https://github.com/bitcoin/bitcoin/pull/14350#discussion_r228674310,228674310,src/wallet/rpcwallet.cpp
ryanofsky,2018-10-30T18:35:07Z,"> Is it bad to add WalletLocation::GetEnvironmentPath() and WalletLocation::GetDatabasePath()?\n\nIt's not terrible, but I think it'd be better not to have berkeley stuff baked into the WalletLocation interface. Maybe a wallet location doesn't need to be a btree file and environment directory. Maybe it could be some other type of database path or connection string.\n\nI think it would be an im",https://github.com/bitcoin/bitcoin/pull/14350#discussion_r229434830,229434830,src/wallet/rpcwallet.cpp
