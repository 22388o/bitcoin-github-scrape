[
  {
    "sha": "75a08e7d17da9db2ac0e9f55a4286dda912385bc",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3NWEwOGU3ZDE3ZGE5ZGIyYWMwZTlmNTVhNDI4NmRkYTkxMjM4NWJj",
    "commit": {
      "author": {
        "name": "Kalle Alm",
        "email": "kalle.alm@gmail.com",
        "date": "2017-04-17T14:32:01Z"
      },
      "committer": {
        "name": "Kalle Alm",
        "email": "kalle.alm@gmail.com",
        "date": "2017-04-17T14:35:53Z"
      },
      "message": "[wallet] Add support for aborting wallet transaction rescans.",
      "tree": {
        "sha": "b0bd5a496e82dbea577bf57dd3864039f75f785a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b0bd5a496e82dbea577bf57dd3864039f75f785a"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/75a08e7d17da9db2ac0e9f55a4286dda912385bc",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIcBAABCAAGBQJY9NLJAAoJEFR0+/Uie++tRtwQALugPdjKZGBvwpmu+O/Kgc/T\nw8nYjaKG45arjN2OSZqGBlp4eIfDMSca+n30hxMZcl3rcXSshIVGa+1FJ0IRXv5I\ni/70IpPVYAMosDJpzdFNYtF4TAKqzLgvQtj+d9lk6E+5ynmeZlEBSH3PyI9djgF5\nBgEze2MIpSK6I3TWEfQ/YnnlGDZeTVn1ygiZnFIe7B+a2DyQNpq6lSkEaG186ESp\nEnIEMLEXfMhvqc3yTBdIjNbKBUOcLGLFfmhFm9ku6PZTgAaLhbw59fXTy8JYHTbT\ngo5WDqIHUxAcM7daWb017uMQ4JrVAAtolNU8oWjlcn57eQsjCNI3FBYGDIsYL4hL\nTJqPWVkF0oPu7U2ingB1lbX5RfhTmQLNuX0Z57fdshwLgYIzo166LN559/HRN5ng\nmnJTJuSo4rnrIJ1m2sP4M1rcd2f77ihFpFqQ35RFfw6S6bGfVwbU5CDTJYHX8AIT\nt6AOEKYdzX3VAXF8FBVikps12J4EZtZMpX3Yj4qqTou7TEokxqt/aOBQ7nL7KOG2\na35RZXAVzVI78BeuTxMfvEDlQUGqe3BRmVG4NwlZGDS8IERRXCFIHjVFQXaI+OK1\nBXyRN1yqs4br2iAsiNsW/Bj2i1leyw+tJ+89KNktpk3jJeoK8atKZJlJKW+Fk192\n+dxZ+TC0DvUkMcFRY11I\n=z/2v\n-----END PGP SIGNATURE-----",
        "payload": "tree b0bd5a496e82dbea577bf57dd3864039f75f785a\nparent b7365f0545b1a6862e3277b2b2139ee0d5aee1cf\nauthor Kalle Alm <kalle.alm@gmail.com> 1492439521 +0900\ncommitter Kalle Alm <kalle.alm@gmail.com> 1492439753 +0900\n\n[wallet] Add support for aborting wallet transaction rescans.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/75a08e7d17da9db2ac0e9f55a4286dda912385bc",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/75a08e7d17da9db2ac0e9f55a4286dda912385bc",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/75a08e7d17da9db2ac0e9f55a4286dda912385bc/comments",
    "author": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b7365f0545b1a6862e3277b2b2139ee0d5aee1cf",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b7365f0545b1a6862e3277b2b2139ee0d5aee1cf",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b7365f0545b1a6862e3277b2b2139ee0d5aee1cf"
      }
    ],
    "stats": {
      "total": 20,
      "additions": 19,
      "deletions": 1
    },
    "files": [
      {
        "sha": "37e0883060afe50220fb2fdf816ef8f1dddfc2f5",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 8,
        "deletions": 1,
        "changes": 9,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/75a08e7d17da9db2ac0e9f55a4286dda912385bc/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/75a08e7d17da9db2ac0e9f55a4286dda912385bc/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=75a08e7d17da9db2ac0e9f55a4286dda912385bc",
        "patch": "@@ -1527,6 +1527,8 @@ CBlockIndex* CWallet::ScanForWalletTransactions(CBlockIndex* pindexStart, bool f\n     CBlockIndex* pindex = pindexStart;\n     {\n         LOCK2(cs_main, cs_wallet);\n+        fAbortRescan = false;\n+        fScanningWallet = true;\n \n         // no need to read and scan block, if block was created before\n         // our wallet birthday (as adjusted for block time variability)\n@@ -1536,7 +1538,7 @@ CBlockIndex* CWallet::ScanForWalletTransactions(CBlockIndex* pindexStart, bool f\n         ShowProgress(_(\"Rescanning...\"), 0); // show rescan progress in GUI as dialog or on splashscreen, if -rescan on startup\n         double dProgressStart = GuessVerificationProgress(chainParams.TxData(), pindex);\n         double dProgressTip = GuessVerificationProgress(chainParams.TxData(), chainActive.Tip());\n-        while (pindex)\n+        while (pindex && !fAbortRescan)\n         {\n             if (pindex->nHeight % 100 == 0 && dProgressTip - dProgressStart > 0.0)\n                 ShowProgress(_(\"Rescanning...\"), std::max(1, std::min(99, (int)((GuessVerificationProgress(chainParams.TxData(), pindex) - dProgressStart) / (dProgressTip - dProgressStart) * 100))));\n@@ -1558,7 +1560,12 @@ CBlockIndex* CWallet::ScanForWalletTransactions(CBlockIndex* pindexStart, bool f\n                 LogPrintf(\"Still rescanning. At block %d. Progress=%f\\n\", pindex->nHeight, GuessVerificationProgress(chainParams.TxData(), pindex));\n             }\n         }\n+        if (pindex && fAbortRescan) {\n+            LogPrintf(\"Rescan aborted at block %d. Progress=%f\\n\", pindex->nHeight, GuessVerificationProgress(chainParams.TxData(), pindex));\n+        }\n         ShowProgress(_(\"Rescanning...\"), 100); // hide progress dialog in GUI\n+\n+        fScanningWallet = false;\n     }\n     return ret;\n }"
      },
      {
        "sha": "59aa701e1d88b061505e6e5684e5244decb9b58c",
        "filename": "src/wallet/wallet.h",
        "status": "modified",
        "additions": 11,
        "deletions": 0,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/75a08e7d17da9db2ac0e9f55a4286dda912385bc/src/wallet/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/75a08e7d17da9db2ac0e9f55a4286dda912385bc/src/wallet/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.h?ref=75a08e7d17da9db2ac0e9f55a4286dda912385bc",
        "patch": "@@ -651,6 +651,8 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n {\n private:\n     static std::atomic<bool> fFlushScheduled;\n+    std::atomic<bool> fAbortRescan;\n+    std::atomic<bool> fScanningWallet;\n \n     /**\n      * Select a set of coins such that nValueRet >= nTargetValue and at least\n@@ -775,6 +777,8 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n         nTimeFirstKey = 0;\n         fBroadcastTransactions = false;\n         nRelockTime = 0;\n+        fAbortRescan = false;\n+        fScanningWallet = false;\n     }\n \n     std::map<uint256, CWalletTx> mapWallet;\n@@ -819,6 +823,13 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n     void UnlockAllCoins();\n     void ListLockedCoins(std::vector<COutPoint>& vOutpts);\n \n+    /*\n+     * Rescan abort properties\n+     */\n+    void AbortRescan() { fAbortRescan = true; }\n+    bool IsAbortingRescan() { return fAbortRescan; }\n+    bool IsScanning() { return fScanningWallet; }\n+\n     /**\n      * keystore implementation\n      * Generate a new key"
      }
    ]
  },
  {
    "sha": "9141622a0f5024775447d9ac728a8760eee2a06c",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5MTQxNjIyYTBmNTAyNDc3NTQ0N2Q5YWM3MjhhODc2MGVlZTJhMDZj",
    "commit": {
      "author": {
        "name": "Kalle Alm",
        "email": "kalle.alm@gmail.com",
        "date": "2017-04-17T14:32:29Z"
      },
      "committer": {
        "name": "Karl-Johan Alm",
        "email": "karljohan-alm@garage.co.jp",
        "date": "2017-04-18T02:41:46Z"
      },
      "message": "[rpc] Add abortrescan command to RPC interface.",
      "tree": {
        "sha": "d4bd4e370a1ff7f369f285c3b2e77b4fd32f1255",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d4bd4e370a1ff7f369f285c3b2e77b4fd32f1255"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/9141622a0f5024775447d9ac728a8760eee2a06c",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIcBAABCAAGBQJY9XzqAAoJEFevdi2zNTMi4l0P/14YIbmtyv2LCw1QgwBVeBMb\nQM3tS5ggw6GqG17wRssN+sgpfBiAFMtOcJhudhCb4GgdII7eByAuABlTlKvmAqsg\nKHw4D9azcZQwI1XmmbWpA72QG2iNX8HU6gGbPyIbCRKw2zLlxDr+FMPofhl2BfSG\nUQ0WkNmZMqJkw+IZEsqGCLYeiStv5IlxFV0fZJQmKkxgY0CW/PV931Z0FtphKAoO\n5WWwGWnY1mPSe99AXqA362d0PJUtJz6ye3vHrV985FVCUyPJ3Npv8PgE85BCbQeM\njYA7FZlljhgeEQHKIM2YzI1W0rPi0om472sO/yKrtlXMvLJ7xZP9R9yFbHXrhvYA\ndDARIX0dc6q65UVOIpdb8muDOuj4ufzOZWhG6Uw05Zssmv6q11qH62fOJZGoL+80\na1HP6jeOFAcHbCtjlsXz5FH53aJHSRWQCWCWNlk4jaboqZwBLCT5ErnMUr8dI//d\n0UvSQ2d+rJ7sVStT915KnvFd+CMIqhaZ2AtSGGGknxxYHAlMJ5VfDpClcwcTL8sW\nW+372QqOAVQtbV0KjQjRKRVPLGW8FoWG2k6EreGpC6YTYx2N8hT6HGSDtfNHu942\nIHfc9w31QLcJjZNf2UvsF0kqQRSwm9Vg57m//B5zWL2PYo6HebsZ9gfC/yz6t7lD\ni+qkbFbuUK6f7rS60Rlk\n=IEsx\n-----END PGP SIGNATURE-----",
        "payload": "tree d4bd4e370a1ff7f369f285c3b2e77b4fd32f1255\nparent 75a08e7d17da9db2ac0e9f55a4286dda912385bc\nauthor Kalle Alm <kalle.alm@gmail.com> 1492439549 +0900\ncommitter Karl-Johan Alm <karljohan-alm@garage.co.jp> 1492483306 +0900\n\n[rpc] Add abortrescan command to RPC interface.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9141622a0f5024775447d9ac728a8760eee2a06c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/9141622a0f5024775447d9ac728a8760eee2a06c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9141622a0f5024775447d9ac728a8760eee2a06c/comments",
    "author": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "kallewoof",
      "id": 250224,
      "node_id": "MDQ6VXNlcjI1MDIyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/250224?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kallewoof",
      "html_url": "https://github.com/kallewoof",
      "followers_url": "https://api.github.com/users/kallewoof/followers",
      "following_url": "https://api.github.com/users/kallewoof/following{/other_user}",
      "gists_url": "https://api.github.com/users/kallewoof/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kallewoof/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kallewoof/subscriptions",
      "organizations_url": "https://api.github.com/users/kallewoof/orgs",
      "repos_url": "https://api.github.com/users/kallewoof/repos",
      "events_url": "https://api.github.com/users/kallewoof/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kallewoof/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "75a08e7d17da9db2ac0e9f55a4286dda912385bc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/75a08e7d17da9db2ac0e9f55a4286dda912385bc",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/75a08e7d17da9db2ac0e9f55a4286dda912385bc"
      }
    ],
    "stats": {
      "total": 27,
      "additions": 27,
      "deletions": 0
    },
    "files": [
      {
        "sha": "e4451bc246834fa244a996f31eb63309391e278d",
        "filename": "src/wallet/rpcdump.cpp",
        "status": "modified",
        "additions": 25,
        "deletions": 0,
        "changes": 25,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9141622a0f5024775447d9ac728a8760eee2a06c/src/wallet/rpcdump.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9141622a0f5024775447d9ac728a8760eee2a06c/src/wallet/rpcdump.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcdump.cpp?ref=9141622a0f5024775447d9ac728a8760eee2a06c",
        "patch": "@@ -154,6 +154,31 @@ UniValue importprivkey(const JSONRPCRequest& request)\n     return NullUniValue;\n }\n \n+UniValue abortrescan(const JSONRPCRequest& request)\n+{\n+    CWallet* const pwallet = GetWalletForJSONRPCRequest(request);\n+    if (!EnsureWalletIsAvailable(pwallet, request.fHelp)) {\n+        return NullUniValue;\n+    }\n+\n+    if (request.fHelp || request.params.size() > 0)\n+        throw std::runtime_error(\n+            \"abortrescan\\n\"\n+            \"\\nStops current wallet rescan triggered e.g. by an importprivkey call.\\n\"\n+            \"\\nExamples:\\n\"\n+            \"\\nImport a private key\\n\"\n+            + HelpExampleCli(\"importprivkey\", \"\\\"mykey\\\"\") +\n+            \"\\nAbort the running wallet rescan\\n\"\n+            + HelpExampleCli(\"abortrescan\", \"\") +\n+            \"\\nAs a JSON-RPC call\\n\"\n+            + HelpExampleRpc(\"abortrescan\", \"\")\n+        );\n+\n+    if (!pwallet->IsScanning() || pwallet->IsAbortingRescan()) return false;\n+    pwallet->AbortRescan();\n+    return true;\n+}\n+\n void ImportAddress(CWallet*, const CBitcoinAddress& address, const std::string& strLabel);\n void ImportScript(CWallet* const pwallet, const CScript& script, const std::string& strLabel, bool isRedeemScript)\n {"
      },
      {
        "sha": "665d856df529cc9bc156cb1f0ea61555aaa69794",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/9141622a0f5024775447d9ac728a8760eee2a06c/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/9141622a0f5024775447d9ac728a8760eee2a06c/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=9141622a0f5024775447d9ac728a8760eee2a06c",
        "patch": "@@ -2914,6 +2914,7 @@ UniValue bumpfee(const JSONRPCRequest& request)\n     return result;\n }\n \n+extern UniValue abortrescan(const JSONRPCRequest& request); // in rpcdump.cpp\n extern UniValue dumpprivkey(const JSONRPCRequest& request); // in rpcdump.cpp\n extern UniValue importprivkey(const JSONRPCRequest& request);\n extern UniValue importaddress(const JSONRPCRequest& request);\n@@ -2930,6 +2931,7 @@ static const CRPCCommand commands[] =\n     { \"rawtransactions\",    \"fundrawtransaction\",       &fundrawtransaction,       false,  {\"hexstring\",\"options\"} },\n     { \"hidden\",             \"resendwallettransactions\", &resendwallettransactions, true,   {} },\n     { \"wallet\",             \"abandontransaction\",       &abandontransaction,       false,  {\"txid\"} },\n+    { \"wallet\",             \"abortrescan\",              &abortrescan,              false,  {} },\n     { \"wallet\",             \"addmultisigaddress\",       &addmultisigaddress,       true,   {\"nrequired\",\"keys\",\"account\"} },\n     { \"wallet\",             \"addwitnessaddress\",        &addwitnessaddress,        true,   {\"address\"} },\n     { \"wallet\",             \"backupwallet\",             &backupwallet,             true,   {\"destination\"} },"
      }
    ]
  }
]