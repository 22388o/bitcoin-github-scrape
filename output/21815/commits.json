[
  {
    "sha": "a3eabdf860bcdfb03fb27713ddc0dce7166158b1",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphM2VhYmRmODYwYmNkZmIwM2ZiMjc3MTNkZGMwZGNlNzE2NjE1OGIx",
    "commit": {
      "author": {
        "name": "unknown",
        "email": "prayank23@outlook.com",
        "date": "2021-04-30T05:43:38Z"
      },
      "committer": {
        "name": "unknown",
        "email": "prayank23@outlook.com",
        "date": "2021-04-30T09:20:39Z"
      },
      "message": "Add `-maxoutfullrelay`\n\n+ User can set maximum outbound full relay connections in `bitcoin.conf`\n+ Value can be anything between 0 and 8",
      "tree": {
        "sha": "966349471a2b85daf58bd714e233ddeadb4a2160",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/966349471a2b85daf58bd714e233ddeadb4a2160"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a3eabdf860bcdfb03fb27713ddc0dce7166158b1",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a3eabdf860bcdfb03fb27713ddc0dce7166158b1",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/a3eabdf860bcdfb03fb27713ddc0dce7166158b1",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a3eabdf860bcdfb03fb27713ddc0dce7166158b1/comments",
    "author": {
      "login": "prayank23",
      "id": 13405205,
      "node_id": "MDQ6VXNlcjEzNDA1MjA1",
      "avatar_url": "https://avatars.githubusercontent.com/u/13405205?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prayank23",
      "html_url": "https://github.com/prayank23",
      "followers_url": "https://api.github.com/users/prayank23/followers",
      "following_url": "https://api.github.com/users/prayank23/following{/other_user}",
      "gists_url": "https://api.github.com/users/prayank23/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prayank23/subscriptions",
      "organizations_url": "https://api.github.com/users/prayank23/orgs",
      "repos_url": "https://api.github.com/users/prayank23/repos",
      "events_url": "https://api.github.com/users/prayank23/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prayank23/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "prayank23",
      "id": 13405205,
      "node_id": "MDQ6VXNlcjEzNDA1MjA1",
      "avatar_url": "https://avatars.githubusercontent.com/u/13405205?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prayank23",
      "html_url": "https://github.com/prayank23",
      "followers_url": "https://api.github.com/users/prayank23/followers",
      "following_url": "https://api.github.com/users/prayank23/following{/other_user}",
      "gists_url": "https://api.github.com/users/prayank23/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prayank23/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prayank23/subscriptions",
      "organizations_url": "https://api.github.com/users/prayank23/orgs",
      "repos_url": "https://api.github.com/users/prayank23/repos",
      "events_url": "https://api.github.com/users/prayank23/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prayank23/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e1e1e708fa0fbc0c51460305da5d401ed8f218f3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e1e1e708fa0fbc0c51460305da5d401ed8f218f3",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e1e1e708fa0fbc0c51460305da5d401ed8f218f3"
      }
    ],
    "stats": {
      "total": 8,
      "additions": 7,
      "deletions": 1
    },
    "files": [
      {
        "sha": "1b5fac00905fe7ccad34550078f9206f7e12e896",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 1,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a3eabdf860bcdfb03fb27713ddc0dce7166158b1/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a3eabdf860bcdfb03fb27713ddc0dce7166158b1/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=a3eabdf860bcdfb03fb27713ddc0dce7166158b1",
        "patch": "@@ -425,6 +425,7 @@ void SetupServerArgs(NodeContext& node)\n     argsman.AddArg(\"-listen\", \"Accept connections from outside (default: 1 if no -proxy or -connect)\", ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-listenonion\", strprintf(\"Automatically create Tor onion service (default: %d)\", DEFAULT_LISTEN_ONION), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-maxconnections=<n>\", strprintf(\"Maintain at most <n> connections to peers (default: %u)\", DEFAULT_MAX_PEER_CONNECTIONS), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n+    argsman.AddArg(\"-maxoutfullrelay=<n>\", strprintf(\"Maintain at most <n> outbound full relay connections to peers (default: %u)\", MAX_OUTBOUND_FULL_RELAY_CONNECTIONS), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-maxreceivebuffer=<n>\", strprintf(\"Maximum per-connection receive buffer, <n>*1000 bytes (default: %u)\", DEFAULT_MAXRECEIVEBUFFER), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-maxsendbuffer=<n>\", strprintf(\"Maximum per-connection send buffer, <n>*1000 bytes (default: %u)\", DEFAULT_MAXSENDBUFFER), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n     argsman.AddArg(\"-maxtimeadjustment\", strprintf(\"Maximum allowed median peer time offset adjustment. Local perspective of time may be influenced by peers forward or backward by this amount. (default: %u seconds)\", DEFAULT_MAX_TIME_ADJUSTMENT), ArgsManager::ALLOW_ANY, OptionsCategory::CONNECTION);\n@@ -750,6 +751,7 @@ namespace { // Variables internal to initialization process only\n \n int nMaxConnections;\n int nUserMaxConnections;\n+int nMaxOutboundFullRelay;\n int nFD;\n ServiceFlags nLocalServices = ServiceFlags(NODE_NETWORK | NODE_NETWORK_LIMITED);\n int64_t peer_connect_timeout;\n@@ -893,6 +895,10 @@ bool AppInitParameterInteraction(const ArgsManager& args)\n     nUserMaxConnections = args.GetArg(\"-maxconnections\", DEFAULT_MAX_PEER_CONNECTIONS);\n     nMaxConnections = std::max(nUserMaxConnections, 0);\n \n+    // Maximum outbound full relay connections defined by user\n+    nMaxOutboundFullRelay = args.GetArg(\"-maxoutfullrelay\", MAX_OUTBOUND_FULL_RELAY_CONNECTIONS);\n+    nMaxOutboundFullRelay = std::max(nMaxOutboundFullRelay, 0);\n+\n     // Trim requested connection counts, to fit into system limitations\n     // <int> in std::min<int>(...) to work around FreeBSD compilation issue described in #2695\n     nFD = RaiseFileDescriptorLimit(nMaxConnections + MIN_CORE_FILEDESCRIPTORS + MAX_ADDNODE_CONNECTIONS + nBind + NUM_FDS_MESSAGE_CAPTURE);\n@@ -1704,7 +1710,7 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     CConnman::Options connOptions;\n     connOptions.nLocalServices = nLocalServices;\n     connOptions.nMaxConnections = nMaxConnections;\n-    connOptions.m_max_outbound_full_relay = std::min(MAX_OUTBOUND_FULL_RELAY_CONNECTIONS, connOptions.nMaxConnections);\n+    connOptions.m_max_outbound_full_relay = std::min(MAX_OUTBOUND_FULL_RELAY_CONNECTIONS, nMaxOutboundFullRelay);\n     connOptions.m_max_outbound_block_relay = std::min(MAX_BLOCK_RELAY_ONLY_CONNECTIONS, connOptions.nMaxConnections-connOptions.m_max_outbound_full_relay);\n     connOptions.nMaxAddnode = MAX_ADDNODE_CONNECTIONS;\n     connOptions.nMaxFeeler = MAX_FEELER_CONNECTIONS;"
      }
    ]
  }
]