[
  {
    "sha": "02bc16ab0eab68abf86f057b83973263b6f4451d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowMmJjMTZhYjBlYWI2OGFiZjg2ZjA1N2I4Mzk3MzI2M2I2ZjQ0NTFk",
    "commit": {
      "author": {
        "name": "Wang Chun",
        "email": "wangchun@me.com",
        "date": "2016-02-03T22:03:33Z"
      },
      "committer": {
        "name": "Wang Chun",
        "email": "wangchun@me.com",
        "date": "2016-02-04T01:00:02Z"
      },
      "message": "Require configuration of opt-in RBF before creating blocks",
      "tree": {
        "sha": "7edbac34e807bac7c647314726668cddd1954940",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7edbac34e807bac7c647314726668cddd1954940"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/02bc16ab0eab68abf86f057b83973263b6f4451d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/02bc16ab0eab68abf86f057b83973263b6f4451d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/02bc16ab0eab68abf86f057b83973263b6f4451d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/02bc16ab0eab68abf86f057b83973263b6f4451d/comments",
    "author": {
      "login": "wangchun",
      "id": 145747,
      "node_id": "MDQ6VXNlcjE0NTc0Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/145747?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wangchun",
      "html_url": "https://github.com/wangchun",
      "followers_url": "https://api.github.com/users/wangchun/followers",
      "following_url": "https://api.github.com/users/wangchun/following{/other_user}",
      "gists_url": "https://api.github.com/users/wangchun/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wangchun/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wangchun/subscriptions",
      "organizations_url": "https://api.github.com/users/wangchun/orgs",
      "repos_url": "https://api.github.com/users/wangchun/repos",
      "events_url": "https://api.github.com/users/wangchun/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wangchun/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "wangchun",
      "id": 145747,
      "node_id": "MDQ6VXNlcjE0NTc0Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/145747?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wangchun",
      "html_url": "https://github.com/wangchun",
      "followers_url": "https://api.github.com/users/wangchun/followers",
      "following_url": "https://api.github.com/users/wangchun/following{/other_user}",
      "gists_url": "https://api.github.com/users/wangchun/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wangchun/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wangchun/subscriptions",
      "organizations_url": "https://api.github.com/users/wangchun/orgs",
      "repos_url": "https://api.github.com/users/wangchun/repos",
      "events_url": "https://api.github.com/users/wangchun/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wangchun/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "eb331794a22b86da0a76d6710cb3eb37903a486e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/eb331794a22b86da0a76d6710cb3eb37903a486e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/eb331794a22b86da0a76d6710cb3eb37903a486e"
      }
    ],
    "stats": {
      "total": 13,
      "additions": 13,
      "deletions": 0
    },
    "files": [
      {
        "sha": "73b9bd72c97b2953814c2a04aa1f703e6546b942",
        "filename": "src/chainparams.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/02bc16ab0eab68abf86f057b83973263b6f4451d/src/chainparams.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/02bc16ab0eab68abf86f057b83973263b6f4451d/src/chainparams.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/chainparams.cpp?ref=02bc16ab0eab68abf86f057b83973263b6f4451d",
        "patch": "@@ -115,6 +115,7 @@ class CMainParams : public CChainParams {\n         vFixedSeeds = std::vector<SeedSpec6>(pnSeed6_main, pnSeed6_main + ARRAYLEN(pnSeed6_main));\n \n         fMiningRequiresPeers = true;\n+        fMiningRequiresConfiguration = true;\n         fDefaultConsistencyChecks = false;\n         fRequireStandard = true;\n         fMineBlocksOnDemand = false;\n@@ -190,6 +191,7 @@ class CTestNetParams : public CChainParams {\n         vFixedSeeds = std::vector<SeedSpec6>(pnSeed6_test, pnSeed6_test + ARRAYLEN(pnSeed6_test));\n \n         fMiningRequiresPeers = true;\n+        fMiningRequiresConfiguration = false;\n         fDefaultConsistencyChecks = false;\n         fRequireStandard = false;\n         fMineBlocksOnDemand = false;\n@@ -242,6 +244,7 @@ class CRegTestParams : public CChainParams {\n         vSeeds.clear();  //! Regtest mode doesn't have any DNS seeds.\n \n         fMiningRequiresPeers = false;\n+        fMiningRequiresConfiguration = false;\n         fDefaultConsistencyChecks = true;\n         fRequireStandard = false;\n         fMineBlocksOnDemand = true;"
      },
      {
        "sha": "5b098ed4849caeec23f50511a0ef2293b6b8cc6d",
        "filename": "src/chainparams.h",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/02bc16ab0eab68abf86f057b83973263b6f4451d/src/chainparams.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/02bc16ab0eab68abf86f057b83973263b6f4451d/src/chainparams.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/chainparams.h?ref=02bc16ab0eab68abf86f057b83973263b6f4451d",
        "patch": "@@ -60,6 +60,8 @@ class CChainParams\n     const CBlock& GenesisBlock() const { return genesis; }\n     /** Make miner wait to have peers to avoid wasting work */\n     bool MiningRequiresPeers() const { return fMiningRequiresPeers; }\n+    /** Require policy configuration before mining */\n+    bool MiningRequiresConfiguration() const { return fMiningRequiresConfiguration; }\n     /** Default value for -checkmempool and -checkblockindex argument */\n     bool DefaultConsistencyChecks() const { return fDefaultConsistencyChecks; }\n     /** Policy: Filter transactions that do not match well-defined patterns */\n@@ -90,6 +92,7 @@ class CChainParams\n     CBlock genesis;\n     std::vector<SeedSpec6> vFixedSeeds;\n     bool fMiningRequiresPeers;\n+    bool fMiningRequiresConfiguration;\n     bool fDefaultConsistencyChecks;\n     bool fRequireStandard;\n     bool fMineBlocksOnDemand;"
      },
      {
        "sha": "95b9cc56e27db9f9a832e57d84f6b328aaaee832",
        "filename": "src/rpc/mining.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/02bc16ab0eab68abf86f057b83973263b6f4451d/src/rpc/mining.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/02bc16ab0eab68abf86f057b83973263b6f4451d/src/rpc/mining.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/mining.cpp?ref=02bc16ab0eab68abf86f057b83973263b6f4451d",
        "patch": "@@ -211,6 +211,9 @@ UniValue setgenerate(const UniValue& params, bool fHelp)\n     if (params.size() > 0)\n         fGenerate = params[0].get_bool();\n \n+    if (fGenerate && Params().MiningRequiresConfiguration() && !mapArgs.count(\"-mempoolreplacement\"))\n+        throw JSONRPCError(RPC_NOT_CONFIGURED, \"You must set opt-in RBF option -mempoolreplacement.\");\n+\n     int nGenProcLimit = GetArg(\"-genproclimit\", DEFAULT_GENERATE_THREADS);\n     if (params.size() > 1)\n     {\n@@ -440,6 +443,9 @@ UniValue getblocktemplate(const UniValue& params, bool fHelp)\n     if (IsInitialBlockDownload())\n         throw JSONRPCError(RPC_CLIENT_IN_INITIAL_DOWNLOAD, \"Bitcoin is downloading blocks...\");\n \n+    if (Params().MiningRequiresConfiguration() && !mapArgs.count(\"-mempoolreplacement\"))\n+        throw JSONRPCError(RPC_NOT_CONFIGURED, \"You must set opt-in RBF option -mempoolreplacement.\");\n+\n     static unsigned int nTransactionsUpdatedLast;\n \n     if (!lpval.isNull())"
      },
      {
        "sha": "8439e443a9df8f7f437dd5e20c30fbb73da61425",
        "filename": "src/rpc/protocol.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/02bc16ab0eab68abf86f057b83973263b6f4451d/src/rpc/protocol.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/02bc16ab0eab68abf86f057b83973263b6f4451d/src/rpc/protocol.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/protocol.h?ref=02bc16ab0eab68abf86f057b83973263b6f4451d",
        "patch": "@@ -50,6 +50,7 @@ enum RPCErrorCode\n     RPC_VERIFY_REJECTED             = -26, //! Transaction or block was rejected by network rules\n     RPC_VERIFY_ALREADY_IN_CHAIN     = -27, //! Transaction already in chain\n     RPC_IN_WARMUP                   = -28, //! Client still warming up\n+    RPC_NOT_CONFIGURED              = -29, //! Some configuration is required\n \n     //! Aliases for backward compatibility\n     RPC_TRANSACTION_ERROR           = RPC_VERIFY_ERROR,"
      }
    ]
  }
]