DrahtBot,2020-06-30 13:00:19,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #20125 (rpc, wallet: Expose database format in getwalletinfo by promag)\n* #19933 (wallet: bugfix; if datadir has a traili",https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-651774831,651774831,
promag,2020-07-01 09:40:11,"No strong opinion regarding excluding some paths. Current patch needs to be updated (format) and maybe change implementation to use a list of ignore/exclude paths.\n\nThis can improve GUI by reducing freezes but it's not the right fix for that. When `ListWalletDir` is triggered from the GUI, it should be called on a background thread. Alternatively we could consider caching `ListWalletDir` resul",https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-652311748,652311748,
Saibato,2020-07-01 12:22:24,"> No strong opinion regarding excluding some paths. Current patch needs to be updated (format) and maybe change implementation to use a list of ignore/exclude paths.\n> \n> This can improve GUI by reducing freezes but it's not the right fix for that. When `ListWalletDir` is triggered from the GUI, it should be called on a background thread. Alternatively we could consider caching `ListWalletDir`",https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-652386136,652386136,
meshcollider,2020-08-13 21:47:05,"Concept ACK, looks good to me",https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-673726585,673726585,
achow101,2020-08-14 16:41:48,"Concept ACK, please squash your commits.",https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-674161697,674161697,
Saibato,2020-08-15 12:37:13,squashed and rebased https://github.com/bitcoin/bitcoin/pull/19419/commits/caa418440dd5e996c730def08e807ddb5d504a44,https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-674391599,674391599,
hebasto,2020-10-04 11:35:27,Concept ACK.,https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-703242278,703242278,
Saibato,2020-10-08 10:59:06,Rebased https://github.com/bitcoin/bitcoin/pull/19419/commits/da6eb3c2f8ed5c8e2a5acb878a1abcb9d6f1c02b and addressed reviews.,https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-705494228,705494228,
Saibato,2020-10-12 12:20:45,"Add `#include <algorithm>` to header.\n\nTyi @hebasto while dev this i encountered and ugly wallet and filesystem edge case. that is only partly fixed by #18095 but with fewer changes and final here and in #19502 u might reach out to @luke-jr or @laanwj for more info.",https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-707086449,707086449,
luke-jr,2020-10-13 19:45:15,"Please make these changes:\n\n* https://github.com/bitcoin/bitcoin/commit/5a8f19eb331acbb1f7e2f52fe786ed21b30297b6\n* https://github.com/bitcoin/bitcoin/commit/4fb4fb716cd222ca8ae988d039328a66eb6e1f3b",https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-707967843,707967843,
DrahtBot,2020-10-15 11:09:41,"<!--cf906140f33d8803c4a75a2196329ecb-->\nüêô This pull request conflicts with the target branch and [needs rebase](https://github.com/bitcoin/bitcoin/blob/master/CONTRIBUTING.md#rebasing-changes).\n\n<sub>Want to unsubscribe from rebase notifications on this pull request? Just convert this pull request to a ""draft"".</sub>",https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-709204374,709204374,
laanwj,2020-10-16 04:57:12,"Marking this as up for grabs. The concept to not iterate needlessly into directories that *should* not contain wallets definitely makes sense, but I think this makes unnecessary changes that are not well motivated.",https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-709776468,709776468,
Saibato,2020-10-17 20:58:52,"Rebased and addressed https://github.com/bitcoin/bitcoin/commit/5a8f19eb331acbb1f7e2f52fe786ed21b30297b6  https://github.com/bitcoin/bitcoin/commit/4fb4fb716cd222ca8ae988d039328a66eb6e1f3b an comments, changed by this a lot so pls review again  \n\n@luke-jr could not use ur code by merge and lost by fixup  ur commit entrys, i hope u don;t mind.\n\nhttps://github.com/Saibato/bitcoin/tree/wallet",https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-711079643,711079643,
Saibato,2020-10-25 10:08:26,"> to find wallets, that consumes time and could cause an unresponsive node.\n\n@laanwj ""... cause an unresponsive node"" in commit message was a hint, this PR is not about to fix something and must not be merged anyway but to point to some lines of code and its implications to gave others a chance to have a look in this and guess by themselfs.\nSo my question is now, will have we have a fix and ",https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-716122348,716122348,
luke-jr,2020-11-13 14:23:21,"@Saibato GitHub won't let *anyone* reopen this since your branch changed. Can you `git push ??? 3f9cc0cd736e79c563dee3573f0dab01dac10622:wallet_351 -f` temporarily (you can re-push your new version after it's reopened; put your repo name in place of `???` of course).\n\nDon't forget to rebase!\n\nAlso: You need to include &lt;set> instead of &lt;algorithm> ;)",https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-726792052,726792052,
luke-jr,2020-11-13 14:28:53,Here's a rebase for later: https://github.com/bitcoin/bitcoin/compare/master...luke-jr:listwalletdir_skip_data,https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-726795144,726795144,
Saibato,2020-11-27 09:11:31,"@luke-jr tyi was the last week just counting my **sats** and had not  looked in this, thx. for the reopen hint.\nbtw look now why some wallets are missing when using the 0.21 rc1 tag, maybe that was the reason i changed also the scan for wallets logic here , but just forgot to mention that sggh... ",https://github.com/bitcoin/bitcoin/pull/19419#issuecomment-734729710,734729710,
promag,2020-07-01 21:40:32,"Instead of multiple variables, you can declare something like `const std::vector ignore_paths{ GetBlocksDir(), sub_path / ""testnet3"", ... }` and then compare against this.",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r448630671,448630671,src/wallet/walletutil.cpp
Saibato,2020-07-02 01:39:34,"yup  :+1:  , btw strange how long those bare strings survived refactor, still no global #define BLOCKS_DIR or TESTNET_STR etc.     ",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r448701432,448701432,src/wallet/walletutil.cpp
Sjors,2020-07-09 18:23:12,"better to define `skip_path` here\n\nNote to other reviewers, the enum file_type: https://www.boost.org/doc/libs/1_66_0/libs/filesystem/doc/reference.html#Enum-file_type",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r452407475,452407475,src/wallet/walletutil.cpp
Sjors,2020-07-09 18:26:58,"could use `break;` so you don't need to check `!skip_path &&` (and in fact, don't need it at all)\n\nYou can also do `it.disable_recursion_pending();` here",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r452409592,452409592,src/wallet/walletutil.cpp
Sjors,2020-07-09 18:28:53,"nit: just use brackets and newline\n\nAlso, I think we should follow symlinks? `symlink_file`",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r452410603,452410603,src/wallet/walletutil.cpp
luke-jr,2020-07-12 18:45:54,Following symlinks could create an infinite loop.,https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453349974,453349974,src/wallet/walletutil.cpp
luke-jr,2020-07-12 18:48:46,"Since we're using exact paths in `ignore_paths`, can't we use an exact match? (And then `ignore_paths` can become an `unordered_set` and just use `.count` here...)",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453350233,453350233,src/wallet/walletutil.cpp
luke-jr,2020-07-12 18:49:33,Suggest alphabetising.,https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453350304,453350304,src/wallet/walletutil.cpp
luke-jr,2020-07-12 18:52:31,"Consider adding ""blktree"" and ""coins"" (see `files.md`)",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453350602,453350602,src/wallet/walletutil.cpp
luke-jr,2020-07-12 18:56:20,Or hopefully `std::filesystem::path::lexically_relative` (C++17) :),https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453350994,453350994,src/wallet/walletutil.cpp
luke-jr,2020-07-12 18:59:17,"```suggestion\n            if (ignore_paths.count(it->path()) {\n                it.disable_recursion_pending();\n                continue;\n            }\n```",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453351273,453351273,src/wallet/walletutil.cpp
Saibato,2020-07-13 09:51:46,"> (and in fact, don't need it at all)\n\nhmm... If we allow wallets in those dir yes, but i would choose to touch the dir's not at all, \nPlease view fixup I will post before i squash.\nI guess we will need the skip  But sure about that we need some vote. :+1:    ",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453531725,453531725,src/wallet/walletutil.cpp
Saibato,2020-07-13 13:39:30,":+1: Though I choose  \n`if (std::count(ignore_paths.begin(), ignore_paths.end(), it->path())) {`\nnot sure ignore_paths has a count?",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453656346,453656346,src/wallet/walletutil.cpp
luke-jr,2020-07-13 15:58:45,Maybe also the default blocks dir too,https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453756689,453756689,src/wallet/walletutil.cpp
luke-jr,2020-07-13 15:59:30,It will once changed to an `unordered_set` as suggested,https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453757173,453757173,src/wallet/walletutil.cpp
Saibato,2020-07-13 16:31:04,"    const std::vector<fs::path> ignore_paths = {\n                                        blocks_dir,\n                                        data_dir / ""blktree"",",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r453777359,453777359,src/wallet/walletutil.cpp
luke-jr,2020-08-18 03:50:59,`disable_recursion_pending` is a new name introduced in Boost 1.72. We support much older. Renaming this to `no_push` (the old name) should just work.,https://github.com/bitcoin/bitcoin/pull/19419#discussion_r471897714,471897714,src/wallet/walletutil.cpp
Saibato,2020-08-21 09:35:26,"How about?\n\nSuggestion:\n\n``` Diff\ndiff --git a/src/fs.h b/src/fs.h\nindex dfbecc18e..390c38790 100644\n--- a/src/fs.h\n+++ b/src/fs.h\n@@ -17,6 +17,10 @@\n /** Filesystem operations and types */\n namespace fs = boost::filesystem;\n \n+#ifndef NAMESPACE_BOOST\n+#define NAMESPACE_BOOST\n+#endif\n+\n /** Bridge operations to C stdio */\n namespace fsbridge {\n     FILE *fopen",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r474580767,474580767,src/wallet/walletutil.cpp
hebasto,2020-10-04 13:13:10,"Please add ""signet"".",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r499245395,499245395,src/wallet/walletutil.cpp
hebasto,2020-10-04 13:40:06,"nit:\n```suggestion\n    // Those directories are referenced in doc/files.md\n```",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r499248059,499248059,src/wallet/walletutil.cpp
hebasto,2020-10-04 13:42:04,"nit:\n```suggestion\n        // We don't want to iterate through those special node dirs\n```",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r499248311,499248311,src/wallet/walletutil.cpp
hebasto,2020-10-04 14:04:21,"I personally prefer ""throwing"" versions of the Boost.Filesystem API. But I don't think that combining ""throwing"" and ""non-throwing"" versions of the Boost.Filesystem API in the same function is a good design.",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r499250262,499250262,src/wallet/walletutil.cpp
Saibato,2020-10-08 10:54:23,"with catch boost::exception\nand  dynamic_cast<std.exception i run with a recursive path in an non catched     \n EXCEPTION: N5boost10filesystem16filesystem_errorE\nso unless u have a hint, i leave it that way, for now?",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r501628611,501628611,src/wallet/walletutil.cpp
hebasto,2020-10-11 03:15:03,nit: [std::find](https://en.cppreference.com/w/cpp/algorithm/find) could return earlier.,https://github.com/bitcoin/bitcoin/pull/19419#discussion_r502858992,502858992,src/wallet/walletutil.cpp
Saibato,2020-10-11 12:18:42,"yup. no insist here from my side, but nit too if ""not""  *const time* could that sidechannel reveal where the wallet is or else?\n\nBtw> since u review here and in  #18095, 18095 does fix some problems, but not the wallet of death, could we transfer attention of reviewers to this here and fix some bugs fast in one sweep, before adding there new ones?\nI must admit my PR headlines look often a bi",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r502908139,502908139,src/wallet/walletutil.cpp
hebasto,2020-10-11 13:38:03,I don't think that `std::count` _guaranties_ const time to prevent sidechannel reveal where the wallet is or else. But I'm not an expert in this field. Feel free to mark this comment as resolved.,https://github.com/bitcoin/bitcoin/pull/19419#discussion_r502916870,502916870,src/wallet/walletutil.cpp
Saibato,2020-10-11 14:24:36,"Ok, then i resolve this here and fix the header. thx for review.",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r502922249,502922249,src/wallet/walletutil.cpp
luke-jr,2020-10-13 19:27:06,Why did you change this?,https://github.com/bitcoin/bitcoin/pull/19419#discussion_r504202796,504202796,src/wallet/walletutil.cpp
luke-jr,2020-10-13 19:32:42,"Why did you add this here? If it's needed in the .cpp file, put it there...",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r504205727,504205727,src/wallet/walletutil.h
Saibato,2020-10-17 19:48:05,its not changed just the correct indent.,https://github.com/bitcoin/bitcoin/pull/19419#discussion_r506977511,506977511,src/wallet/walletutil.cpp
Saibato,2020-10-17 20:53:10,";was keen to see some compiler warnings, i though that was the hint from @hebasto  to add `<algorithm>` addressed and changed back to .cpp that other bug we can fix later.",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r506982984,506982984,src/wallet/walletutil.h
Saibato,2020-10-17 22:30:16,"If u mean the whole logic itself, its because there where an other wallet access issue not mentioned here fixed also, could be no longer valid since we had some grave changes in master, i have to check, but since the PR its closed yet, it makes sense to let all as is and open two new and or wait until its reopened and then help out with the review.",https://github.com/bitcoin/bitcoin/pull/19419#discussion_r506990674,506990674,src/wallet/walletutil.cpp
