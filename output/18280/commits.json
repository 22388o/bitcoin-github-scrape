[
  {
    "sha": "03cd591f47f852e0a2c2e6262367eff4acefca62",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowM2NkNTkxZjQ3Zjg1MmUwYTJjMmU2MjYyMzY3ZWZmNGFjZWZjYTYy",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2020-03-11T11:49:01Z"
      },
      "committer": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2020-03-11T19:06:41Z"
      },
      "message": "Handle no threads serving in MaybeScheduleProcessQueue\n\nThis is necessary if SyncWithValidationInterfaceQueue is called after\nscheduler thread exists, which happen at shutdown.",
      "tree": {
        "sha": "2127ce6fb374d89c523a874d801f1c0d7a192139",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2127ce6fb374d89c523a874d801f1c0d7a192139"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/03cd591f47f852e0a2c2e6262367eff4acefca62",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/03cd591f47f852e0a2c2e6262367eff4acefca62",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/03cd591f47f852e0a2c2e6262367eff4acefca62",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/03cd591f47f852e0a2c2e6262367eff4acefca62/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "6fb4bbfb0e5f1885bd8c4fea652facfbe3de5299",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6fb4bbfb0e5f1885bd8c4fea652facfbe3de5299",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/6fb4bbfb0e5f1885bd8c4fea652facfbe3de5299"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 5,
      "deletions": 1
    },
    "files": [
      {
        "sha": "44e5ee78ef9f15aa261df717af8454ec542ef396",
        "filename": "src/scheduler.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 1,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/03cd591f47f852e0a2c2e6262367eff4acefca62/src/scheduler.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/03cd591f47f852e0a2c2e6262367eff4acefca62/src/scheduler.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/scheduler.cpp?ref=03cd591f47f852e0a2c2e6262367eff4acefca62",
        "patch": "@@ -195,7 +195,11 @@ void SingleThreadedSchedulerClient::AddToProcessQueue(std::function<void ()> fun\n         LOCK(m_cs_callbacks_pending);\n         m_callbacks_pending.emplace_back(std::move(func));\n     }\n-    MaybeScheduleProcessQueue();\n+    if (m_pscheduler->AreThreadsServicingQueue()) {\n+        MaybeScheduleProcessQueue();\n+    } else {\n+        EmptyQueue();\n+    }\n }\n \n void SingleThreadedSchedulerClient::EmptyQueue() {"
      }
    ]
  },
  {
    "sha": "2097e35a635cd58bfc21e8ab149a903d58e94bf2",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyMDk3ZTM1YTYzNWNkNThiZmMyMWU4YWIxNDlhOTAzZDU4ZTk0YmYy",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2020-03-10T18:13:50Z"
      },
      "committer": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2020-03-11T19:06:46Z"
      },
      "message": "wallet: UnregisterValidationInterface before SyncWithValidationInterfaceQueue",
      "tree": {
        "sha": "6b3c7a899efb6d54c2fa3a44202a5d1e5f787d1e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6b3c7a899efb6d54c2fa3a44202a5d1e5f787d1e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2097e35a635cd58bfc21e8ab149a903d58e94bf2",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2097e35a635cd58bfc21e8ab149a903d58e94bf2",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2097e35a635cd58bfc21e8ab149a903d58e94bf2",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2097e35a635cd58bfc21e8ab149a903d58e94bf2/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "03cd591f47f852e0a2c2e6262367eff4acefca62",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/03cd591f47f852e0a2c2e6262367eff4acefca62",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/03cd591f47f852e0a2c2e6262367eff4acefca62"
      }
    ],
    "stats": {
      "total": 11,
      "additions": 9,
      "deletions": 2
    },
    "files": [
      {
        "sha": "b243f777a3ddf5f8dc8dfcbf1e3fe3d6347f5131",
        "filename": "src/interfaces/chain.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2097e35a635cd58bfc21e8ab149a903d58e94bf2/src/interfaces/chain.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2097e35a635cd58bfc21e8ab149a903d58e94bf2/src/interfaces/chain.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/interfaces/chain.cpp?ref=2097e35a635cd58bfc21e8ab149a903d58e94bf2",
        "patch": "@@ -354,6 +354,10 @@ class ChainImpl : public Chain\n         }\n         SyncWithValidationInterfaceQueue();\n     }\n+    void waitForNotifications() override\n+    {\n+        SyncWithValidationInterfaceQueue();\n+    }\n     std::unique_ptr<Handler> handleRpc(const CRPCCommand& command) override\n     {\n         return MakeUnique<RpcHandlerImpl>(command);"
      },
      {
        "sha": "8e7f6d5cdde188ff90b9ea9a369187144b419d88",
        "filename": "src/interfaces/chain.h",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2097e35a635cd58bfc21e8ab149a903d58e94bf2/src/interfaces/chain.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2097e35a635cd58bfc21e8ab149a903d58e94bf2/src/interfaces/chain.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/interfaces/chain.h?ref=2097e35a635cd58bfc21e8ab149a903d58e94bf2",
        "patch": "@@ -232,6 +232,9 @@ class Chain\n     //! chain tip.\n     virtual void waitForNotificationsIfTipChanged(const uint256& old_tip) = 0;\n \n+    //! Wait for pending notifications to be processed.\n+    virtual void waitForNotifications() = 0;\n+\n     //! Register handler for RPC. Command is not copied, so reference\n     //! needs to remain valid until Handler is disconnected.\n     virtual std::unique_ptr<Handler> handleRpc(const CRPCCommand& command) = 0;"
      },
      {
        "sha": "1498a15f4aad130b19259dd10c6326fbb3190ba4",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2097e35a635cd58bfc21e8ab149a903d58e94bf2/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2097e35a635cd58bfc21e8ab149a903d58e94bf2/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=2097e35a635cd58bfc21e8ab149a903d58e94bf2",
        "patch": "@@ -109,9 +109,9 @@ static void ReleaseWallet(CWallet* wallet)\n     // so that it's in sync with the current chainstate.\n     const std::string name = wallet->GetName();\n     wallet->WalletLogPrintf(\"Releasing wallet\\n\");\n-    wallet->BlockUntilSyncedToCurrentChain();\n-    wallet->Flush();\n     wallet->m_chain_notifications_handler.reset();\n+    wallet->chain().waitForNotifications();\n+    wallet->Flush();\n     delete wallet;\n     // Wallet is now released, notify UnloadWallet, if any.\n     {"
      }
    ]
  }
]