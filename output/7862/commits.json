[
  {
    "sha": "7e91f632c70ff1848a152f24ee67a06796803943",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3ZTkxZjYzMmM3MGZmMTg0OGExNTJmMjRlZTY3YTA2Nzk2ODAzOTQz",
    "commit": {
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2016-04-11T16:52:29Z"
      },
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2016-04-11T19:58:01Z"
      },
      "message": "Use txid as key in mapAlreadyAskedFor\n\nPreviously we used the CInv that would be sent to the peer announcing the\ntransaction as the key, but using the txid instead allows us to decouple the\np2p layer from the application logic (which relies on this map to avoid\nduplicate tx requests).",
      "tree": {
        "sha": "53995d33bf585645d43e51abbef2a7caf9754ef3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/53995d33bf585645d43e51abbef2a7caf9754ef3"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7e91f632c70ff1848a152f24ee67a06796803943",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7e91f632c70ff1848a152f24ee67a06796803943",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/7e91f632c70ff1848a152f24ee67a06796803943",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7e91f632c70ff1848a152f24ee67a06796803943/comments",
    "author": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "934f2b5e769368d1a2407d41d53cafd5d51e6b36",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/934f2b5e769368d1a2407d41d53cafd5d51e6b36",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/934f2b5e769368d1a2407d41d53cafd5d51e6b36"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 5,
      "deletions": 5
    },
    "files": [
      {
        "sha": "5c1af9ecccfc8d128d117f385fa0344de14eb717",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7e91f632c70ff1848a152f24ee67a06796803943/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7e91f632c70ff1848a152f24ee67a06796803943/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=7e91f632c70ff1848a152f24ee67a06796803943",
        "patch": "@@ -4956,7 +4956,7 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n         CValidationState state;\n \n         pfrom->setAskFor.erase(inv.hash);\n-        mapAlreadyAskedFor.erase(inv);\n+        mapAlreadyAskedFor.erase(inv.hash);\n \n         CFeeRate txFeeRate = CFeeRate(0);\n         if (!AlreadyHave(inv) && AcceptToMemoryPool(mempool, state, tx, true, &fMissingInputs, &txFeeRate)) {"
      },
      {
        "sha": "3bf8c165dc91101ee06a24243cae423f74086822",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 3,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7e91f632c70ff1848a152f24ee67a06796803943/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7e91f632c70ff1848a152f24ee67a06796803943/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=7e91f632c70ff1848a152f24ee67a06796803943",
        "patch": "@@ -93,7 +93,7 @@ CCriticalSection cs_vNodes;\n map<CInv, CDataStream> mapRelay;\n deque<pair<int64_t, CInv> > vRelayExpiration;\n CCriticalSection cs_mapRelay;\n-limitedmap<CInv, int64_t> mapAlreadyAskedFor(MAX_INV_SZ);\n+limitedmap<uint256, int64_t> mapAlreadyAskedFor(MAX_INV_SZ);\n \n static deque<string> vOneShots;\n CCriticalSection cs_vOneShots;\n@@ -2436,7 +2436,7 @@ void CNode::AskFor(const CInv& inv)\n     // We're using mapAskFor as a priority queue,\n     // the key is the earliest time the request can be sent\n     int64_t nRequestTime;\n-    limitedmap<CInv, int64_t>::const_iterator it = mapAlreadyAskedFor.find(inv);\n+    limitedmap<uint256, int64_t>::const_iterator it = mapAlreadyAskedFor.find(inv.hash);\n     if (it != mapAlreadyAskedFor.end())\n         nRequestTime = it->second;\n     else\n@@ -2455,7 +2455,7 @@ void CNode::AskFor(const CInv& inv)\n     if (it != mapAlreadyAskedFor.end())\n         mapAlreadyAskedFor.update(it, nRequestTime);\n     else\n-        mapAlreadyAskedFor.insert(std::make_pair(inv, nRequestTime));\n+        mapAlreadyAskedFor.insert(std::make_pair(inv.hash, nRequestTime));\n     mapAskFor.insert(std::make_pair(nRequestTime, inv));\n }\n "
      },
      {
        "sha": "1892c963fcee2a981349f676cb43f41070ada883",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7e91f632c70ff1848a152f24ee67a06796803943/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7e91f632c70ff1848a152f24ee67a06796803943/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=7e91f632c70ff1848a152f24ee67a06796803943",
        "patch": "@@ -164,7 +164,7 @@ extern CCriticalSection cs_vNodes;\n extern std::map<CInv, CDataStream> mapRelay;\n extern std::deque<std::pair<int64_t, CInv> > vRelayExpiration;\n extern CCriticalSection cs_mapRelay;\n-extern limitedmap<CInv, int64_t> mapAlreadyAskedFor;\n+extern limitedmap<uint256, int64_t> mapAlreadyAskedFor;\n \n extern std::vector<std::string> vAddedNodes;\n extern CCriticalSection cs_vAddedNodes;"
      }
    ]
  }
]