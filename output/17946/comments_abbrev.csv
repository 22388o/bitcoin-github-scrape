ryanofsky,2020-01-17 17:08:10,"[Comments in IRC](http://www.erisian.com.au/bitcoin-core-dev/log-2020-01-17.html#l-49) provide some context: without the information in rules field ""miners have no way to know what rules are being used and might produce invalid blocks""",https://github.com/bitcoin/bitcoin/pull/17946#issuecomment-575713292,575713292,
jnewbery,2020-01-17 17:47:52,Discussion in 16060 is here: https://github.com/bitcoin/bitcoin/pull/16060#discussion_r308043941,https://github.com/bitcoin/bitcoin/pull/17946#issuecomment-575727268,575727268,
luke-jr,2020-01-17 18:14:53,"(For clarity, I didn't mean fixing *this* bug in a separate PR, but rather the missing `""!""` and/or bad name/description of the `gbt_force` flag.)",https://github.com/bitcoin/bitcoin/pull/17946#issuecomment-575736743,575736743,
luke-jr,2020-01-17 19:45:43,"#9955 introduced a bug, sure, but that bug would only have impacted Segwit-unaware miners. Segwit-aware miners would have continued to work correctly because they saw that segwit was an active rule.\n\nRemoving the rule entirely means that sigops are counted differently, and transactions may not include witness data. I don't know if there are any real-world miners impacted by this, but it is at ",https://github.com/bitcoin/bitcoin/pull/17946#issuecomment-575768913,575768913,
jnewbery,2020-01-17 20:22:08,"> that bug would only have impacted Segwit-unaware miners.\n\nI think you have this the wrong way round. Segwit-unaware miners would see ""segwit"" in the rules, but according to BIP 9:\n\n> Without this [""!""] prefix, GBT clients may assume the rule will not impact usage of the template as-is;\n\nand so the segwit-unaware miner would use the template, but not be able to add the witness commitm",https://github.com/bitcoin/bitcoin/pull/17946#issuecomment-575780961,575780961,
luke-jr,2020-01-18 01:40:41,"> I think you have this the wrong way round. Segwit-unaware miners would see ""segwit"" in the rules, \n\nThey would fail by mining invalid blocks, instead of failing explicitly. Either way, they fail.\n\nSegwit-capable miners, on the other hand, shouldn't fail, but might because they think they're mining a non-segwit block.\n\n> Since #14811, the GBT request must include ""segwit"" in the rule ",https://github.com/bitcoin/bitcoin/pull/17946#issuecomment-575853886,575853886,
jameshilliard,2020-05-18 01:45:42,FYI without this mining with ckpool breaks since it will only try to produce segwit blocks when the segwit rule is seen.,https://github.com/bitcoin/bitcoin/pull/17946#issuecomment-629902012,629902012,
jnewbery,2020-05-18 13:19:16,"> FYI without this mining with ckpool breaks since it will only try to produce segwit blocks when the segwit rule is seen.\n\n@jameshilliard can you point me at the code that does that? The only getblocktemplate `""rules""` handling code I was able to find in ckpool was checking that the gbt response doesn't contain an unknown rule: https://bitbucket.org/ckolivas/ckpool/src/73f560cf3144f824823077c",https://github.com/bitcoin/bitcoin/pull/17946#issuecomment-630177499,630177499,
jameshilliard,2020-05-18 19:22:33,@jnewbery Well here's the [workaround](https://bitbucket.org/ckolivas/ckpool/commits/6a967c0c8a3814c319248b5ea0aa2d3261f31c2f) ck had to apply.,https://github.com/bitcoin/bitcoin/pull/17946#issuecomment-630387855,630387855,
sipa,2020-05-18 19:36:56,"ACK 412d5fe8791c417bf46fc55a5bb8d59be98a33db\n\n",https://github.com/bitcoin/bitcoin/pull/17946#issuecomment-630394387,630394387,
jnewbery,2020-05-18 20:41:32,"Thanks for the references, James.\n\nTested ACK 412d5fe8791c417bf46fc55a5bb8d59be98a33db.",https://github.com/bitcoin/bitcoin/pull/17946#issuecomment-630424244,630424244,
jnewbery,2020-05-19 13:50:31,This should be backported to v0.20.,https://github.com/bitcoin/bitcoin/pull/17946#issuecomment-630832292,630832292,
MarcoFalke,2020-05-19 14:20:11,"This this need a new rc? Maybe not for a two-line change?\n\nI suggest either creating a backport pr or bringing it up in the meeting, so that it is not forgotten.",https://github.com/bitcoin/bitcoin/pull/17946#issuecomment-630851067,630851067,
jameshilliard,2020-05-18 03:58:17,shouldn't we also test for `'csv'` being present here?,https://github.com/bitcoin/bitcoin/pull/17946#discussion_r426357879,426357879,test/functional/feature_segwit.py
MarcoFalke,2020-05-19 12:37:40,Going to merge this to not invalidate ACKs. Test improvements are welcome and can be submitted in a follow-up,https://github.com/bitcoin/bitcoin/pull/17946#discussion_r427267887,427267887,test/functional/feature_segwit.py
