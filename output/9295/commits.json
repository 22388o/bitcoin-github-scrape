[
  {
    "sha": "c24a4f5981d47d55aa9e4eb40294832a4d38fb80",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjMjRhNGY1OTgxZDQ3ZDU1YWE5ZTRlYjQwMjk0ODMyYTRkMzhmYjgw",
    "commit": {
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2016-12-06T12:45:56Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2016-12-06T12:45:56Z"
      },
      "message": "[Wallet] Bugfix: FRT: don't terminate when keypool is empty",
      "tree": {
        "sha": "49e95b564c108f15a272db2619bb0a49a839e647",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/49e95b564c108f15a272db2619bb0a49a839e647"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/c24a4f5981d47d55aa9e4eb40294832a4d38fb80",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "expired_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v2\n\niQIcBAABCAAGBQJYRrM0AAoJECnUvLZBb1PsSToP/i67V/33MD2gTWpcAYe9Znjw\nk5AoSu/a7vZTY1X57l9QQ1rxKZcxzidvG0X56go3TP3NBur6WBq1xObFHrmZCWqR\nqggFjqYm1XDSl5gBQywA8fWSMRbDRR+zbRknevBwadYdvoVJPucV3mwB3nSG4ZU1\n5ObfW0/J5hrx9nYpimpAQaLedyka3dS/VP+THc6Nem25ZEGIm27W/Oa1RluXaaZ4\nl1RVargl/1eAXJbpzwQSloSKs1hacedWZIEp5KAMzT74zl3h0fX4GgMfmQC6/YK3\naLxWOJTrZgm/itb564IvoAivpomyElFAC5E9/o24O1jrQ9eFRiUOWESyCjT6q5IY\nV8edTQACtJCulzwU250ivnWF3oxwc1qnnAunEdpC1n+SY4KOOI/Wkf3i1KXKzr33\nR+rfxlCHonEJq6WW+tsgBP+z+35OkcrDzpAERUfMq7ggYVYRnqGp9Rixu81PbGTv\ndPt7gHOMID7U8yCBpFR1ZZrkfrylUCkVbNj5l3GcUjQeSjQeoj9vYrx/ShgIUsuX\nDIOzE3YtqBL0vjE8R0pEHTugeRiq/VMEzrQOnfr54c4PxQNG6kcWCyqr/S98lUw6\ndGIF5oR/uArZ1H9w2ZmYmuWQSm6Roc5On4B5XyEkjEysalLomm9Am/gZ+E+Mdiiv\nKAFqSMUdkkFaBSi+R/GS\n=EgC0\n-----END PGP SIGNATURE-----",
        "payload": "tree 49e95b564c108f15a272db2619bb0a49a839e647\nparent 919db037f1f5cc73cdcaef92dd9cb0e7f5c8dec3\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1481028356 +0100\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1481028356 +0100\n\n[Wallet] Bugfix: FRT: don't terminate when keypool is empty\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c24a4f5981d47d55aa9e4eb40294832a4d38fb80",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/c24a4f5981d47d55aa9e4eb40294832a4d38fb80",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c24a4f5981d47d55aa9e4eb40294832a4d38fb80/comments",
    "author": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "919db037f1f5cc73cdcaef92dd9cb0e7f5c8dec3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/919db037f1f5cc73cdcaef92dd9cb0e7f5c8dec3",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/919db037f1f5cc73cdcaef92dd9cb0e7f5c8dec3"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 5,
      "deletions": 1
    },
    "files": [
      {
        "sha": "00e97d3c7fe1ce958b3897fd2824b3defef399a0",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 1,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/c24a4f5981d47d55aa9e4eb40294832a4d38fb80/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/c24a4f5981d47d55aa9e4eb40294832a4d38fb80/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=c24a4f5981d47d55aa9e4eb40294832a4d38fb80",
        "patch": "@@ -2389,7 +2389,11 @@ bool CWallet::CreateTransaction(const vector<CRecipient>& vecSend, CWalletTx& wt\n                         CPubKey vchPubKey;\n                         bool ret;\n                         ret = reservekey.GetReservedKey(vchPubKey);\n-                        assert(ret); // should never fail, as we just unlocked\n+                        if (!ret)\n+                        {\n+                            strFailReason = _(\"Keypool ran out, please call keypoolrefill first\");\n+                            return false;\n+                        }\n \n                         scriptChange = GetScriptForDestination(vchPubKey.GetID());\n                     }"
      }
    ]
  },
  {
    "sha": "1a6eacbf3b7e3d5941fec1154079bbc4678ce861",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxYTZlYWNiZjNiN2UzZDU5NDFmZWMxMTU0MDc5YmJjNDY3OGNlODYx",
    "commit": {
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2016-12-07T14:20:40Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2016-12-07T14:20:40Z"
      },
      "message": "[QA] add fundrawtransaction test on a locked wallet with empty keypool",
      "tree": {
        "sha": "3e6c5851b42cdcd0bd214c06ccda6b37377ae8bf",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3e6c5851b42cdcd0bd214c06ccda6b37377ae8bf"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1a6eacbf3b7e3d5941fec1154079bbc4678ce861",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "expired_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v2\n\niQIcBAABCAAGBQJYSBrIAAoJECnUvLZBb1PsK3gP/0/dHrDY+AERU69SVYIBU9vW\n+TlOxoGSRAqyJnPWQP+pcD1rhIT8j2CitkfU+GohqQpmeaWa2/YoLxuRdeKVmYWd\njIC5OQ5tISxTNfCVVGmBbflue/4VE0QYKAy9pcr1qA3KXdLRR+XqrzUz/Bu6cjuR\n6+h4IcbPvcVxclNbGVh5lbBOxxIcUOeKOesozYU0X0S8HBH96kBmbw4JPS+F66kd\neJ2oPpqKa0EssX7m5XFIF5dTj4g21SKgjtGjd7ddw6+kMl3srjtZtPUZsM2r3Ee5\npQQre3wDqXuYEZDibK+ETJKvmj+HO62LENQiBWiTxqQU/NgR+Z5CFBl+yy731oTk\n+10YYlU78eeAlmwuZfHTl29SYxAZsgG3DQXax8uAD4a6reMeqTEQ0JnxU44ZPxiP\nLnwcY0msJsu9vS9i88pFP94mWu1JMbeYu9LZxj+XfusqwqzNGCUI5JrSRDTxszRh\nQo1wCzQ6d9PoFbxmkDidlIK0tiErmZRklgVny/8TipyH7oAIwlUASEl4K5zJSbEG\nQ1kYG3W/FPvBE9wFTIMXzehdwQRWRAhp6n8xORYiW6QJYPlG+8+1fNSzde8VkOuG\nbIwX/LbQDmw29zyvSI2QwBx2LT9dQ5rV6OcxxAT041dXkqJ+tRisnAuIfJIaP2cH\nAytL4OQd3oF9mA3+rp0J\n=zXzs\n-----END PGP SIGNATURE-----",
        "payload": "tree 3e6c5851b42cdcd0bd214c06ccda6b37377ae8bf\nparent c24a4f5981d47d55aa9e4eb40294832a4d38fb80\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1481120440 +0100\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1481120440 +0100\n\n[QA] add fundrawtransaction test on a locked wallet with empty keypool\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1a6eacbf3b7e3d5941fec1154079bbc4678ce861",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/1a6eacbf3b7e3d5941fec1154079bbc4678ce861",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1a6eacbf3b7e3d5941fec1154079bbc4678ce861/comments",
    "author": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "c24a4f5981d47d55aa9e4eb40294832a4d38fb80",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c24a4f5981d47d55aa9e4eb40294832a4d38fb80",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/c24a4f5981d47d55aa9e4eb40294832a4d38fb80"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 17,
      "deletions": 0
    },
    "files": [
      {
        "sha": "0dcca4cb570fd231ca76f14392a2b9d8166a17fa",
        "filename": "qa/rpc-tests/fundrawtransaction.py",
        "status": "modified",
        "additions": 17,
        "deletions": 0,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1a6eacbf3b7e3d5941fec1154079bbc4678ce861/qa/rpc-tests/fundrawtransaction.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1a6eacbf3b7e3d5941fec1154079bbc4678ce861/qa/rpc-tests/fundrawtransaction.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/fundrawtransaction.py?ref=1a6eacbf3b7e3d5941fec1154079bbc4678ce861",
        "patch": "@@ -484,6 +484,23 @@ def run_test(self):\n         self.is_network_split=False\n         self.sync_all()\n \n+        # drain the keypool\n+        self.nodes[1].getnewaddress()\n+        inputs = []\n+        outputs = {self.nodes[0].getnewaddress():1.1}\n+        rawTx = self.nodes[1].createrawtransaction(inputs, outputs)\n+        # fund a transaction that requires a new key for the change output\n+        # creating the key must be impossible because the wallet is locked\n+        try:\n+            fundedTx = self.nodes[1].fundrawtransaction(rawTx)\n+            raise AssertionError(\"Wallet unlocked without passphrase\")\n+        except JSONRPCException as e:\n+            assert('Keypool ran out' in e.error['message'])\n+\n+        #refill the keypool\n+        self.nodes[1].walletpassphrase(\"test\", 100)\n+        self.nodes[1].walletlock()\n+\n         try:\n             self.nodes[1].sendtoaddress(self.nodes[0].getnewaddress(), 1.2)\n             raise AssertionError(\"Wallet unlocked without passphrase\")"
      }
    ]
  }
]