jnewbery,2018-06-28T19:06:35Z,"Feedback to address from @ryanofsky\n\nSome thoughts looking at code:\n\n- It seems like it would be good to raise an error if `IsDeprecatedRPCEnabled(""accounts"")` and the account argument is not null or ""*"". Otherwise the argument would be silently ignored.\n- Documentation seems to say default minconf is 1, while implementation uses 0 or 1.\n- Maybe could dedup caching code in `GetAvailabl",https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401140985,401140985,
jnewbery,2018-06-28T21:00:07Z,"> I guess that would not work for min dept of 0 (unconfirmed).\n\nAre you saying that we also need to check `pcoin->InMempool()` for coins with 0 depth?",https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401171720,401171720,
jnewbery,2018-06-28T21:59:52Z,"I believe that I've addressed all of @ryanofsky's feedback. Russ - can you rereview and confirm?\n\nNeed to address @jonasschnelli's comment. Jonas - can you please confirm my question above? Thanks!",https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401186338,401186338,
jnewbery,2018-06-29T14:25:57Z,"Thanks @ryanofsky . Updated to treat `*` as an acceptable dummy argument.\n\nI don't think we want to entirely remove the possibility of calling this method with positional arguments.",https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401370490,401370490,
jnewbery,2018-06-29T15:48:26Z,Thanks for the review @ryanofsky !,https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401395313,401395313,
Empact,2018-06-29T16:44:11Z,"This calls for a test, no?",https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401410116,401410116,
jnewbery,2018-06-29T19:55:24Z,@Empact - test added. Review plz :slightly_smiling_face: ,https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401457799,401457799,
Empact,2018-06-29T20:24:06Z,Should `CWallet::GetUnconfirmedBalance` use the cache?,https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401464423,401464423,
Empact,2018-06-29T20:54:24Z,utACK 702ae1e,https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401471423,401471423,
DrahtBot,2018-06-30T11:36:36Z,<!--e57a25ab6845829454e8d69fc972939a-->Note to reviewers: This pull request conflicts with the following ones:\n\n* #13637 (wallet: Add GetBalances to calculate all balances by promag)\n* #13631 (Add CMerkleTx::IsImmatureCoinBase method by Empact)\n* #13083 (Add compile time checking for cs_main runtime locking assertions by practicalswift)\n* #11634 (wallet: Add missing cs_wallet/cs_KeyStore lock,https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-401535534,401535534,
laanwj,2018-07-04T13:06:34Z,utACK 702ae1e21a09d8c31406839c4ea507c5fa276898,https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-402473757,402473757,
sipa,2018-07-14T01:27:54Z,utACK 702ae1e21a09d8c31406839c4ea507c5fa276898,https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-404989086,404989086,
jnewbery,2018-07-16T02:38:46Z,@Empact @promag - thanks for the reviews. I'll look at addressing nits in a follow-up.,https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-405138171,405138171,
jnewbery,2018-11-01T16:48:28Z,"@Empact @promag - I've addressed the remaining nits in https://github.com/jnewbery/bitcoin/tree/13566_nits, but there isn't much in there. I'm not sure if there's much point in opening a new PR.",https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-435105708,435105708,
Empact,2018-11-02T14:21:04Z,Yeah I would leave it as-is at this point.,https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-435395589,435395589,
promag,2018-11-02T14:34:39Z,"@jnewbery agree, not worth it.",https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-435399892,435399892,
jnewbery,2018-11-02T15:34:54Z,Agree. Thanks for the input. Sorry those changes didn't make it!,https://github.com/bitcoin/bitcoin/pull/13566#issuecomment-435419771,435419771,
ryanofsky,2018-06-29T13:39:45Z,"In commit ""[RPC] [wallet] allow getbalance to use min_conf and watch_only""\n\nI think the safest thing here would be to raise an error whenever accounts are deprecated and account is non-null, because previously `getbalance(null)`, `getbalance(""*"")`, and `getbalance("""")` each did different things, and it doesn't seem good to silently ignore a requested behavior. Another slightly less safe but ma",https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199161775,199161775,src/wallet/rpcwallet.cpp
ryanofsky,2018-06-29T14:23:03Z,"https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199161775\n\nAlso want to note that another approach we could take here would not be to deprecate the `account` argument at all, but instead just rename it to `label` and pass it down as an option to the GetBalance() and GetAvailableCredit methods where it could be used to filter txouts there by address label. This would be a simple code ",https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199175544,199175544,src/wallet/rpcwallet.cpp
Empact,2018-06-29T20:19:05Z,nit: comment bool arg?,https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199270410,199270410,src/wallet/wallet.cpp
Empact,2018-06-29T20:30:22Z,"nit: could move this into a `fUseCache` block, connected with 1991 below.",https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199272826,199272826,src/wallet/wallet.cpp
Empact,2018-06-29T20:34:52Z,nit: `|=`,https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199273845,199273845,src/wallet/rpcwallet.cpp
Empact,2018-06-29T20:37:38Z,Maybe show `*` here instead of dummy?,https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199274395,199274395,src/wallet/rpcwallet.cpp
Empact,2018-06-29T20:44:50Z,nit: whitespace,https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199275856,199275856,src/wallet/rpcwallet.cpp
Empact,2018-06-29T20:45:53Z,nit: whitespace,https://github.com/bitcoin/bitcoin/pull/13566#discussion_r199276069,199276069,src/wallet/rpcwallet.cpp
promag,2018-07-04T22:52:37Z,What if `filter == ISMINE_ALL` — which can be when `include_watchonly=true` in RPC `getbalance` — could sum both if cached?,https://github.com/bitcoin/bitcoin/pull/13566#discussion_r200208092,200208092,src/wallet/wallet.cpp
promag,2018-07-04T23:06:36Z,"nit, drop `&`?",https://github.com/bitcoin/bitcoin/pull/13566#discussion_r200208757,200208757,src/wallet/wallet.h
promag,2018-07-04T23:12:05Z,"`IsTrusted()` already computes `GetDepthInMainChain()`. Suggestion:\n```cpp\nbool IsTrusted(int min_depth = 1)\n```",https://github.com/bitcoin/bitcoin/pull/13566#discussion_r200209060,200209060,src/wallet/wallet.cpp
promag,2018-07-16T22:49:44Z,"Ignore my comment, I tried that refactor and it doesn't look good.",https://github.com/bitcoin/bitcoin/pull/13566#discussion_r202848913,202848913,src/wallet/wallet.cpp
jnewbery,2018-11-01T15:16:13Z,"I don't think it's the project's coding style to always comment arguments (at least, I don't see that elsewhere in the codebase as the norm).",https://github.com/bitcoin/bitcoin/pull/13566#discussion_r230078846,230078846,src/wallet/wallet.cpp
jnewbery,2018-11-01T15:20:56Z,`dummy` is the name of the argument. `*` is the value that it needs to be set to.,https://github.com/bitcoin/bitcoin/pull/13566#discussion_r230080654,230080654,src/wallet/rpcwallet.cpp
jnewbery,2018-11-01T15:54:24Z,"No, `cache` and `cache_used` are updated below even if `fUseCache` is not set.",https://github.com/bitcoin/bitcoin/pull/13566#discussion_r230093851,230093851,src/wallet/wallet.cpp
jnewbery,2018-11-01T15:57:37Z,"Seems like a reasonable optimization, but I don't think it's required. Could be done in a separate PR.",https://github.com/bitcoin/bitcoin/pull/13566#discussion_r230095022,230095022,src/wallet/wallet.cpp
