[
  {
    "sha": "2590acfa8208a91bb1b89504efb23a5d3639b663",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyNTkwYWNmYTgyMDhhOTFiYjFiODk1MDRlZmIyM2E1ZDM2MzliNjYz",
    "commit": {
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2016-11-29T16:16:30Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2016-11-29T16:17:26Z"
      },
      "message": "Ignore BIP35 mempool command by default",
      "tree": {
        "sha": "47e6fbb6b62ccc4e0178a0b5a1b75e8099af5c0e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/47e6fbb6b62ccc4e0178a0b5a1b75e8099af5c0e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2590acfa8208a91bb1b89504efb23a5d3639b663",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "expired_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v2\n\niQIcBAABCAAGBQJYPaoWAAoJECnUvLZBb1PsWYYP/0cawwEOaRirQb8c/iHC01km\nwH+v6bBN7oQxPQUNJj/UlFXY6kfSzM1/tAtywgPjJubyuBcSmPbMXw/HyI2o1TGr\nqFEm+ANk722FEhnRK4WUBHQxmknnJeJVcxR70FE4k0ITKnVBdd3cpsZF8mEGqlGy\nL7d9/aPBKOxTy98yBZVD/LIjRDypJvphu6/uXWW6BXesPpR8WO8bsGz8j4IukPQV\nXvAHBMB7ZNRJa0MmnrDu6SoMPAg/FEWVnwSxS6Lm51iM+XVbsIkhKkc6pnn6EbE5\ntwhJsai4Dz261ljhXkZxfcGvsP9pxBZ8RKWwHxdVpGwUxXYT8PYsmraWgzzrf1kW\n5CtpJceZjc+bZOLbfKJXztkSIPXFNv826VnJ8GJMh5ebem+LBTZxPEosiOJnmhhE\nPNazB5SNyS83Qcdi4duF1O9mPcdKOoklS5VEs78Nmcc4tOXqC2yKPBbRo77f0Fbu\nfinsV+/SrH99ZKl0FmZvcjL7e5eHZwTWivgc/99Uj7F9uplVytIJJyT6jXp3mJ1y\no6UVtZSG2OqANgwff9kc3HGE4s+6bZJlWlc7IRJPwSjeYuPSNSlbjdtYRGhYefg7\njwVbyWePPfySdfz4e6qgPQCV6L6v3HnJTcMdUPTf7fz2XgSXf0wfM7z70bfDWzBJ\n3ZvF/Bw/nvSTUzquaFCZ\n=gKK6\n-----END PGP SIGNATURE-----",
        "payload": "tree 47e6fbb6b62ccc4e0178a0b5a1b75e8099af5c0e\nparent e56cf67e6b3f2e87bee42aaa5ab709f479c9e6ca\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1480436190 +0100\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1480436246 +0100\n\nIgnore BIP35 mempool command by default\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2590acfa8208a91bb1b89504efb23a5d3639b663",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2590acfa8208a91bb1b89504efb23a5d3639b663",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2590acfa8208a91bb1b89504efb23a5d3639b663/comments",
    "author": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e56cf67e6b3f2e87bee42aaa5ab709f479c9e6ca",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e56cf67e6b3f2e87bee42aaa5ab709f479c9e6ca",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e56cf67e6b3f2e87bee42aaa5ab709f479c9e6ca"
      }
    ],
    "stats": {
      "total": 26,
      "additions": 24,
      "deletions": 2
    },
    "files": [
      {
        "sha": "647bb44a52fb3ec7aa9b41cbcdae1eef267920ee",
        "filename": "doc/bips.md",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2590acfa8208a91bb1b89504efb23a5d3639b663/doc/bips.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2590acfa8208a91bb1b89504efb23a5d3639b663/doc/bips.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/bips.md?ref=2590acfa8208a91bb1b89504efb23a5d3639b663",
        "patch": "@@ -13,6 +13,7 @@ BIPs that are implemented by Bitcoin Core (up-to-date up to **v0.13.0**):\n * [`BIP 32`](https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki): Hierarchical Deterministic Wallets has been implemented since **v0.13.0** ([PR #8035](https://github.com/bitcoin/bitcoin/pull/8035)).\n * [`BIP 34`](https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki): The rule that requires blocks to contain their height (number) in the coinbase input, and the introduction of version 2 blocks has been implemented since **v0.7.0**. The rule took effect for version 2 blocks as of *block 224413* (March 5th 2013), and version 1 blocks are no longer allowed since *block 227931* (March 25th 2013) ([PR #1526](https://github.com/bitcoin/bitcoin/pull/1526)).\n * [`BIP 35`](https://github.com/bitcoin/bips/blob/master/bip-0035.mediawiki): The 'mempool' protocol message (and the protocol version bump to 60002) has been implemented since **v0.7.0** ([PR #1641](https://github.com/bitcoin/bitcoin/pull/1641)).\n+  Disabled since **v0.14.0**.\n * [`BIP 37`](https://github.com/bitcoin/bips/blob/master/bip-0037.mediawiki): The bloom filtering for transaction relaying, partial merkle trees for blocks, and the protocol version bump to 70001 (enabling low-bandwidth SPV clients) has been implemented since **v0.8.0** ([PR #1795](https://github.com/bitcoin/bitcoin/pull/1795)).\n * [`BIP 42`](https://github.com/bitcoin/bips/blob/master/bip-0042.mediawiki): The bug that would have caused the subsidy schedule to resume after block 13440000 was fixed in **v0.9.2** ([PR #3842](https://github.com/bitcoin/bitcoin/pull/3842)).\n * [`BIP 61`](https://github.com/bitcoin/bips/blob/master/bip-0061.mediawiki): The 'reject' protocol message (and the protocol version bump to 70002) was added in **v0.9.0** ([PR #3185](https://github.com/bitcoin/bitcoin/pull/3185))."
      },
      {
        "sha": "056358a923c9dc9fb2bf851bf204af991c0cce36",
        "filename": "doc/release-notes.md",
        "status": "modified",
        "additions": 8,
        "deletions": 0,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2590acfa8208a91bb1b89504efb23a5d3639b663/doc/release-notes.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2590acfa8208a91bb1b89504efb23a5d3639b663/doc/release-notes.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/release-notes.md?ref=2590acfa8208a91bb1b89504efb23a5d3639b663",
        "patch": "@@ -62,6 +62,14 @@ Removal of Priority Estimation\n   major version. To prepare for this, the default for the rate limit of priority\n   transactions (`-limitfreerelay`) has been set to `0` kB/minute.\n \n+\n+Disabling the p2p mempool command (BIP35)\n+------------------------------------------\n+\n+- The mempool command was repetitively misused for surveillance and DOS attacks and the current use case (SPV scanning of unconfirmed transactions) do not justify the risks.\n+\n+- The command can be optionally be enabled with `-peermempool`.\n+\n 0.14.0 Change log\n =================\n "
      },
      {
        "sha": "00cfb7690d290ce82b628fdc74039b37126b1aed",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2590acfa8208a91bb1b89504efb23a5d3639b663/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2590acfa8208a91bb1b89504efb23a5d3639b663/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=2590acfa8208a91bb1b89504efb23a5d3639b663",
        "patch": "@@ -376,6 +376,7 @@ std::string HelpMessage(HelpMessageMode mode)\n     strUsage += HelpMessageOpt(\"-onlynet=<net>\", _(\"Only connect to nodes in network <net> (ipv4, ipv6 or onion)\"));\n     strUsage += HelpMessageOpt(\"-permitbaremultisig\", strprintf(_(\"Relay non-P2SH multisig (default: %u)\"), DEFAULT_PERMIT_BAREMULTISIG));\n     strUsage += HelpMessageOpt(\"-peerbloomfilters\", strprintf(_(\"Support filtering of blocks and transaction with bloom filters (default: %u)\"), DEFAULT_PEERBLOOMFILTERS));\n+    strUsage += HelpMessageOpt(\"-peermempool\", strprintf(_(\"Accept mempool requests from other peers (default: %u)\"), DEFAULT_PEERMEMPOOLCMD));\n     strUsage += HelpMessageOpt(\"-port=<port>\", strprintf(_(\"Listen for connections on <port> (default: %u or testnet: %u)\"), Params(CBaseChainParams::MAIN).GetDefaultPort(), Params(CBaseChainParams::TESTNET).GetDefaultPort()));\n     strUsage += HelpMessageOpt(\"-proxy=<ip:port>\", _(\"Connect through SOCKS5 proxy\"));\n     strUsage += HelpMessageOpt(\"-proxyrandomize\", strprintf(_(\"Randomize credentials for every proxy connection. This enables Tor stream isolation (default: %u)\"), DEFAULT_PROXYRANDOMIZE));\n@@ -975,6 +976,9 @@ bool AppInit2(boost::thread_group& threadGroup, CScheduler& scheduler)\n     if (GetBoolArg(\"-peerbloomfilters\", DEFAULT_PEERBLOOMFILTERS))\n         nLocalServices = ServiceFlags(nLocalServices | NODE_BLOOM);\n \n+    if (GetBoolArg(\"-peermempool\", DEFAULT_PEERMEMPOOLCMD))\n+        nLocalServices = ServiceFlags(nLocalServices | NODE_MEMPOOLCMD);\n+\n     nMaxTipAge = GetArg(\"-maxtipage\", DEFAULT_MAX_TIP_AGE);\n \n     fEnableReplacement = GetBoolArg(\"-mempoolreplacement\", DEFAULT_ENABLE_REPLACEMENT);"
      },
      {
        "sha": "dd86bb91655a64d6e11ecbd526c9bf93801abcf8",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2590acfa8208a91bb1b89504efb23a5d3639b663/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2590acfa8208a91bb1b89504efb23a5d3639b663/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=2590acfa8208a91bb1b89504efb23a5d3639b663",
        "patch": "@@ -6153,7 +6153,7 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv,\n     }\n \n \n-    else if (strCommand == NetMsgType::MEMPOOL)\n+    else if (strCommand == NetMsgType::MEMPOOL && (pfrom->GetLocalServices() & NODE_MEMPOOLCMD))\n     {\n         if (!(pfrom->GetLocalServices() & NODE_BLOOM) && !pfrom->fWhitelisted)\n         {"
      },
      {
        "sha": "aa13062a6cc8b19f442e76062cfd96943b502a3e",
        "filename": "src/main.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2590acfa8208a91bb1b89504efb23a5d3639b663/src/main.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2590acfa8208a91bb1b89504efb23a5d3639b663/src/main.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.h?ref=2590acfa8208a91bb1b89504efb23a5d3639b663",
        "patch": "@@ -148,6 +148,7 @@ static const unsigned int MAX_BLOCKS_TO_ANNOUNCE = 8;\n static const int MAX_UNCONNECTING_HEADERS = 10;\n \n static const bool DEFAULT_PEERBLOOMFILTERS = true;\n+static const bool DEFAULT_PEERMEMPOOLCMD = false;\n \n struct BlockHasher\n {"
      },
      {
        "sha": "067b6ba5b096ed8a79e38cb70bcdb40dbdc0598d",
        "filename": "src/protocol.h",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2590acfa8208a91bb1b89504efb23a5d3639b663/src/protocol.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2590acfa8208a91bb1b89504efb23a5d3639b663/src/protocol.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/protocol.h?ref=2590acfa8208a91bb1b89504efb23a5d3639b663",
        "patch": "@@ -267,6 +267,8 @@ enum ServiceFlags : uint64_t {\n     // NODE_XTHIN means the node supports Xtreme Thinblocks\n     // If this is turned off then the node will not service nor make xthin requests\n     NODE_XTHIN = (1 << 4),\n+    // NODE_MEMPOOLCMD indicates that a node can be asked for mempool transactions\n+    NODE_MEMPOOLCMD = (1 << 5),\n \n     // Bits 24-31 are reserved for temporary experiments. Just pick a bit that\n     // isn't getting used, or one not being used much, and notify the"
      },
      {
        "sha": "37ce46af1cfea9ae6dc38fefe7c3bf5889017ff0",
        "filename": "src/qt/guiutil.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2590acfa8208a91bb1b89504efb23a5d3639b663/src/qt/guiutil.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2590acfa8208a91bb1b89504efb23a5d3639b663/src/qt/guiutil.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/guiutil.cpp?ref=2590acfa8208a91bb1b89504efb23a5d3639b663",
        "patch": "@@ -928,6 +928,9 @@ QString formatServicesStr(quint64 mask)\n             case NODE_XTHIN:\n                 strList.append(\"XTHIN\");\n                 break;\n+            case NODE_MEMPOOLCMD:\n+                strList.append(\"MEMPOOLCMD\");\n+                break;\n             default:\n                 strList.append(QString(\"%1[%2]\").arg(\"UNKNOWN\").arg(check));\n             }"
      },
      {
        "sha": "7d0a2908b6e66f9993575e7bc6d23c1ca6739abb",
        "filename": "src/version.h",
        "status": "modified",
        "additions": 4,
        "deletions": 1,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2590acfa8208a91bb1b89504efb23a5d3639b663/src/version.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2590acfa8208a91bb1b89504efb23a5d3639b663/src/version.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/version.h?ref=2590acfa8208a91bb1b89504efb23a5d3639b663",
        "patch": "@@ -9,7 +9,7 @@\n  * network protocol versioning\n  */\n \n-static const int PROTOCOL_VERSION = 70015;\n+static const int PROTOCOL_VERSION = 70016;\n \n //! initial proto version, to be increased after version/verack negotiation\n static const int INIT_PROTO_VERSION = 209;\n@@ -45,4 +45,7 @@ static const int SHORT_IDS_BLOCKS_VERSION = 70014;\n //! not banning for invalid compact blocks starts with this version\n static const int INVALID_CB_NO_BAN_VERSION = 70015;\n \n+//! BIP35 mempool requests are ignored when the NODE_MEMPOOLCMD service bit is not set with this version\n+static const int DISABLE_MEMPOOl_CMD_VERSION = 70016;\n+\n #endif // BITCOIN_VERSION_H"
      }
    ]
  }
]