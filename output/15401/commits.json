[
  {
    "sha": "fa05626ca7a0fe896ac554c79eaea4c36acdf861",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTA1NjI2Y2E3YTBmZTg5NmFjNTU0Yzc5ZWFlYTRjMzZhY2RmODYx",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-02-13T01:16:29Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-02-20T18:32:17Z"
      },
      "message": "rpc: Add RPCHelpMan::IsValidNumArgs()",
      "tree": {
        "sha": "7aa3908300e4233d608666a05ec48c232432d926",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7aa3908300e4233d608666a05ec48c232432d926"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa05626ca7a0fe896ac554c79eaea4c36acdf861",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGcBAABCgAGBQJcbZ0xAAoJEM4rdWl+aaVI7pMMAInEBBotv6pMfSpAvIHIOCDI\nqrBGX4jgOKelE5UwIiQje7fucCPjEcH7PpG03VMUS6r9U7fnYSw1vnC4PK+qrk55\nYqfkaj9X4E2jgxN1ymJXZSAdQGEvaWXtFuu1T3wj3F32HE9dhNOKew4KOE9ml4o/\nAEwGA7ncNs18cVVSb2z5+p4a4k15AnKs7Zlb+Ka+VS0bDW0BHPndt9cUlpO5x8j6\ndMZaYQ7iS2ek0UtOcgdRNRTy9knCPqo6K1jd2wKv+Bzj2Jlzb8cBF6llSuzkuLj2\nrRxkgoEH5/0oWIREPC81sxdwt5GhXTW15lMzjXzsaKyZWvHOmJHUK7I9R8AUm0Lz\n8IHvH0zj2/ljOBVwhBWmyRqfbUMfGs0Ye2ZmYDDP10IcpefnCN/SOdB4V8N2fCTY\nssbmUTIdwWPUFnSMzhSyA0VvLiPma7TPezhisEgdgxS1UcXDbHWK68E2eU1GYH9G\nXpluB6xqi79zz6B90QBJJu2pWd6KY9cYmaaEDh3BOA==\n=6e0N\n-----END PGP SIGNATURE-----",
        "payload": "tree 7aa3908300e4233d608666a05ec48c232432d926\nparent f9775a865597b3cc926ba3375fa692516c7415be\nauthor MarcoFalke <falke.marco@gmail.com> 1550020589 -0500\ncommitter MarcoFalke <falke.marco@gmail.com> 1550687537 -0500\n\nrpc: Add RPCHelpMan::IsValidNumArgs()\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa05626ca7a0fe896ac554c79eaea4c36acdf861",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa05626ca7a0fe896ac554c79eaea4c36acdf861",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa05626ca7a0fe896ac554c79eaea4c36acdf861/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "f9775a865597b3cc926ba3375fa692516c7415be",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/f9775a865597b3cc926ba3375fa692516c7415be",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/f9775a865597b3cc926ba3375fa692516c7415be"
      }
    ],
    "stats": {
      "total": 37,
      "additions": 28,
      "deletions": 9
    },
    "files": [
      {
        "sha": "e37af953fadca1e8a6567af5abb980d8b96fb524",
        "filename": "src/rpc/util.cpp",
        "status": "modified",
        "additions": 22,
        "deletions": 7,
        "changes": 29,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa05626ca7a0fe896ac554c79eaea4c36acdf861/src/rpc/util.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa05626ca7a0fe896ac554c79eaea4c36acdf861/src/rpc/util.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/util.cpp?ref=fa05626ca7a0fe896ac554c79eaea4c36acdf861",
        "patch": "@@ -1,4 +1,4 @@\n-// Copyright (c) 2017-2018 The Bitcoin Core developers\n+// Copyright (c) 2017-2019 The Bitcoin Core developers\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n@@ -315,6 +315,17 @@ std::string RPCExamples::ToDescriptionString() const\n     return m_examples.empty() ? m_examples : \"\\nExamples:\\n\" + m_examples;\n }\n \n+bool RPCHelpMan::IsValidNumArgs(size_t num_args) const\n+{\n+    size_t num_required_args = 0;\n+    for (size_t n = m_args.size(); n > 0; --n) {\n+        if (!m_args.at(n - 1).IsOptional()) {\n+            num_required_args = n;\n+            break;\n+        }\n+    }\n+    return num_required_args <= num_args && num_args <= m_args.size();\n+}\n std::string RPCHelpMan::ToString() const\n {\n     std::string ret;\n@@ -323,12 +334,7 @@ std::string RPCHelpMan::ToString() const\n     ret += m_name;\n     bool was_optional{false};\n     for (const auto& arg : m_args) {\n-        bool optional;\n-        if (arg.m_fallback.which() == 1) {\n-            optional = true;\n-        } else {\n-            optional = RPCArg::Optional::NO != boost::get<RPCArg::Optional>(arg.m_fallback);\n-        }\n+        const bool optional = arg.IsOptional();\n         ret += \" \";\n         if (optional) {\n             if (!was_optional) ret += \"( \";\n@@ -370,6 +376,15 @@ std::string RPCHelpMan::ToString() const\n     return ret;\n }\n \n+bool RPCArg::IsOptional() const\n+{\n+    if (m_fallback.which() == 1) {\n+        return true;\n+    } else {\n+        return RPCArg::Optional::NO != boost::get<RPCArg::Optional>(m_fallback);\n+    }\n+}\n+\n std::string RPCArg::ToDescriptionString() const\n {\n     std::string ret;"
      },
      {
        "sha": "7b8dd5a9ecffd6ef376ac5e1c4104ed3dd721ef7",
        "filename": "src/rpc/util.h",
        "status": "modified",
        "additions": 6,
        "deletions": 2,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa05626ca7a0fe896ac554c79eaea4c36acdf861/src/rpc/util.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa05626ca7a0fe896ac554c79eaea4c36acdf861/src/rpc/util.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/util.h?ref=fa05626ca7a0fe896ac554c79eaea4c36acdf861",
        "patch": "@@ -1,4 +1,4 @@\n-// Copyright (c) 2017-2018 The Bitcoin Core developers\n+// Copyright (c) 2017-2019 The Bitcoin Core developers\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n@@ -53,7 +53,7 @@ struct RPCArg {\n         /** Required arg */\n         NO,\n         /**\n-         * Optinal arg that is a named argument and has a default value of\n+         * Optional arg that is a named argument and has a default value of\n          * `null`. When possible, the default value should be specified.\n          */\n         OMITTED_NAMED_ARG,\n@@ -110,6 +110,8 @@ struct RPCArg {\n         assert(type == Type::ARR || type == Type::OBJ);\n     }\n \n+    bool IsOptional() const;\n+\n     /**\n      * Return the type string of the argument.\n      * Set oneline to allow it to be overridden by a custom oneline type string (m_oneline_description).\n@@ -185,6 +187,8 @@ class RPCHelpMan\n     RPCHelpMan(std::string name, std::string description, std::vector<RPCArg> args, RPCResults results, RPCExamples examples);\n \n     std::string ToString() const;\n+    /** If the supplied number of args is neither too small nor too high */\n+    bool IsValidNumArgs(size_t num_args) const;\n \n private:\n     const std::string m_name;"
      }
    ]
  },
  {
    "sha": "fa4ce7038d444defe0b98a30097174c278054a33",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTRjZTcwMzhkNDQ0ZGVmZTBiOThhMzAwOTcxNzRjMjc4MDU0YTMz",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-02-13T21:51:27Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2019-02-20T18:34:16Z"
      },
      "message": "rpc: Actually throw help when passed invalid number of params",
      "tree": {
        "sha": "48d5aaa962b2bf2d9d7365fd9276a3b5821fadb9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/48d5aaa962b2bf2d9d7365fd9276a3b5821fadb9"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa4ce7038d444defe0b98a30097174c278054a33",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGcBAABCgAGBQJcbZ2oAAoJEM4rdWl+aaVIfB4MAMfWo7LQbn1jUON/9mNHvZHj\nUZDwQ12sNQGoGeUrrventAKCWgvWcMZ8q3bCPfCktNQdIoyAYVW7eJJ+gUUwP0Xh\nDWb0uLj+Z4ZaYwmzmDcH5KuiQbYwwO6XXRXB3JYttn8MzcSKNl8WMb0UgE0MGarK\nGPVwVFA2zVRsRVf638hbIsn6WgJ9X/ECh1Qna2AOsP/XsA6KQfLHClboubE4mOSq\nfMPQp36oSQwYwUJUl2ULW+Hu1Ea2rbSAOLqB+KzvQ1+/INdsrn6IdpfYR6aonzU0\ndBeUhcMHk/f/MT1pWtQqnraiJJJmjU4jtIWpILeOns+TuApq/TC2GTuCpx7RnSua\nZv0k+OcZr4R5KjSQ9nXcwQYCCpTaTD3i/yf9bc2FINVXuWlu3HiM2AvKbw/mrcQC\n2Zj/flj7g61IN3GQxkJg3DR7zLq0HCXmEyBm5NiMbZfIIIAhnNzJuzsWMG1S+m4F\nl6KT1m0ZrZxPtaQwwaLwOqMlo1W+FSk0+xAbKHooew==\n=p86Z\n-----END PGP SIGNATURE-----",
        "payload": "tree 48d5aaa962b2bf2d9d7365fd9276a3b5821fadb9\nparent fa05626ca7a0fe896ac554c79eaea4c36acdf861\nauthor MarcoFalke <falke.marco@gmail.com> 1550094687 -0500\ncommitter MarcoFalke <falke.marco@gmail.com> 1550687656 -0500\n\nrpc: Actually throw help when passed invalid number of params\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa4ce7038d444defe0b98a30097174c278054a33",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa4ce7038d444defe0b98a30097174c278054a33",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa4ce7038d444defe0b98a30097174c278054a33/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fa05626ca7a0fe896ac554c79eaea4c36acdf861",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa05626ca7a0fe896ac554c79eaea4c36acdf861",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fa05626ca7a0fe896ac554c79eaea4c36acdf861"
      }
    ],
    "stats": {
      "total": 31,
      "additions": 18,
      "deletions": 13
    },
    "files": [
      {
        "sha": "c73a8d48cfa6d31bf74bc6baf9886448dfd4ad5b",
        "filename": "src/rpc/blockchain.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 5,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa4ce7038d444defe0b98a30097174c278054a33/src/rpc/blockchain.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa4ce7038d444defe0b98a30097174c278054a33/src/rpc/blockchain.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/blockchain.cpp?ref=fa4ce7038d444defe0b98a30097174c278054a33",
        "patch": "@@ -1,5 +1,5 @@\n // Copyright (c) 2010 Satoshi Nakamoto\n-// Copyright (c) 2009-2018 The Bitcoin Core developers\n+// Copyright (c) 2009-2019 The Bitcoin Core developers\n // Distributed under the MIT software license, see the accompanying\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n@@ -1778,9 +1778,7 @@ static constexpr size_t PER_UTXO_OVERHEAD = sizeof(COutPoint) + sizeof(uint32_t)\n \n static UniValue getblockstats(const JSONRPCRequest& request)\n {\n-    if (request.fHelp || request.params.size() < 1 || request.params.size() > 4) {\n-        throw std::runtime_error(\n-            RPCHelpMan{\"getblockstats\",\n+    const RPCHelpMan help{\"getblockstats\",\n                 \"\\nCompute per block statistics for a given window. All amounts are in satoshis.\\n\"\n                 \"It won't work for some heights with pruning.\\n\"\n                 \"It won't work without -txindex for utxo_size_inc, *fee or *feerate stats.\\n\",\n@@ -1836,7 +1834,9 @@ static UniValue getblockstats(const JSONRPCRequest& request)\n                     HelpExampleCli(\"getblockstats\", \"1000 '[\\\"minfeerate\\\",\\\"avgfeerate\\\"]'\")\n             + HelpExampleRpc(\"getblockstats\", \"1000 '[\\\"minfeerate\\\",\\\"avgfeerate\\\"]'\")\n                 },\n-            }.ToString());\n+    };\n+    if (request.fHelp || !help.IsValidNumArgs(request.params.size())) {\n+        throw std::runtime_error(help.ToString());\n     }\n \n     LOCK(cs_main);"
      },
      {
        "sha": "c7b3478f440c148998d3802b9292991ed1313e18",
        "filename": "src/rpc/net.cpp",
        "status": "modified",
        "additions": 8,
        "deletions": 8,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa4ce7038d444defe0b98a30097174c278054a33/src/rpc/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa4ce7038d444defe0b98a30097174c278054a33/src/rpc/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpc/net.cpp?ref=fa4ce7038d444defe0b98a30097174c278054a33",
        "patch": "@@ -523,13 +523,7 @@ static UniValue getnetworkinfo(const JSONRPCRequest& request)\n \n static UniValue setban(const JSONRPCRequest& request)\n {\n-    std::string strCommand;\n-    if (!request.params[1].isNull())\n-        strCommand = request.params[1].get_str();\n-    if (request.fHelp || request.params.size() < 2 ||\n-        (strCommand != \"add\" && strCommand != \"remove\"))\n-        throw std::runtime_error(\n-            RPCHelpMan{\"setban\",\n+    const RPCHelpMan help{\"setban\",\n                 \"\\nAttempts to add or remove an IP/Subnet from the banned list.\\n\",\n                 {\n                     {\"subnet\", RPCArg::Type::STR, RPCArg::Optional::NO, \"The IP/Subnet (see getpeerinfo for nodes IP) with an optional netmask (default is /32 = single IP)\"},\n@@ -543,7 +537,13 @@ static UniValue setban(const JSONRPCRequest& request)\n                             + HelpExampleCli(\"setban\", \"\\\"192.168.0.0/24\\\" \\\"add\\\"\")\n                             + HelpExampleRpc(\"setban\", \"\\\"192.168.0.6\\\", \\\"add\\\", 86400\")\n                 },\n-            }.ToString());\n+    };\n+    std::string strCommand;\n+    if (!request.params[1].isNull())\n+        strCommand = request.params[1].get_str();\n+    if (request.fHelp || !help.IsValidNumArgs(request.params.size()) || (strCommand != \"add\" && strCommand != \"remove\")) {\n+        throw std::runtime_error(help.ToString());\n+    }\n     if (!g_banman) {\n         throw JSONRPCError(RPC_DATABASE_ERROR, \"Error: Ban database not loaded\");\n     }"
      },
      {
        "sha": "feba16f1b3847bee66bbdd8d7a4c2ae9179f8dfe",
        "filename": "test/functional/rpc_getblockstats.py",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa4ce7038d444defe0b98a30097174c278054a33/test/functional/rpc_getblockstats.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa4ce7038d444defe0b98a30097174c278054a33/test/functional/rpc_getblockstats.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/rpc_getblockstats.py?ref=fa4ce7038d444defe0b98a30097174c278054a33",
        "patch": "@@ -178,5 +178,10 @@ def run_test(self):\n         assert_raises_rpc_error(-5, 'Block not found', self.nodes[0].getblockstats,\n                                 hash_or_height='000000000019d6689c085ae165831e934ff763ae46a2a6c172b3f1b60a8ce26f')\n \n+        # Invalid number of args\n+        assert_raises_rpc_error(-1, 'getblockstats hash_or_height ( stats )', self.nodes[0].getblockstats, '00', 1, 2)\n+        assert_raises_rpc_error(-1, 'getblockstats hash_or_height ( stats )', self.nodes[0].getblockstats)\n+\n+\n if __name__ == '__main__':\n     GetblockstatsTest().main()"
      }
    ]
  }
]