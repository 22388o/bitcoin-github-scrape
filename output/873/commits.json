[
  {
    "sha": "18c0fa97d0408a3ee8e4cb39c08156f7667f99ac",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxOGMwZmE5N2QwNDA4YTNlZThlNGNiMzljMDgxNTZmNzY2N2Y5OWFj",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-02-20T00:33:31Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-02-21T19:46:39Z"
      },
      "message": "Post-feb20 simplifications\n\nNow the entire network upgraded to (initial) protocol version 209,\ncrtainl simplifications in the source code are possible.",
      "tree": {
        "sha": "5a49fa04a410626fe2e04628f98944be2017298d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5a49fa04a410626fe2e04628f98944be2017298d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/18c0fa97d0408a3ee8e4cb39c08156f7667f99ac",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/18c0fa97d0408a3ee8e4cb39c08156f7667f99ac",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/18c0fa97d0408a3ee8e4cb39c08156f7667f99ac",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/18c0fa97d0408a3ee8e4cb39c08156f7667f99ac/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "8a949dd6c3ce8161967330ebabf8ba021c0a6295",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8a949dd6c3ce8161967330ebabf8ba021c0a6295",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/8a949dd6c3ce8161967330ebabf8ba021c0a6295"
      }
    ],
    "stats": {
      "total": 66,
      "additions": 27,
      "deletions": 39
    },
    "files": [
      {
        "sha": "fe15a7f64c8ab8d97f291262342c9c4740ca84c2",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 20,
        "deletions": 22,
        "changes": 42,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/18c0fa97d0408a3ee8e4cb39c08156f7667f99ac/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/18c0fa97d0408a3ee8e4cb39c08156f7667f99ac/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=18c0fa97d0408a3ee8e4cb39c08156f7667f99ac",
        "patch": "@@ -2100,18 +2100,24 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv)\n         CAddress addrFrom;\n         uint64 nNonce = 1;\n         vRecv >> pfrom->nVersion >> pfrom->nServices >> nTime >> addrMe;\n+        if (pfrom->nVersion < 209)\n+        {\n+            // Since Februari 20, 2012, the protocol is initiated at version 209,\n+            // and earlier versions are no longer supported\n+            printf(\"partner %s using obsolete version %i; disconnecting\\n\", pfrom->addr.ToString().c_str(), pfrom->nVersion);\n+            pfrom->fDisconnect = true;\n+            return false;\n+        }\n+\n         if (pfrom->nVersion == 10300)\n             pfrom->nVersion = 300;\n-        if (pfrom->nVersion >= 106 && !vRecv.empty())\n+        if (!vRecv.empty())\n             vRecv >> addrFrom >> nNonce;\n-        if (pfrom->nVersion >= 106 && !vRecv.empty())\n+        if (!vRecv.empty())\n             vRecv >> pfrom->strSubVer;\n-        if (pfrom->nVersion >= 209 && !vRecv.empty())\n+        if (!vRecv.empty())\n             vRecv >> pfrom->nStartingHeight;\n \n-        if (pfrom->nVersion == 0)\n-            return false;\n-\n         // Disconnect if we connected to ourself\n         if (nNonce == nLocalHostNonce && nNonce > 1)\n         {\n@@ -2129,11 +2135,8 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv)\n         AddTimeData(pfrom->addr, nTime);\n \n         // Change version\n-        if (pfrom->nVersion >= 209)\n-            pfrom->PushMessage(\"verack\");\n+        pfrom->PushMessage(\"verack\");\n         pfrom->vSend.SetVersion(min(pfrom->nVersion, PROTOCOL_VERSION));\n-        if (pfrom->nVersion < 209)\n-            pfrom->vRecv.SetVersion(min(pfrom->nVersion, PROTOCOL_VERSION));\n \n         if (!pfrom->fInbound)\n         {\n@@ -2197,8 +2200,6 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv)\n         vRecv >> vAddr;\n \n         // Don't want addr from older versions unless seeding\n-        if (pfrom->nVersion < 209)\n-            return true;\n         if (pfrom->nVersion < 31402 && mapAddresses.size() > 1000)\n             return true;\n         if (vAddr.size() > 1000)\n@@ -2660,17 +2661,14 @@ bool ProcessMessages(CNode* pfrom)\n         }\n \n         // Checksum\n-        if (vRecv.GetVersion() >= 209)\n+        uint256 hash = Hash(vRecv.begin(), vRecv.begin() + nMessageSize);\n+        unsigned int nChecksum = 0;\n+        memcpy(&nChecksum, &hash, sizeof(nChecksum));\n+        if (nChecksum != hdr.nChecksum)\n         {\n-            uint256 hash = Hash(vRecv.begin(), vRecv.begin() + nMessageSize);\n-            unsigned int nChecksum = 0;\n-            memcpy(&nChecksum, &hash, sizeof(nChecksum));\n-            if (nChecksum != hdr.nChecksum)\n-            {\n-                printf(\"ProcessMessage(%s, %u bytes) : CHECKSUM ERROR nChecksum=%08x hdr.nChecksum=%08x\\n\",\n-                       strCommand.c_str(), nMessageSize, nChecksum, hdr.nChecksum);\n-                continue;\n-            }\n+            printf(\"ProcessMessage(%s, %u bytes) : CHECKSUM ERROR nChecksum=%08x hdr.nChecksum=%08x\\n\",\n+               strCommand.c_str(), nMessageSize, nChecksum, hdr.nChecksum);\n+            continue;\n         }\n \n         // Copy message to its own buffer"
      },
      {
        "sha": "e3e92dad84a87584ba8c3a41da08c43c27938e11",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 7,
        "deletions": 16,
        "changes": 23,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/18c0fa97d0408a3ee8e4cb39c08156f7667f99ac/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/18c0fa97d0408a3ee8e4cb39c08156f7667f99ac/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=18c0fa97d0408a3ee8e4cb39c08156f7667f99ac",
        "patch": "@@ -166,15 +166,9 @@ class CNode\n         nServices = 0;\n         hSocket = hSocketIn;\n         vSend.SetType(SER_NETWORK);\n-        vSend.SetVersion(0);\n         vRecv.SetType(SER_NETWORK);\n-        vRecv.SetVersion(0);\n-        // Version 0.2 obsoletes 20 Feb 2012\n-        if (GetTime() > 1329696000)\n-        {\n-            vSend.SetVersion(209);\n-            vRecv.SetVersion(209);\n-        }\n+        vSend.SetVersion(209);\n+        vRecv.SetVersion(209);\n         nLastSend = 0;\n         nLastRecv = 0;\n         nLastSendEmpty = GetTime();\n@@ -333,14 +327,11 @@ class CNode\n         memcpy((char*)&vSend[nHeaderStart] + offsetof(CMessageHeader, nMessageSize), &nSize, sizeof(nSize));\n \n         // Set the checksum\n-        if (vSend.GetVersion() >= 209)\n-        {\n-            uint256 hash = Hash(vSend.begin() + nMessageStart, vSend.end());\n-            unsigned int nChecksum = 0;\n-            memcpy(&nChecksum, &hash, sizeof(nChecksum));\n-            assert(nMessageStart - nHeaderStart >= offsetof(CMessageHeader, nChecksum) + sizeof(nChecksum));\n-            memcpy((char*)&vSend[nHeaderStart] + offsetof(CMessageHeader, nChecksum), &nChecksum, sizeof(nChecksum));\n-        }\n+        uint256 hash = Hash(vSend.begin() + nMessageStart, vSend.end());\n+        unsigned int nChecksum = 0;\n+        memcpy(&nChecksum, &hash, sizeof(nChecksum));\n+        assert(nMessageStart - nHeaderStart >= offsetof(CMessageHeader, nChecksum) + sizeof(nChecksum));\n+        memcpy((char*)&vSend[nHeaderStart] + offsetof(CMessageHeader, nChecksum), &nChecksum, sizeof(nChecksum));\n \n         if (fDebug) {\n             printf(\"(%d bytes)\\n\", nSize);"
      },
      {
        "sha": "b70dd71b82d91635a28c27d29ce9a4b2fdacfb41",
        "filename": "src/protocol.h",
        "status": "modified",
        "additions": 0,
        "deletions": 1,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/18c0fa97d0408a3ee8e4cb39c08156f7667f99ac/src/protocol.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/18c0fa97d0408a3ee8e4cb39c08156f7667f99ac/src/protocol.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/protocol.h?ref=18c0fa97d0408a3ee8e4cb39c08156f7667f99ac",
        "patch": "@@ -45,7 +45,6 @@ class CMessageHeader\n              READWRITE(FLATDATA(pchMessageStart));\n              READWRITE(FLATDATA(pchCommand));\n              READWRITE(nMessageSize);\n-             if (nVersion >= 209)\n              READWRITE(nChecksum);\n             )\n "
      }
    ]
  }
]