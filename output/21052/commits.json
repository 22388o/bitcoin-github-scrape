[
  {
    "sha": "1bca2aa694cd85984c09699ae28daec313077462",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxYmNhMmFhNjk0Y2Q4NTk4NGMwOTY5OWFlMjhkYWVjMzEzMDc3NDYy",
    "commit": {
      "author": {
        "name": "Kiminuo",
        "email": "kiminuo@protonmail.com",
        "date": "2021-02-01T12:35:28Z"
      },
      "committer": {
        "name": "Kiminuo",
        "email": "kiminuo@protonmail.com",
        "date": "2021-02-04T10:38:09Z"
      },
      "message": "Introduce GetUniquePath(base) helper method to replace boost::filesystem::unique_path() which is not available in std::filesystem.",
      "tree": {
        "sha": "dd3ea392cf4379cb03e1476736c5e968c759129e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/dd3ea392cf4379cb03e1476736c5e968c759129e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1bca2aa694cd85984c09699ae28daec313077462",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1bca2aa694cd85984c09699ae28daec313077462",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/1bca2aa694cd85984c09699ae28daec313077462",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1bca2aa694cd85984c09699ae28daec313077462/comments",
    "author": {
      "login": "kiminuo",
      "id": 58662979,
      "node_id": "MDQ6VXNlcjU4NjYyOTc5",
      "avatar_url": "https://avatars.githubusercontent.com/u/58662979?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kiminuo",
      "html_url": "https://github.com/kiminuo",
      "followers_url": "https://api.github.com/users/kiminuo/followers",
      "following_url": "https://api.github.com/users/kiminuo/following{/other_user}",
      "gists_url": "https://api.github.com/users/kiminuo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kiminuo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kiminuo/subscriptions",
      "organizations_url": "https://api.github.com/users/kiminuo/orgs",
      "repos_url": "https://api.github.com/users/kiminuo/repos",
      "events_url": "https://api.github.com/users/kiminuo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kiminuo/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "kiminuo",
      "id": 58662979,
      "node_id": "MDQ6VXNlcjU4NjYyOTc5",
      "avatar_url": "https://avatars.githubusercontent.com/u/58662979?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kiminuo",
      "html_url": "https://github.com/kiminuo",
      "followers_url": "https://api.github.com/users/kiminuo/followers",
      "following_url": "https://api.github.com/users/kiminuo/following{/other_user}",
      "gists_url": "https://api.github.com/users/kiminuo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kiminuo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kiminuo/subscriptions",
      "organizations_url": "https://api.github.com/users/kiminuo/orgs",
      "repos_url": "https://api.github.com/users/kiminuo/repos",
      "events_url": "https://api.github.com/users/kiminuo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kiminuo/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "ea5a50f92a6ff81b1d2dd67cdc3663e0e66733ac",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ea5a50f92a6ff81b1d2dd67cdc3663e0e66733ac",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/ea5a50f92a6ff81b1d2dd67cdc3663e0e66733ac"
      }
    ],
    "stats": {
      "total": 55,
      "additions": 52,
      "deletions": 3
    },
    "files": [
      {
        "sha": "20f131630200a807b3a7c3bf1061e8ca5e6982f5",
        "filename": "src/Makefile.am",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1bca2aa694cd85984c09699ae28daec313077462/src/Makefile.am",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1bca2aa694cd85984c09699ae28daec313077462/src/Makefile.am",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/Makefile.am?ref=1bca2aa694cd85984c09699ae28daec313077462",
        "patch": "@@ -233,6 +233,7 @@ BITCOIN_CORE_H = \\\n   util/check.h \\\n   util/error.h \\\n   util/fees.h \\\n+  util/getuniquepath.h \\\n   util/golombrice.h \\\n   util/hasher.h \\\n   util/macros.h \\\n@@ -556,6 +557,7 @@ libbitcoin_util_a_SOURCES = \\\n   util/bytevectorhash.cpp \\\n   util/error.cpp \\\n   util/fees.cpp \\\n+  util/getuniquepath.cpp \\\n   util/hasher.cpp \\\n   util/system.cpp \\\n   util/message.cpp \\"
      },
      {
        "sha": "e52cd5230c9b89049f24d44674f1bfe2e169cde8",
        "filename": "src/test/fs_tests.cpp",
        "status": "modified",
        "additions": 17,
        "deletions": 1,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1bca2aa694cd85984c09699ae28daec313077462/src/test/fs_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1bca2aa694cd85984c09699ae28daec313077462/src/test/fs_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fs_tests.cpp?ref=1bca2aa694cd85984c09699ae28daec313077462",
        "patch": "@@ -5,6 +5,7 @@\n #include <fs.h>\n #include <test/util/setup_common.h>\n #include <util/system.h>\n+#include <util/getuniquepath.h>\n \n #include <boost/test/unit_test.hpp>\n \n@@ -69,6 +70,21 @@ BOOST_AUTO_TEST_CASE(fsbridge_fstream)\n         BOOST_CHECK_EQUAL(tmpfile1, fsbridge::AbsPathJoin(tmpfile1, \"\"));\n         BOOST_CHECK_EQUAL(tmpfile1, fsbridge::AbsPathJoin(tmpfile1, {}));\n     }\n+    {\n+        fs::path p1 = GetUniquePath(tmpfolder);\n+        fs::path p2 = GetUniquePath(tmpfolder);\n+        fs::path p3 = GetUniquePath(tmpfolder);\n+\n+        // Ensure that the parent path is always the same.\n+        BOOST_CHECK_EQUAL(tmpfolder, p1.parent_path());\n+        BOOST_CHECK_EQUAL(tmpfolder, p2.parent_path());\n+        BOOST_CHECK_EQUAL(tmpfolder, p3.parent_path());\n+\n+        // Ensure that generated paths are actually different.\n+        BOOST_CHECK(p1 != p2);\n+        BOOST_CHECK(p2 != p3);\n+        BOOST_CHECK(p1 != p3);\n+    }\n }\n \n-BOOST_AUTO_TEST_SUITE_END()\n+BOOST_AUTO_TEST_SUITE_END()\n\\ No newline at end of file"
      },
      {
        "sha": "dccbf00d6fe4e034e645a772e080177325e84379",
        "filename": "src/test/util_tests.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1bca2aa694cd85984c09699ae28daec313077462/src/test/util_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1bca2aa694cd85984c09699ae28daec313077462/src/test/util_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/util_tests.cpp?ref=1bca2aa694cd85984c09699ae28daec313077462",
        "patch": "@@ -13,6 +13,7 @@\n #include <test/util/setup_common.h>\n #include <test/util/str.h>\n #include <uint256.h>\n+#include <util/getuniquepath.h>\n #include <util/message.h> // For MessageSign(), MessageVerify(), MESSAGE_MAGIC\n #include <util/moneystr.h>\n #include <util/spanparsing.h>\n@@ -1816,7 +1817,7 @@ BOOST_AUTO_TEST_CASE(test_DirIsWritable)\n     BOOST_CHECK_EQUAL(DirIsWritable(tmpdirname), true);\n \n     // Should not be able to write to a non-existent dir.\n-    tmpdirname = tmpdirname / fs::unique_path();\n+    tmpdirname = GetUniquePath(tmpdirname);\n     BOOST_CHECK_EQUAL(DirIsWritable(tmpdirname), false);\n \n     fs::create_directory(tmpdirname);"
      },
      {
        "sha": "9839d2f6246e57903af41c816fdf8926acbb6747",
        "filename": "src/util/getuniquepath.cpp",
        "status": "added",
        "additions": 10,
        "deletions": 0,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1bca2aa694cd85984c09699ae28daec313077462/src/util/getuniquepath.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1bca2aa694cd85984c09699ae28daec313077462/src/util/getuniquepath.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util/getuniquepath.cpp?ref=1bca2aa694cd85984c09699ae28daec313077462",
        "patch": "@@ -0,0 +1,10 @@\n+#include <random.h>\n+#include <fs.h>\n+#include <util/strencodings.h>\n+\n+fs::path GetUniquePath(const fs::path& base)\n+{\n+    FastRandomContext rnd;\n+    fs::path tmpFile = base / HexStr(rnd.randbytes(8));\n+    return tmpFile;\n+}\n\\ No newline at end of file"
      },
      {
        "sha": "e0c6147876b6d880bea36ebe7ea4613d34aebb60",
        "filename": "src/util/getuniquepath.h",
        "status": "added",
        "additions": 19,
        "deletions": 0,
        "changes": 19,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1bca2aa694cd85984c09699ae28daec313077462/src/util/getuniquepath.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1bca2aa694cd85984c09699ae28daec313077462/src/util/getuniquepath.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util/getuniquepath.h?ref=1bca2aa694cd85984c09699ae28daec313077462",
        "patch": "@@ -0,0 +1,19 @@\n+// Copyright (c) 2021 The Bitcoin Core developers\n+// Distributed under the MIT software license, see the accompanying\n+// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+#ifndef BITCOIN_UTIL_GETUNIQUEPATH_H\n+#define BITCOIN_UTIL_GETUNIQUEPATH_H\n+\n+#include <fs.h>\n+\n+/**\n+ * Helper function for getting a unique path\n+ *\n+ * @param[in] base  Base path\n+ * @returns base joined with a random 8-character long string.\n+ * @post Returned path is unique with high probability.\n+ */\n+fs::path GetUniquePath(const fs::path& base);\n+\n+#endif // BITCOIN_UTIL_GETUNIQUEPATH_H\n\\ No newline at end of file"
      },
      {
        "sha": "9a2e719bbc80dc78f9bc6b8751c51d8f9d14bd61",
        "filename": "src/util/system.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1bca2aa694cd85984c09699ae28daec313077462/src/util/system.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1bca2aa694cd85984c09699ae28daec313077462/src/util/system.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util/system.cpp?ref=1bca2aa694cd85984c09699ae28daec313077462",
        "patch": "@@ -12,6 +12,7 @@\n #include <chainparamsbase.h>\n #include <sync.h>\n #include <util/check.h>\n+#include <util/getuniquepath.h>\n #include <util/strencodings.h>\n #include <util/string.h>\n #include <util/translation.h>\n@@ -124,7 +125,7 @@ void ReleaseDirectoryLocks()\n \n bool DirIsWritable(const fs::path& directory)\n {\n-    fs::path tmpFile = directory / fs::unique_path();\n+    fs::path tmpFile = GetUniquePath(directory);\n \n     FILE* file = fsbridge::fopen(tmpFile, \"a\");\n     if (!file) return false;"
      }
    ]
  }
]