[
  {
    "sha": "84912d4b24382ae022da3a863bd6caa2b8948d94",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4NDkxMmQ0YjI0MzgyYWUwMjJkYTNhODYzYmQ2Y2FhMmI4OTQ4ZDk0",
    "commit": {
      "author": {
        "name": "Carl Dong",
        "email": "contact@carldong.me",
        "date": "2021-02-25T23:16:07Z"
      },
      "committer": {
        "name": "Carl Dong",
        "email": "contact@carldong.me",
        "date": "2021-04-05T23:13:54Z"
      },
      "message": "build: Remove spaces from variable-printing rules\n\nThis simplifies parsing when using these rules from scripts.",
      "tree": {
        "sha": "7481d26c4913e6809aea6698bbc7164cc70699e6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7481d26c4913e6809aea6698bbc7164cc70699e6"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/84912d4b24382ae022da3a863bd6caa2b8948d94",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/84912d4b24382ae022da3a863bd6caa2b8948d94",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/84912d4b24382ae022da3a863bd6caa2b8948d94",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/84912d4b24382ae022da3a863bd6caa2b8948d94/comments",
    "author": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "0102f80b511307fe5b6d107e6c133b71940838ce",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0102f80b511307fe5b6d107e6c133b71940838ce",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/0102f80b511307fe5b6d107e6c133b71940838ce"
      }
    ],
    "stats": {
      "total": 8,
      "additions": 4,
      "deletions": 4
    },
    "files": [
      {
        "sha": "5e453b9ae1995343b48635cf88337c549875a656",
        "filename": "Makefile.am",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/84912d4b24382ae022da3a863bd6caa2b8948d94/Makefile.am",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/84912d4b24382ae022da3a863bd6caa2b8948d94/Makefile.am",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/Makefile.am?ref=84912d4b24382ae022da3a863bd6caa2b8948d94",
        "patch": "@@ -4,7 +4,7 @@\n \n # Pattern rule to print variables, e.g. make print-top_srcdir\n print-%:\n-\t@echo '$*' = '$($*)'\n+\t@echo '$*'='$($*)'\n \n ACLOCAL_AMFLAGS = -I build-aux/m4\n SUBDIRS = src"
      },
      {
        "sha": "818ea7c8efbe506814805be7db9e9727d0b80531",
        "filename": "contrib/guix/guix-build",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/84912d4b24382ae022da3a863bd6caa2b8948d94/contrib/guix/guix-build",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/84912d4b24382ae022da3a863bd6caa2b8948d94/contrib/guix/guix-build",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/guix/guix-build?ref=84912d4b24382ae022da3a863bd6caa2b8948d94",
        "patch": "@@ -119,7 +119,7 @@ fi\n for host in $HOSTS; do\n     case \"$host\" in\n         *darwin*)\n-            OSX_SDK=\"$(make -C \"${PWD}/depends\" --no-print-directory HOST=\"$host\" print-OSX_SDK | sed 's@^[^=]\\+=[[:space:]]\\+@@g')\"\n+            OSX_SDK=\"$(make -C \"${PWD}/depends\" --no-print-directory HOST=\"$host\" print-OSX_SDK | sed 's@^[^=]\\+=@@g')\"\n             if [ -e \"$OSX_SDK\" ]; then\n                 echo \"Found macOS SDK at '${OSX_SDK}', using...\"\n             else"
      },
      {
        "sha": "c5dfd1e8a72824094930fc384f494fcf5226ba3a",
        "filename": "depends/Makefile",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/84912d4b24382ae022da3a863bd6caa2b8948d94/depends/Makefile",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/84912d4b24382ae022da3a863bd6caa2b8948d94/depends/Makefile",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/Makefile?ref=84912d4b24382ae022da3a863bd6caa2b8948d94",
        "patch": "@@ -2,7 +2,7 @@\n \n # Pattern rule to print variables, e.g. make print-top_srcdir\n print-%:\n-\t@echo '$*' = '$($*)'\n+\t@echo '$*'='$($*)'\n \n # When invoking a sub-make, keep only the command line variable definitions\n # matching the pattern in the filter function."
      },
      {
        "sha": "b47bdfaa2695721c5ce47805d8125209eb7f3ee7",
        "filename": "src/Makefile.am",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/84912d4b24382ae022da3a863bd6caa2b8948d94/src/Makefile.am",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/84912d4b24382ae022da3a863bd6caa2b8948d94/src/Makefile.am",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/Makefile.am?ref=84912d4b24382ae022da3a863bd6caa2b8948d94",
        "patch": "@@ -4,7 +4,7 @@\n \n # Pattern rule to print variables, e.g. make print-top_srcdir\n print-%:\n-\t@echo '$*' = '$($*)'\n+\t@echo '$*'='$($*)'\n \n DIST_SUBDIRS = secp256k1 univalue\n "
      }
    ]
  },
  {
    "sha": "44f6d4f56b16e1dc5e8a23318b8e7aad0665f178",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0NGY2ZDRmNTZiMTZlMWRjNWU4YTIzMzE4YjhlN2FhZDA2NjVmMTc4",
    "commit": {
      "author": {
        "name": "Carl Dong",
        "email": "contact@carldong.me",
        "date": "2021-02-26T22:42:02Z"
      },
      "committer": {
        "name": "Carl Dong",
        "email": "contact@carldong.me",
        "date": "2021-04-05T23:13:54Z"
      },
      "message": "guix: Record precious directories and add guix-clean\n\nMany users have reported problems that stem from having an unclean\nworking tree. To that end, I've written a guix-clean script which should\nhelp reset the working tree while respecting user-specified precious\ndirectories.\n\nPrecious directories, such as:\n\n- SOURCES_PATH\n- BASE_CACHE\n- SDK_PATH\n- OUTDIR\n\nShould be preserved when cleaning the working tree, and are thus\nrecorded in ./contrib/guix/var/precious_dirs.\n\nThe ./contrib/guix/guix-clean script is able to parse that file and make\nsure to avoid them when cleaning out the working tree.",
      "tree": {
        "sha": "3f614a858548563330f9fd1a3c3ee60cb7c2c87d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3f614a858548563330f9fd1a3c3ee60cb7c2c87d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/44f6d4f56b16e1dc5e8a23318b8e7aad0665f178",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/44f6d4f56b16e1dc5e8a23318b8e7aad0665f178",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/44f6d4f56b16e1dc5e8a23318b8e7aad0665f178",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/44f6d4f56b16e1dc5e8a23318b8e7aad0665f178/comments",
    "author": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "84912d4b24382ae022da3a863bd6caa2b8948d94",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/84912d4b24382ae022da3a863bd6caa2b8948d94",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/84912d4b24382ae022da3a863bd6caa2b8948d94"
      }
    ],
    "stats": {
      "total": 158,
      "additions": 146,
      "deletions": 12
    },
    "files": [
      {
        "sha": "619924d29efea067594b9e7012627a1267358438",
        "filename": "contrib/guix/guix-build",
        "status": "modified",
        "additions": 60,
        "deletions": 12,
        "changes": 72,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/44f6d4f56b16e1dc5e8a23318b8e7aad0665f178/contrib/guix/guix-build",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/44f6d4f56b16e1dc5e8a23318b8e7aad0665f178/contrib/guix/guix-build",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/guix/guix-build?ref=44f6d4f56b16e1dc5e8a23318b8e7aad0665f178",
        "patch": "@@ -178,12 +178,6 @@ host_to_commonname() {\n     esac\n }\n \n-# Download the depends sources now as we won't have internet access in the build\n-# container\n-for host in $HOSTS; do\n-    make -C \"${PWD}/depends\" -j\"$JOBS\" download-\"$(host_to_commonname \"$host\")\" ${V:+V=1} ${SOURCES_PATH:+SOURCES_PATH=\"$SOURCES_PATH\"}\n-done\n-\n # Determine the reference time used for determinism (overridable by environment)\n SOURCE_DATE_EPOCH=\"${SOURCE_DATE_EPOCH:-$(git log --format=%at -1)}\"\n \n@@ -201,10 +195,70 @@ time-machine() {\n                       -- \"$@\"\n }\n \n+\n+# Precious directories are those which should not be cleaned between successive\n+# guix builds\n+depends_precious_dir_names='SOURCES_PATH BASE_CACHE SDK_PATH'\n+precious_dir_names=\"${depends_precious_dir_names} OUTDIR_BASE\"\n+\n+# Usage: contains IFS-SEPARATED-LIST ITEM\n+contains() {\n+    for i in ${1}; do\n+        if [ \"$i\" = \"${2}\" ]; then\n+            return 0  # Found!\n+        fi\n+    done\n+    return 1\n+}\n+\n+# If the user explicitly specified a precious directory, create it so we\n+# can map it into the container\n+for precious_dir_name in $precious_dir_names; do\n+    precious_dir_path=\"${!precious_dir_name}\"\n+    if [ -n \"$precious_dir_path\" ]; then\n+        if [ ! -e \"$precious_dir_path\" ]; then\n+            mkdir -p \"$precious_dir_path\"\n+        elif [ -L \"$precious_dir_path\" ]; then\n+            echo \"ERR: ${precious_dir_name} cannot be a symbolic link\"\n+            exit 1\n+        elif [ ! -d \"$precious_dir_path\" ]; then\n+            echo \"ERR: ${precious_dir_name} must be a directory\"\n+            exit 1\n+        fi\n+    fi\n+done\n+\n+mkdir -p \"$VAR_BASE\"\n+\n+# Record the _effective_ values of precious directories such that guix-clean can\n+# avoid clobbering them if appropriate.\n+#\n+# shellcheck disable=SC2046,SC2086\n+{\n+    # Get depends precious dir definitions from depends\n+    make -C \"${PWD}/depends\" \\\n+         --no-print-directory \\\n+         -- $(printf \"print-%s\\n\" $depends_precious_dir_names)\n+\n+    # Get remaining precious dir definitions from the environment\n+    for precious_dir_name in $precious_dir_names; do\n+        precious_dir_path=\"${!precious_dir_name}\"\n+        if ! contains \"$depends_precious_dir_names\" \"$precious_dir_name\"; then\n+            echo \"${precious_dir_name}=${precious_dir_path}\"\n+        fi\n+    done\n+} > \"${VAR_BASE}/precious_dirs\"\n+\n # Make sure an output directory exists for our builds\n OUTDIR_BASE=\"${OUTDIR_BASE:-${VERSION_BASE}/output}\"\n mkdir -p \"$OUTDIR_BASE\"\n \n+# Download the depends sources now as we won't have internet access in the build\n+# container\n+for host in $HOSTS; do\n+    make -C \"${PWD}/depends\" -j\"$JOBS\" download-\"$(host_to_commonname \"$host\")\" ${V:+V=1} ${SOURCES_PATH:+SOURCES_PATH=\"$SOURCES_PATH\"}\n+done\n+\n # Usage: outdir_for_host HOST\n #\n #   HOST: The current platform triple we're building for\n@@ -235,12 +289,6 @@ and untracked files and directories will be wiped, allowing you to start anew.\n EOF\n }\n \n-# Create SOURCES_PATH, BASE_CACHE, and SDK_PATH if they are non-empty so that we\n-# can map them into the container\n-[ -z \"$SOURCES_PATH\" ] || mkdir -p \"$SOURCES_PATH\"\n-[ -z \"$BASE_CACHE\" ]   || mkdir -p \"$BASE_CACHE\"\n-[ -z \"$SDK_PATH\" ]     || mkdir -p \"$SDK_PATH\"\n-\n # Deterministically build Bitcoin Core\n # shellcheck disable=SC2153\n for host in $HOSTS; do"
      },
      {
        "sha": "9fa17191e80888902f52b30dcca16fd37adbf0cd",
        "filename": "contrib/guix/guix-clean",
        "status": "added",
        "additions": 83,
        "deletions": 0,
        "changes": 83,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/44f6d4f56b16e1dc5e8a23318b8e7aad0665f178/contrib/guix/guix-clean",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/44f6d4f56b16e1dc5e8a23318b8e7aad0665f178/contrib/guix/guix-clean",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/guix/guix-clean?ref=44f6d4f56b16e1dc5e8a23318b8e7aad0665f178",
        "patch": "@@ -0,0 +1,83 @@\n+#!/usr/bin/env bash\n+export LC_ALL=C\n+set -e -o pipefail\n+\n+# Source the common prelude, which:\n+#   1. Checks if we're at the top directory of the Bitcoin Core repository\n+#   2. Defines a few common functions and variables\n+#\n+# shellcheck source=libexec/prelude.bash\n+source \"$(dirname \"${BASH_SOURCE[0]}\")/libexec/prelude.bash\"\n+\n+\n+###################\n+## Sanity Checks ##\n+###################\n+\n+################\n+# Required non-builtin commands should be invokable\n+################\n+\n+check_tools cat mkdir make git guix\n+\n+\n+#############\n+##  Clean  ##\n+#############\n+\n+# Usage: under_dir MAYBE_PARENT MAYBE_CHILD\n+#\n+# If MAYBE_CHILD is a subdirectory of MAYBE_PARENT, print the relative path\n+# from MAYBE_PARENT to MAYBE_CHILD. Otherwise, return 1 as the error code.\n+#\n+# NOTE: This does not perform any symlink-resolving or path canonicalization.\n+#\n+under_dir() {\n+    local path_residue\n+    path_residue=\"${2##${1}}\"\n+    if [ -z \"$path_residue\" ] || [ \"$path_residue\" = \"$2\" ]; then\n+        return 1\n+    else\n+        echo \"$path_residue\"\n+    fi\n+}\n+\n+# Usage: dir_under_git_root MAYBE_CHILD\n+#\n+# If MAYBE_CHILD is under the current git repository and exists, print the\n+# relative path from the git repository's top-level directory to MAYBE_CHILD,\n+# otherwise, exit with an error code.\n+#\n+dir_under_git_root() {\n+    local rv\n+    rv=\"$(under_dir \"$(git_root)\" \"$1\")\"\n+    [ -n \"$rv\" ] && echo \"$rv\"\n+}\n+\n+shopt -s nullglob\n+found_precious_dirs_files=( \"${version_base_prefix}\"*/\"${var_base_basename}/precious_dirs\" ) # This expands to an array of directories...\n+shopt -u nullglob\n+\n+exclude_flags=()\n+\n+for precious_dirs_file in \"${found_precious_dirs_files[@]}\"; do\n+    # Make sure the precious directories (e.g. SOURCES_PATH, BASE_CACHE, SDK_PATH)\n+    # are excluded from git-clean\n+    echo \"Found precious_dirs file: '${precious_dirs_file}'\"\n+\n+    # Exclude the precious_dirs file itself\n+    if dirs_file_exclude_fragment=$(dir_under_git_root \"$(dirname \"$precious_dirs_file\")\"); then\n+        exclude_flags+=( --exclude=\"${dirs_file_exclude_fragment}/precious_dirs\" )\n+    fi\n+\n+    # Read each 'name=dir' pair from the precious_dirs file\n+    while IFS='=' read -r name dir; do\n+        # Add an exclusion flag if the precious directory is under the git root.\n+        if under=$(dir_under_git_root \"$dir\"); then\n+            echo \"Avoiding ${name}: ${under}\"\n+            exclude_flags+=( --exclude=\"$under\" )\n+        fi\n+    done < \"$precious_dirs_file\"\n+done\n+\n+git clean -xdff \"${exclude_flags[@]}\""
      },
      {
        "sha": "e6d3a5b7225da79f0823e04d359b03ad686b28e9",
        "filename": "contrib/guix/libexec/prelude.bash",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/44f6d4f56b16e1dc5e8a23318b8e7aad0665f178/contrib/guix/libexec/prelude.bash",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/44f6d4f56b16e1dc5e8a23318b8e7aad0665f178/contrib/guix/libexec/prelude.bash",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/guix/libexec/prelude.bash?ref=44f6d4f56b16e1dc5e8a23318b8e7aad0665f178",
        "patch": "@@ -58,3 +58,6 @@ VERSION_BASE=\"${version_base_prefix}${VERSION}\"  # TOP\n DISTSRC_BASE=\"${DISTSRC_BASE:-${VERSION_BASE}}\"\n \n OUTDIR_BASE=\"${OUTDIR_BASE:-${VERSION_BASE}/output}\"\n+\n+var_base_basename=\"var\"\n+VAR_BASE=\"${VAR_BASE:-${VERSION_BASE}/${var_base_basename}}\""
      }
    ]
  },
  {
    "sha": "8f8b96fb542701b7717683caa3848390b24f77ab",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4ZjhiOTZmYjU0MjcwMWI3NzE3NjgzY2FhMzg0ODM5MGIyNGY3N2Fi",
    "commit": {
      "author": {
        "name": "Carl Dong",
        "email": "contact@carldong.me",
        "date": "2021-03-02T22:26:56Z"
      },
      "committer": {
        "name": "Carl Dong",
        "email": "contact@carldong.me",
        "date": "2021-04-07T19:20:25Z"
      },
      "message": "guix: Update hint messages to mention guix-clean",
      "tree": {
        "sha": "768f6d351f858ca200b3ece8bccd7022f60bdcbe",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/768f6d351f858ca200b3ece8bccd7022f60bdcbe"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8f8b96fb542701b7717683caa3848390b24f77ab",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8f8b96fb542701b7717683caa3848390b24f77ab",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/8f8b96fb542701b7717683caa3848390b24f77ab",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8f8b96fb542701b7717683caa3848390b24f77ab/comments",
    "author": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "44f6d4f56b16e1dc5e8a23318b8e7aad0665f178",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/44f6d4f56b16e1dc5e8a23318b8e7aad0665f178",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/44f6d4f56b16e1dc5e8a23318b8e7aad0665f178"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 13,
      "deletions": 4
    },
    "files": [
      {
        "sha": "a0eef59ac1d0d7b6fd18ae8090bc62ba7c40610f",
        "filename": "contrib/guix/guix-build",
        "status": "modified",
        "additions": 13,
        "deletions": 4,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8f8b96fb542701b7717683caa3848390b24f77ab/contrib/guix/guix-build",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8f8b96fb542701b7717683caa3848390b24f77ab/contrib/guix/guix-build",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/guix/guix-build?ref=8f8b96fb542701b7717683caa3848390b24f77ab",
        "patch": "@@ -103,6 +103,14 @@ ERR: Build directories for this commit already exist for the following platform\n \n      Aborting...\n \n+Hint: To blow everything away, you may want to use:\n+\n+  $ ./contrib/guix/guix-clean\n+\n+Specifically, this will remove all files without an entry in the index,\n+excluding the SDK directory, the depends download cache, the depends built\n+packages cache, the garbage collector roots for Guix environments, and the\n+output directory.\n EOF\n for host in $hosts_distsrc_exists; do\n     echo \"     ${host} '$(distsrc_for_host \"$host\")'\"\n@@ -277,15 +285,16 @@ outdir_for_host() {\n int_trap() {\n cat << EOF\n ** INT received while building ${1}, you may want to clean up the relevant\n-   output, deploy, and distsrc-* directories before rebuilding\n+   work directories (e.g. distsrc-*) before rebuilding\n \n Hint: To blow everything away, you may want to use:\n \n-  $ git clean -xdff --exclude='/depends/SDKs/*'\n+  $ ./contrib/guix/guix-clean\n \n Specifically, this will remove all files without an entry in the index,\n-excluding the SDK directory. Practically speaking, this means that all ignored\n-and untracked files and directories will be wiped, allowing you to start anew.\n+excluding the SDK directory, the depends download cache, the depends built\n+packages cache, the garbage collector roots for Guix environments, and the\n+output directory.\n EOF\n }\n "
      }
    ]
  },
  {
    "sha": "867a5e172a23899a4a70eca4a396c64f1951745e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4NjdhNWUxNzJhMjM4OTlhNGE3MGVjYTRhMzk2YzY0ZjE5NTE3NDVl",
    "commit": {
      "author": {
        "name": "Carl Dong",
        "email": "contact@carldong.me",
        "date": "2021-03-17T17:13:10Z"
      },
      "committer": {
        "name": "Carl Dong",
        "email": "contact@carldong.me",
        "date": "2021-04-07T19:21:00Z"
      },
      "message": "guix: Register garbage collector root for containers\n\nBy registering the container profiles as garbage collector roots, it\nwill prevent `guix gc` from garbage collecting derivations which our\ncontainer needs and inconvieniencing the user with a rebuild.",
      "tree": {
        "sha": "9a6552df66a9207ace04cacb6f9b4f104f417bde",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9a6552df66a9207ace04cacb6f9b4f104f417bde"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/867a5e172a23899a4a70eca4a396c64f1951745e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/867a5e172a23899a4a70eca4a396c64f1951745e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/867a5e172a23899a4a70eca4a396c64f1951745e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/867a5e172a23899a4a70eca4a396c64f1951745e/comments",
    "author": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "dongcarl",
      "id": 3445290,
      "node_id": "MDQ6VXNlcjM0NDUyOTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3445290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dongcarl",
      "html_url": "https://github.com/dongcarl",
      "followers_url": "https://api.github.com/users/dongcarl/followers",
      "following_url": "https://api.github.com/users/dongcarl/following{/other_user}",
      "gists_url": "https://api.github.com/users/dongcarl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dongcarl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dongcarl/subscriptions",
      "organizations_url": "https://api.github.com/users/dongcarl/orgs",
      "repos_url": "https://api.github.com/users/dongcarl/repos",
      "events_url": "https://api.github.com/users/dongcarl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dongcarl/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "8f8b96fb542701b7717683caa3848390b24f77ab",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8f8b96fb542701b7717683caa3848390b24f77ab",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/8f8b96fb542701b7717683caa3848390b24f77ab"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 13,
      "deletions": 1
    },
    "files": [
      {
        "sha": "56c3398c97b1df56f1737482ecf3d8c71fdf495b",
        "filename": "contrib/guix/guix-build",
        "status": "modified",
        "additions": 10,
        "deletions": 1,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/867a5e172a23899a4a70eca4a396c64f1951745e/contrib/guix/guix-build",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/867a5e172a23899a4a70eca4a396c64f1951745e/contrib/guix/guix-build",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/guix/guix-build?ref=867a5e172a23899a4a70eca4a396c64f1951745e",
        "patch": "@@ -207,7 +207,7 @@ time-machine() {\n # Precious directories are those which should not be cleaned between successive\n # guix builds\n depends_precious_dir_names='SOURCES_PATH BASE_CACHE SDK_PATH'\n-precious_dir_names=\"${depends_precious_dir_names} OUTDIR_BASE\"\n+precious_dir_names=\"${depends_precious_dir_names} OUTDIR_BASE PROFILES_BASE\"\n \n # Usage: contains IFS-SEPARATED-LIST ITEM\n contains() {\n@@ -275,6 +275,14 @@ outdir_for_host() {\n     echo \"${OUTDIR_BASE}/${1}\"\n }\n \n+# Usage: profiledir_for_host HOST COMMAND\n+#\n+#   HOST: The current platform triple we're building for\n+#\n+profiledir_for_host() {\n+    echo \"${PROFILES_BASE}/${2}-${1}\"\n+}\n+\n \n #########\n # BUILD #\n@@ -404,6 +412,7 @@ EOF\n                                  --keep-failed \\\n                                  --fallback \\\n                                  --link-profile \\\n+                                 --root=\"$(profiledir_for_host \"${HOST}\" build)\" \\\n                                  ${SUBSTITUTE_URLS:+--substitute-urls=\"$SUBSTITUTE_URLS\"} \\\n                                  ${ADDITIONAL_GUIX_COMMON_FLAGS} ${ADDITIONAL_GUIX_ENVIRONMENT_FLAGS} \\\n                                  -- env HOST=\"$host\" \\"
      },
      {
        "sha": "971aebf2b0ddc3ef107572cadf14267421d8856e",
        "filename": "contrib/guix/libexec/prelude.bash",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/867a5e172a23899a4a70eca4a396c64f1951745e/contrib/guix/libexec/prelude.bash",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/867a5e172a23899a4a70eca4a396c64f1951745e/contrib/guix/libexec/prelude.bash",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/guix/libexec/prelude.bash?ref=867a5e172a23899a4a70eca4a396c64f1951745e",
        "patch": "@@ -61,3 +61,6 @@ OUTDIR_BASE=\"${OUTDIR_BASE:-${VERSION_BASE}/output}\"\n \n var_base_basename=\"var\"\n VAR_BASE=\"${VAR_BASE:-${VERSION_BASE}/${var_base_basename}}\"\n+\n+profiles_base_basename=\"profiles\"\n+PROFILES_BASE=\"${PROFILES_BASE:-${VAR_BASE}/${profiles_base_basename}}\""
      }
    ]
  }
]