jgarzik,2015-09-15T23:27:52Z,I like the feature - concept ACK\n\nTrying to think through whether there are edge cases that persuade us to default this 'off'  Leaning towards default-on as presented.\n,https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-140579848,140579848,
dcousens,2015-09-16T07:09:51Z,concept ACK\n,https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-140650996,140650996,
btcdrak,2015-09-23T19:55:12Z,concept ACK\n,https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-142710743,142710743,
sipa,2015-09-26T00:07:35Z,"2015-09-26 00:03:11 [tor] Using COOKIE authentication, reading cookie authentication from /var/run/tor/control.authcookie\n2015-09-26 00:03:11 [tor] Authentication cookie not found, is inaccessible, or is not exactly 64 bytes\n\nI have ControlPort 9051 and CookieAuthentication in torrc.\n",https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-143380439,143380439,
pstratem,2015-09-26T00:23:25Z,"Check the permissions\nOn Sep 25, 2015 5:07 PM, ""Pieter Wuille"" notifications@github.com wrote:\n\n> 2015-09-26 00:03:11 [tor] Using COOKIE authentication, reading cookie\n> authentication from /var/run/tor/control.authcookie\n> 2015-09-26 00:03:11 [tor] Authentication cookie not found, is\n> inaccessible, or is not exactly 64 bytes\n> \n> I have ControlPort 9051 and CookieAuthentication in torrc.",https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-143382128,143382128,
laanwj,2015-10-02T12:25:51Z,"@sipa the check was broken, the cookie is 32 bytes not 64. That said, we should have a more specific error message.\n",https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-145002257,145002257,
theuni,2015-10-02T15:54:15Z,Can the shutdown detection be changed to work like the httpserver? ie Init calls InterruptTorControl() which starts the immediate shutdown process?\n,https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-145069722,145069722,
theuni,2015-10-02T16:43:00Z,(Not for this PR) Looks like it'd be pretty simple to add support for connecting via Unix socket (/var/run/tor/control) as well.\n,https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-145082851,145082851,
theuni,2015-10-02T16:45:20Z,Concept ACK. This looks like a great feature.\n,https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-145083330,145083330,
laanwj,2015-10-03T09:57:45Z,"@cfields \n\n> Can the shutdown detection be changed to work like the httpserver? ie Init calls InterruptTorControl() which starts the immediate shutdown process?\n\nYes, that sounds better. I have not done this before because it means making the libevent instance thread-safe - `Interrupt` happens from a different thread. But as we need multi-threaded libevent anyway from the http server that's a ",https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-145233066,145233066,
laanwj,2015-10-03T15:26:49Z,"Ok: addressed all of @theuni's comments (apart from the UNIX socket, which we can add later).\nStill have SAFECOOKIE auth support on my TODO list above, it is superior to COOKIE (no potential exposure of data), and COOKIE will eventually be deprecated.\nThis does require use of HMAC-SHA256. Luckily we have an implementation of that for BIP32, so I think it's doable.\n\nEdit: done\n",https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-145256375,145256375,
laanwj,2015-11-10T17:07:17Z,Also mentioned in release notes now.\n,https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-155489121,155489121,
petertodd,2015-11-10T20:30:07Z,ACK\n\nTests done:\n- [x] Restart reuses cached onion private key\n- [X] SAFECOOKIE auth\n- [X] HASHEDPASSWORD auth\n- [X] Onion advertisement stops with tor disconnects\n- [X] Onion advertisement starts when tor restarted\n,https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-155556503,155556503,
sipa,2015-11-11T07:53:58Z,"No code review, did a weak test (it correctly reports my Tor version is too old).\n",https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-155696989,155696989,
MarcoFalke,2015-11-11T12:50:08Z,That's great! I will try to look into this soon.\n,https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-155769558,155769558,
petertodd,2015-11-11T18:06:15Z,utACK squashme commits\n,https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-155863540,155863540,
MarcoFalke,2015-11-11T22:57:24Z,"Somehow I can set up a `-onlynet=onion` node and connect to it (sometimes) but it never established outgoing connections:\n\n```\n2015-11-11 22:05:45 tor: ADD_ONION succesful\n2015-11-11 22:05:45 tor: Got service ID moheur3skn7jbca4, advertizing service moheur3skn7jbca4.onion:18333\n2015-11-11 22:05:45 tor: Cached service private key to /home/test/.bitcoin/testnet3/onion_private_key\n2015-11-11 22",https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-155936122,155936122,
gits7r,2015-11-11T23:56:48Z,"you are mistaking. it's -onlynet=tor . you confuse onion with -onion=127.0.0.1:9050 where you instruct bitcoin to use that socks5 proxy to connect to onion peers (from tor network). While -onlynet=tor will make sure you connect only to onion (Tor) peers, -onion=xxx will only provide a gateway for these peers but connect to other kind of peers also.\n",https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-155948382,155948382,
MarcoFalke,2015-11-12T07:15:34Z,"Then, why does `-?` doesn't even mention `tor`?\n\n```\n  -onlynet=<net>\n       Only connect to nodes in network <net> (ipv4, ipv6 or onion)\n```\n",https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-156021014,156021014,
laanwj,2015-11-12T07:29:50Z,onlynet=onion should work. But is unrelated to this pull. Did you pass a proxy?\n,https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-156024269,156024269,
MarcoFalke,2015-11-12T07:48:03Z,I tried with and without proxy:\n`bitcoin/src/bitcoind  -debug=tor  -onlynet=onion -proxy=127.0.0.1:9050 -listen=1 -torpassword=bar`\n\nBut maybe my VPS provider is blocking tor...\n,https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-156027194,156027194,
laanwj,2015-11-12T07:54:01Z,"They could, but that whouldn't result in  errors like\n\n```\n2015-11-11 22:05:46 Cannot connect to t6xj6wilh4ytvcs7.onion:18333: unsupported network\n```\n\nInstead you'd get proxy errors. It's not using the proxy, why is that (again, this is seemingly unrleated to this pull, maybe file a new issue)\n",https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-156027940,156027940,
MarcoFalke,2015-11-12T18:37:06Z,tested ACK 58ef0ff\n,https://github.com/bitcoin/bitcoin/pull/6639#issuecomment-156195962,156195962,
theuni,2015-10-02T15:24:04Z,false case needs fclose too\n,https://github.com/bitcoin/bitcoin/pull/6639#discussion_r41033302,41033302,src/torcontrol.cpp
theuni,2015-10-02T16:26:06Z,Need to undo the AddLocal here?\n,https://github.com/bitcoin/bitcoin/pull/6639#discussion_r41039837,41039837,src/torcontrol.cpp
theuni,2015-10-02T16:37:59Z,"Don't we want logic to retry this every n seconds if it fails? If I launch Bitcoin and Tor a minute later, I would expect that it would be detected and used after a few minutes.\n",https://github.com/bitcoin/bitcoin/pull/6639#discussion_r41040909,41040909,src/torcontrol.cpp
laanwj,2015-10-02T16:48:14Z,"That's what `RECONNECT_TIMEOUT_START` / `RECONNECT_TIMEOUT_EXP` is supposed to do. When I last checked, it was working.\n",https://github.com/bitcoin/bitcoin/pull/6639#discussion_r41041888,41041888,src/torcontrol.cpp
laanwj,2015-10-02T16:50:45Z,oops good catch\n,https://github.com/bitcoin/bitcoin/pull/6639#discussion_r41042111,41042111,src/torcontrol.cpp
theuni,2015-10-02T17:04:21Z,"It looks like that only works on disconnection, though. If the first attempt fails on socket connection and the callbacks never start, I don't see how the reconnect logic kicks in. Am I misreading?\n",https://github.com/bitcoin/bitcoin/pull/6639#discussion_r41043270,41043270,src/torcontrol.cpp
theuni,2015-10-02T17:28:29Z,"Nevermind, I misremembered this function's return meaning. I thought it was possible to get an immediate failure in some cases, but a quick test shows that's not the case.\n",https://github.com/bitcoin/bitcoin/pull/6639#discussion_r41045722,41045722,src/torcontrol.cpp
MarcoFalke,2015-11-11T22:41:44Z,"~~Nit: ""Wrote service key...""?~~\n",https://github.com/bitcoin/bitcoin/pull/6639#discussion_r44597922,44597922,src/torcontrol.cpp
MarcoFalke,2015-11-11T22:54:29Z,"Also, mind to pass this file through\n\n`contrib/devtools/clang-format.py clang-format src/torcontrol.cpp`?\n",https://github.com/bitcoin/bitcoin/pull/6639#discussion_r44599329,44599329,src/torcontrol.cpp
MarcoFalke,2015-11-12T10:25:36Z,Nit: Please update https://github.com/bitcoin/bitcoin/blob/master/doc/files.md\n,https://github.com/bitcoin/bitcoin/pull/6639#discussion_r44641275,44641275,src/torcontrol.cpp
