[
  {
    "sha": "3a68546fd0981e032005d3a5d2ca7b2ab9acc70b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozYTY4NTQ2ZmQwOTgxZTAzMjAwNWQzYTVkMmNhN2IyYWI5YWNjNzBi",
    "commit": {
      "author": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-09-05T23:48:36Z"
      },
      "committer": {
        "name": "Hennadii Stepanov",
        "email": "32963518+hebasto@users.noreply.github.com",
        "date": "2021-09-07T13:49:35Z"
      },
      "message": "ci: Build and cache static Qt instead of downloading a pre-built one",
      "tree": {
        "sha": "87855777a3f417ef1dec44354b4340a455085903",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/87855777a3f417ef1dec44354b4340a455085903"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3a68546fd0981e032005d3a5d2ca7b2ab9acc70b",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEE0dvyxLlvLev0wWZUQQEIES5+qB8FAmE3be8ACgkQQQEIES5+\nqB8dBw/+LA9ApUtm2L+J6biGFDwfuVZFP6QbGOobY9eVNTFOb7lKRURmfDcGiYUS\nQpApdo4hO1VNjRfFDa41fEP12UPilkUp8UdLLWqFP4SYsvgHnAUqkkARo6hNTMWT\n0LmY8iifAkxPxt7l7/h+Fi6rkcnE9aNlDHQFhQ6kunp20nlm43AVXiFvoe4gWC+u\nnzvYDh4ZVVmRG6Yo7Kmhpof+FWP8d62m7t/engtwCIpII9NaqtxGaE3TT5+SkLKW\nXpJfXZ8Lq9FAepBrDCao4fbrOhJvwkPgvmHbOY76BesM5Ydu0zWWA4nSRWSjoti3\nvlf1+VNegVq8KmzV0QyTWtiUb3Pacqe6WkWi/GZvBnO8nBckuCCFwq6htji6jsJo\nxEoiriIrMV5cFc0nXXKRtCvdVazmJ5EuWZH3K5YqWbv+ocaErgsG+8ec8C/n1kkh\n10U2hSkvPIhzSVoujUsH+whENMebiv1KpkFyIN4Gm7FBq7muPlfvk+Q9anXcq1MX\nphdypi1EDKZpgCy3nXotlhFIxba+bT/UDsy+Z4EGSOQd/U9pxmV0sSo+sH6h0FBV\n92l5AudoTQYVHjCUbpvhAZNNvhRI60uj8WH+OUAECGJQeMC43ZeFyC9mVXYj480s\nHT+0LXoKV/QrN40T35L4jh3yIo95qR+SKRN4pNCQJAz2XT7JurM=\n=ilAh\n-----END PGP SIGNATURE-----",
        "payload": "tree 87855777a3f417ef1dec44354b4340a455085903\nparent e0ca5d05136e4729697b33f146d9e05bd42c6ded\nauthor Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1630885716 +0300\ncommitter Hennadii Stepanov <32963518+hebasto@users.noreply.github.com> 1631022575 +0300\n\nci: Build and cache static Qt instead of downloading a pre-built one\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3a68546fd0981e032005d3a5d2ca7b2ab9acc70b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3a68546fd0981e032005d3a5d2ca7b2ab9acc70b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3a68546fd0981e032005d3a5d2ca7b2ab9acc70b/comments",
    "author": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e0ca5d05136e4729697b33f146d9e05bd42c6ded",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e0ca5d05136e4729697b33f146d9e05bd42c6ded",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e0ca5d05136e4729697b33f146d9e05bd42c6ded"
      }
    ],
    "stats": {
      "total": 69,
      "additions": 36,
      "deletions": 33
    },
    "files": [
      {
        "sha": "5105e0a4900aceb46d89c9c0b7c3de41adc26500",
        "filename": ".cirrus.yml",
        "status": "modified",
        "additions": 36,
        "deletions": 33,
        "changes": 69,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3a68546fd0981e032005d3a5d2ca7b2ab9acc70b/.cirrus.yml",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3a68546fd0981e032005d3a5d2ca7b2ab9acc70b/.cirrus.yml",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/.cirrus.yml?ref=3a68546fd0981e032005d3a5d2ca7b2ab9acc70b",
        "patch": "@@ -85,65 +85,68 @@ task:\n     image: cirrusci/windowsservercore:visualstudio2019\n   timeout_in: 120m\n   env:\n-    CIRRUS_SHELL: powershell\n-    PATH: 'C:\\Python39;C:\\Python39\\Scripts;C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\BuildTools\\MSBuild\\Current\\Bin;%PATH%'\n+    PATH: 'C:\\jom;C:\\Python39;C:\\Python39\\Scripts;C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\BuildTools\\MSBuild\\Current\\Bin;%PATH%'\n     PYTHONUTF8: 1\n     VCPKG_TAG: '75522bb1f2e7d863078bcd06322348f053a9e33f'\n     VCPKG_FEATURE_FLAGS: 'manifests'\n-    QT_DOWNLOAD_URL: 'https://github.com/sipsorcery/qt_win_binary/releases/download/qt51211x64_static_vs2019_160900/Qt5.12.11_x64_static_vs2019_160900.zip'\n-    QT_DOWNLOAD_HASH: 'b24436bbc49ac69d992efc148e640f02e8dec426bed5f8497abf735e7d7d59d0'\n-    QT_LOCAL_PATH: 'C:\\Qt5.12.11_x64_static_vs2019_160900'\n+    QT_DOWNLOAD_URL: 'https://download.qt.io/official_releases/qt/5.12/5.12.11/single/qt-everywhere-src-5.12.11.zip'\n+    QT_LOCAL_PATH: 'C:\\qt-everywhere-src-5.12.11.zip'\n+    QT_SOURCE_DIR: 'C:\\qt-everywhere-src-5.12.11'\n+    QTBASEDIR: 'C:\\Qt5.12.11_x64_static_vs2019_160900'\n+    x64_NATIVE_TOOLS: '\"C:\\Program Files (x86)\\Microsoft Visual Studio\\2019\\BuildTools\\VC\\Auxiliary\\Build\\vcvars64.bat\"'\n     IgnoreWarnIntDirInTempDetected: 'true'\n   merge_script:\n-    - git config --global user.email \"ci@ci.ci\"\n-    - git config --global user.name \"ci\"\n+    - ps: git config --global user.email \"ci@ci.ci\"\n+    - ps: git config --global user.name \"ci\"\n     # Windows filesystem loses the executable bit, and all of the executable\n     # files are considered \"modified\" now. It will break the following `git merge`\n     # command. The next two commands make git ignore this issue.\n-    - git config core.filemode false\n-    - git reset --hard\n-    - if ($env:CIRRUS_PR -eq $null) { exit 0; }\n-    - git fetch $env:CIRRUS_REPO_CLONE_URL $env:CIRRUS_BASE_BRANCH\n+    - ps: git config core.filemode false\n+    - ps: git reset --hard\n+    - ps: if ($env:CIRRUS_PR -eq $null) { exit 0; }\n+    - ps: git fetch $env:CIRRUS_REPO_CLONE_URL $env:CIRRUS_BASE_BRANCH\n     # Merge base to detect silent merge conflicts.\n-    - git merge FETCH_HEAD\n+    - ps: git merge FETCH_HEAD\n+  msvc_qt_built_cache:\n+    folder: \"%QTBASEDIR%\"\n+    reupload_on_changes: false\n+    fingerprint_script:\n+      - echo %QT_DOWNLOAD_URL%\n+      - msbuild -version\n+    populate_script:\n+      - curl -L -o C:\\jom.zip http://download.qt.io/official_releases/jom/jom.zip\n+      - mkdir C:\\jom\n+      - tar -xf C:\\jom.zip -C C:\\jom\n+      - curl -L -o %QT_LOCAL_PATH% %QT_DOWNLOAD_URL%\n+      - tar -xf %QT_LOCAL_PATH% -C C:\\\n+      - '%x64_NATIVE_TOOLS%'\n+      - cd %QT_SOURCE_DIR%\n+      - mkdir build\n+      - cd build\n+      - ..\\configure -release -silent -opensource -confirm-license -opengl desktop -no-shared -static -static-runtime -mp -qt-zlib -qt-pcre -qt-libpng -no-libjpeg -nomake examples -nomake tests -nomake tools -no-dbus -no-libudev -no-icu -no-gtk -no-opengles3 -no-angle -no-sql-sqlite -no-sql-odbc -no-sqlite -no-libudev -no-vulkan -skip qt3d -skip qtactiveqt -skip qtandroidextras -skip qtcanvas3d -skip qtcharts -skip qtconnectivity -skip qtdatavis3d -skip qtdeclarative -skip qtdoc -skip qtgamepad -skip qtgraphicaleffects -skip qtimageformats -skip qtlocation -skip qtmacextras -skip qtmultimedia -skip qtnetworkauth -skip qtpurchasing -skip qtquickcontrols -skip qtquickcontrols2 -skip qtscript -skip qtscxml -skip qtsensors -skip qtserialbus -skip qtserialport -skip qtspeech -skip qtvirtualkeyboard -skip qtwayland -skip qtwebchannel -skip qtwebengine -skip qtwebsockets -skip qtwebview -skip qtx11extras -skip qtxmlpatterns -no-openssl -no-feature-sql -no-feature-sqlmodel -prefix %QTBASEDIR%\n+      - jom\n+      - jom install\n   vcpkg_cache:\n     folder: 'C:\\Users\\ContainerAdministrator\\AppData\\Local\\vcpkg\\archives'\n   install_python_script:\n     - choco install --yes --no-progress python3 --version=3.9.6\n-    - Write-Host \"\"\n     - python -VV\n   install_vcpkg_script:\n     - cd ..\n     - git clone --quiet https://github.com/microsoft/vcpkg.git\n     - cd vcpkg\n-    - git -c advice.detachedHead=false checkout $env:VCPKG_TAG\n+    - git -c advice.detachedHead=false checkout %VCPKG_TAG%\n     - .\\bootstrap-vcpkg -disableMetrics\n-    - Add-Content \"triplets\\x64-windows-static.cmake\" \"set(VCPKG_BUILD_TYPE release)\"\n+    - echo set(VCPKG_BUILD_TYPE release) >> triplets\\x64-windows-static.cmake\n     - .\\vcpkg integrate install\n-    - Write-Host \"\"\n     - .\\vcpkg version\n-  download_qt_binaries_script: |\n-      Invoke-WebRequest -Uri $env:QT_DOWNLOAD_URL -Out qtdownload.zip;\n-      Write-Host \"Qt binaries successfully downloaded, checking hash against $env:QT_DOWNLOAD_HASH...\";\n-      if ((Get-FileHash qtdownload.zip).Hash -eq $env:QT_DOWNLOAD_HASH) {\n-        Write-Host \"Downloaded Qt binaries archive matched the expected hash.\";\n-        Expand-Archive qtdownload.zip -DestinationPath $env:QT_LOCAL_PATH;\n-      }\n-      else {\n-        Write-Host \"ERROR: Downloaded Qt binaries archive did not match the expected hash.\";\n-        exit 1;\n-      }\n-  build_environment_script:\n-    - choco list --localonly\n-    - Write-Host \"\"\n-    - msbuild -version\n   build_script:\n-    - cd $env:CIRRUS_WORKING_DIR\n+    - cd %CIRRUS_WORKING_DIR%\n     - python build_msvc\\msvc-autogen.py\n     - msbuild build_msvc\\bitcoin.sln -property:Configuration=Release -maxCpuCount -verbosity:minimal -noLogo\n   unit_tests_script:\n     - src\\test_bitcoin.exe -l test_suite\n-    - src\\bench_bitcoin.exe > $null\n+    - src\\bench_bitcoin.exe > NUL\n     - python test\\util\\test_runner.py\n     - python test\\util\\rpcauth-test.py\n "
      }
    ]
  }
]