[
  {
    "sha": "55c9ced6422a05be6ee5de56c4657168e9a41553",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1NWM5Y2VkNjQyMmEwNWJlNmVlNWRlNTZjNDY1NzE2OGU5YTQxNTUz",
    "commit": {
      "author": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2020-05-30T22:29:02Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2020-05-30T22:29:02Z"
      },
      "message": "wallet: add ScriptPubKeyMan::GetScriptPubKeys virtual function\n\nLegacyScriptPubKey::GetScriptPubKeys is a stub",
      "tree": {
        "sha": "846179664ccf27169ffcc986938bd2572d799f7f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/846179664ccf27169ffcc986938bd2572d799f7f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/55c9ced6422a05be6ee5de56c4657168e9a41553",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/55c9ced6422a05be6ee5de56c4657168e9a41553",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/55c9ced6422a05be6ee5de56c4657168e9a41553",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/55c9ced6422a05be6ee5de56c4657168e9a41553/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "98ebe7896dabbdfc787dfdb83277ba3de22e318f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/98ebe7896dabbdfc787dfdb83277ba3de22e318f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/98ebe7896dabbdfc787dfdb83277ba3de22e318f"
      }
    ],
    "stats": {
      "total": 13,
      "additions": 12,
      "deletions": 1
    },
    "files": [
      {
        "sha": "f8591bec82b17d8fc4a0c90aa7443996f06f8e20",
        "filename": "src/wallet/scriptpubkeyman.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 0,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/55c9ced6422a05be6ee5de56c4657168e9a41553/src/wallet/scriptpubkeyman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/55c9ced6422a05be6ee5de56c4657168e9a41553/src/wallet/scriptpubkeyman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.cpp?ref=55c9ced6422a05be6ee5de56c4657168e9a41553",
        "patch": "@@ -1577,6 +1577,13 @@ std::set<CKeyID> LegacyScriptPubKeyMan::GetKeys() const\n     return set_address;\n }\n \n+const std::vector<CScript> LegacyScriptPubKeyMan::GetScriptPubKeys() const\n+{\n+    LOCK(cs_KeyStore);\n+    std::vector<CScript> script_pub_keys;\n+    return script_pub_keys;\n+}\n+\n void LegacyScriptPubKeyMan::SetInternal(bool internal) {}\n \n bool DescriptorScriptPubKeyMan::GetNewDestination(const OutputType type, CTxDestination& dest, std::string& error)"
      },
      {
        "sha": "733b6272528de38e9882a811cf6e6718faed9969",
        "filename": "src/wallet/scriptpubkeyman.h",
        "status": "modified",
        "additions": 5,
        "deletions": 1,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/55c9ced6422a05be6ee5de56c4657168e9a41553/src/wallet/scriptpubkeyman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/55c9ced6422a05be6ee5de56c4657168e9a41553/src/wallet/scriptpubkeyman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.h?ref=55c9ced6422a05be6ee5de56c4657168e9a41553",
        "patch": "@@ -251,6 +251,8 @@ class ScriptPubKeyMan\n \n     /** Keypool has new keys */\n     boost::signals2::signal<void ()> NotifyCanGetAddressesChanged;\n+\n+    virtual const std::vector<CScript> GetScriptPubKeys() const { return std::vector<CScript>(); };\n };\n \n class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProvider\n@@ -493,6 +495,8 @@ class LegacyScriptPubKeyMan : public ScriptPubKeyMan, public FillableSigningProv\n     const std::map<CKeyID, int64_t>& GetAllReserveKeys() const { return m_pool_key_to_index; }\n \n     std::set<CKeyID> GetKeys() const override;\n+\n+    const std::vector<CScript> GetScriptPubKeys() const override;\n };\n \n /** Wraps a LegacyScriptPubKeyMan so that it can be returned in a new unique_ptr. Does not provide privkeys */\n@@ -612,7 +616,7 @@ class DescriptorScriptPubKeyMan : public ScriptPubKeyMan\n     void WriteDescriptor();\n \n     const WalletDescriptor GetWalletDescriptor() const EXCLUSIVE_LOCKS_REQUIRED(cs_desc_man);\n-    const std::vector<CScript> GetScriptPubKeys() const;\n+    const std::vector<CScript> GetScriptPubKeys() const override;\n };\n \n #endif // BITCOIN_WALLET_SCRIPTPUBKEYMAN_H"
      }
    ]
  },
  {
    "sha": "872661b29882d4d859975b0533a90516410a422d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4NzI2NjFiMjk4ODJkNGQ4NTk5NzViMDUzM2E5MDUxNjQxMGE0MjJk",
    "commit": {
      "author": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2020-05-30T22:57:03Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2020-05-30T22:57:03Z"
      },
      "message": "wallet: partially implement LegacyScriptPubKeyMan::GetScriptPubKeys\n\nimplements p2pkh",
      "tree": {
        "sha": "5bedd6555df21a7901c5865e20214aaaffead40e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5bedd6555df21a7901c5865e20214aaaffead40e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/872661b29882d4d859975b0533a90516410a422d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/872661b29882d4d859975b0533a90516410a422d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/872661b29882d4d859975b0533a90516410a422d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/872661b29882d4d859975b0533a90516410a422d/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "55c9ced6422a05be6ee5de56c4657168e9a41553",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/55c9ced6422a05be6ee5de56c4657168e9a41553",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/55c9ced6422a05be6ee5de56c4657168e9a41553"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 6,
      "deletions": 0
    },
    "files": [
      {
        "sha": "28205d88cb6581b5c0b152f054e6b0eb04199309",
        "filename": "src/wallet/scriptpubkeyman.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/872661b29882d4d859975b0533a90516410a422d/src/wallet/scriptpubkeyman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/872661b29882d4d859975b0533a90516410a422d/src/wallet/scriptpubkeyman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/scriptpubkeyman.cpp?ref=872661b29882d4d859975b0533a90516410a422d",
        "patch": "@@ -1580,7 +1580,13 @@ std::set<CKeyID> LegacyScriptPubKeyMan::GetKeys() const\n const std::vector<CScript> LegacyScriptPubKeyMan::GetScriptPubKeys() const\n {\n     LOCK(cs_KeyStore);\n+    std::set<CKeyID> key_ids = GetKeys();\n     std::vector<CScript> script_pub_keys;\n+    script_pub_keys.reserve(key_ids.size());\n+    for (const CKeyID& key_id : key_ids)\n+    {\n+        script_pub_keys.push_back(GetScriptForDestination(PKHash(key_id)));\n+    }\n     return script_pub_keys;\n }\n "
      }
    ]
  },
  {
    "sha": "b59f89b1fd39843bfb87c380e1aba86aaacdc64a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiNTlmODliMWZkMzk4NDNiZmI4N2MzODBlMWFiYTg2YWFhY2RjNjRh",
    "commit": {
      "author": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2020-05-31T00:34:26Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2020-05-31T00:34:26Z"
      },
      "message": "chain: add filterMatchesAny to chain interface\n\ntaken from #15845",
      "tree": {
        "sha": "dd1400c6269d8aaa7378880f2b18d31d6e44739a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/dd1400c6269d8aaa7378880f2b18d31d6e44739a"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b59f89b1fd39843bfb87c380e1aba86aaacdc64a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b59f89b1fd39843bfb87c380e1aba86aaacdc64a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/b59f89b1fd39843bfb87c380e1aba86aaacdc64a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b59f89b1fd39843bfb87c380e1aba86aaacdc64a/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "872661b29882d4d859975b0533a90516410a422d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/872661b29882d4d859975b0533a90516410a422d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/872661b29882d4d859975b0533a90516410a422d"
      }
    ],
    "stats": {
      "total": 20,
      "additions": 20,
      "deletions": 0
    },
    "files": [
      {
        "sha": "cbc67a553a454f9fe04178034b16b978f0a27448",
        "filename": "src/interfaces/chain.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 0,
        "changes": 15,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b59f89b1fd39843bfb87c380e1aba86aaacdc64a/src/interfaces/chain.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b59f89b1fd39843bfb87c380e1aba86aaacdc64a/src/interfaces/chain.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/interfaces/chain.cpp?ref=b59f89b1fd39843bfb87c380e1aba86aaacdc64a",
        "patch": "@@ -6,6 +6,7 @@\n \n #include <chain.h>\n #include <chainparams.h>\n+#include <index/blockfilterindex.h>\n #include <interfaces/handler.h>\n #include <interfaces/wallet.h>\n #include <net.h>\n@@ -186,6 +187,20 @@ class ChainImpl : public Chain\n         }\n         return nullopt;\n     }\n+    Optional<bool> filterMatchesAny(const uint256& hash, const GCSFilter::ElementSet& filter_set) override\n+    {\n+        const BlockFilterIndex* block_filter_index = GetBlockFilterIndex(BlockFilterType::BASIC);\n+        if (!block_filter_index) return {};\n+        BlockFilter filter;\n+        const CBlockIndex* index;\n+        {\n+            LOCK(cs_main);\n+            index = LookupBlockIndex(hash);\n+            if (!index) return {};\n+        }\n+        if (!block_filter_index->LookupFilter(index, filter)) return {};\n+        return filter.GetFilter().MatchAny(filter_set);\n+    }\n     CBlockLocator getTipLocator() override\n     {\n         LOCK(cs_main);"
      },
      {
        "sha": "7b248ffd3ff22673ff364fc5ca9047308b20bb0a",
        "filename": "src/interfaces/chain.h",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b59f89b1fd39843bfb87c380e1aba86aaacdc64a/src/interfaces/chain.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b59f89b1fd39843bfb87c380e1aba86aaacdc64a/src/interfaces/chain.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/interfaces/chain.h?ref=b59f89b1fd39843bfb87c380e1aba86aaacdc64a",
        "patch": "@@ -5,6 +5,7 @@\n #ifndef BITCOIN_INTERFACES_CHAIN_H\n #define BITCOIN_INTERFACES_CHAIN_H\n \n+#include <blockfilter.h>            // For GCSFilter::ElementSet\n #include <optional.h>               // For Optional and nullopt\n #include <primitives/transaction.h> // For CTransactionRef\n \n@@ -126,6 +127,10 @@ class Chain\n     //! information.\n     virtual bool findFirstBlockWithTimeAndHeight(int64_t min_time, int min_height, const FoundBlock& block={}) = 0;\n \n+    //! Returns whether any of the elements match the block via a BIP 157 block filter or nothing if the block filter\n+    //! for this block could be found.\n+    virtual Optional<bool> filterMatchesAny(const uint256& hash, const GCSFilter::ElementSet& filter_set) = 0;\n+\n     //! Find next block if block is part of current chain. Also flag if\n     //! there was a reorg and the specified block hash is no longer in the\n     //! current chain, and optionally return block information."
      }
    ]
  },
  {
    "sha": "fe107fcdfe39cd87dff5e77d17d9817dd6390d25",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmZTEwN2ZjZGZlMzljZDg3ZGZmNWU3N2QxN2Q5ODE3ZGQ2MzkwZDI1",
    "commit": {
      "author": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2020-05-31T00:58:54Z"
      },
      "committer": {
        "name": "Patrick Strateman",
        "email": "patrick.strateman@gmail.com",
        "date": "2020-06-02T22:09:58Z"
      },
      "message": "wallet: Use blockfilterindex \"basic\" to accelerate rescan time\n\nwe avoid issues with the keypool expanding during a rescan with the\nscript_pub_key_filter_set flag",
      "tree": {
        "sha": "a5f04b60eac1e41e4b0fdc159d80b18dc4813eb9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a5f04b60eac1e41e4b0fdc159d80b18dc4813eb9"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fe107fcdfe39cd87dff5e77d17d9817dd6390d25",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fe107fcdfe39cd87dff5e77d17d9817dd6390d25",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fe107fcdfe39cd87dff5e77d17d9817dd6390d25",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fe107fcdfe39cd87dff5e77d17d9817dd6390d25/comments",
    "author": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "pstratem",
      "id": 620611,
      "node_id": "MDQ6VXNlcjYyMDYxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/620611?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pstratem",
      "html_url": "https://github.com/pstratem",
      "followers_url": "https://api.github.com/users/pstratem/followers",
      "following_url": "https://api.github.com/users/pstratem/following{/other_user}",
      "gists_url": "https://api.github.com/users/pstratem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pstratem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pstratem/subscriptions",
      "organizations_url": "https://api.github.com/users/pstratem/orgs",
      "repos_url": "https://api.github.com/users/pstratem/repos",
      "events_url": "https://api.github.com/users/pstratem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pstratem/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b59f89b1fd39843bfb87c380e1aba86aaacdc64a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b59f89b1fd39843bfb87c380e1aba86aaacdc64a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b59f89b1fd39843bfb87c380e1aba86aaacdc64a"
      }
    ],
    "stats": {
      "total": 32,
      "additions": 28,
      "deletions": 4
    },
    "files": [
      {
        "sha": "cd485ae5afd32aca666573e20764b8f34422fcf3",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 21,
        "deletions": 3,
        "changes": 24,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fe107fcdfe39cd87dff5e77d17d9817dd6390d25/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fe107fcdfe39cd87dff5e77d17d9817dd6390d25/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=fe107fcdfe39cd87dff5e77d17d9817dd6390d25",
        "patch": "@@ -5,6 +5,7 @@\n \n #include <wallet/wallet.h>\n \n+#include <blockfilter.h>\n #include <chain.h>\n #include <consensus/consensus.h>\n #include <consensus/validation.h>\n@@ -1616,6 +1617,20 @@ int64_t CWallet::RescanFromTime(int64_t startTime, const WalletRescanReserver& r\n     return startTime;\n }\n \n+\n+GCSFilter::ElementSet& CWallet::GetScriptPubKeyFilterSet() {\n+    if (!m_regenerate_script_pub_key_list) return script_pub_key_filter_set;\n+    script_pub_key_filter_set.clear();\n+    for (ScriptPubKeyMan* spk_man : GetAllScriptPubKeyMans()) {\n+        for (const CScript& script_pub_key : spk_man->GetScriptPubKeys()) {\n+            script_pub_key_filter_set.emplace(script_pub_key.begin(), script_pub_key.end());\n+        }\n+    }\n+    m_regenerate_script_pub_key_list = false;\n+    WalletLogPrintf(\"script_pub_key_filter_set.size() %d\\n\", script_pub_key_filter_set.size());\n+    return script_pub_key_filter_set;\n+}\n+\n /**\n  * Scan the block chain (starting in start_block) for transactions\n  * from or to us. If fUpdate is true, found transactions that already\n@@ -1684,9 +1699,12 @@ CWallet::ScanResult CWallet::ScanForWalletTransactions(const uint256& start_bloc\n                 result.status = ScanResult::FAILURE;\n                 break;\n             }\n-            for (size_t posInBlock = 0; posInBlock < block.vtx.size(); ++posInBlock) {\n-                CWalletTx::Confirmation confirm(CWalletTx::Status::CONFIRMED, block_height, block_hash, posInBlock);\n-                SyncTransaction(block.vtx[posInBlock], confirm, fUpdate);\n+            Optional<bool> filter_matches = chain().filterMatchesAny(block_hash, GetScriptPubKeyFilterSet());\n+            if (filter_matches.value_or(true)) {\n+                for (size_t posInBlock = 0; posInBlock < block.vtx.size(); ++posInBlock) {\n+                    CWalletTx::Confirmation confirm(CWalletTx::Status::CONFIRMED, block_height, block_hash, posInBlock);\n+                    SyncTransaction(block.vtx[posInBlock], confirm, fUpdate);\n+                }\n             }\n             // scan succeeded, record block as most recent successfully scanned\n             result.last_scanned_block = block_hash;"
      },
      {
        "sha": "ee18e192ad3814ec69ab3f07c0aceacbbb9a6a5c",
        "filename": "src/wallet/wallet.h",
        "status": "modified",
        "additions": 7,
        "deletions": 1,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fe107fcdfe39cd87dff5e77d17d9817dd6390d25/src/wallet/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fe107fcdfe39cd87dff5e77d17d9817dd6390d25/src/wallet/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.h?ref=fe107fcdfe39cd87dff5e77d17d9817dd6390d25",
        "patch": "@@ -723,6 +723,10 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     // ScriptPubKeyMan::GetID. In many cases it will be the hash of an internal structure\n     std::map<uint256, std::unique_ptr<ScriptPubKeyMan>> m_spk_managers;\n \n+    std::atomic<bool> m_regenerate_script_pub_key_list;\n+\n+    GCSFilter::ElementSet script_pub_key_filter_set;\n+    GCSFilter::ElementSet& GetScriptPubKeyFilterSet();\n public:\n     /*\n      * Main wallet lock.\n@@ -761,8 +765,10 @@ class CWallet final : public WalletStorage, public interfaces::Chain::Notificati\n     CWallet(interfaces::Chain* chain, const WalletLocation& location, std::unique_ptr<WalletDatabase> database)\n         : m_chain(chain),\n           m_location(location),\n-          database(std::move(database))\n+          database(std::move(database)),\n+          m_regenerate_script_pub_key_list(true)\n     {\n+        NotifyCanGetAddressesChanged.connect([&]{this->m_regenerate_script_pub_key_list = true;});\n     }\n \n     ~CWallet()"
      }
    ]
  }
]