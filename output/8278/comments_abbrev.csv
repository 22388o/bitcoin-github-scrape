laanwj,2016-06-28T09:37:36Z,Concept ACK\n,https://github.com/bitcoin/bitcoin/pull/8278#issuecomment-229000780,229000780,
sipa,2016-06-28T09:39:15Z,Concept ACK\n,https://github.com/bitcoin/bitcoin/pull/8278#issuecomment-229001113,229001113,
jonasschnelli,2016-06-28T20:18:20Z,Concept ACK\n,https://github.com/bitcoin/bitcoin/pull/8278#issuecomment-229169814,229169814,
ChoHag,2016-06-30T10:49:08Z,"I'm not overly concerned with making the feature freeze but I realised it's a bad code smell to have two mutually exclusive command line arguments, so have simply removed the chdir for the time being.\n",https://github.com/bitcoin/bitcoin/pull/8278#issuecomment-229625332,229625332,
laanwj,2016-07-01T07:58:11Z,Thanks. Will test.\n,https://github.com/bitcoin/bitcoin/pull/8278#issuecomment-229881799,229881799,
laanwj,2016-07-01T08:17:06Z,"I get the following compile error when I force HAVE_DECL_DAEMON off:\n\n```\n/home/user/src/bitcoin/src/bitcoind.cpp:164:27: error: use of undeclared identifier '_PATH_DEVNULL'\n            int fd = open(_PATH_DEVNULL, 02, 0);\n```\n\nWhere is that definition supposed to come from?\n",https://github.com/bitcoin/bitcoin/pull/8278#issuecomment-229885446,229885446,
ChoHag,2016-07-01T09:26:09Z,"It's from /usr/include/paths.h but now that I see the initial _ (and, of course, your error) I wonder how portable it is. The file's there on OpenBSD and Linux. I don't have anything else to hand to look in but notably the file's copyright is 1993 to Berkely so if not officially portable it's probably practically portable.\n\nAccording to gnulib's manual:\n    Portability problems not fixed by Gnu",https://github.com/bitcoin/bitcoin/pull/8278#issuecomment-229901041,229901041,
sipa,2016-08-25T12:15:16Z,Anything holding this up?\n,https://github.com/bitcoin/bitcoin/pull/8278#issuecomment-242364970,242364970,
laanwj,2016-08-26T11:11:39Z,"Yes, it's not compiling for me when pretending not to have daemonize(). If we can't test that fallback code, we shouldn't even include it.\n@ChoHag was working on a change.\n(probably an autotools detection for _PATH_DEVNULL)\n",https://github.com/bitcoin/bitcoin/pull/8278#issuecomment-242704745,242704745,
laanwj,2016-08-26T11:20:29Z,"Note that we do have some things that potentially print to stdout/stderr after daemonize():\n- util.cpp: PrintExceptionContinue\n- noui.cpp: noui_ThreadSafeMessageBox (used for reporting some errors during http initialization)\n- sync.cpp: AssertLockHeldInternal\n\nShould not hold up this pull, as this is bad behavior in the first place, but we should make sure that everything printed also ends up",https://github.com/bitcoin/bitcoin/pull/8278#issuecomment-242706794,242706794,
gmaxwell,2016-09-22T23:05:26Z,@ChoHag  Around? If not then maybe someone else wants to pick this up?\n,https://github.com/bitcoin/bitcoin/pull/8278#issuecomment-249053510,249053510,
ChoHag,2016-09-23T10:40:09Z,"I'm not really, I have pressing personal matters to deal with and cannot\ndevote time to hacking so I'm happy to hand this over to someone else. I\nwas researching the best way to make the change fully portable but really\nthe whole process is quite simple.\n\nMatthew\n\n> @ChoHag  Around? If not then maybe someone else wants to pick this up?\n> \n> ## \n> \n> You are receiving this because you we",https://github.com/bitcoin/bitcoin/pull/8278#issuecomment-249159107,249159107,
laanwj,2016-09-26T09:12:25Z,"Are there any POSIX-ish OSes that are supported by our build that don't support `daemon()`? I've checked at least Linux and OpenBSD and they do. OSX does too (thanks @jonasschnelli).\n\nIf not, we could just disable -daemon if that call is not available (like on WIndows). That makes it a lot easier to do this as well as maintain the code afterward as the fallback path is not needed.\n",https://github.com/bitcoin/bitcoin/pull/8278#issuecomment-249518778,249518778,
laanwj,2016-09-26T09:39:56Z,Closing in favor of #8813\n,https://github.com/bitcoin/bitcoin/pull/8278#issuecomment-249524593,249524593,
laanwj,2016-06-28T11:38:46Z,Nice use of the build system\n,https://github.com/bitcoin/bitcoin/pull/8278#discussion_r68740822,68740822,configure.ac
laanwj,2016-06-28T11:41:05Z,"This may be a change of behavior: we should check whether there are arguments that take relative paths (e.g. `-datadir`, `-conf`, but also the `-*notify` options) that are affected by this.\n",https://github.com/bitcoin/bitcoin/pull/8278#discussion_r68741029,68741029,src/bitcoind.cpp
ChoHag,2016-06-28T18:39:04Z,"Having looked up alternative ways of dealing with absolute/relative paths, I've come up with these options:\n- Remove chdir and tell daemon() not to either\n- Remember PWD before changing and prepend it to all relative paths (alternatively open a fd to PWD before changing and cd back or openat when necessary, but that won't work with exec and is probably a terrible idea even if it did)\n- Abort if",https://github.com/bitcoin/bitcoin/pull/8278#discussion_r68816747,68816747,src/bitcoind.cpp
laanwj,2016-06-29T07:06:17Z,"I think the first option for this PR makes sense. That keeps this a refactor, not a change of behavior (which would break compatibility for users). In some later change the chdir could be re-added after implementing one of the other options.\n",https://github.com/bitcoin/bitcoin/pull/8278#discussion_r68895080,68895080,src/bitcoind.cpp
ChoHag,2016-06-30T08:36:36Z,"I like the chdir, myself, and think it will look neater than 'cd / && bitcoind' so may I propose two new command-line switches:\n- -chdir; CHange DIRectory to / (or C:\) prior to daemonising, can perhaps later be changed into a noop.\n- -pwdir; Preserve Working DIRectory*, currently a noop, can perhaps later be changed into preserving current functionality.\n\nI considered giving -chdir an optiona",https://github.com/bitcoin/bitcoin/pull/8278#discussion_r69093274,69093274,src/bitcoind.cpp
laanwj,2016-06-30T08:41:59Z,"Sure, I'm not against changing the behavior in the future, we can do that later, one step at a time. However if you can do this PR as a simple change to `daemonize` that keeps the behavior the same, it's much easier to get it merged, even for 0.13.\nIf you start adding command-line flags this is too late for the feature freeze, so will only be considered after the 0.14 branch (and you will have to",https://github.com/bitcoin/bitcoin/pull/8278#discussion_r69094011,69094011,src/bitcoind.cpp
