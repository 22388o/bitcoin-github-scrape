[
  {
    "sha": "2855409302c665b0a3eecbb5bf02ac412d86720d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyODU1NDA5MzAyYzY2NWIwYTNlZWNiYjViZjAyYWM0MTJkODY3MjBk",
    "commit": {
      "author": {
        "name": "Matthew King",
        "email": "chohag@jtan.com",
        "date": "2016-06-28T06:35:41Z"
      },
      "committer": {
        "name": "Matthew King",
        "email": "chohag@jtan.com",
        "date": "2016-06-28T06:50:38Z"
      },
      "message": "[bitcoind] Daemonise using daemon(3) if available",
      "tree": {
        "sha": "6c4d774323c792709b9f0072d98ea299b273886d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6c4d774323c792709b9f0072d98ea299b273886d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2855409302c665b0a3eecbb5bf02ac412d86720d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2855409302c665b0a3eecbb5bf02ac412d86720d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2855409302c665b0a3eecbb5bf02ac412d86720d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2855409302c665b0a3eecbb5bf02ac412d86720d/comments",
    "author": {
      "login": "ChoHag",
      "id": 139629,
      "node_id": "MDQ6VXNlcjEzOTYyOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/139629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ChoHag",
      "html_url": "https://github.com/ChoHag",
      "followers_url": "https://api.github.com/users/ChoHag/followers",
      "following_url": "https://api.github.com/users/ChoHag/following{/other_user}",
      "gists_url": "https://api.github.com/users/ChoHag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ChoHag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ChoHag/subscriptions",
      "organizations_url": "https://api.github.com/users/ChoHag/orgs",
      "repos_url": "https://api.github.com/users/ChoHag/repos",
      "events_url": "https://api.github.com/users/ChoHag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ChoHag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "ChoHag",
      "id": 139629,
      "node_id": "MDQ6VXNlcjEzOTYyOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/139629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ChoHag",
      "html_url": "https://github.com/ChoHag",
      "followers_url": "https://api.github.com/users/ChoHag/followers",
      "following_url": "https://api.github.com/users/ChoHag/following{/other_user}",
      "gists_url": "https://api.github.com/users/ChoHag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ChoHag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ChoHag/subscriptions",
      "organizations_url": "https://api.github.com/users/ChoHag/orgs",
      "repos_url": "https://api.github.com/users/ChoHag/repos",
      "events_url": "https://api.github.com/users/ChoHag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ChoHag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "5a06ebbf2d5f6ff57966c9ea9956cc1b666b3028",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5a06ebbf2d5f6ff57966c9ea9956cc1b666b3028",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5a06ebbf2d5f6ff57966c9ea9956cc1b666b3028"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 13,
      "deletions": 1
    },
    "files": [
      {
        "sha": "65cba9c4af9a74e69537ae6e0048acc01cf11dec",
        "filename": "configure.ac",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2855409302c665b0a3eecbb5bf02ac412d86720d/configure.ac",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2855409302c665b0a3eecbb5bf02ac412d86720d/configure.ac",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/configure.ac?ref=2855409302c665b0a3eecbb5bf02ac412d86720d",
        "patch": "@@ -514,6 +514,9 @@ AC_SEARCH_LIBS([inet_pton], [nsl resolv], [AC_DEFINE(HAVE_INET_PTON, 1, [Define\n \n AC_CHECK_DECLS([strnlen])\n \n+# Check for daemon(3), unrelated to --with-daemon (although used by it)\n+AC_CHECK_DECLS([daemon])\n+\n AC_CHECK_DECLS([le16toh, le32toh, le64toh, htole16, htole32, htole64, be16toh, be32toh, be64toh, htobe16, htobe32, htobe64],,,\n \t\t[#if HAVE_ENDIAN_H\n                  #include <endian.h>"
      },
      {
        "sha": "ac738f778861d3ef282195dc0f41d9b3f6363df0",
        "filename": "src/bitcoind.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 1,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2855409302c665b0a3eecbb5bf02ac412d86720d/src/bitcoind.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2855409302c665b0a3eecbb5bf02ac412d86720d/src/bitcoind.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoind.cpp?ref=2855409302c665b0a3eecbb5bf02ac412d86720d",
        "patch": "@@ -9,6 +9,7 @@\n \n #include \"chainparams.h\"\n #include \"clientversion.h\"\n+#include \"compat.h\"\n #include \"rpc/server.h\"\n #include \"init.h\"\n #include \"noui.h\"\n@@ -136,6 +137,13 @@ bool AppInit(int argc, char* argv[])\n             fprintf(stdout, \"Bitcoin server starting\\n\");\n \n             // Daemonize\n+#  if HAVE_DECL_DAEMON\n+            if (daemon(0, 0)) {\n+                fprintf(stderr, \"Failed to become daemon: %s\",\n+                        strerror(errno));\n+                return false;\n+            }\n+#  else\n             pid_t pid = fork();\n             if (pid < 0)\n             {\n@@ -151,8 +159,9 @@ bool AppInit(int argc, char* argv[])\n             pid_t sid = setsid();\n             if (sid < 0)\n                 fprintf(stderr, \"Error: setsid() returned %d errno %d\\n\", sid, errno);\n+#  endif // HAVE_DECL_DAEMON\n         }\n-#endif\n+#endif // WIN32\n         SoftSetBoolArg(\"-server\", true);\n \n         // Set this early so that parameter interactions go to console"
      }
    ]
  },
  {
    "sha": "136908e94b1782c2cbe12899c61f91122e02fca9",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxMzY5MDhlOTRiMTc4MmMyY2JlMTI4OTljNjFmOTExMjJlMDJmY2E5",
    "commit": {
      "author": {
        "name": "Matthew King",
        "email": "chohag@jtan.com",
        "date": "2016-06-28T07:33:09Z"
      },
      "committer": {
        "name": "Matthew King",
        "email": "chohag@jtan.com",
        "date": "2016-06-28T07:47:10Z"
      },
      "message": "[bitcoind] Act more like daemon(3) if unavailable\n\n[bitcoind] Make forking error messages consistent",
      "tree": {
        "sha": "cfc0de4e5f74269f3d5dd06efe87791db7b3e1e4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cfc0de4e5f74269f3d5dd06efe87791db7b3e1e4"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/136908e94b1782c2cbe12899c61f91122e02fca9",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/136908e94b1782c2cbe12899c61f91122e02fca9",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/136908e94b1782c2cbe12899c61f91122e02fca9",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/136908e94b1782c2cbe12899c61f91122e02fca9/comments",
    "author": {
      "login": "ChoHag",
      "id": 139629,
      "node_id": "MDQ6VXNlcjEzOTYyOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/139629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ChoHag",
      "html_url": "https://github.com/ChoHag",
      "followers_url": "https://api.github.com/users/ChoHag/followers",
      "following_url": "https://api.github.com/users/ChoHag/following{/other_user}",
      "gists_url": "https://api.github.com/users/ChoHag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ChoHag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ChoHag/subscriptions",
      "organizations_url": "https://api.github.com/users/ChoHag/orgs",
      "repos_url": "https://api.github.com/users/ChoHag/repos",
      "events_url": "https://api.github.com/users/ChoHag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ChoHag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "ChoHag",
      "id": 139629,
      "node_id": "MDQ6VXNlcjEzOTYyOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/139629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ChoHag",
      "html_url": "https://github.com/ChoHag",
      "followers_url": "https://api.github.com/users/ChoHag/followers",
      "following_url": "https://api.github.com/users/ChoHag/following{/other_user}",
      "gists_url": "https://api.github.com/users/ChoHag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ChoHag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ChoHag/subscriptions",
      "organizations_url": "https://api.github.com/users/ChoHag/orgs",
      "repos_url": "https://api.github.com/users/ChoHag/repos",
      "events_url": "https://api.github.com/users/ChoHag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ChoHag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "2855409302c665b0a3eecbb5bf02ac412d86720d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2855409302c665b0a3eecbb5bf02ac412d86720d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/2855409302c665b0a3eecbb5bf02ac412d86720d"
      }
    ],
    "stats": {
      "total": 19,
      "additions": 15,
      "deletions": 4
    },
    "files": [
      {
        "sha": "ec6baf5ad8a7b4b3b07c3ed577625e71f81dfc99",
        "filename": "src/bitcoind.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 4,
        "changes": 19,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/136908e94b1782c2cbe12899c61f91122e02fca9/src/bitcoind.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/136908e94b1782c2cbe12899c61f91122e02fca9/src/bitcoind.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoind.cpp?ref=136908e94b1782c2cbe12899c61f91122e02fca9",
        "patch": "@@ -138,16 +138,17 @@ bool AppInit(int argc, char* argv[])\n \n             // Daemonize\n #  if HAVE_DECL_DAEMON\n+            // daemon(3) basically does exactly what follows in the else block,\n+            // but it's best to use library functions where they're available\n             if (daemon(0, 0)) {\n-                fprintf(stderr, \"Failed to become daemon: %s\",\n-                        strerror(errno));\n+                fprintf(stderr, \"Error: daemon() failed: %s\\n\", strerror(errno));\n                 return false;\n             }\n #  else\n             pid_t pid = fork();\n             if (pid < 0)\n             {\n-                fprintf(stderr, \"Error: fork() returned %d errno %d\\n\", pid, errno);\n+                fprintf(stderr, \"Error: fork() failed: %s\\n\", strerror(errno));\n                 return false;\n             }\n             if (pid > 0) // Parent process, pid is child process id\n@@ -158,7 +159,17 @@ bool AppInit(int argc, char* argv[])\n \n             pid_t sid = setsid();\n             if (sid < 0)\n-                fprintf(stderr, \"Error: setsid() returned %d errno %d\\n\", sid, errno);\n+                fprintf(stderr, \"Error: setsid() failed: %s\\n\", strerror(errno));\n+\n+            (void)chdir(\"/\");\n+\n+            int fd = open(_PATH_DEVNULL, O_RDWR, 0);\n+            (void)dup2(fd, STDIN_FILENO);\n+            (void)dup2(fd, STDOUT_FILENO);\n+            (void)dup2(fd, STDERR_FILENO);\n+            if (fd > 2)\n+                (void)close(fd);\n+\n #  endif // HAVE_DECL_DAEMON\n         }\n #endif // WIN32"
      }
    ]
  },
  {
    "sha": "d2cc39a017ec0a6ec84431d1f45c3085746d2771",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpkMmNjMzlhMDE3ZWMwYTZlYzg0NDMxZDFmNDVjMzA4NTc0NmQyNzcx",
    "commit": {
      "author": {
        "name": "Matthew King",
        "email": "chohag@jtan.com",
        "date": "2016-06-30T10:40:30Z"
      },
      "committer": {
        "name": "Matthew King",
        "email": "chohag@jtan.com",
        "date": "2016-06-30T10:40:30Z"
      },
      "message": "[bitcoind] Preserve daemonise behaviour; no chdir",
      "tree": {
        "sha": "f9a2f05e4bd95f7a42b8930bba09233fbff95978",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f9a2f05e4bd95f7a42b8930bba09233fbff95978"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/d2cc39a017ec0a6ec84431d1f45c3085746d2771",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d2cc39a017ec0a6ec84431d1f45c3085746d2771",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/d2cc39a017ec0a6ec84431d1f45c3085746d2771",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d2cc39a017ec0a6ec84431d1f45c3085746d2771/comments",
    "author": {
      "login": "ChoHag",
      "id": 139629,
      "node_id": "MDQ6VXNlcjEzOTYyOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/139629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ChoHag",
      "html_url": "https://github.com/ChoHag",
      "followers_url": "https://api.github.com/users/ChoHag/followers",
      "following_url": "https://api.github.com/users/ChoHag/following{/other_user}",
      "gists_url": "https://api.github.com/users/ChoHag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ChoHag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ChoHag/subscriptions",
      "organizations_url": "https://api.github.com/users/ChoHag/orgs",
      "repos_url": "https://api.github.com/users/ChoHag/repos",
      "events_url": "https://api.github.com/users/ChoHag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ChoHag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "ChoHag",
      "id": 139629,
      "node_id": "MDQ6VXNlcjEzOTYyOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/139629?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ChoHag",
      "html_url": "https://github.com/ChoHag",
      "followers_url": "https://api.github.com/users/ChoHag/followers",
      "following_url": "https://api.github.com/users/ChoHag/following{/other_user}",
      "gists_url": "https://api.github.com/users/ChoHag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ChoHag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ChoHag/subscriptions",
      "organizations_url": "https://api.github.com/users/ChoHag/orgs",
      "repos_url": "https://api.github.com/users/ChoHag/repos",
      "events_url": "https://api.github.com/users/ChoHag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ChoHag/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "136908e94b1782c2cbe12899c61f91122e02fca9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/136908e94b1782c2cbe12899c61f91122e02fca9",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/136908e94b1782c2cbe12899c61f91122e02fca9"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 1,
      "deletions": 3
    },
    "files": [
      {
        "sha": "99abb4ded659cd1e79f4949061e9153b1f3a5def",
        "filename": "src/bitcoind.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 3,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/d2cc39a017ec0a6ec84431d1f45c3085746d2771/src/bitcoind.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/d2cc39a017ec0a6ec84431d1f45c3085746d2771/src/bitcoind.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoind.cpp?ref=d2cc39a017ec0a6ec84431d1f45c3085746d2771",
        "patch": "@@ -140,7 +140,7 @@ bool AppInit(int argc, char* argv[])\n #  if HAVE_DECL_DAEMON\n             // daemon(3) basically does exactly what follows in the else block,\n             // but it's best to use library functions where they're available\n-            if (daemon(0, 0)) {\n+            if (daemon(1, 0)) { // don't chdir (1), do close FDs (0)\n                 fprintf(stderr, \"Error: daemon() failed: %s\\n\", strerror(errno));\n                 return false;\n             }\n@@ -161,8 +161,6 @@ bool AppInit(int argc, char* argv[])\n             if (sid < 0)\n                 fprintf(stderr, \"Error: setsid() failed: %s\\n\", strerror(errno));\n \n-            (void)chdir(\"/\");\n-\n             int fd = open(_PATH_DEVNULL, O_RDWR, 0);\n             (void)dup2(fd, STDIN_FILENO);\n             (void)dup2(fd, STDOUT_FILENO);"
      }
    ]
  }
]