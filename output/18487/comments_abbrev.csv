DrahtBot,2020-04-01 09:56:25,<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.,https://github.com/bitcoin/bitcoin/pull/18487#issuecomment-607153672,607153672,
MarcoFalke,2020-04-02 15:27:39,Can be tested with #18507 ,https://github.com/bitcoin/bitcoin/pull/18487#issuecomment-607915726,607915726,
MarcoFalke,2020-04-02 16:09:48,ACK 47dd37cc83bdcaf19a3abe95950b2409baae6249 only tested that this avoids the node freezing. Didn't look at how libevent works or how the deadlock happens or if this breaks other stuff.,https://github.com/bitcoin/bitcoin/pull/18487#issuecomment-607940922,607940922,
MarcoFalke,2020-04-02 16:31:22,"ACK 7b8e15728d, only tested that this avoids the node freezing. Did not look at how libevent works or how the deadlock happens or if this breaks other stuff. ðŸ“ž\n\n<details><summary>Show signature and timestamp</summary>\n\nSignature:\n\n```\n-----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA512\n\nACK 7b8e15728d, only tested that this avoids the node freezing. Did not look at how libevent wor",https://github.com/bitcoin/bitcoin/pull/18487#issuecomment-607953365,607953365,
promag,2020-04-02 16:33:38,I didn't want to write libevent details in rpcwallet and also how RPCRunLater is implemented.,https://github.com/bitcoin/bitcoin/pull/18487#issuecomment-607954628,607954628,
promag,2020-04-02 16:45:08,"@MarcoFalke the deadlock happens in this case: \n\n- (we are in one of the http thread)\n- walletpassphrase\n- RPCRunLater\n- ~HTTPEvent()\n- event_free()\n- event_del()\n- event_del_(, EVENT_DEL_AUTOBLOCK);\n\nAnd from libevent header\n```\n/** Argument for event_del_nolock_. Tells event_del to block on the event\n * if it is running in another thread and it doesn't have EV_FINALIZE ",https://github.com/bitcoin/bitcoin/pull/18487#issuecomment-607961047,607961047,
promag,2020-04-29 02:57:32,"> > or if this breaks other stuff.\n> \n> I can't see how that could happen. but..\n\n@MarcoFalke but #18811 happened.",https://github.com/bitcoin/bitcoin/pull/18487#issuecomment-620964063,620964063,
MarcoFalke,2020-04-02 15:23:32,Would be nice to add a comment why this scope is needed for `cs_wallet`,https://github.com/bitcoin/bitcoin/pull/18487#discussion_r402400566,402400566,src/wallet/rpcwallet.cpp
promag,2020-04-02 15:25:49,Ok.,https://github.com/bitcoin/bitcoin/pull/18487#discussion_r402402433,402402433,src/wallet/rpcwallet.cpp
MarcoFalke,2020-04-02 15:33:01,"Should this say ""locked"" instead of ""loaded""?",https://github.com/bitcoin/bitcoin/pull/18487#discussion_r402407866,402407866,src/wallet/rpcwallet.cpp
MarcoFalke,2020-04-02 15:34:08,"Why ""currently""? Is there a plan to change this in the future?\n\nAlso, could add a `AssertLockNotHeld(cs_wallet);` to accommodate  the comment?",https://github.com/bitcoin/bitcoin/pull/18487#discussion_r402408647,402408647,src/wallet/rpcwallet.cpp
MarcoFalke,2020-04-02 15:37:09,"Instead of plain hashtag and number, which is hard to quickly look up (especially without internet), what about describing the issue here briefly?",https://github.com/bitcoin/bitcoin/pull/18487#discussion_r402410809,402410809,src/wallet/rpcwallet.cpp
MarcoFalke,2020-04-02 16:08:56,The comment from the pull request description seems suitable,https://github.com/bitcoin/bitcoin/pull/18487#discussion_r402433672,402433672,src/wallet/rpcwallet.cpp
promag,2020-04-02 16:19:25,"No, loaded. This is to handle the case a wallet is unloaded before the timer is triggered.",https://github.com/bitcoin/bitcoin/pull/18487#discussion_r402440776,402440776,src/wallet/rpcwallet.cpp
promag,2020-04-02 16:20:47,"> Why ""currently""? Is there a plan to change this in the future?\n\nNo plans. However I think it could be improved because after the timer stays in `deadlineTimers` after being triggered.",https://github.com/bitcoin/bitcoin/pull/18487#discussion_r402441700,402441700,src/wallet/rpcwallet.cpp
promag,2020-04-02 16:21:04,"> Also, could add a `AssertLockNotHeld(cs_wallet);` to accommodate the comment?\n\nDone.",https://github.com/bitcoin/bitcoin/pull/18487#discussion_r402441861,402441861,src/wallet/rpcwallet.cpp
promag,2020-04-02 16:21:20,Will improve&mix.,https://github.com/bitcoin/bitcoin/pull/18487#discussion_r402442061,402442061,src/wallet/rpcwallet.cpp
