luke-jr,2016-11-27T03:42:53Z,utACK,https://github.com/bitcoin/bitcoin/pull/9227#issuecomment-263100482,263100482,
TheBlueMatt,2016-11-27T03:51:50Z,"If you're gonna touch this, might as well fix it - will it interact negatively with multiwallet support as written? Also, should be easy to make it only exist in walletdb.cpp, I'd think?",https://github.com/bitcoin/bitcoin/pull/9227#issuecomment-263100738,263100738,
laanwj,2016-11-28T07:11:52Z,"> will it interact negatively with multiwallet support as written? \n\nRight - this should probably exist on the CWalletDB object instead of globally, otherwise multiple wallets will react on each other's changes.\n(and then you may not even need an atomic because they will be holding their respective wallet lock)\nThis is not entirely trivial to fix because the 'wallet flush' thread (which II",https://github.com/bitcoin/bitcoin/pull/9227#issuecomment-263198732,263198732,
jonasschnelli,2016-11-28T07:40:25Z,"Agree with @laanwj.\nAlso, #8776 would be a step towards a better – multiwallet safe – wallet flush.",https://github.com/bitcoin/bitcoin/pull/9227#issuecomment-263202760,263202760,
luke-jr,2016-11-28T09:13:11Z,multiwallet makes the flush thread go over all the wallets and flush them all when this is updated. AFAIK extraneous flushing is mostly harmless...?,https://github.com/bitcoin/bitcoin/pull/9227#issuecomment-263219269,263219269,
laanwj,2016-11-28T09:25:35Z,"> multiwallet makes the flush thread go over all the wallets and flush them all when this is updated. AFAIK extraneous flushing is mostly harmless...?\n\nIt's would be a performance sink. Remember the thread is named badly. Our 'flushing' isn't really flushing, it is a full fledged database consolidation.\n\nEdit: so the idea of having a single flush thread visit all wallets is good, but the w",https://github.com/bitcoin/bitcoin/pull/9227#issuecomment-263221967,263221967,
TheBlueMatt,2016-11-28T19:06:15Z,This should probably also move to CScheduler to avoid having Yet Another Thread when we dont need it.,https://github.com/bitcoin/bitcoin/pull/9227#issuecomment-263362527,263362527,
gmaxwell,2016-11-29T20:05:54Z,"The db flush here doesn't really flush a wallet at all, it flushes the whole database environment, so I don't believe it can be made per-wallet.",https://github.com/bitcoin/bitcoin/pull/9227#issuecomment-263683106,263683106,
pstratem,2016-11-30T01:55:24Z,"Indeed this cannot be made per wallet, this is flushing the entire database environment.",https://github.com/bitcoin/bitcoin/pull/9227#issuecomment-263759607,263759607,
jonasschnelli,2016-11-30T08:00:20Z,"Right now we are flushing the DB environment (https://docs.oracle.com/cd/E17276_01/html/api_reference/C/envclose.html) with `DBEnv->CloseDb(filename)`.\nIs there a reason why we wouldn't want to use `DB->Sync()` (https://docs.oracle.com/cd/E17276_01/html/api_reference/C/dbsync.html)?",https://github.com/bitcoin/bitcoin/pull/9227#issuecomment-263807700,263807700,
laanwj,2016-11-30T08:36:44Z,"> Is there a reason why we wouldn't want to use DB->Sync() \n> (https://docs.oracle.com/cd/E17276_01/html/api_reference/C/dbsync.html)?\n\nThe wallet code is set up to *flush* after every (important) write immediately, that's not what the thread is for.\n\nWhat the flush thread does is not really flushing. The method you propose would be a less hassle solution to do flushing, but what the thr",https://github.com/bitcoin/bitcoin/pull/9227#issuecomment-263814145,263814145,
laanwj,2016-11-30T08:37:07Z,"> The db flush here doesn't really flush a wallet at all, it flushes the whole database environment, so I don't believe it can be made per-wallet.\n\nDoesn't every wallet get its own database environment? I guess not.",https://github.com/bitcoin/bitcoin/pull/9227#issuecomment-263814213,263814213,
gmaxwell,2016-11-30T09:04:34Z,"No-- well every database environment needs it's own database directory, cache overheads, etc. So I'm guessing that wouldn't be a great move.",https://github.com/bitcoin/bitcoin/pull/9227#issuecomment-263819874,263819874,
TheBlueMatt,2017-02-03T21:54:06Z,"Can this get an 0.14 tag, since its a simple bugfix?",https://github.com/bitcoin/bitcoin/pull/9227#issuecomment-277372627,277372627,
TheBlueMatt,2017-02-03T21:57:37Z,utACK d63ff6265b0c6ae30efcbb9120d4db419606198a,https://github.com/bitcoin/bitcoin/pull/9227#issuecomment-277373397,277373397,
sipa,2017-02-04T00:44:16Z,utACK d63ff6265b0c6ae30efcbb9120d4db419606198a,https://github.com/bitcoin/bitcoin/pull/9227#issuecomment-277401855,277401855,
TheBlueMatt,2016-12-01T02:39:20Z,nit: move this to the .cpp.,https://github.com/bitcoin/bitcoin/pull/9227#discussion_r90373685,90373685,src/wallet/walletdb.h
pstratem,2016-12-21T21:50:37Z,nit picked,https://github.com/bitcoin/bitcoin/pull/9227#discussion_r93526486,93526486,src/wallet/walletdb.h
TheBlueMatt,2017-02-03T15:39:18Z,Not it wasnt?,https://github.com/bitcoin/bitcoin/pull/9227#discussion_r99360684,99360684,src/wallet/walletdb.h
