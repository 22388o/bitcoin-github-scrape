[
  {
    "sha": "5d1b8f1725f5c65a170feb44d182f9016caa9709",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1ZDFiOGYxNzI1ZjVjNjVhMTcwZmViNDRkMTgyZjkwMTZjYWE5NzA5",
    "commit": {
      "author": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2012-02-01T23:08:03Z"
      },
      "committer": {
        "name": "Gregory Maxwell",
        "email": "greg@xiph.org",
        "date": "2012-02-01T23:08:03Z"
      },
      "message": "Avoid advertising the node's address when it is not listening or IsInitialBlockDownload().\n\nThis also avoids flushing setAddrKnown until 24 hours has passed,\nand avoids contacting the external IP services when not listening.\n\nAdvertising non-listening nodes is just addr message spam.\nIt doesn't help the network, in fact it hurts the network,\nand it also hurts user's privacy.\n\nAdvertising far out of sync nodes doesn't help the network\u2014\nthey can't even forward (most) transactions and wastes nodes\noutbound slots.",
      "tree": {
        "sha": "921eb8d680b726cf4e5f87824470a85f2a5cc355",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/921eb8d680b726cf4e5f87824470a85f2a5cc355"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5d1b8f1725f5c65a170feb44d182f9016caa9709",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5d1b8f1725f5c65a170feb44d182f9016caa9709",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/5d1b8f1725f5c65a170feb44d182f9016caa9709",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5d1b8f1725f5c65a170feb44d182f9016caa9709/comments",
    "author": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "d2291cce9235708f3bc3f95ac1b45164a03cd2ce",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d2291cce9235708f3bc3f95ac1b45164a03cd2ce",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/d2291cce9235708f3bc3f95ac1b45164a03cd2ce"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 8,
      "deletions": 6
    },
    "files": [
      {
        "sha": "f0e5183e983e89424e7dba7a07cfb54137f604d2",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 5,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5d1b8f1725f5c65a170feb44d182f9016caa9709/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5d1b8f1725f5c65a170feb44d182f9016caa9709/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=5d1b8f1725f5c65a170feb44d182f9016caa9709",
        "patch": "@@ -2107,7 +2107,8 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv)\n         if (!pfrom->fInbound)\n         {\n             // Advertise our address\n-            if (addrLocalHost.IsRoutable() && !fUseProxy)\n+            if (!fNoListen && !fUseProxy && addrLocalHost.IsRoutable() &&\n+                !IsInitialBlockDownload())\n             {\n                 CAddress addr(addrLocalHost);\n                 addr.nTime = GetAdjustedTime();\n@@ -2703,25 +2704,26 @@ bool SendMessages(CNode* pto, bool fSendTrickle)\n \n         // Address refresh broadcast\n         static int64 nLastRebroadcast;\n-        if (GetTime() - nLastRebroadcast > 24 * 60 * 60)\n+        if (!IsInitialBlockDownload() && (GetTime() - nLastRebroadcast > 24 * 60 * 60))\n         {\n-            nLastRebroadcast = GetTime();\n             CRITICAL_BLOCK(cs_vNodes)\n             {\n                 BOOST_FOREACH(CNode* pnode, vNodes)\n                 {\n                     // Periodically clear setAddrKnown to allow refresh broadcasts\n-                    pnode->setAddrKnown.clear();\n+                    if (nLastRebroadcast)\n+                        pnode->setAddrKnown.clear();\n \n                     // Rebroadcast our address\n-                    if (addrLocalHost.IsRoutable() && !fUseProxy)\n+                    if (!fNoListen && !fUseProxy && addrLocalHost.IsRoutable())\n                     {\n                         CAddress addr(addrLocalHost);\n                         addr.nTime = GetAdjustedTime();\n                         pnode->PushAddress(addr);\n                     }\n                 }\n             }\n+            nLastRebroadcast = GetTime();\n         }\n \n         // Clear out old addresses periodically so it's not too much work at once"
      },
      {
        "sha": "a7eaaaceb6b69358dbbc5e33a0f3acf7ba73eb1d",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5d1b8f1725f5c65a170feb44d182f9016caa9709/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5d1b8f1725f5c65a170feb44d182f9016caa9709/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=5d1b8f1725f5c65a170feb44d182f9016caa9709",
        "patch": "@@ -141,7 +141,7 @@ bool GetMyExternalIP(CNetAddr& ipRet)\n     const char* pszGet;\n     const char* pszKeyword;\n \n-    if (fUseProxy)\n+    if (fNoListen||fUseProxy)\n         return false;\n \n     for (int nLookup = 0; nLookup <= 1; nLookup++)"
      }
    ]
  }
]