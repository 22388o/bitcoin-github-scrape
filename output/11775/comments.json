[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347317891",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#issuecomment-347317891",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11775",
    "id": 347317891,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NzMxNzg5MQ==",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-27T20:29:59Z",
    "updated_at": "2017-11-27T20:29:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "Obviously this cleans up some of the interface gook from #10286, and adds some more docs that probably could have been there. Next up after this one is moving alll the remaining events all into the background thread, with associated net_processing cleanups in the process.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/347317891/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351547020",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#issuecomment-351547020",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11775",
    "id": 351547020,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTU0NzAyMA==",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-13T22:34:05Z",
    "updated_at": "2017-12-13T22:34:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/351547020/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/352598832",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#issuecomment-352598832",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11775",
    "id": 352598832,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MjU5ODgzMg==",
    "user": {
      "login": "theuni",
      "id": 417043,
      "node_id": "MDQ6VXNlcjQxNzA0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/417043?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theuni",
      "html_url": "https://github.com/theuni",
      "followers_url": "https://api.github.com/users/theuni/followers",
      "following_url": "https://api.github.com/users/theuni/following{/other_user}",
      "gists_url": "https://api.github.com/users/theuni/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theuni/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theuni/subscriptions",
      "organizations_url": "https://api.github.com/users/theuni/orgs",
      "repos_url": "https://api.github.com/users/theuni/repos",
      "events_url": "https://api.github.com/users/theuni/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theuni/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-19T00:13:16Z",
    "updated_at": "2017-12-19T00:13:16Z",
    "author_association": "MEMBER",
    "body": "Concept ACK.\r\n\r\nThough I'm nervous about backgrounding more stuff before safeguarding against outside (unsynchronized) access. For example, the mempool/feeestimator may now be significantly ahead of what the wallet has processed. So calling CreateTransaction when we're in the middle of connecting 10 blocks seems... dangerous, even with the BlockUntilSyncedToCurrentChain hack.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/352598832/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/352602229",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#issuecomment-352602229",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11775",
    "id": 352602229,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MjYwMjIyOQ==",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-19T00:34:39Z",
    "updated_at": "2017-12-19T00:34:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hmm? If anything the fee estimator should be at much lower risk there than for wallet...at worst you'll get out of date fee estimates...something you'd get anyway because you're calling the fee estimator in the middle of syncing stuff. Note that #11824 also keeps the queue depth at no more than 10, though I dont really want to rely on that and would prefer to implement the dump/reload-from-disk proposal suggested at https://github.com/bitcoin/bitcoin/pull/11775/files#diff-e8d9e22d9683f73a9fb8399be0dab640R145",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/352602229/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/376677416",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#issuecomment-376677416",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11775",
    "id": 376677416,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NjY3NzQxNg==",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-27T21:13:25Z",
    "updated_at": "2018-03-27T21:13:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "Rebased.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/376677416/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/380223276",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#issuecomment-380223276",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11775",
    "id": 380223276,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MDIyMzI3Ng==",
    "user": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-10T19:42:46Z",
    "updated_at": "2018-04-10T19:42:46Z",
    "author_association": "MEMBER",
    "body": "I've started reviewing and testing the first few commits in this PR, but I already agree with @jimpo above, that this would be easier to review if it was split up.\r\n\r\nPerhaps we could first have a PR that changed the callback interface around, and then another PR that reworks the fee estimator to take advantage of the new interface?\r\n\r\n(also this needs rebase)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/380223276/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/380658484",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#issuecomment-380658484",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11775",
    "id": 380658484,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MDY1ODQ4NA==",
    "user": {
      "login": "ajtowns",
      "id": 127186,
      "node_id": "MDQ6VXNlcjEyNzE4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/127186?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajtowns",
      "html_url": "https://github.com/ajtowns",
      "followers_url": "https://api.github.com/users/ajtowns/followers",
      "following_url": "https://api.github.com/users/ajtowns/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajtowns/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajtowns/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajtowns/subscriptions",
      "organizations_url": "https://api.github.com/users/ajtowns/orgs",
      "repos_url": "https://api.github.com/users/ajtowns/repos",
      "events_url": "https://api.github.com/users/ajtowns/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajtowns/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-12T02:50:02Z",
    "updated_at": "2018-04-12T02:50:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "ConceptACK for what it's worth, but definitely split this up -- it overflows my mental stack, and both times I've tried to review it it's already had conflicts with master that make a review not crazy useful...\r\n\r\nBreaking out the trivial bits, at least \"Clarify validationinterface notification ordering\" and \"Remove useless scoped (sic?) in AcceptToMemoryPool\" seems like a good first move. Maybe \"Split removeRecursive\" as well. Otherwise just splitting the remaining patches into mempool/validationinterface vs fee-estimation focused seems plausible.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/380658484/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/380822298",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#issuecomment-380822298",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11775",
    "id": 380822298,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MDgyMjI5OA==",
    "user": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?u=71263a00d1269c7f0ed6660aa0c15c894df78a88&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-12T14:20:21Z",
    "updated_at": "2018-04-12T14:20:21Z",
    "author_association": "MEMBER",
    "body": "I haven't looked at the changes but a +700/-600 diff is somewhat intimidating.\r\n\r\nI'd love to help you make progress on this and will happily review PRs that are a subset of this.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/380822298/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/380828696",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#issuecomment-380828696",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11775",
    "id": 380828696,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MDgyODY5Ng==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-12T14:38:21Z",
    "updated_at": "2018-04-12T14:38:21Z",
    "author_association": "MEMBER",
    "body": "Tested ACK.\r\n\r\nI'm kidding :trollface: please please split up \ud83d\udc4d ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/380828696/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/380841918",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#issuecomment-380841918",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11775",
    "id": 380841918,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MDg0MTkxOA==",
    "user": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?u=0691974eedcc2ab5366cc1080fb1c030e87244c2&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-12T15:16:23Z",
    "updated_at": "2018-04-12T15:16:23Z",
    "author_association": "MEMBER",
    "body": "@bugthebluematt ^",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/380841918/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381231388",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#issuecomment-381231388",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/11775",
    "id": 381231388,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MTIzMTM4OA==",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-13T18:59:22Z",
    "updated_at": "2018-04-13T18:59:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "Now based on #12979.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/381231388/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153686716",
    "pull_request_review_id": 79728713,
    "id": 153686716,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE1MzY4NjcxNg==",
    "diff_hunk": "@@ -492,6 +492,8 @@ class CTxMemPool\n \n     std::vector<indexed_transaction_set::const_iterator> GetSortedDepthAndScore() const;\n \n+    void calculateRemoveRecursive(const CTransaction &tx, setEntries &stage);",
    "path": "src/txmempool.h",
    "position": 20,
    "original_position": 4,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "188179e008cd953bf3bd4b651ded54cb6fd60f8d",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "commit: Split removeRecursive into calculate/remove steps\r\n\r\nstyle: Capitalize function name.",
    "created_at": "2017-11-29T03:31:46Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r153686716",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153686716"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r153686716"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/153686716/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 515,
    "original_line": 515,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178595675",
    "pull_request_review_id": 79728713,
    "id": 178595675,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODU5NTY3NQ==",
    "diff_hunk": "@@ -470,11 +470,8 @@ void CTxMemPool::CalculateDescendants(txiter entryit, setEntries &setDescendants\n     }\n }\n \n-void CTxMemPool::removeRecursive(const CTransaction &origTx, MemPoolRemovalReason reason)\n+void CTxMemPool::calculateRemoveRecursive(const CTransaction &origTx, setEntries &setAllRemoves)",
    "path": "src/txmempool.cpp",
    "position": 63,
    "original_position": 5,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f0d6d0bb6b34c18762ab0c30b970875698519f55",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "commit: Split removeRecursive into calculate/remove steps\r\n\r\nShould this AssertLockHeld?",
    "created_at": "2018-04-02T17:23:54Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178595675",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178595675"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178595675"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178595675/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 475,
    "original_line": 475,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178597496",
    "pull_request_review_id": 79728713,
    "id": 178597496,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODU5NzQ5Ng==",
    "diff_hunk": "@@ -551,7 +551,13 @@ void CTxMemPool::removeConflicts(const CTransaction &tx)\n             if (txConflict != tx)\n             {\n                 ClearPrioritisation(txConflict.GetHash());\n-                removeRecursive(txConflict, MemPoolRemovalReason::CONFLICT);\n+                setEntries set_removes;\n+                calculateRemoveRecursive(txConflict, set_removes);\n+                txn_removed.reserve(txn_removed.size() + set_removes.size());",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "b3a9ecb5684cda9a0bb9bb64a9946d5e2b259a8c",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "commit: Track the set of transactions removed/conflicted in removeForBlock\r\n\r\nI think this `reserve` call could be less performant than skipping it if there are a sufficient number of conflicting inputs. https://stackoverflow.com/a/1742961",
    "created_at": "2018-04-02T17:30:57Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178597496",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178597496"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178597496"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178597496/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 556,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178607413",
    "pull_request_review_id": 79728713,
    "id": 178607413,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYwNzQxMw==",
    "diff_hunk": "@@ -1226,7 +1226,16 @@ void CWallet::TransactionRemovedFromMempool(const CTransactionRef &ptx, MemPoolR\n     }\n }\n \n-void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const CBlockIndex *pindex, const std::vector<CTransactionRef>& vtxConflicted) {\n+void CWallet::MempoolUpdatedForBlockConnect(const std::vector<CTransactionRef>& tx_removed_in_block, const std::vector<CTransactionRef>& tx_removed_conflicted) {\n+    LOCK2(cs_main, cs_wallet);\n+    for (const CTransactionRef& ptx : tx_removed_conflicted) {\n+        SyncTransaction(ptx);\n+        TransactionRemovedFromMempool(ptx, MemPoolRemovalReason::CONFLICT);\n+    }\n+    // We can ignore tx_removed_in_block, we'll get it in BlockConnected",
    "path": "src/wallet/wallet.cpp",
    "position": 36,
    "original_position": 11,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "a897ff03aef495d3ede6f11cafc2672563650678",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "commit: BlockConnected(vtxConflicted) -> New MempoolInterface callback\r\n\r\nWhy not just move that logic here from BlockConnected as well?",
    "created_at": "2018-04-02T18:08:13Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178607413",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178607413"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178607413"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178607413/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1258,
    "original_line": 1258,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178609180",
    "pull_request_review_id": 79728713,
    "id": 178609180,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYwOTE4MA==",
    "diff_hunk": "@@ -197,7 +197,8 @@ void Shutdown()\n     // Because these depend on each-other, we make sure that neither can be\n     // using the other before destroying them.\n     if (peerLogic) UnregisterValidationInterface(peerLogic.get());\n-    if (g_connman) g_connman->Stop();\n+    if (peerLogic) UnregisterMempoolInterface(peerLogic.get());\n+    if(g_connman) g_connman->Stop();",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "cd74b8f63a376c5c342a3c35d115b496d05fc64a",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "commit: Add txn_replaced to Added callback, remove lReplaced ATMP arg\r\n\r\nnit: Space after `if`",
    "created_at": "2018-04-02T18:14:45Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178609180",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178609180"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178609180"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178609180/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 201,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178611267",
    "pull_request_review_id": 79728713,
    "id": 178611267,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYxMTI2Nw==",
    "diff_hunk": "@@ -418,8 +418,10 @@ bool CTxMemPool::addUnchecked(const uint256& hash, const CTxMemPoolEntry &entry,\n \n void CTxMemPool::removeUnchecked(txiter it, MemPoolRemovalReason reason)\n {\n-    if (reason != MemPoolRemovalReason::BLOCK && reason != MemPoolRemovalReason::CONFLICT) {\n+    if (reason != MemPoolRemovalReason::BLOCK && reason != MemPoolRemovalReason::CONFLICT &&\n+        reason != MemPoolRemovalReason::REPLACED) {\n         // BLOCK and CONFLICT callbacks are generated in removeForBlock\n+        // REPLACED txn are included in TransactionAddedToMempool from ATMP",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 8,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "cd74b8f63a376c5c342a3c35d115b496d05fc64a",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "commit: Add txn_replaced to Added callback, remove lReplaced ATMP arg\r\n\r\nIt wasn't obvious to me what ATMP stood for. I think it would be better to spell out `AddToMemoryPool` for clarity.",
    "created_at": "2018-04-02T18:23:08Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178611267",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178611267"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178611267"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178611267/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 424,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178615598",
    "pull_request_review_id": 79728713,
    "id": 178615598,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYxNTU5OA==",
    "diff_hunk": "@@ -152,9 +152,9 @@ void CMainSignals::UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockInd\n     });\n }\n \n-void CMainSignals::TransactionAddedToMempool(const CTransactionRef &ptx) {\n-    m_internals->m_schedulerClient.AddToProcessQueue([ptx, this] {\n-        m_internals->TransactionAddedToMempool(ptx);\n+void CMainSignals::TransactionAddedToMempool(const CTransactionRef &ptx, const std::shared_ptr<std::vector<CTransactionRef>>& txn_replaced) {",
    "path": "src/validationinterface.cpp",
    "position": null,
    "original_position": 34,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "cd74b8f63a376c5c342a3c35d115b496d05fc64a",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "commit: Add txn_replaced to Added callback, remove lReplaced ATMP arg\r\n\r\nThis method takes a `std::shared_ptr` while `MempoolUpdatedForBlockConnect` takes rvalue refs and constructs the `std::shared_ptr`s itself. I think these should be consistent.",
    "created_at": "2018-04-02T18:39:47Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178615598",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178615598"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178615598"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178615598/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 155,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178617351",
    "pull_request_review_id": 79728713,
    "id": 178617351,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYxNzM1MQ==",
    "diff_hunk": "@@ -70,6 +70,28 @@ void SyncWithValidationInterfaceQueue();\n  * called on the thread generating the callbacks.\n  */\n class MempoolInterface {\n+public:\n+    /**\n+     * Information about a newly-added-to-mempool transaction.\n+     */\n+    struct NewMempoolTransactionInfo {\n+        //!A shared pointer to the transaction which was added.\n+        CTransactionRef m_tx;\n+        //! The fee the added thransaction paid",
    "path": "src/validationinterface.h",
    "position": null,
    "original_position": 11,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f54c193f920cfa8ade3b65dab72ddd09f6eda697",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "commit: Make fee estimation not need CTxMemPoolEntry is block processing\r\n\r\ntypo: thransaction",
    "created_at": "2018-04-02T18:46:53Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178617351",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178617351"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178617351"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178617351/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 80,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178617393",
    "pull_request_review_id": 79728713,
    "id": 178617393,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYxNzM5Mw==",
    "diff_hunk": "@@ -70,6 +70,28 @@ void SyncWithValidationInterfaceQueue();\n  * called on the thread generating the callbacks.\n  */\n class MempoolInterface {\n+public:\n+    /**\n+     * Information about a newly-added-to-mempool transaction.\n+     */\n+    struct NewMempoolTransactionInfo {\n+        //!A shared pointer to the transaction which was added.",
    "path": "src/validationinterface.h",
    "position": null,
    "original_position": 9,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f54c193f920cfa8ade3b65dab72ddd09f6eda697",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "commit: Make fee estimation not need CTxMemPoolEntry is block processing\r\n\r\nnit: space after bang",
    "created_at": "2018-04-02T18:47:07Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178617393",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178617393"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178617393"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178617393/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 78,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178617924",
    "pull_request_review_id": 79728713,
    "id": 178617924,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYxNzkyNA==",
    "diff_hunk": "@@ -599,6 +589,7 @@ void CTxMemPool::removeForBlock(const std::vector<CTransactionRef>& vtx, unsigne\n         removeConflicts(*tx, txn_conflicts);\n         ClearPrioritisation(tx->GetHash());\n     }\n+    if (minerPolicyEstimator) {minerPolicyEstimator->processBlock(nBlockHeight, txn_removed_in_block);}",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 32,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f54c193f920cfa8ade3b65dab72ddd09f6eda697",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "commit: Make fee estimation not need CTxMemPoolEntry is block processing\r\n\r\nnit: Remove braces or move statement body onto newline.",
    "created_at": "2018-04-02T18:49:24Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178617924",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178617924"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178617924"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178617924/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 592,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178618284",
    "pull_request_review_id": 79728713,
    "id": 178618284,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYxODI4NA==",
    "diff_hunk": "@@ -443,7 +443,8 @@ void CTxMemPool::removeUnchecked(txiter it, MemPoolRemovalReason reason)\n     mapLinks.erase(it);\n     mapTx.erase(it);\n     nTransactionsUpdated++;\n-    if (minerPolicyEstimator) {minerPolicyEstimator->removeTx(hash, false);}\n+    if (reason != MemPoolRemovalReason::BLOCK && minerPolicyEstimator) {\n+        minerPolicyEstimator->removeTx(hash);}",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f54c193f920cfa8ade3b65dab72ddd09f6eda697",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "commit: Make fee estimation not need CTxMemPoolEntry is block processing\r\n\r\nnit: Move closing brace onto newline.",
    "created_at": "2018-04-02T18:50:52Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178618284",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178618284"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178618284"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178618284/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 447,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178618859",
    "pull_request_review_id": 79728713,
    "id": 178618859,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYxODg1OQ==",
    "diff_hunk": "@@ -504,20 +505,24 @@ void TxConfirmStats::removeTx(unsigned int entryHeight, unsigned int nBestSeenHe\n     }\n }\n \n+void CBlockPolicyEstimator::removeTx(std::map<uint256, TxStatsInfo>::iterator pos, bool inBlock) {",
    "path": "src/policy/fees.cpp",
    "position": null,
    "original_position": 25,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f54c193f920cfa8ade3b65dab72ddd09f6eda697",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "commit: Make fee estimation not need CTxMemPoolEntry is block processing\r\n\r\nstyle: s/inBlock/in_block/",
    "created_at": "2018-04-02T18:53:07Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178618859",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178618859"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178618859"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178618859/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 508,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178620537",
    "pull_request_review_id": 79728713,
    "id": 178620537,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYyMDUzNw==",
    "diff_hunk": "@@ -185,20 +186,30 @@ class CBlockPolicyEstimator\n      */\n     static constexpr double FEE_SPACING = 1.05;\n \n+    struct TxStatsInfo",
    "path": "src/policy/fees.h",
    "position": 25,
    "original_position": 12,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f54c193f920cfa8ade3b65dab72ddd09f6eda697",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "commit: Make fee estimation not need CTxMemPoolEntry is block processing\r\n\r\nAny particular reason to move this up here rather than leave it in the second `private` section where it is now?",
    "created_at": "2018-04-02T18:59:34Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178620537",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178620537"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178620537"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178620537/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 191,
    "original_line": 191,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178622043",
    "pull_request_review_id": 79728713,
    "id": 178622043,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYyMjA0Mw==",
    "diff_hunk": "@@ -577,43 +582,45 @@ void CBlockPolicyEstimator::processTransaction(const CTxMemPoolEntry& entry, boo\n     CFeeRate feeRate(entry.GetFee(), entry.GetTxSize());\n \n     mapMemPoolTxs[hash].blockHeight = txHeight;\n+    mapMemPoolTxs[hash].m_fee_per_k = feeRate.GetFeePerK();\n     unsigned int bucketIndex = feeStats->NewTx(txHeight, (double)feeRate.GetFeePerK());\n-    mapMemPoolTxs[hash].bucketIndex = bucketIndex;\n     unsigned int bucketIndex2 = shortStats->NewTx(txHeight, (double)feeRate.GetFeePerK());\n     assert(bucketIndex == bucketIndex2);\n     unsigned int bucketIndex3 = longStats->NewTx(txHeight, (double)feeRate.GetFeePerK());\n     assert(bucketIndex == bucketIndex3);\n }\n \n-bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTxMemPoolEntry* entry)\n+bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const uint256& hash)\n {\n-    if (!removeTx(entry->GetTx().GetHash(), true)) {\n+    std::map<uint256, TxStatsInfo>::iterator pos = mapMemPoolTxs.find(hash);\n+    if (pos == mapMemPoolTxs.end()) {\n         // This transaction wasn't being tracked for fee estimation\n         return false;\n     }\n+    removeTx(pos, true);\n \n     // How many blocks did it take for miners to include this transaction?\n     // blocksToConfirm is 1-based, so a transaction included in the earliest\n     // possible block has confirmation count of 1\n-    int blocksToConfirm = nBlockHeight - entry->GetHeight();\n+    int blocksToConfirm = nBlockHeight - pos->second.blockHeight;\n     if (blocksToConfirm <= 0) {\n         // This can't happen because we don't process transactions from a block with a height\n         // lower than our greatest seen height\n         LogPrint(BCLog::ESTIMATEFEE, \"Blockpolicy error Transaction had negative blocksToConfirm\\n\");\n+        mapMemPoolTxs.erase(pos);\n         return false;\n     }\n \n-    // Feerates are stored and reported as BTC-per-kb:\n-    CFeeRate feeRate(entry->GetFee(), entry->GetTxSize());\n+    feeStats->Record(blocksToConfirm, (double)pos->second.m_fee_per_k);\n+    shortStats->Record(blocksToConfirm, (double)pos->second.m_fee_per_k);\n+    longStats->Record(blocksToConfirm, (double)pos->second.m_fee_per_k);\n \n-    feeStats->Record(blocksToConfirm, (double)feeRate.GetFeePerK());\n-    shortStats->Record(blocksToConfirm, (double)feeRate.GetFeePerK());\n-    longStats->Record(blocksToConfirm, (double)feeRate.GetFeePerK());\n+    mapMemPoolTxs.erase(pos);",
    "path": "src/policy/fees.cpp",
    "position": 153,
    "original_position": 97,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f54c193f920cfa8ade3b65dab72ddd09f6eda697",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "commit: Make fee estimation not need CTxMemPoolEntry is block processing\r\n\r\nI'd move this erase immediately after the `removeTx` above and define `double fee_per_k = (double)pos->second.m_fee_per_k;` as a variable up there as well.",
    "created_at": "2018-04-02T19:06:06Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178622043",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178622043"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178622043"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178622043/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 616,
    "original_line": 616,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178623164",
    "pull_request_review_id": 79728713,
    "id": 178623164,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYyMzE2NA==",
    "diff_hunk": "@@ -185,20 +186,30 @@ class CBlockPolicyEstimator\n      */\n     static constexpr double FEE_SPACING = 1.05;\n \n+    struct TxStatsInfo\n+    {\n+        unsigned int blockHeight;\n+        CAmount m_fee_per_k;\n+        TxStatsInfo() : blockHeight(0), m_fee_per_k(0) {}\n+    };\n+\n+    /** Remove a transaction from the mempool tracking stats*/\n+    void removeTx(std::map<uint256, TxStatsInfo>::iterator pos, bool inBlock);",
    "path": "src/policy/fees.h",
    "position": 34,
    "original_position": 20,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f54c193f920cfa8ade3b65dab72ddd09f6eda697",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "commit: Make fee estimation not need CTxMemPoolEntry is block processing\r\n\r\nI don't really like that this method has the same name as the other `removeTx` because it's responsibilities are different.",
    "created_at": "2018-04-02T19:11:06Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178623164",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178623164"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178623164"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178623164/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 200,
    "original_line": 200,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178636650",
    "pull_request_review_id": 79728713,
    "id": 178636650,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYzNjY1MA==",
    "diff_hunk": "@@ -580,13 +581,20 @@ void CBlockPolicyEstimator::TransactionRemovedFromMempool(const CTransactionRef\n     removeTxNotInBlock(tx->GetHash());\n }\n \n-bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const uint256& hash)\n+bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTransactionRef& tx)\n {\n-    std::map<uint256, TxStatsInfo>::iterator pos = mapMemPoolTxs.find(hash);\n+    std::map<uint256, TxStatsInfo>::iterator pos = mapMemPoolTxs.find(tx->GetHash());\n     if (pos == mapMemPoolTxs.end()) {\n         // This transaction wasn't being tracked for fee estimation\n         return false;\n     }\n+    if (pos->second.witness_hash != tx->GetWitnessHash()) {\n+        // In the case that we saw a tx which had its witness malleated,",
    "path": "src/policy/fees.cpp",
    "position": 123,
    "original_position": 22,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "68d7445e2350b1f3cd8ad0bc79bd06c79c23ad00",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "commit: Track witness hash malleation in fee estimator\r\n\r\nWhy don't we want to record the blocks to confirm in this case?",
    "created_at": "2018-04-02T20:10:45Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178636650",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178636650"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178636650"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178636650/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 592,
    "original_line": 592,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178639530",
    "pull_request_review_id": 79728713,
    "id": 178639530,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYzOTUzMA==",
    "diff_hunk": "@@ -77,6 +84,13 @@ BOOST_AUTO_TEST_CASE(BlockPolicyEstimates)\n         block.clear();\n         // Check after just a few txs that combining buckets works as expected\n         if (blocknum == 3) {\n+            // Wait for fee estimator to catch up",
    "path": "src/test/policyestimator_tests.cpp",
    "position": 41,
    "original_position": 40,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "9266c936b747e564859275165e5e12983ed56301",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "commit: Process fee estimates in the background via MempoolInterface\r\n\r\nUse SyncWithValidationInterfaceQueue?",
    "created_at": "2018-04-02T20:22:18Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178639530",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178639530"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178639530"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178639530/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 87,
    "original_line": 87,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178639756",
    "pull_request_review_id": 79728713,
    "id": 178639756,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3ODYzOTc1Ng==",
    "diff_hunk": "@@ -196,20 +197,18 @@ class CBlockPolicyEstimator\n     /** Remove a transaction from the mempool tracking stats*/\n     void removeTx(std::map<uint256, TxStatsInfo>::iterator pos, bool inBlock);\n \n+    /** Helper method to quickly remove transactions that left mempool without going in a block */\n+    void removeTxNotInBlock(const uint256& hash);\n+\n public:\n     /** Create new BlockPolicyEstimator and initialize stats tracking classes with default values */\n     CBlockPolicyEstimator();\n     ~CBlockPolicyEstimator();\n \n-    /** Process all the transactions that have been included in a block */\n-    void processBlock(unsigned int nBlockHeight,\n-                      const std::vector<CTransactionRef>& txn_removed_in_block);\n-\n-    /** Process a transaction accepted to the mempool*/\n-    void processTransaction(const CTxMemPoolEntry& entry, bool validFeeEstimate);\n-\n-    /** Remove a transaction from the mempool tracking stats*/\n-    bool removeTx(uint256 hash);\n+    // MempoolInterface functions:\n+    void TransactionAddedToMempool(const NewMempoolTransactionInfo& info, const std::vector<CTransactionRef>& txn_replaced) override;",
    "path": "src/policy/fees.h",
    "position": null,
    "original_position": 39,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "9266c936b747e564859275165e5e12983ed56301",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "commit: Process fee estimates in the background via MempoolInterface\r\n\r\nMake the callbacks protected?",
    "created_at": "2018-04-02T20:23:09Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178639756",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178639756"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r178639756"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/178639756/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 207,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550906",
    "pull_request_review_id": 109816870,
    "id": 179550906,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTU1MDkwNg==",
    "diff_hunk": "@@ -196,20 +197,18 @@ class CBlockPolicyEstimator\n     /** Remove a transaction from the mempool tracking stats*/\n     void removeTx(std::map<uint256, TxStatsInfo>::iterator pos, bool inBlock);\n \n+    /** Helper method to quickly remove transactions that left mempool without going in a block */\n+    void removeTxNotInBlock(const uint256& hash);\n+\n public:\n     /** Create new BlockPolicyEstimator and initialize stats tracking classes with default values */\n     CBlockPolicyEstimator();\n     ~CBlockPolicyEstimator();\n \n-    /** Process all the transactions that have been included in a block */\n-    void processBlock(unsigned int nBlockHeight,\n-                      const std::vector<CTransactionRef>& txn_removed_in_block);\n-\n-    /** Process a transaction accepted to the mempool*/\n-    void processTransaction(const CTxMemPoolEntry& entry, bool validFeeEstimate);\n-\n-    /** Remove a transaction from the mempool tracking stats*/\n-    bool removeTx(uint256 hash);\n+    // MempoolInterface functions:\n+    void TransactionAddedToMempool(const NewMempoolTransactionInfo& info, const std::vector<CTransactionRef>& txn_replaced) override;",
    "path": "src/policy/fees.h",
    "position": null,
    "original_position": 39,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "9266c936b747e564859275165e5e12983ed56301",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed.",
    "created_at": "2018-04-05T18:02:29Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550906",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550906"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550906"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550906/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 207,
    "side": "RIGHT",
    "in_reply_to_id": 178639756
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550914",
    "pull_request_review_id": 109816876,
    "id": 179550914,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTU1MDkxNA==",
    "diff_hunk": "@@ -77,6 +84,13 @@ BOOST_AUTO_TEST_CASE(BlockPolicyEstimates)\n         block.clear();\n         // Check after just a few txs that combining buckets works as expected\n         if (blocknum == 3) {\n+            // Wait for fee estimator to catch up",
    "path": "src/test/policyestimator_tests.cpp",
    "position": 41,
    "original_position": 40,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "9266c936b747e564859275165e5e12983ed56301",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This was written before that existed. Fixed.",
    "created_at": "2018-04-05T18:02:30Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550914",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550914"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550914"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550914/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 87,
    "original_line": 87,
    "side": "RIGHT",
    "in_reply_to_id": 178639530
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550928",
    "pull_request_review_id": 109816881,
    "id": 179550928,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTU1MDkyOA==",
    "diff_hunk": "@@ -580,13 +581,20 @@ void CBlockPolicyEstimator::TransactionRemovedFromMempool(const CTransactionRef\n     removeTxNotInBlock(tx->GetHash());\n }\n \n-bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const uint256& hash)\n+bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTransactionRef& tx)\n {\n-    std::map<uint256, TxStatsInfo>::iterator pos = mapMemPoolTxs.find(hash);\n+    std::map<uint256, TxStatsInfo>::iterator pos = mapMemPoolTxs.find(tx->GetHash());\n     if (pos == mapMemPoolTxs.end()) {\n         // This transaction wasn't being tracked for fee estimation\n         return false;\n     }\n+    if (pos->second.witness_hash != tx->GetWitnessHash()) {\n+        // In the case that we saw a tx which had its witness malleated,",
    "path": "src/policy/fees.cpp",
    "position": 123,
    "original_position": 22,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "68d7445e2350b1f3cd8ad0bc79bd06c79c23ad00",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Because we don't know how long its been around/it waited.",
    "created_at": "2018-04-05T18:02:30Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550928",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550928"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550928"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550928/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 592,
    "original_line": 592,
    "side": "RIGHT",
    "in_reply_to_id": 178636650
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550944",
    "pull_request_review_id": 109816897,
    "id": 179550944,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTU1MDk0NA==",
    "diff_hunk": "@@ -185,20 +186,30 @@ class CBlockPolicyEstimator\n      */\n     static constexpr double FEE_SPACING = 1.05;\n \n+    struct TxStatsInfo\n+    {\n+        unsigned int blockHeight;\n+        CAmount m_fee_per_k;\n+        TxStatsInfo() : blockHeight(0), m_fee_per_k(0) {}\n+    };\n+\n+    /** Remove a transaction from the mempool tracking stats*/\n+    void removeTx(std::map<uint256, TxStatsInfo>::iterator pos, bool inBlock);",
    "path": "src/policy/fees.h",
    "position": 34,
    "original_position": 20,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f54c193f920cfa8ade3b65dab72ddd09f6eda697",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Happy to rename it, but honestly I dont remember what the different responsibilities are. Its been so long since I wrote this I dont know how it works anymore. Any suggestions?",
    "created_at": "2018-04-05T18:02:32Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550944",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550944"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550944"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550944/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 200,
    "original_line": 200,
    "side": "RIGHT",
    "in_reply_to_id": 178623164
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550956",
    "pull_request_review_id": 109816907,
    "id": 179550956,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTU1MDk1Ng==",
    "diff_hunk": "@@ -577,43 +582,45 @@ void CBlockPolicyEstimator::processTransaction(const CTxMemPoolEntry& entry, boo\n     CFeeRate feeRate(entry.GetFee(), entry.GetTxSize());\n \n     mapMemPoolTxs[hash].blockHeight = txHeight;\n+    mapMemPoolTxs[hash].m_fee_per_k = feeRate.GetFeePerK();\n     unsigned int bucketIndex = feeStats->NewTx(txHeight, (double)feeRate.GetFeePerK());\n-    mapMemPoolTxs[hash].bucketIndex = bucketIndex;\n     unsigned int bucketIndex2 = shortStats->NewTx(txHeight, (double)feeRate.GetFeePerK());\n     assert(bucketIndex == bucketIndex2);\n     unsigned int bucketIndex3 = longStats->NewTx(txHeight, (double)feeRate.GetFeePerK());\n     assert(bucketIndex == bucketIndex3);\n }\n \n-bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTxMemPoolEntry* entry)\n+bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const uint256& hash)\n {\n-    if (!removeTx(entry->GetTx().GetHash(), true)) {\n+    std::map<uint256, TxStatsInfo>::iterator pos = mapMemPoolTxs.find(hash);\n+    if (pos == mapMemPoolTxs.end()) {\n         // This transaction wasn't being tracked for fee estimation\n         return false;\n     }\n+    removeTx(pos, true);\n \n     // How many blocks did it take for miners to include this transaction?\n     // blocksToConfirm is 1-based, so a transaction included in the earliest\n     // possible block has confirmation count of 1\n-    int blocksToConfirm = nBlockHeight - entry->GetHeight();\n+    int blocksToConfirm = nBlockHeight - pos->second.blockHeight;\n     if (blocksToConfirm <= 0) {\n         // This can't happen because we don't process transactions from a block with a height\n         // lower than our greatest seen height\n         LogPrint(BCLog::ESTIMATEFEE, \"Blockpolicy error Transaction had negative blocksToConfirm\\n\");\n+        mapMemPoolTxs.erase(pos);\n         return false;\n     }\n \n-    // Feerates are stored and reported as BTC-per-kb:\n-    CFeeRate feeRate(entry->GetFee(), entry->GetTxSize());\n+    feeStats->Record(blocksToConfirm, (double)pos->second.m_fee_per_k);\n+    shortStats->Record(blocksToConfirm, (double)pos->second.m_fee_per_k);\n+    longStats->Record(blocksToConfirm, (double)pos->second.m_fee_per_k);\n \n-    feeStats->Record(blocksToConfirm, (double)feeRate.GetFeePerK());\n-    shortStats->Record(blocksToConfirm, (double)feeRate.GetFeePerK());\n-    longStats->Record(blocksToConfirm, (double)feeRate.GetFeePerK());\n+    mapMemPoolTxs.erase(pos);",
    "path": "src/policy/fees.cpp",
    "position": 153,
    "original_position": 97,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f54c193f920cfa8ade3b65dab72ddd09f6eda697",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Would also need to copy blockHeight as well, at which point you'd just be copying the whole struct so that you can remove it.",
    "created_at": "2018-04-05T18:02:33Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550956",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550956"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550956"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550956/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 616,
    "original_line": 616,
    "side": "RIGHT",
    "in_reply_to_id": 178622043
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550962",
    "pull_request_review_id": 109816912,
    "id": 179550962,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTU1MDk2Mg==",
    "diff_hunk": "@@ -185,20 +186,30 @@ class CBlockPolicyEstimator\n      */\n     static constexpr double FEE_SPACING = 1.05;\n \n+    struct TxStatsInfo",
    "path": "src/policy/fees.h",
    "position": 25,
    "original_position": 12,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f54c193f920cfa8ade3b65dab72ddd09f6eda697",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Probably just a change in code between when I wrote this and now.",
    "created_at": "2018-04-05T18:02:34Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550962",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550962"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550962"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550962/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 191,
    "original_line": 191,
    "side": "RIGHT",
    "in_reply_to_id": 178620537
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550965",
    "pull_request_review_id": 109816914,
    "id": 179550965,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTU1MDk2NQ==",
    "diff_hunk": "@@ -504,20 +505,24 @@ void TxConfirmStats::removeTx(unsigned int entryHeight, unsigned int nBestSeenHe\n     }\n }\n \n+void CBlockPolicyEstimator::removeTx(std::map<uint256, TxStatsInfo>::iterator pos, bool inBlock) {",
    "path": "src/policy/fees.cpp",
    "position": null,
    "original_position": 25,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f54c193f920cfa8ade3b65dab72ddd09f6eda697",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed.",
    "created_at": "2018-04-05T18:02:36Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550965",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550965"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550965"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550965/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 508,
    "side": "RIGHT",
    "in_reply_to_id": 178618859
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550967",
    "pull_request_review_id": 109816918,
    "id": 179550967,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTU1MDk2Nw==",
    "diff_hunk": "@@ -443,7 +443,8 @@ void CTxMemPool::removeUnchecked(txiter it, MemPoolRemovalReason reason)\n     mapLinks.erase(it);\n     mapTx.erase(it);\n     nTransactionsUpdated++;\n-    if (minerPolicyEstimator) {minerPolicyEstimator->removeTx(hash, false);}\n+    if (reason != MemPoolRemovalReason::BLOCK && minerPolicyEstimator) {\n+        minerPolicyEstimator->removeTx(hash);}",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f54c193f920cfa8ade3b65dab72ddd09f6eda697",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed.",
    "created_at": "2018-04-05T18:02:36Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550967",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550967"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550967"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550967/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 447,
    "side": "RIGHT",
    "in_reply_to_id": 178618284
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550974",
    "pull_request_review_id": 109816927,
    "id": 179550974,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTU1MDk3NA==",
    "diff_hunk": "@@ -599,6 +589,7 @@ void CTxMemPool::removeForBlock(const std::vector<CTransactionRef>& vtx, unsigne\n         removeConflicts(*tx, txn_conflicts);\n         ClearPrioritisation(tx->GetHash());\n     }\n+    if (minerPolicyEstimator) {minerPolicyEstimator->processBlock(nBlockHeight, txn_removed_in_block);}",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 32,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f54c193f920cfa8ade3b65dab72ddd09f6eda697",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed.",
    "created_at": "2018-04-05T18:02:38Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550974",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550974"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550974"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550974/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 592,
    "side": "RIGHT",
    "in_reply_to_id": 178617924
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550986",
    "pull_request_review_id": 109816935,
    "id": 179550986,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTU1MDk4Ng==",
    "diff_hunk": "@@ -70,6 +70,28 @@ void SyncWithValidationInterfaceQueue();\n  * called on the thread generating the callbacks.\n  */\n class MempoolInterface {\n+public:\n+    /**\n+     * Information about a newly-added-to-mempool transaction.\n+     */\n+    struct NewMempoolTransactionInfo {\n+        //!A shared pointer to the transaction which was added.",
    "path": "src/validationinterface.h",
    "position": null,
    "original_position": 9,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f54c193f920cfa8ade3b65dab72ddd09f6eda697",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed.",
    "created_at": "2018-04-05T18:02:39Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550986",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550986"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550986"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550986/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 78,
    "side": "RIGHT",
    "in_reply_to_id": 178617393
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550992",
    "pull_request_review_id": 109816944,
    "id": 179550992,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTU1MDk5Mg==",
    "diff_hunk": "@@ -70,6 +70,28 @@ void SyncWithValidationInterfaceQueue();\n  * called on the thread generating the callbacks.\n  */\n class MempoolInterface {\n+public:\n+    /**\n+     * Information about a newly-added-to-mempool transaction.\n+     */\n+    struct NewMempoolTransactionInfo {\n+        //!A shared pointer to the transaction which was added.\n+        CTransactionRef m_tx;\n+        //! The fee the added thransaction paid",
    "path": "src/validationinterface.h",
    "position": null,
    "original_position": 11,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f54c193f920cfa8ade3b65dab72ddd09f6eda697",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed.",
    "created_at": "2018-04-05T18:02:41Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550992",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550992"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550992"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550992/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 80,
    "side": "RIGHT",
    "in_reply_to_id": 178617351
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550993",
    "pull_request_review_id": 109816947,
    "id": 179550993,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTU1MDk5Mw==",
    "diff_hunk": "@@ -152,9 +152,9 @@ void CMainSignals::UpdatedBlockTip(const CBlockIndex *pindexNew, const CBlockInd\n     });\n }\n \n-void CMainSignals::TransactionAddedToMempool(const CTransactionRef &ptx) {\n-    m_internals->m_schedulerClient.AddToProcessQueue([ptx, this] {\n-        m_internals->TransactionAddedToMempool(ptx);\n+void CMainSignals::TransactionAddedToMempool(const CTransactionRef &ptx, const std::shared_ptr<std::vector<CTransactionRef>>& txn_replaced) {",
    "path": "src/validationinterface.cpp",
    "position": null,
    "original_position": 34,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "cd74b8f63a376c5c342a3c35d115b496d05fc64a",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Obviousy avoiding the move is a bit more performant, hence its use here. The use of the move in MempoolUpdatedForBlockConnect was to reduce diff size.",
    "created_at": "2018-04-05T18:02:42Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550993",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550993"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550993"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550993/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 155,
    "side": "RIGHT",
    "in_reply_to_id": 178615598
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550998",
    "pull_request_review_id": 109816953,
    "id": 179550998,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTU1MDk5OA==",
    "diff_hunk": "@@ -418,8 +418,10 @@ bool CTxMemPool::addUnchecked(const uint256& hash, const CTxMemPoolEntry &entry,\n \n void CTxMemPool::removeUnchecked(txiter it, MemPoolRemovalReason reason)\n {\n-    if (reason != MemPoolRemovalReason::BLOCK && reason != MemPoolRemovalReason::CONFLICT) {\n+    if (reason != MemPoolRemovalReason::BLOCK && reason != MemPoolRemovalReason::CONFLICT &&\n+        reason != MemPoolRemovalReason::REPLACED) {\n         // BLOCK and CONFLICT callbacks are generated in removeForBlock\n+        // REPLACED txn are included in TransactionAddedToMempool from ATMP",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 8,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "cd74b8f63a376c5c342a3c35d115b496d05fc64a",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done.",
    "created_at": "2018-04-05T18:02:42Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550998",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550998"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179550998"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179550998/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 424,
    "side": "RIGHT",
    "in_reply_to_id": 178611267
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179551004",
    "pull_request_review_id": 109816959,
    "id": 179551004,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTU1MTAwNA==",
    "diff_hunk": "@@ -197,7 +197,8 @@ void Shutdown()\n     // Because these depend on each-other, we make sure that neither can be\n     // using the other before destroying them.\n     if (peerLogic) UnregisterValidationInterface(peerLogic.get());\n-    if (g_connman) g_connman->Stop();\n+    if (peerLogic) UnregisterMempoolInterface(peerLogic.get());\n+    if(g_connman) g_connman->Stop();",
    "path": "src/init.cpp",
    "position": null,
    "original_position": 6,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "cd74b8f63a376c5c342a3c35d115b496d05fc64a",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Fixed.",
    "created_at": "2018-04-05T18:02:44Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179551004",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179551004"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179551004"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179551004/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 201,
    "side": "RIGHT",
    "in_reply_to_id": 178609180
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179551005",
    "pull_request_review_id": 109816963,
    "id": 179551005,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTU1MTAwNQ==",
    "diff_hunk": "@@ -1226,7 +1226,16 @@ void CWallet::TransactionRemovedFromMempool(const CTransactionRef &ptx, MemPoolR\n     }\n }\n \n-void CWallet::BlockConnected(const std::shared_ptr<const CBlock>& pblock, const CBlockIndex *pindex, const std::vector<CTransactionRef>& vtxConflicted) {\n+void CWallet::MempoolUpdatedForBlockConnect(const std::vector<CTransactionRef>& tx_removed_in_block, const std::vector<CTransactionRef>& tx_removed_conflicted) {\n+    LOCK2(cs_main, cs_wallet);\n+    for (const CTransactionRef& ptx : tx_removed_conflicted) {\n+        SyncTransaction(ptx);\n+        TransactionRemovedFromMempool(ptx, MemPoolRemovalReason::CONFLICT);\n+    }\n+    // We can ignore tx_removed_in_block, we'll get it in BlockConnected",
    "path": "src/wallet/wallet.cpp",
    "position": 36,
    "original_position": 11,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "a897ff03aef495d3ede6f11cafc2672563650678",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Because we still need it in BlockConnected - there may be txn that weren't in our mempool that got confirmed, so copying it would be useless.",
    "created_at": "2018-04-05T18:02:44Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179551005",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179551005"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179551005"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179551005/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 1258,
    "original_line": 1258,
    "side": "RIGHT",
    "in_reply_to_id": 178607413
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179551014",
    "pull_request_review_id": 109816974,
    "id": 179551014,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTU1MTAxNA==",
    "diff_hunk": "@@ -551,7 +551,13 @@ void CTxMemPool::removeConflicts(const CTransaction &tx)\n             if (txConflict != tx)\n             {\n                 ClearPrioritisation(txConflict.GetHash());\n-                removeRecursive(txConflict, MemPoolRemovalReason::CONFLICT);\n+                setEntries set_removes;\n+                calculateRemoveRecursive(txConflict, set_removes);\n+                txn_removed.reserve(txn_removed.size() + set_removes.size());",
    "path": "src/txmempool.cpp",
    "position": null,
    "original_position": 16,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "b3a9ecb5684cda9a0bb9bb64a9946d5e2b259a8c",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Good catch. Removed.",
    "created_at": "2018-04-05T18:02:46Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179551014",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179551014"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179551014"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179551014/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 556,
    "side": "RIGHT",
    "in_reply_to_id": 178597496
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179551017",
    "pull_request_review_id": 109816979,
    "id": 179551017,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTU1MTAxNw==",
    "diff_hunk": "@@ -470,11 +470,8 @@ void CTxMemPool::CalculateDescendants(txiter entryit, setEntries &setDescendants\n     }\n }\n \n-void CTxMemPool::removeRecursive(const CTransaction &origTx, MemPoolRemovalReason reason)\n+void CTxMemPool::calculateRemoveRecursive(const CTransaction &origTx, setEntries &setAllRemoves)",
    "path": "src/txmempool.cpp",
    "position": 63,
    "original_position": 5,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f0d6d0bb6b34c18762ab0c30b970875698519f55",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done (bonus: also fixed the whitespace issues in that commit).",
    "created_at": "2018-04-05T18:02:46Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179551017",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179551017"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179551017"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179551017/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 475,
    "original_line": 475,
    "side": "RIGHT",
    "in_reply_to_id": 178595675
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179551028",
    "pull_request_review_id": 109816990,
    "id": 179551028,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTU1MTAyOA==",
    "diff_hunk": "@@ -492,6 +492,8 @@ class CTxMemPool\n \n     std::vector<indexed_transaction_set::const_iterator> GetSortedDepthAndScore() const;\n \n+    void calculateRemoveRecursive(const CTransaction &tx, setEntries &stage);",
    "path": "src/txmempool.h",
    "position": 20,
    "original_position": 4,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "188179e008cd953bf3bd4b651ded54cb6fd60f8d",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "This PR was created long before the introduction of that part of the style guide, so it matches the capitalization of removeRecursive.",
    "created_at": "2018-04-05T18:02:48Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179551028",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179551028"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179551028"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179551028/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 515,
    "original_line": 515,
    "side": "RIGHT",
    "in_reply_to_id": 153686716
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179636457",
    "pull_request_review_id": 109919902,
    "id": 179636457,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTYzNjQ1Nw==",
    "diff_hunk": "@@ -185,20 +186,30 @@ class CBlockPolicyEstimator\n      */\n     static constexpr double FEE_SPACING = 1.05;\n \n+    struct TxStatsInfo\n+    {\n+        unsigned int blockHeight;\n+        CAmount m_fee_per_k;\n+        TxStatsInfo() : blockHeight(0), m_fee_per_k(0) {}\n+    };\n+\n+    /** Remove a transaction from the mempool tracking stats*/\n+    void removeTx(std::map<uint256, TxStatsInfo>::iterator pos, bool inBlock);",
    "path": "src/policy/fees.h",
    "position": 34,
    "original_position": 20,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f54c193f920cfa8ade3b65dab72ddd09f6eda697",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Actually, it's fine leaving this one as is because in the later commit (Process fee estimates in the background via MempoolInterface), the other `removeTx` gets renamed to `removeTxNotInBlock`.\r\n\r\nNot really necessary, but maybe rename the other function to `removeTxNotInBlock` in this commit instead of a later commit to avoid the confusion here.",
    "created_at": "2018-04-06T00:41:27Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179636457",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179636457"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179636457"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179636457/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 200,
    "original_line": 200,
    "side": "RIGHT",
    "in_reply_to_id": 178623164
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179636911",
    "pull_request_review_id": 109920383,
    "id": 179636911,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTYzNjkxMQ==",
    "diff_hunk": "@@ -577,43 +582,45 @@ void CBlockPolicyEstimator::processTransaction(const CTxMemPoolEntry& entry, boo\n     CFeeRate feeRate(entry.GetFee(), entry.GetTxSize());\n \n     mapMemPoolTxs[hash].blockHeight = txHeight;\n+    mapMemPoolTxs[hash].m_fee_per_k = feeRate.GetFeePerK();\n     unsigned int bucketIndex = feeStats->NewTx(txHeight, (double)feeRate.GetFeePerK());\n-    mapMemPoolTxs[hash].bucketIndex = bucketIndex;\n     unsigned int bucketIndex2 = shortStats->NewTx(txHeight, (double)feeRate.GetFeePerK());\n     assert(bucketIndex == bucketIndex2);\n     unsigned int bucketIndex3 = longStats->NewTx(txHeight, (double)feeRate.GetFeePerK());\n     assert(bucketIndex == bucketIndex3);\n }\n \n-bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTxMemPoolEntry* entry)\n+bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const uint256& hash)\n {\n-    if (!removeTx(entry->GetTx().GetHash(), true)) {\n+    std::map<uint256, TxStatsInfo>::iterator pos = mapMemPoolTxs.find(hash);\n+    if (pos == mapMemPoolTxs.end()) {\n         // This transaction wasn't being tracked for fee estimation\n         return false;\n     }\n+    removeTx(pos, true);\n \n     // How many blocks did it take for miners to include this transaction?\n     // blocksToConfirm is 1-based, so a transaction included in the earliest\n     // possible block has confirmation count of 1\n-    int blocksToConfirm = nBlockHeight - entry->GetHeight();\n+    int blocksToConfirm = nBlockHeight - pos->second.blockHeight;\n     if (blocksToConfirm <= 0) {\n         // This can't happen because we don't process transactions from a block with a height\n         // lower than our greatest seen height\n         LogPrint(BCLog::ESTIMATEFEE, \"Blockpolicy error Transaction had negative blocksToConfirm\\n\");\n+        mapMemPoolTxs.erase(pos);\n         return false;\n     }\n \n-    // Feerates are stored and reported as BTC-per-kb:\n-    CFeeRate feeRate(entry->GetFee(), entry->GetTxSize());\n+    feeStats->Record(blocksToConfirm, (double)pos->second.m_fee_per_k);\n+    shortStats->Record(blocksToConfirm, (double)pos->second.m_fee_per_k);\n+    longStats->Record(blocksToConfirm, (double)pos->second.m_fee_per_k);\n \n-    feeStats->Record(blocksToConfirm, (double)feeRate.GetFeePerK());\n-    shortStats->Record(blocksToConfirm, (double)feeRate.GetFeePerK());\n-    longStats->Record(blocksToConfirm, (double)feeRate.GetFeePerK());\n+    mapMemPoolTxs.erase(pos);",
    "path": "src/policy/fees.cpp",
    "position": 153,
    "original_position": 97,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "f54c193f920cfa8ade3b65dab72ddd09f6eda697",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yeah, I think copying the struct for the sake of simplifying the control flow (by only erasing in one place) is actually good. Also would just make it more readable to have a descriptive variable name like `tx_info` instead of `pos->second`.",
    "created_at": "2018-04-06T00:45:20Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179636911",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179636911"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179636911"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179636911/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 616,
    "original_line": 616,
    "side": "RIGHT",
    "in_reply_to_id": 178622043
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179887104",
    "pull_request_review_id": 110222360,
    "id": 179887104,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTg4NzEwNA==",
    "diff_hunk": "@@ -580,13 +581,20 @@ void CBlockPolicyEstimator::TransactionRemovedFromMempool(const CTransactionRef\n     removeTxNotInBlock(tx->GetHash());\n }\n \n-bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const uint256& hash)\n+bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTransactionRef& tx)\n {\n-    std::map<uint256, TxStatsInfo>::iterator pos = mapMemPoolTxs.find(hash);\n+    std::map<uint256, TxStatsInfo>::iterator pos = mapMemPoolTxs.find(tx->GetHash());\n     if (pos == mapMemPoolTxs.end()) {\n         // This transaction wasn't being tracked for fee estimation\n         return false;\n     }\n+    if (pos->second.witness_hash != tx->GetWitnessHash()) {\n+        // In the case that we saw a tx which had its witness malleated,",
    "path": "src/policy/fees.cpp",
    "position": 123,
    "original_position": 22,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "68d7445e2350b1f3cd8ad0bc79bd06c79c23ad00",
    "user": {
      "login": "jimpo",
      "id": 881253,
      "node_id": "MDQ6VXNlcjg4MTI1Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/881253?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimpo",
      "html_url": "https://github.com/jimpo",
      "followers_url": "https://api.github.com/users/jimpo/followers",
      "following_url": "https://api.github.com/users/jimpo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimpo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimpo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimpo/subscriptions",
      "organizations_url": "https://api.github.com/users/jimpo/orgs",
      "repos_url": "https://api.github.com/users/jimpo/repos",
      "events_url": "https://api.github.com/users/jimpo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimpo/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "I don't understand. We have the record of when the tx entered the mempool (albeit with different witness data). How does the malleated witness change things?",
    "created_at": "2018-04-06T22:08:14Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179887104",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179887104"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179887104"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179887104/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 592,
    "original_line": 592,
    "side": "RIGHT",
    "in_reply_to_id": 178636650
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179919250",
    "pull_request_review_id": 110258087,
    "id": 179919250,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE3OTkxOTI1MA==",
    "diff_hunk": "@@ -580,13 +581,20 @@ void CBlockPolicyEstimator::TransactionRemovedFromMempool(const CTransactionRef\n     removeTxNotInBlock(tx->GetHash());\n }\n \n-bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const uint256& hash)\n+bool CBlockPolicyEstimator::processBlockTx(unsigned int nBlockHeight, const CTransactionRef& tx)\n {\n-    std::map<uint256, TxStatsInfo>::iterator pos = mapMemPoolTxs.find(hash);\n+    std::map<uint256, TxStatsInfo>::iterator pos = mapMemPoolTxs.find(tx->GetHash());\n     if (pos == mapMemPoolTxs.end()) {\n         // This transaction wasn't being tracked for fee estimation\n         return false;\n     }\n+    if (pos->second.witness_hash != tx->GetWitnessHash()) {\n+        // In the case that we saw a tx which had its witness malleated,",
    "path": "src/policy/fees.cpp",
    "position": 123,
    "original_position": 22,
    "commit_id": "6697c02f7d5f99847b6e134fa48b51e4f1fe85b3",
    "original_commit_id": "68d7445e2350b1f3cd8ad0bc79bd06c79c23ad00",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Because clearly there was a propagation issue. We dont know whether the lower-feerate version (or some other version) was the one most miners saw or the higher-feerate version. Better to just ignore it.",
    "created_at": "2018-04-07T15:16:53Z",
    "updated_at": "2018-05-02T18:15:14Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179919250",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179919250"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/11775#discussion_r179919250"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/11775"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/179919250/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 592,
    "original_line": 592,
    "side": "RIGHT",
    "in_reply_to_id": 178636650
  }
]