[
  {
    "sha": "75400a2a413c082de2ba5fc2f1da9dc86fd1d924",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3NTQwMGEyYTQxM2MwODJkZTJiYTVmYzJmMWRhOWRjODZmZDFkOTI0",
    "commit": {
      "author": {
        "name": "Jeff Garzik",
        "email": "jgarzik@bitpay.com",
        "date": "2014-08-24T05:18:24Z"
      },
      "committer": {
        "name": "Jeff Garzik",
        "email": "jgarzik@bitpay.com",
        "date": "2014-08-24T05:18:24Z"
      },
      "message": "contrib/linearize: Guarantee that output is generated in-order\n\nThis was typically ensured implicitly by virtue of normal bitcoind\noperation.  Adding an explicit check provides a stronger guarantee, and\nit is cheap to add.",
      "tree": {
        "sha": "92da0c937a5428e1d7ae18de34085d352f73d6ae",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/92da0c937a5428e1d7ae18de34085d352f73d6ae"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/75400a2a413c082de2ba5fc2f1da9dc86fd1d924",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/75400a2a413c082de2ba5fc2f1da9dc86fd1d924",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/75400a2a413c082de2ba5fc2f1da9dc86fd1d924",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/75400a2a413c082de2ba5fc2f1da9dc86fd1d924/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "087eb43cff13e3ba3cc34f047acaab861f723204",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/087eb43cff13e3ba3cc34f047acaab861f723204",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/087eb43cff13e3ba3cc34f047acaab861f723204"
      }
    ],
    "stats": {
      "total": 6,
      "additions": 6,
      "deletions": 0
    },
    "files": [
      {
        "sha": "2d57d245f65418ddcd38f9ad754dd1bf292aa5f7",
        "filename": "contrib/linearize/linearize-data.py",
        "status": "modified",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/75400a2a413c082de2ba5fc2f1da9dc86fd1d924/contrib/linearize/linearize-data.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/75400a2a413c082de2ba5fc2f1da9dc86fd1d924/contrib/linearize/linearize-data.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/linearize/linearize-data.py?ref=75400a2a413c082de2ba5fc2f1da9dc86fd1d924",
        "patch": "@@ -125,6 +125,12 @@ def copydata(settings, blkindex, blkset):\n \t\t\tprint(\"Skipping unknown block \" + hash_str)\n \t\t\tcontinue\n \n+\t\tif blkindex[blkCount] != hash_str:\n+\t\t\tprint(\"Out of order block.\")\n+\t\t\tprint(\"Expected \" + blkindex[blkCount])\n+\t\t\tprint(\"Got \" + hash_str)\n+\t\t\tsys.exit(1)\n+\n \t\tif not fileOutput and ((outsz + inLen) > maxOutSz):\n \t\t\toutF.close()\n \t\t\toutF = None"
      }
    ]
  },
  {
    "sha": "8f5a423344b277fbb63eb4295ce5928e16c6dc9d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4ZjVhNDIzMzQ0YjI3N2ZiYjYzZWI0Mjk1Y2U1OTI4ZTE2YzZkYzlk",
    "commit": {
      "author": {
        "name": "Jeff Garzik",
        "email": "jgarzik@bitpay.com",
        "date": "2014-08-24T05:40:40Z"
      },
      "committer": {
        "name": "Jeff Garzik",
        "email": "jgarzik@bitpay.com",
        "date": "2014-08-24T05:40:40Z"
      },
      "message": "contrib/linearize: split block files based on year-month, not just year",
      "tree": {
        "sha": "f6da162742a3e8bd7f7007d28874cb2db757f026",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f6da162742a3e8bd7f7007d28874cb2db757f026"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8f5a423344b277fbb63eb4295ce5928e16c6dc9d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8f5a423344b277fbb63eb4295ce5928e16c6dc9d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/8f5a423344b277fbb63eb4295ce5928e16c6dc9d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8f5a423344b277fbb63eb4295ce5928e16c6dc9d/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "75400a2a413c082de2ba5fc2f1da9dc86fd1d924",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/75400a2a413c082de2ba5fc2f1da9dc86fd1d924",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/75400a2a413c082de2ba5fc2f1da9dc86fd1d924"
      }
    ],
    "stats": {
      "total": 29,
      "additions": 15,
      "deletions": 14
    },
    "files": [
      {
        "sha": "3a4c9759fe479051eecc8d115162522ce8bf64a5",
        "filename": "contrib/linearize/linearize-data.py",
        "status": "modified",
        "additions": 15,
        "deletions": 14,
        "changes": 29,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8f5a423344b277fbb63eb4295ce5928e16c6dc9d/contrib/linearize/linearize-data.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8f5a423344b277fbb63eb4295ce5928e16c6dc9d/contrib/linearize/linearize-data.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/linearize/linearize-data.py?ref=8f5a423344b277fbb63eb4295ce5928e16c6dc9d",
        "patch": "@@ -58,10 +58,11 @@ def calc_hash_str(blk_hdr):\n \thash_str = hash.encode('hex')\n \treturn hash_str\n \n-def get_blk_year(blk_hdr):\n+def get_blk_dt(blk_hdr):\n \tmembers = struct.unpack(\"<I\", blk_hdr[68:68+4])\n \tdt = datetime.datetime.fromtimestamp(members[0])\n-\treturn dt.year\n+\tdt_ym = datetime.datetime(dt.year, dt.month, 1)\n+\treturn dt_ym\n \n def get_block_hashes(settings):\n \tblkindex = []\n@@ -88,14 +89,14 @@ def copydata(settings, blkindex, blkset):\n \toutF = None\n \tblkCount = 0\n \n-\tlastYear = 0\n-\tsplitYear = False\n+\tlastDate = datetime.datetime(2000, 1, 1)\n+\ttimestampSplit = False\n \tfileOutput = True\n \tmaxOutSz = settings['max_out_sz']\n \tif 'output' in settings:\n \t\tfileOutput = False\n-\tif settings['split_year'] != 0:\n-\t\tsplitYear = True\n+\tif settings['split_timestamp'] != 0:\n+\t\ttimestampSplit = True\n \n \twhile True:\n \t\tif not inF:\n@@ -137,11 +138,11 @@ def copydata(settings, blkindex, blkset):\n \t\t\toutFn = outFn + 1\n \t\t\toutsz = 0\n \n-\t\tif splitYear:\n-\t\t\tblkYear = get_blk_year(blk_hdr)\n-\t\t\tif blkYear > lastYear:\n-\t\t\t\tprint(\"New year \" + str(blkYear) + \" @ \" + hash_str)\n-\t\t\t\tlastYear = blkYear\n+\t\tif timestampSplit:\n+\t\t\tblkDate = get_blk_dt(blk_hdr)\n+\t\t\tif blkDate > lastDate:\n+\t\t\t\tprint(\"New month \" + blkDate.strftime(\"%Y-%m\") + \" @ \" + hash_str)\n+\t\t\t\tlastDate = blkDate\n \t\t\t\tif outF:\n \t\t\t\t\toutF.close()\n \t\t\t\t\toutF = None\n@@ -190,13 +191,13 @@ def copydata(settings, blkindex, blkset):\n \t\tsettings['input'] = 'input'\n \tif 'hashlist' not in settings:\n \t\tsettings['hashlist'] = 'hashlist.txt'\n-\tif 'split_year' not in settings:\n-\t\tsettings['split_year'] = 0\n+\tif 'split_timestamp' not in settings:\n+\t\tsettings['split_timestamp'] = 0\n \tif 'max_out_sz' not in settings:\n \t\tsettings['max_out_sz'] = 1000L * 1000 * 1000\n \n \tsettings['max_out_sz'] = long(settings['max_out_sz'])\n-\tsettings['split_year'] = int(settings['split_year'])\n+\tsettings['split_timestamp'] = int(settings['split_timestamp'])\n \tsettings['netmagic'] = settings['netmagic'].decode('hex')\n \n \tif 'output_file' not in settings and 'output' not in settings:"
      }
    ]
  },
  {
    "sha": "4bb61b45359b98632c64fca2f3640d276ab75244",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0YmI2MWI0NTM1OWI5ODYzMmM2NGZjYTJmMzY0MGQyNzZhYjc1MjQ0",
    "commit": {
      "author": {
        "name": "Jeff Garzik",
        "email": "jgarzik@bitpay.com",
        "date": "2014-08-24T15:37:14Z"
      },
      "committer": {
        "name": "Jeff Garzik",
        "email": "jgarzik@bitpay.com",
        "date": "2014-08-24T15:37:14Z"
      },
      "message": "contrib/linearize: Add feature to set file's timestamp\nbased on block header time.",
      "tree": {
        "sha": "fdb9145c3fc65b5fa5866a8a597c432a962c5686",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/fdb9145c3fc65b5fa5866a8a597c432a962c5686"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/4bb61b45359b98632c64fca2f3640d276ab75244",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4bb61b45359b98632c64fca2f3640d276ab75244",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/4bb61b45359b98632c64fca2f3640d276ab75244",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4bb61b45359b98632c64fca2f3640d276ab75244/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "8f5a423344b277fbb63eb4295ce5928e16c6dc9d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8f5a423344b277fbb63eb4295ce5928e16c6dc9d",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/8f5a423344b277fbb63eb4295ce5928e16c6dc9d"
      }
    ],
    "stats": {
      "total": 55,
      "additions": 37,
      "deletions": 18
    },
    "files": [
      {
        "sha": "9e1eccaeb5f52990343aab11f05f395861e32ada",
        "filename": "contrib/linearize/README.md",
        "status": "modified",
        "additions": 3,
        "deletions": 2,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4bb61b45359b98632c64fca2f3640d276ab75244/contrib/linearize/README.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4bb61b45359b98632c64fca2f3640d276ab75244/contrib/linearize/README.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/linearize/README.md?ref=4bb61b45359b98632c64fca2f3640d276ab75244",
        "patch": "@@ -27,6 +27,7 @@ output.\n Optional config file setting for linearize-data:\n * \"netmagic\": network magic number\n * \"max_out_sz\": maximum output file size (default 1000*1000*1000)\n-* \"split_year\": Split files when a new year is first seen, in addition to\n+* \"split_timestamp\": Split files when a new year is first seen, in addition to\n reaching a maximum file size.\n-\n+* \"file_timestamp\": Set each file's last-modified time to that of the\n+most recent block in that file."
      },
      {
        "sha": "383bb38198a705e7e7bf397622970a8e49323bef",
        "filename": "contrib/linearize/linearize-data.py",
        "status": "modified",
        "additions": 34,
        "deletions": 16,
        "changes": 50,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/4bb61b45359b98632c64fca2f3640d276ab75244/contrib/linearize/linearize-data.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/4bb61b45359b98632c64fca2f3640d276ab75244/contrib/linearize/linearize-data.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/linearize/linearize-data.py?ref=4bb61b45359b98632c64fca2f3640d276ab75244",
        "patch": "@@ -10,11 +10,13 @@\n import json\n import struct\n import re\n+import os\n import base64\n import httplib\n import sys\n import hashlib\n import datetime\n+import time\n \n settings = {}\n \n@@ -60,9 +62,10 @@ def calc_hash_str(blk_hdr):\n \n def get_blk_dt(blk_hdr):\n \tmembers = struct.unpack(\"<I\", blk_hdr[68:68+4])\n-\tdt = datetime.datetime.fromtimestamp(members[0])\n+\tnTime = members[0]\n+\tdt = datetime.datetime.fromtimestamp(nTime)\n \tdt_ym = datetime.datetime(dt.year, dt.month, 1)\n-\treturn dt_ym\n+\treturn (dt_ym, nTime)\n \n def get_block_hashes(settings):\n \tblkindex = []\n@@ -87,14 +90,19 @@ def copydata(settings, blkindex, blkset):\n \toutFn = 0\n \toutsz = 0\n \toutF = None\n+\toutFname = None\n \tblkCount = 0\n \n \tlastDate = datetime.datetime(2000, 1, 1)\n+\thighTS = 1408893517 - 315360000\n \ttimestampSplit = False\n \tfileOutput = True\n+\tsetFileTime = False\n \tmaxOutSz = settings['max_out_sz']\n \tif 'output' in settings:\n \t\tfileOutput = False\n+\tif settings['file_timestamp'] != 0:\n+\t\tsetFileTime = True\n \tif settings['split_timestamp'] != 0:\n \t\ttimestampSplit = True\n \n@@ -134,34 +142,41 @@ def copydata(settings, blkindex, blkset):\n \n \t\tif not fileOutput and ((outsz + inLen) > maxOutSz):\n \t\t\toutF.close()\n+\t\t\tif setFileTime:\n+\t\t\t\tos.utime(outFname, (int(time.time()), highTS))\n \t\t\toutF = None\n+\t\t\toutFname = None\n \t\t\toutFn = outFn + 1\n \t\t\toutsz = 0\n \n-\t\tif timestampSplit:\n-\t\t\tblkDate = get_blk_dt(blk_hdr)\n-\t\t\tif blkDate > lastDate:\n-\t\t\t\tprint(\"New month \" + blkDate.strftime(\"%Y-%m\") + \" @ \" + hash_str)\n-\t\t\t\tlastDate = blkDate\n-\t\t\t\tif outF:\n-\t\t\t\t\toutF.close()\n-\t\t\t\t\toutF = None\n-\t\t\t\t\toutFn = outFn + 1\n-\t\t\t\t\toutsz = 0\n+\t\t(blkDate, blkTS) = get_blk_dt(blk_hdr)\n+\t\tif timestampSplit and (blkDate > lastDate):\n+\t\t\tprint(\"New month \" + blkDate.strftime(\"%Y-%m\") + \" @ \" + hash_str)\n+\t\t\tlastDate = blkDate\n+\t\t\tif outF:\n+\t\t\t\toutF.close()\n+\t\t\t\tif setFileTime:\n+\t\t\t\t\tos.utime(outFname, (int(time.time()), highTS))\n+\t\t\t\toutF = None\n+\t\t\t\toutFname = None\n+\t\t\t\toutFn = outFn + 1\n+\t\t\t\toutsz = 0\n \n \t\tif not outF:\n \t\t\tif fileOutput:\n-\t\t\t\tfname = settings['output_file']\n+\t\t\t\toutFname = settings['output_file']\n \t\t\telse:\n-\t\t\t\tfname = \"%s/blk%05d.dat\" % (settings['output'], outFn)\n-\t\t\tprint(\"Output file\" + fname)\n-\t\t\toutF = open(fname, \"wb\")\n+\t\t\t\toutFname = \"%s/blk%05d.dat\" % (settings['output'], outFn)\n+\t\t\tprint(\"Output file\" + outFname)\n+\t\t\toutF = open(outFname, \"wb\")\n \n \t\toutF.write(inhdr)\n \t\toutF.write(rawblock)\n \t\toutsz = outsz + inLen + 8\n \n \t\tblkCount = blkCount + 1\n+\t\tif blkTS > highTS:\n+\t\t\thighTS = blkTS\n \n \t\tif (blkCount % 1000) == 0:\n \t\t\tprint(\"Wrote \" + str(blkCount) + \" blocks\")\n@@ -191,13 +206,16 @@ def copydata(settings, blkindex, blkset):\n \t\tsettings['input'] = 'input'\n \tif 'hashlist' not in settings:\n \t\tsettings['hashlist'] = 'hashlist.txt'\n+\tif 'file_timestamp' not in settings:\n+\t\tsettings['file_timestamp'] = 0\n \tif 'split_timestamp' not in settings:\n \t\tsettings['split_timestamp'] = 0\n \tif 'max_out_sz' not in settings:\n \t\tsettings['max_out_sz'] = 1000L * 1000 * 1000\n \n \tsettings['max_out_sz'] = long(settings['max_out_sz'])\n \tsettings['split_timestamp'] = int(settings['split_timestamp'])\n+\tsettings['file_timestamp'] = int(settings['file_timestamp'])\n \tsettings['netmagic'] = settings['netmagic'].decode('hex')\n \n \tif 'output_file' not in settings and 'output' not in settings:"
      }
    ]
  }
]