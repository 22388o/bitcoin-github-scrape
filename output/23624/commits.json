[
  {
    "sha": "52c477e97f84a6d838bd5715a8c3574e7b49ec8c",
    "node_id": "C_kwDOABII59oAKDUyYzQ3N2U5N2Y4NGE2ZDgzOGJkNTcxNWE4YzM1NzRlN2I0OWVjOGM",
    "commit": {
      "author": {
        "name": "0xb10c",
        "email": "0xb10c@gmail.com",
        "date": "2021-11-29T09:00:00Z"
      },
      "committer": {
        "name": "0xb10c",
        "email": "0xb10c@gmail.com",
        "date": "2021-11-29T09:00:00Z"
      },
      "message": "zmq: add rawmempooltx publisher\n\nThe rawtx ZMQ publisher publishes transactions added to the mempool\nand transactions in blocks. Often transactions are published multiple\ntimes. Some applications only want to subscribe to mempool\ntransactions.",
      "tree": {
        "sha": "ffd81cf8c365193d387956020537486633fe2d39",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ffd81cf8c365193d387956020537486633fe2d39"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/52c477e97f84a6d838bd5715a8c3574e7b49ec8c",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCgAdFiEEDMuq/Xai7OLM0xQd4v/VsdiMqX0FAmGklysACgkQ4v/VsdiM\nqX1wkw//cMUrTFwZdgK8qDu6+u+QO8pgKj1fJU6pN3+Hlz+YT6QD/7PROiZwR3fF\nFzWgXVor3Itp6u9f5ERHSBE2PslVVs+MbSDpnHEzfs4F4X8NqdsH/QjvtBWfpjnV\npUY9CpOS4PmJHnWNhbGdUM8884Rt9Ktwyl7jK7VsBYWlmbMcDvpEonZ9n17cUmxe\nItLBzEGKrABjaR1YE0kvm5lmw2KFh/lwYKZFW2wDdeuMcb/khY3TDn8Sm3f7o3wQ\nLVOCfc20eHB3ykVxf/MX8s8xWI6xQy4vQ44Qq7d+K+j09vnF2z/FRMpcUYajZcZ9\nK/cNAaKEDmdkpcMynbZuH3qGxXmxBeUNhUYFjU1tjzNIEJzsrBoP2refNUeZ/v4W\ncIgmP1505NqPsdTRh2w1IwRaUFYLh9JdptxB1OHkj6pm7z9JQd2uojbOY5Ywo3sE\n58iHcpNBvixSilKnIcPYQ17kKQE8/JnjlGROXeWs6gLVNCP9gfwItU8aV7/Pjych\nzhvyS1HRVLznOMEZgWPXy8A0UUBFsExEbAkG51DA6db6wjW1qT8xi3BOEDy5ZxPP\nOyn1vSfsu0qxz4CzVGI4ENU8UeX+upj501oi5hQUcmt9gv7ZHk8aRs1Vbru611Yc\nlUz8FmMj05bdbC7DUn2uBHslrWsnu8v2USIRWZB9Caordu7Fn1M=\n=uaMd\n-----END PGP SIGNATURE-----",
        "payload": "tree ffd81cf8c365193d387956020537486633fe2d39\nparent 23ae7931be50376fa6bda692c641a3d2538556ee\nauthor 0xb10c <0xb10c@gmail.com> 1638176400 +0100\ncommitter 0xb10c <0xb10c@gmail.com> 1638176400 +0100\n\nzmq: add rawmempooltx publisher\n\nThe rawtx ZMQ publisher publishes transactions added to the mempool\nand transactions in blocks. Often transactions are published multiple\ntimes. Some applications only want to subscribe to mempool\ntransactions.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/52c477e97f84a6d838bd5715a8c3574e7b49ec8c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/52c477e97f84a6d838bd5715a8c3574e7b49ec8c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/52c477e97f84a6d838bd5715a8c3574e7b49ec8c/comments",
    "author": {
      "login": "0xB10C",
      "id": 19157360,
      "node_id": "MDQ6VXNlcjE5MTU3MzYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xB10C",
      "html_url": "https://github.com/0xB10C",
      "followers_url": "https://api.github.com/users/0xB10C/followers",
      "following_url": "https://api.github.com/users/0xB10C/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xB10C/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
      "organizations_url": "https://api.github.com/users/0xB10C/orgs",
      "repos_url": "https://api.github.com/users/0xB10C/repos",
      "events_url": "https://api.github.com/users/0xB10C/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xB10C/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "0xB10C",
      "id": 19157360,
      "node_id": "MDQ6VXNlcjE5MTU3MzYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/19157360?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xB10C",
      "html_url": "https://github.com/0xB10C",
      "followers_url": "https://api.github.com/users/0xB10C/followers",
      "following_url": "https://api.github.com/users/0xB10C/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xB10C/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xB10C/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xB10C/subscriptions",
      "organizations_url": "https://api.github.com/users/0xB10C/orgs",
      "repos_url": "https://api.github.com/users/0xB10C/repos",
      "events_url": "https://api.github.com/users/0xB10C/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xB10C/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "23ae7931be50376fa6bda692c641a3d2538556ee",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/23ae7931be50376fa6bda692c641a3d2538556ee",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/23ae7931be50376fa6bda692c641a3d2538556ee"
      }
    ],
    "stats": {
      "total": 35,
      "additions": 34,
      "deletions": 1
    },
    "files": [
      {
        "sha": "b581a1593bee6f39b532759eefa6f7483b678cde",
        "filename": "contrib/zmq/zmq_sub.py",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/52c477e97f84a6d838bd5715a8c3574e7b49ec8c/contrib/zmq/zmq_sub.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/52c477e97f84a6d838bd5715a8c3574e7b49ec8c/contrib/zmq/zmq_sub.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/contrib/zmq/zmq_sub.py?ref=52c477e97f84a6d838bd5715a8c3574e7b49ec8c",
        "patch": "@@ -9,6 +9,7 @@\n     Bitcoin should be started with the command line arguments:\n         bitcoind -testnet -daemon \\\n                 -zmqpubrawtx=tcp://127.0.0.1:28332 \\\n+                -zmqpubrawmempooltx=tcp://127.0.0.1:28332 \\\n                 -zmqpubrawblock=tcp://127.0.0.1:28332 \\\n                 -zmqpubhashtx=tcp://127.0.0.1:28332 \\\n                 -zmqpubhashblock=tcp://127.0.0.1:28332 \\\n@@ -47,6 +48,7 @@ def __init__(self):\n         self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"hashtx\")\n         self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"rawblock\")\n         self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"rawtx\")\n+        self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"rawmempooltx\")\n         self.zmqSubSocket.setsockopt_string(zmq.SUBSCRIBE, \"sequence\")\n         self.zmqSubSocket.connect(\"tcp://127.0.0.1:%i\" % port)\n \n@@ -67,6 +69,9 @@ async def handle(self) :\n         elif topic == b\"rawtx\":\n             print('- RAW TX ('+sequence+') -')\n             print(body.hex())\n+        elif topic == b\"rawmempooltx\":\n+            print('- RAW MEMPOOL TX ('+sequence+') -')\n+            print(body.hex())\n         elif topic == b\"sequence\":\n             hash = body[:32].hex()\n             label = chr(body[32])"
      },
      {
        "sha": "7863f63ef82488bbd25be2d06ee026e4358f28ae",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/52c477e97f84a6d838bd5715a8c3574e7b49ec8c/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/52c477e97f84a6d838bd5715a8c3574e7b49ec8c/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=52c477e97f84a6d838bd5715a8c3574e7b49ec8c",
        "patch": "@@ -481,22 +481,26 @@ void SetupServerArgs(ArgsManager& argsman)\n     argsman.AddArg(\"-zmqpubhashtx=<address>\", \"Enable publish hash transaction in <address>\", ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);\n     argsman.AddArg(\"-zmqpubrawblock=<address>\", \"Enable publish raw block in <address>\", ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);\n     argsman.AddArg(\"-zmqpubrawtx=<address>\", \"Enable publish raw transaction in <address>\", ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);\n+    argsman.AddArg(\"-zmqpubrawmempooltx=<address>\", \"Enable publish raw mempool transaction in <address>\", ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);\n     argsman.AddArg(\"-zmqpubsequence=<address>\", \"Enable publish hash block and tx sequence in <address>\", ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);\n     argsman.AddArg(\"-zmqpubhashblockhwm=<n>\", strprintf(\"Set publish hash block outbound message high water mark (default: %d)\", CZMQAbstractNotifier::DEFAULT_ZMQ_SNDHWM), ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);\n     argsman.AddArg(\"-zmqpubhashtxhwm=<n>\", strprintf(\"Set publish hash transaction outbound message high water mark (default: %d)\", CZMQAbstractNotifier::DEFAULT_ZMQ_SNDHWM), ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);\n     argsman.AddArg(\"-zmqpubrawblockhwm=<n>\", strprintf(\"Set publish raw block outbound message high water mark (default: %d)\", CZMQAbstractNotifier::DEFAULT_ZMQ_SNDHWM), ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);\n     argsman.AddArg(\"-zmqpubrawtxhwm=<n>\", strprintf(\"Set publish raw transaction outbound message high water mark (default: %d)\", CZMQAbstractNotifier::DEFAULT_ZMQ_SNDHWM), ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);\n+    argsman.AddArg(\"-zmqpubrawmempooltxhwm=<n>\", strprintf(\"Set publish raw mempool transaction outbound message high water mark (default: %d)\", CZMQAbstractNotifier::DEFAULT_ZMQ_SNDHWM), ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);\n     argsman.AddArg(\"-zmqpubsequencehwm=<n>\", strprintf(\"Set publish hash sequence message high water mark (default: %d)\", CZMQAbstractNotifier::DEFAULT_ZMQ_SNDHWM), ArgsManager::ALLOW_ANY, OptionsCategory::ZMQ);\n #else\n     hidden_args.emplace_back(\"-zmqpubhashblock=<address>\");\n     hidden_args.emplace_back(\"-zmqpubhashtx=<address>\");\n     hidden_args.emplace_back(\"-zmqpubrawblock=<address>\");\n     hidden_args.emplace_back(\"-zmqpubrawtx=<address>\");\n+    hidden_args.emplace_back(\"-zmqpubrawmempooltx=<address>\");\n     hidden_args.emplace_back(\"-zmqpubsequence=<n>\");\n     hidden_args.emplace_back(\"-zmqpubhashblockhwm=<n>\");\n     hidden_args.emplace_back(\"-zmqpubhashtxhwm=<n>\");\n     hidden_args.emplace_back(\"-zmqpubrawblockhwm=<n>\");\n     hidden_args.emplace_back(\"-zmqpubrawtxhwm=<n>\");\n+    hidden_args.emplace_back(\"-zmqpubrawmempooltxhwm=<n>\");\n     hidden_args.emplace_back(\"-zmqpubsequencehwm=<n>\");\n #endif\n "
      },
      {
        "sha": "e8e152f7a36a30c5f3d5ab2e9dc526a10f78952a",
        "filename": "src/zmq/zmqabstractnotifier.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/52c477e97f84a6d838bd5715a8c3574e7b49ec8c/src/zmq/zmqabstractnotifier.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/52c477e97f84a6d838bd5715a8c3574e7b49ec8c/src/zmq/zmqabstractnotifier.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/zmq/zmqabstractnotifier.cpp?ref=52c477e97f84a6d838bd5715a8c3574e7b49ec8c",
        "patch": "@@ -23,6 +23,11 @@ bool CZMQAbstractNotifier::NotifyTransaction(const CTransaction &/*transaction*/\n     return true;\n }\n \n+bool CZMQAbstractNotifier::NotifyMempoolTransaction(const CTransaction &/*transaction*/)\n+{\n+    return true;\n+}\n+\n bool CZMQAbstractNotifier::NotifyBlockConnect(const CBlockIndex * /*CBlockIndex*/)\n {\n     return true;"
      },
      {
        "sha": "91d26f9b31f725b10a68e22720f7c5c35714ee46",
        "filename": "src/zmq/zmqabstractnotifier.h",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/52c477e97f84a6d838bd5715a8c3574e7b49ec8c/src/zmq/zmqabstractnotifier.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/52c477e97f84a6d838bd5715a8c3574e7b49ec8c/src/zmq/zmqabstractnotifier.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/zmq/zmqabstractnotifier.h?ref=52c477e97f84a6d838bd5715a8c3574e7b49ec8c",
        "patch": "@@ -55,6 +55,8 @@ class CZMQAbstractNotifier\n     virtual bool NotifyTransactionRemoval(const CTransaction &transaction, uint64_t mempool_sequence);\n     // Notifies of transactions added to mempool or appearing in blocks\n     virtual bool NotifyTransaction(const CTransaction &transaction);\n+    // Notifies of transactions added to mempool\n+    virtual bool NotifyMempoolTransaction(const CTransaction &transaction);\n \n protected:\n     void *psocket;"
      },
      {
        "sha": "6f03639150644e303da21b5d0beea19dd97e248f",
        "filename": "src/zmq/zmqnotificationinterface.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/52c477e97f84a6d838bd5715a8c3574e7b49ec8c/src/zmq/zmqnotificationinterface.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/52c477e97f84a6d838bd5715a8c3574e7b49ec8c/src/zmq/zmqnotificationinterface.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/zmq/zmqnotificationinterface.cpp?ref=52c477e97f84a6d838bd5715a8c3574e7b49ec8c",
        "patch": "@@ -36,6 +36,7 @@ CZMQNotificationInterface* CZMQNotificationInterface::Create()\n     factories[\"pubhashtx\"] = CZMQAbstractNotifier::Create<CZMQPublishHashTransactionNotifier>;\n     factories[\"pubrawblock\"] = CZMQAbstractNotifier::Create<CZMQPublishRawBlockNotifier>;\n     factories[\"pubrawtx\"] = CZMQAbstractNotifier::Create<CZMQPublishRawTransactionNotifier>;\n+    factories[\"pubrawmempooltx\"] = CZMQAbstractNotifier::Create<CZMQPublishRawMempoolTransactionNotifier>;\n     factories[\"pubsequence\"] = CZMQAbstractNotifier::Create<CZMQPublishSequenceNotifier>;\n \n     std::list<std::unique_ptr<CZMQAbstractNotifier>> notifiers;\n@@ -144,7 +145,7 @@ void CZMQNotificationInterface::TransactionAddedToMempool(const CTransactionRef&\n     const CTransaction& tx = *ptx;\n \n     TryForEachAndRemoveFailed(notifiers, [&tx, mempool_sequence](CZMQAbstractNotifier* notifier) {\n-        return notifier->NotifyTransaction(tx) && notifier->NotifyTransactionAcceptance(tx, mempool_sequence);\n+        return notifier->NotifyTransaction(tx) && notifier->NotifyMempoolTransaction(tx) && notifier->NotifyTransactionAcceptance(tx, mempool_sequence);\n     });\n }\n "
      },
      {
        "sha": "7b0279e5e28bde2c1c222789b5111a5f8f66a1be",
        "filename": "src/zmq/zmqpublishnotifier.cpp",
        "status": "modified",
        "additions": 10,
        "deletions": 0,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/52c477e97f84a6d838bd5715a8c3574e7b49ec8c/src/zmq/zmqpublishnotifier.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/52c477e97f84a6d838bd5715a8c3574e7b49ec8c/src/zmq/zmqpublishnotifier.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/zmq/zmqpublishnotifier.cpp?ref=52c477e97f84a6d838bd5715a8c3574e7b49ec8c",
        "patch": "@@ -29,6 +29,7 @@ static const char *MSG_HASHBLOCK = \"hashblock\";\n static const char *MSG_HASHTX    = \"hashtx\";\n static const char *MSG_RAWBLOCK  = \"rawblock\";\n static const char *MSG_RAWTX     = \"rawtx\";\n+static const char *MSG_RAWMEMPOOLTX = \"rawmempooltx\";\n static const char *MSG_SEQUENCE  = \"sequence\";\n \n // Internal function to send multipart message\n@@ -253,6 +254,15 @@ bool CZMQPublishRawTransactionNotifier::NotifyTransaction(const CTransaction &tr\n     return SendZmqMessage(MSG_RAWTX, &(*ss.begin()), ss.size());\n }\n \n+bool CZMQPublishRawMempoolTransactionNotifier::NotifyMempoolTransaction(const CTransaction &transaction)\n+{\n+    uint256 hash = transaction.GetHash();\n+    LogPrint(BCLog::ZMQ, \"zmq: Publish rawmempooltx %s to %s\\n\", hash.GetHex(), this->address);\n+    CDataStream ss(SER_NETWORK, PROTOCOL_VERSION | RPCSerializationFlags());\n+    ss << transaction;\n+    return SendZmqMessage(MSG_RAWMEMPOOLTX, &(*ss.begin()), ss.size());\n+}\n+\n // Helper function to send a 'sequence' topic message with the following structure:\n //    <32-byte hash> | <1-byte label> | <8-byte LE sequence> (optional)\n static bool SendSequenceMsg(CZMQAbstractPublishNotifier& notifier, uint256 hash, char label, std::optional<uint64_t> sequence = {})"
      },
      {
        "sha": "e0a7c0506112457a2e5edf25e271245d1a595ae3",
        "filename": "src/zmq/zmqpublishnotifier.h",
        "status": "modified",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/52c477e97f84a6d838bd5715a8c3574e7b49ec8c/src/zmq/zmqpublishnotifier.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/52c477e97f84a6d838bd5715a8c3574e7b49ec8c/src/zmq/zmqpublishnotifier.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/zmq/zmqpublishnotifier.h?ref=52c477e97f84a6d838bd5715a8c3574e7b49ec8c",
        "patch": "@@ -52,6 +52,12 @@ class CZMQPublishRawTransactionNotifier : public CZMQAbstractPublishNotifier\n     bool NotifyTransaction(const CTransaction &transaction) override;\n };\n \n+class CZMQPublishRawMempoolTransactionNotifier : public CZMQAbstractPublishNotifier\n+{\n+public:\n+    bool NotifyMempoolTransaction(const CTransaction &transaction) override;\n+};\n+\n class CZMQPublishSequenceNotifier : public CZMQAbstractPublishNotifier\n {\n public:"
      }
    ]
  }
]