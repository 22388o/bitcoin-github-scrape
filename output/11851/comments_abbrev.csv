jnewbery,2017-12-08T13:23:38Z,"Concept ACK. The current naming is very confusing. There's even a comment in walletdb.h to say so:\n\n```\n/**\n * Overview of wallet database classes:\n *\n * - CDBEnv is an environment in which the database exists (has no analog in dbwrapper.h)\n * - CWalletDBWrapper represents a wallet database (similar to CDBWrapper in dbwrapper.h)\n * - CDB is a low-level database transaction (similar",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350261935,350261935,
ryanofsky,2017-12-08T15:56:54Z,"> manually update that overview comment (and perhaps move to wallet.h?)\n\nAdded commit to fix the overview comment: 51eaec47ccb61de2d791c86b785ee4cf111c3b05. I didn't move it into `wallet.h` for now because it sounds from https://github.com/bitcoin/bitcoin/pull/11687#discussion_r155354119 like a goal is to pull database reading and writing code out of main wallet class, which would make `wallet",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350298479,350298479,
TheBlueMatt,2017-12-08T15:58:07Z,"Nice! I find the ""WalletCheckpoint"" name kinda confusing, it is a DB batch/transaction, so I'd kinda prefer we stick with ""normal"" nomenclature there. I'm really not sure that ""BerkeleyCheckpoint"" makes all that much sense for CDB, either. I kinda wish we'd split it out into an interface and implementation, though not sure if its required for this PR, but its already essentially a pretty clean int",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350298811,350298811,
ryanofsky,2017-12-08T16:04:35Z,"> I find the ""WalletCheckpoint"" name kinda confusing\n\nYeah, actually checkpoint is a bad name. I just chose it because I saw a `txn_checkpoint` call in `CDB::Flush` and assumed ""checkpoint"" was some kind of BDB synonym for transaction. But it's really not. It would be good to avoid the word transaction so maybe the best thing to call this is something like `Batch` or `Update` or `Commit`.",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350300599,350300599,
jnewbery,2017-12-08T17:23:09Z,"Can you push your latest branch onto `pr/wren` so it shows up here?\n\nACK changing Checkpoint to Batch or Commit. Please just not transaction!\n\nACK your suggested filename changes. My preferences would be:\n- `wallet/db.h` *->* `wallet/db-berkeley.h`\n- `wallet/walletdb.h` *->* `wallet/schema.h`\n\nI've reviewed your commit changing the overview comment. I think it could be improved fur",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350320608,350320608,
TheBlueMatt,2017-12-08T17:28:09Z,"> It would be good to avoid the word transaction so maybe the best thing to call this is something like Batch or Update or Commit.\n\nGood point. We use the term ""Batch"" in the context of LevelDB/CCoin stuff, so I'd vote for that.",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350321876,350321876,
ryanofsky,2017-12-08T19:05:34Z,"Updated 51eaec47ccb61de2d791c86b785ee4cf111c3b05 -> 4299018f8f1f2b952c93f79b82073bcaa96807f6 ([pr/wren.2](https://github.com/ryanofsky/bitcoin/commits/pr/wren.2) -> [pr/wren.3](https://github.com/ryanofsky/bitcoin/commits/pr/wren.3)), switching from checkpoint to batch, dropping the CWallet->Wallet rename (because it isn't really related and makes the change bigger), adding some variable renames f",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350345537,350345537,
jnewbery,2017-12-08T19:23:43Z,"I'm going to hold off reviewing until we're closer to a major release (since I think this only makes sense going in right before branching). Russ - let me know if you disagree and think we should be reviewing/merging sooner. If this does get merged just before a branch, then I think there's no issue with doing `s/CWallet/Wallet` at the same time.",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350349606,350349606,
ryanofsky,2017-12-08T19:30:01Z,"Sounds good to me. It would also make things slightly easier for me if this were merged after #11687, rather than before.",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350351133,350351133,
TheBlueMatt,2017-12-08T20:50:56Z,I'm not sure I'd call BerkeleyBatch so low-level or recommend it be BDB-specific. Its public interface is pretty DB-agnostic - Read/Write/Verify/PeriodicFlush.,https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350368764,350368764,
ryanofsky,2017-12-08T21:40:34Z,"> I'm not sure I'd call BerkeleyBatch so low-level or recommend it be BDB-specific. Its public interface is pretty DB-agnostic - Read/Write/Verify/PeriodicFlush.\n\nYeah, that code could be pulled out into WalletBatch or a new key-value store generic class. But I think John's comment is basically right. WalletBatch code should be agnostic to berkeley db details and potentially able to work with ",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350379044,350379044,
practicalswift,2017-12-10T10:53:30Z,Concept ACK,https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350539835,350539835,
laanwj,2017-12-11T17:19:47Z,"Agree on the naming and using `Batch`.\n\nHowever I agree with this as well:\n\n> I'm not sure I'd call BerkeleyBatch so low-level or  recommend it be BDB-specific. Its public interface is pretty DB-agnostic  - Read/Write/Verify/PeriodicFlush.\n\nI tend to agree. I have a local patch set that ports the wallet functions to LevelDB. I don't think the interface should hardcode the database impl",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350793441,350793441,
ryanofsky,2017-12-11T19:23:08Z,"@laanwj, is there a link to your leveldb patch? I'm surprised there's much code in these classes that's reusable for leveldb. BerkeleyEnvironment and BerkeleyDatabase in particular seem pretty tied to Berkeley, though BerkeleyBatch is more independent.\n\nI'm thinking perhaps I should move the independent parts of BerkeleyBatch out into WalletBatch along with this renaming to avoid creating new ",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350829560,350829560,
ryanofsky,2017-12-11T19:27:04Z,"I think I found the leveldb wallet branch, it is https://github.com/laanwj/bitcoin/commits/20170310_experiment_leveldb_wallet and #9951. #5686 is also similar.",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350830706,350830706,
laanwj,2017-12-12T09:16:04Z,"> @laanwj, is there a link to your leveldb patch? I'm surprised there's much code in these classes that's reusable for leveldb.\n\nRight - the patch replaces pretty much all the code *inside* the classes.\nMy only comment is about the exterior. So wallet.cpp etc should not be referring to `Berkeley` anything as class name, it doesn't have to leak through in the class naming used by the client c",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-350991383,350991383,
ryanofsky,2017-12-12T12:08:36Z,"> My only comment is about the exterior. So wallet.cpp etc should not be referring to Berkeley anything as class name\n\nAh, I see. Your concern was narrower than I thought and can be addressed by a typedef like you suggested. Will fix and have the PR ready again soon. I still might want to merge this after #11687, though since #11687 touches a lot of the same code and this being a scripted-diff",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-351033221,351033221,
PierreRochard,2017-12-12T14:57:04Z,Concept ACK. Was changing `dbw` to `database` in the src/test/dbwrapper_tests.cpp file intentional? That would seem to increase the scope of this PR beyond the wallet code,https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-351075464,351075464,
ryanofsky,2017-12-12T15:32:11Z,"PSA: Everybody commenting here please stop reviewing this work in progress PR and look at #11687 instead :)\n\n> Was changing dbw to database in the src/test/dbwrapper_tests.cpp file intentional? That would seem to increase the scope of this PR beyond the wallet code\n\nThis was unintentional but seemed harmless so I just left it in. I can try to tweak the scripted-diff to prevent it.",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-351086556,351086556,
laanwj,2017-12-13T05:50:15Z,">  Will fix and have the PR ready again soon.\n\nThanks. Sorry for being unclear at first.",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-351290403,351290403,
sipa,2017-12-15T21:16:40Z,Pieter was here.,https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-352113765,352113765,
MarcoFalke,2018-03-08T15:21:48Z,Needs rebase to fix travis (sorry),https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-371519231,371519231,
ryanofsky,2018-03-12T18:53:56Z,"> Needs rebase to fix travis (sorry)\n\nRebased e0ad11506a62c7ad28411ba67abad68131058bf5 -> 333ede1b54f00b063a311cf8bf7d70c711fa234f ([pr/wren.10](https://github.com/ryanofsky/bitcoin/commits/pr/wren.10) -> [pr/wren.11](https://github.com/ryanofsky/bitcoin/commits/pr/wren.11)) for #12607.\n\n",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-372423835,372423835,
PierreRochard,2018-03-13T08:32:02Z,"Opening comment could be updated to include `WalletDatabase`/`BerkeleyDatabase` distinction as well as the variable renames:\n\n| Current  | New |\n| ------------- | ------------- |\n| dbw  | database  |\n| m_dbw  | m_database  |\n| pwalletdb  | batch  |\n| pwalletdbIn  | batch_in  |\n| walletdb  | batch  |\n\nShould `pwalletdbEncryption` be renamed as well?",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-372585699,372585699,
ryanofsky,2018-03-13T20:36:06Z,"> Opening comment could be updated to include WalletDatabase/BerkeleyDatabase distinction as well as the variable renames:\n\nThanks, updated to note the distinction and variable renames.\n\n> Should pwalletdbEncryption be renamed as well?\n\nGood catch. Added `ren pwalletdbEncryption encrypted_batch` line to the script.\n\nUpdated 333ede1b54f00b063a311cf8bf7d70c711fa234f -> e2ce4c00c14127",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-372809531,372809531,
PierreRochard,2018-03-14T08:20:44Z,"Tested ACK e2ce4c00c141275fbbf733dc0abef1bb4d986065\n\nFYI in your scripted diff there's `ren wallet/batch.h   wallet/walletdb.h` which doesn't do anything because it's in the wrong order.",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-372939413,372939413,
ryanofsky,2018-03-15T19:47:30Z,"Rebased e2ce4c00c141275fbbf733dc0abef1bb4d986065 -> b21912d455f225740fc5d4356cb4b31379c077d2 ([pr/wren.12](https://github.com/ryanofsky/bitcoin/commits/pr/wren.12) -> [pr/wren.13](https://github.com/ryanofsky/bitcoin/commits/pr/wren.13)) because of merge conflict with #10637 in wallet_tests.cpp.\n\n> FYI in your scripted diff there's ren wallet/batch.h wallet/walletdb.h which doesn't do anything",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-373500805,373500805,
PierreRochard,2018-03-17T22:38:17Z,"> That line is needed to prevent the earlier ren walletdb from mangling #includes.\n\nAh I see, I didn't think that through.\n\nTested ACK b21912d455f225740fc5d4356cb4b31379c077d2",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-373958044,373958044,
meshcollider,2018-03-17T22:49:28Z,"LGTM, light review utACK https://github.com/bitcoin/bitcoin/pull/11851/commits/b21912d455f225740fc5d4356cb4b31379c077d2",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-373958639,373958639,
ryanofsky,2018-03-19T16:52:05Z,Rebased b21912d455f225740fc5d4356cb4b31379c077d2 -> 294442d56d0aff5571756980ee0e0f700656428e ([pr/wren.13](https://github.com/ryanofsky/bitcoin/commits/pr/wren.13) -> [pr/wren.14](https://github.com/ryanofsky/bitcoin/commits/pr/wren.14)) due to merge conflict with #12408.,https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-374284092,374284092,
jnewbery,2018-03-20T21:46:29Z,reACK c4719633496d6be338d3c2ee3d64be613200ae82 . Can confirm that the `batch` -> `m_batch` renaming is the only change.,https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-374768142,374768142,
MarcoFalke,2018-03-22T22:36:07Z,Needs rebase,https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-375479968,375479968,
ryanofsky,2018-03-22T22:57:09Z,"> Needs rebase\n\nRebased c4719633496d6be338d3c2ee3d64be613200ae82 -> 6db9ee94fa91d3ebc864f63567314a2cce437bdd ([pr/wren.15](https://github.com/ryanofsky/bitcoin/commits/pr/wren.15) -> [pr/wren.16](https://github.com/ryanofsky/bitcoin/commits/pr/wren.16)) due to conflicts with #11536 and #12694.\nRebased 6db9ee94fa91d3ebc864f63567314a2cce437bdd -> 4dff15cd3e4cdda37b614b57278cbf4b06b26e2b ([pr/w",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-375484310,375484310,
Sjors,2018-03-29T11:18:04Z,"Concept ACK on more clear variable names. No opinion on the chosen names, but they seem like an improvement. 4dff15c compiles for me on macOS and my wallets still work.",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-377203841,377203841,
ryanofsky,2018-04-06T18:21:22Z,"Rebased 4dff15cd3e4cdda37b614b57278cbf4b06b26e2b -> 70caf7f7538efe1f859ce849967b7b40bbb8ae6f ([pr/wren.17](https://github.com/ryanofsky/bitcoin/commits/pr/wren.17) -> [pr/wren.18](https://github.com/ryanofsky/bitcoin/commits/pr/wren.18)) due to conflicts with #12718 and #12853\n",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-379336014,379336014,
PierreRochard,2018-04-07T11:46:26Z,"I should have caught this sooner, this comment https://github.com/ryanofsky/bitcoin/blob/70caf7f7538efe1f859ce849967b7b40bbb8ae6f/src/wallet/walletdb.h#L137 (walletdb.h line 137) should be updated to reflect the renaming that happpened. \n",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-379463639,379463639,
ryanofsky,2018-04-07T17:23:09Z,"> I should have caught this sooner, this comment https://github.com/ryanofsky/bitcoin/blob/70caf7f7538efe1f859ce849967b7b40bbb8ae6f/src/wallet/walletdb.h#L137 (walletdb.h line 137) should be updated to reflect the renaming that happpened.\n\nThanks, updated coment in 3b205a89eaff2ae2b87557e6406e550e6656c4ef.\n\n---\n\nRebased 70caf7f7538efe1f859ce849967b7b40bbb8ae6f -> 59cf1f2377f8f6315200a9",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-379485492,379485492,
PierreRochard,2018-04-07T20:07:29Z,Tested ACK 9b0f0c5513f74825b06a728ab9bb2fd0e4224c9f,https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-379495781,379495781,
jnewbery,2018-04-09T14:50:35Z,"Tested ACK 9b0f0c5513f74825b06a728ab9bb2fd0e4224c9f.\n\nThis is a conflict-heavy PR. It'd be great to get this merged soon to avoid repeated rebases.",https://github.com/bitcoin/bitcoin/pull/11851#issuecomment-379779304,379779304,
jnewbery,2018-03-19T18:04:11Z,"You could rename this to `m_batch` in this PR, although that may be out of scope.",https://github.com/bitcoin/bitcoin/pull/11851#discussion_r175532351,175532351,src/wallet/walletdb.h
ryanofsky,2018-03-20T18:50:27Z,"https://github.com/bitcoin/bitcoin/pull/11851#discussion_r175532351\n\n> You could rename this to m_batch in this PR, although that may be out of scope.\n\nDone in c4719633496d6be338d3c2ee3d64be613200ae82\n",https://github.com/bitcoin/bitcoin/pull/11851#discussion_r175883923,175883923,src/wallet/walletdb.h
