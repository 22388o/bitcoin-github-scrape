DrahtBot,2020-07-06 19:24:32,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19619 (Remove wallet.dat path handling from wallet.cpp, rpcwallet.cpp by ryanofsky)\n* #19137 (wallettool: Add dump and c",https://github.com/bitcoin/bitcoin/pull/19457#issuecomment-654421452,654421452,
achow101,2020-07-22 16:35:06,Rebased. I've also added a commit that fixes the first error in #19078,https://github.com/bitcoin/bitcoin/pull/19457#issuecomment-662557978,662557978,
achow101,2020-08-13 00:12:53,I've dropped the last commit. I agree it doesn't fit well here and can be for a followup.,https://github.com/bitcoin/bitcoin/pull/19457#issuecomment-673170794,673170794,
MarcoFalke,2020-08-14 13:25:12,@ryanofsky Are you going to submit this patch as a pull: https://github.com/bitcoin/bitcoin/pull/19457#discussion_r469510175 ?,https://github.com/bitcoin/bitcoin/pull/19457#issuecomment-674073384,674073384,
ryanofsky,2020-08-24 20:08:04,"> @ryanofsky Are you going to submit this patch as a pull: [#19457 (comment)](https://github.com/bitcoin/bitcoin/pull/19457#discussion_r469510175) ?\n\nSure, created #19793",https://github.com/bitcoin/bitcoin/pull/19457#issuecomment-679339437,679339437,
MarcoFalke,2020-07-07 09:37:22,Any reason to ask translators to waste effort when these were previously untranslated and the new translations are unused?,https://github.com/bitcoin/bitcoin/pull/19457#discussion_r450736655,450736655,src/wallet/salvage.cpp
achow101,2020-07-07 14:42:13,"Since these are utility functions, we might add them to the gui in the future. Or maybe add a gui to the wallettool to make it more user friendly. I wanted to make sure that we could use these in the gui if we wanted to.",https://github.com/bitcoin/bitcoin/pull/19457#discussion_r450918303,450918303,src/wallet/salvage.cpp
laanwj,2020-07-15 13:11:26,I'd prefer to err on the side of not adding a translation message if it's not currently used. This can always be done when necessary.,https://github.com/bitcoin/bitcoin/pull/19457#discussion_r455038868,455038868,src/wallet/salvage.cpp
achow101,2020-07-15 15:36:35,I've changed these to use `Untranslated`.,https://github.com/bitcoin/bitcoin/pull/19457#discussion_r455146536,455146536,src/wallet/salvage.cpp
MarcoFalke,2020-07-22 05:41:22,"style nit in commit ""wallettool: ...""\n\nA range based for loop does not need to be guarded by a size check, so you can remove the `if (warnings.size() > 0)`",https://github.com/bitcoin/bitcoin/pull/19457#discussion_r458546966,458546966,src/wallet/wallettool.cpp
achow101,2020-07-22 16:34:42,Fixed.,https://github.com/bitcoin/bitcoin/pull/19457#discussion_r458928962,458928962,src/wallet/wallettool.cpp
ryanofsky,2020-07-24 19:17:06,"In commit ""Return false instead of asserting when a loaded tx isn't new"" (21349ec568abd5b25b6ca722aa6a9df3037fa4e8)\n\nThis definitely needs a comment. I don't understand when this condition happens. Does it indicate corruption or is it a thing expected to happen in certain cases? Comment doesn't need to be involved but should give a clue about what is happening here, since by itself this is eni",https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460241977,460241977,src/wallet/walletdb.cpp
MarcoFalke,2020-07-25 07:24:17,"The assert has been added in https://github.com/bitcoin/bitcoin/commit/65b9d8f8ddb5a838454efc8bdd6576f0deb65f6d?w=1 , assuming that adding it does not change behavior. Making it a `return false` would restore the previous behavior instead of crashing.",https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460376597,460376597,src/wallet/walletdb.cpp
MarcoFalke,2020-07-25 07:28:02,"in commit b27b5f7307:\n\nwhy is open_error ignored and overwritten?",https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460376896,460376896,src/wallet/salvage.cpp
achow101,2020-07-27 00:23:05,Dunno. I've restored the previous behavior.,https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460593044,460593044,src/wallet/salvage.cpp
achow101,2020-07-27 00:26:47,"This condition can happen with corruption. It means that the db has the same tx in multiple records which shouldn't happen. However this isn't something we should be asserting for because it isn't a critical error where money can be lost. It should be recoverable with rescan, else zapwallettxs will fix it.\n\nI've added a comment indicating this.",https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460593506,460593506,src/wallet/walletdb.cpp
MarcoFalke,2020-07-27 05:27:09,"This shouldn't be corruption, or at least it seems to happen in normal operation. All that the test in #19078 does is call `getnewaddress` and `sendmany`",https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460653761,460653761,src/wallet/walletdb.cpp
achow101,2020-07-27 15:25:33,"The fact that #19078 is hitting this is probably a result of the aggressive salvage which, afaik, sometimes creates corruption when there isn't corruption. It's probably from BDB shuffling data around (as part of the normal btree operations) and leaving behind records that are marked as deleted but not actually deleted. So the aggressive salvage still finds these ""deleted"" records.",https://github.com/bitcoin/bitcoin/pull/19457#discussion_r460973647,460973647,src/wallet/walletdb.cpp
ryanofsky,2020-08-12 20:07:15,"In commit ""Return false instead of asserting when a loaded tx isn't new"" (fbe8816f1a95e266b59b39327da4374a0442e279)\n\n> The fact that #19078 is hitting this is probably a result of the aggressive salvage\n\nMaybe this change is ultimately the right one, but until we clearly understand what is happening I think it would be better to either drop this commit and follow up in a separate PR, or  u",https://github.com/bitcoin/bitcoin/pull/19457#discussion_r469510175,469510175,src/wallet/walletdb.cpp
fanquake,2020-08-14 07:20:23,"Are there any followups queued for this file, or did you want to fix this now?\n\n```bash\nwallet/wallettool.cpp:133:33: warning: loop variable 'warning' of type 'const bilingual_str' creates a copy from type 'const bilingual_str' [-Wrange-loop-analysis]\n                for (const auto warning : warnings) {\n                                ^\nwallet/wallettool.cpp:133:22: note: use referenc",https://github.com/bitcoin/bitcoin/pull/19457#discussion_r470453427,470453427,src/wallet/wallettool.cpp
