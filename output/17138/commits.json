[
  {
    "sha": "eea462de9c652dca556ad241d2126b10790f67f8",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplZWE0NjJkZTljNjUyZGNhNTU2YWQyNDFkMjEyNmIxMDc5MGY2N2Y4",
    "commit": {
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2019-10-14T17:32:41Z"
      },
      "committer": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2019-10-14T17:32:41Z"
      },
      "message": "[wallet] Remove package limit config access from wallet\n\nThe wallet should not be able to directly access global configuration\nfrom the node. Remove access of \"-limitancestorcount\" and\n\"-limitdescendantcount\".",
      "tree": {
        "sha": "a2744495dcb9580b02479c89e33e0b77ef194a45",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a2744495dcb9580b02479c89e33e0b77ef194a45"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/eea462de9c652dca556ad241d2126b10790f67f8",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/eea462de9c652dca556ad241d2126b10790f67f8",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/eea462de9c652dca556ad241d2126b10790f67f8",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/eea462de9c652dca556ad241d2126b10790f67f8/comments",
    "author": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b33c03b0cb82e57eb862542c9d331b7ceb8f3a62",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b33c03b0cb82e57eb862542c9d331b7ceb8f3a62",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b33c03b0cb82e57eb862542c9d331b7ceb8f3a62"
      }
    ],
    "stats": {
      "total": 18,
      "additions": 15,
      "deletions": 3
    },
    "files": [
      {
        "sha": "b7cd65ff3af6a63cbb8764b6b6f154b1979e5ca4",
        "filename": "src/interfaces/chain.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/eea462de9c652dca556ad241d2126b10790f67f8/src/interfaces/chain.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/eea462de9c652dca556ad241d2126b10790f67f8/src/interfaces/chain.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/interfaces/chain.cpp?ref=eea462de9c652dca556ad241d2126b10790f67f8",
        "patch": "@@ -298,6 +298,11 @@ class ChainImpl : public Chain\n     {\n         ::mempool.GetTransactionAncestry(txid, ancestors, descendants);\n     }\n+    void getPackageLimits(unsigned int& limit_ancestor_count, unsigned int& limit_descendant_count) override\n+    {\n+        limit_ancestor_count = gArgs.GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT);\n+        limit_descendant_count = gArgs.GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT);\n+    }\n     bool checkChainLimits(const CTransactionRef& tx) override\n     {\n         LockPoints lp;"
      },
      {
        "sha": "73a78e21fb31e1684fb803a663ac45faa8888597",
        "filename": "src/interfaces/chain.h",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/eea462de9c652dca556ad241d2126b10790f67f8/src/interfaces/chain.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/eea462de9c652dca556ad241d2126b10790f67f8/src/interfaces/chain.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/interfaces/chain.h?ref=eea462de9c652dca556ad241d2126b10790f67f8",
        "patch": "@@ -163,6 +163,11 @@ class Chain\n     //! Calculate mempool ancestor and descendant counts for the given transaction.\n     virtual void getTransactionAncestry(const uint256& txid, size_t& ancestors, size_t& descendants) = 0;\n \n+    //! Get the node's package limits.\n+    //! Currently only returns the ancestor and descendant count limits, but could be enhanced to\n+    //! return more policy settings.\n+    virtual void getPackageLimits(unsigned int& limit_ancestor_count, unsigned int& limit_descendant_count) = 0;\n+\n     //! Check if transaction will pass the mempool's chain limits.\n     virtual bool checkChainLimits(const CTransactionRef& tx) = 0;\n "
      },
      {
        "sha": "1551c645d0b5630f40f25545a7a1cadb252c97ca",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 3,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/eea462de9c652dca556ad241d2126b10790f67f8/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/eea462de9c652dca556ad241d2126b10790f67f8/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=eea462de9c652dca556ad241d2126b10790f67f8",
        "patch": "@@ -27,7 +27,6 @@\n #include <util/rbf.h>\n #include <util/translation.h>\n #include <util/validation.h>\n-#include <validation.h>\n #include <wallet/coincontrol.h>\n #include <wallet/fees.h>\n \n@@ -2739,8 +2738,11 @@ bool CWallet::SelectCoins(const std::vector<COutput>& vAvailableCoins, const CAm\n     }\n     std::vector<OutputGroup> groups = GroupOutputs(vCoins, !coin_control.m_avoid_partial_spends);\n \n-    size_t max_ancestors = (size_t)std::max<int64_t>(1, gArgs.GetArg(\"-limitancestorcount\", DEFAULT_ANCESTOR_LIMIT));\n-    size_t max_descendants = (size_t)std::max<int64_t>(1, gArgs.GetArg(\"-limitdescendantcount\", DEFAULT_DESCENDANT_LIMIT));\n+    unsigned int limit_ancestor_count;\n+    unsigned int limit_descendant_count;\n+    chain().getPackageLimits(limit_ancestor_count, limit_descendant_count);\n+    size_t max_ancestors = (size_t)std::max<int64_t>(1, limit_ancestor_count);\n+    size_t max_descendants = (size_t)std::max<int64_t>(1, limit_descendant_count);\n     bool fRejectLongChains = gArgs.GetBoolArg(\"-walletrejectlongchains\", DEFAULT_WALLET_REJECT_LONG_CHAINS);\n \n     bool res = nTargetValue <= nValueFromPresetInputs ||"
      }
    ]
  },
  {
    "sha": "b96ed0396294fc4fa89d83ceab6bc169dd09f002",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiOTZlZDAzOTYyOTRmYzRmYTg5ZDgzY2VhYjZiYzE2OWRkMDlmMDAy",
    "commit": {
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2019-10-14T17:39:25Z"
      },
      "committer": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2019-10-14T17:39:25Z"
      },
      "message": "[wallet] Remove pruning check for -rescan option\n\nPrior to this PR, the wallet would not allow the `-rescan` option at\nstartup if pruning was enabled. This is unnecessarily restrictive. It\nshould be possible to rescan if pruning is enabled, as long as no blocks\nhave actually been pruned yet.\n\nRemove the pruning check from WalletInit::ParameterInteraction(). If any\nblocks have been pruned, that will be caught in CreateWalletFromFile().",
      "tree": {
        "sha": "8da7d40bfa69145497b56b4755c98e5c568d27f8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8da7d40bfa69145497b56b4755c98e5c568d27f8"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/b96ed0396294fc4fa89d83ceab6bc169dd09f002",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b96ed0396294fc4fa89d83ceab6bc169dd09f002",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/b96ed0396294fc4fa89d83ceab6bc169dd09f002",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b96ed0396294fc4fa89d83ceab6bc169dd09f002/comments",
    "author": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "eea462de9c652dca556ad241d2126b10790f67f8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/eea462de9c652dca556ad241d2126b10790f67f8",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/eea462de9c652dca556ad241d2126b10790f67f8"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 0,
      "deletions": 2
    },
    "files": [
      {
        "sha": "b7f3f2e5fe286068bc33095148d794672e11ce2e",
        "filename": "src/wallet/init.cpp",
        "status": "modified",
        "additions": 0,
        "deletions": 2,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/b96ed0396294fc4fa89d83ceab6bc169dd09f002/src/wallet/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/b96ed0396294fc4fa89d83ceab6bc169dd09f002/src/wallet/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/init.cpp?ref=b96ed0396294fc4fa89d83ceab6bc169dd09f002",
        "patch": "@@ -122,8 +122,6 @@ bool WalletInit::ParameterInteraction() const\n \n     if (gArgs.GetBoolArg(\"-sysperms\", false))\n         return InitError(\"-sysperms is not allowed in combination with enabled wallet functionality\");\n-    if (gArgs.GetArg(\"-prune\", 0) && gArgs.GetBoolArg(\"-rescan\", false))\n-        return InitError(_(\"Rescans are not possible in pruned mode. You will need to use -reindex which will download the whole blockchain again.\").translated);\n \n     return true;\n }"
      }
    ]
  }
]