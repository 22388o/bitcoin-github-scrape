ajweiss,2015-07-07T17:22:54Z,Nice!  Reviewing this...\n,https://github.com/bitcoin/bitcoin/pull/6388#issuecomment-119274621,119274621,
ajweiss,2015-07-07T18:01:43Z,"I spent some time trying to break this, and was unable to do so.  This grinds off one of bitcoind's most annoying burrs, very nice!  One thing to note is that some of the init scripts in the contrib directory have checks for a set rpcpassword, so when this goes in those should be removed.    \n",https://github.com/bitcoin/bitcoin/pull/6388#issuecomment-119285103,119285103,
jonasschnelli,2015-07-07T18:46:47Z,Nice work!\nTested ACK (nit: doesn't work in regtest atm).\n,https://github.com/bitcoin/bitcoin/pull/6388#issuecomment-119300165,119300165,
laanwj,2015-07-13T11:12:44Z,"Rebased against #6398, added generic UI error message before shutting down when writing cookie fails.\n",https://github.com/bitcoin/bitcoin/pull/6388#issuecomment-120892721,120892721,
laanwj,2015-07-07T13:29:16Z,"Not convinced that this code actually belongs in `rpcprotocol`, it is here because that file is shared between bitcoin-cli and bitcoind server, but conceptually it exists on a higher level than the protocol. Feel free to suggest a better place.\n",https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34038636,34038636,src/rpcprotocol.cpp
laanwj,2015-07-07T15:49:01Z,"This error should be changed. It will be shown if bitcoin-cli is used while bitcoind is not running, so it's confusing to tell the user to just set a password (which will indeed make this message go away, but just enough to get to `connection refused` :-).\n",https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34055509,34055509,src/bitcoin-cli.cpp
jonasschnelli,2015-07-07T18:39:55Z,I think this if needs to be rewritten because at the moment the cookie system does not work in regtest.\n,https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34074675,34074675,src/rpcserver.cpp
jonasschnelli,2015-07-07T18:42:50Z,I think `rpcprotocol.h/.cpp` is a good place for this extension. A new `cookieauth.h/cpp` file would be possible but i think is more compact and neatly arranged if it stays in `rpcprotocol.h/cpp`\n,https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34075046,34075046,src/rpcprotocol.cpp
jonasschnelli,2015-07-07T18:46:00Z,"I think this if block from L100-L112 should go down to L126 (after the connection has been set up).\nIt would make more sense to first check if we can connect to bitcoind, then check if we have some credentials available.\n",https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34075442,34075442,src/bitcoin-cli.cpp
laanwj,2015-07-08T11:51:07Z,"Agreed. Thought this through a bit and that'd be better.\n_if_ it can connect, and there is no cookie file, this message still makes sense.\n",https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34139186,34139186,src/bitcoin-cli.cpp
laanwj,2015-07-08T11:58:58Z,"Making a new file pair e.g. `rpcauthcookie` sounds good to me too. But I don't feel strongly about it either. \nThe low-level code from rpcprotocol will be unnecessary with the libevent-based HTTP server (#5677), so this will at least leave something there :)\n",https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34139635,34139635,src/rpcprotocol.cpp
laanwj,2015-07-08T12:03:31Z,"I'd personally love to get rid of `Params().RequireRPCPassword()`, also for consistency reasons. But I think it's unrelated to this pull - on regtest, setting an empty password is currently just allowed, so takes precedence.\n",https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34139935,34139935,src/rpcserver.cpp
jonasschnelli,2015-07-08T12:14:08Z,"Hmm... but the following way don't work.\n\n`jonasschnelli$ ./src/bitcoind --regtest --datadir=/tmp/dummy2 --printtoconsole` (fresh datadir)\n\n```\njonasschnelli$ ./src/bitcoin-cli --regtest --datadir=/tmp/dummy2/ help\nerror: You must set rpcpassword=<password> in the configuration file:\n/tmp/dummy2/bitcoin.conf\nIf the file does not exist, create it with owner-readable-only file permissions.\n",https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34140649,34140649,src/rpcserver.cpp
laanwj,2015-07-08T12:24:12Z,"Right, so bitcoin-cli should mind that flag as well (for now). Thanks.\n",https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34141294,34141294,src/rpcserver.cpp
laanwj,2015-07-08T12:28:13Z,"Bleh, that'd mean moving the flag to BaseParams... \n",https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34141534,34141534,src/rpcserver.cpp
sipa,2015-07-09T16:32:45Z,Mention in this help text that the ability to write to [authfilepath] would also solve the problem? Now it may be confusing as being unable to write a file results in a help text mentioning some unrelated config option.\n,https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34274418,34274418,src/bitcoin-cli.cpp
sipa,2015-07-09T16:33:31Z,"No logic to prevent too wide permissions on that file?\n\nEDIT: nevermind, umask\n",https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34274508,34274508,src/rpcprotocol.cpp
laanwj,2015-07-10T12:25:12Z,"This message triggers if it is unable to _read_ from the file, e.g. if it doesn't exist, but is somehow able to connect. This is a very strange situation, but it won't be solved by ability to write anywhere.\n\n(bitcoind won't even start if no rpcpassword is set but it is unable to write the cookie file)\n",https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34349908,34349908,src/bitcoin-cli.cpp
laanwj,2015-07-10T12:28:35Z,Right: even for the wallet permissions we rely on the umask.\n,https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34350102,34350102,src/rpcprotocol.cpp
,2015-07-13T04:35:06Z,"Would it make sense to move the rpcpassword warning into here, instead of removing it entirely? This would give the user warning if GenerateAuthCookie() fails to write to disk for example.\n",https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34432914,34432914,src/rpcserver.cpp
laanwj,2015-07-13T10:22:37Z,"GenerateAuthCookie already logs an error when it is unable to create the file. The data directory must be writable (otherwise creating the lock file will fail, earlier), so it is an extremely rare error. IMO it doesn't need an extensive translated message.\n",https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34449751,34449751,src/rpcserver.cpp
laanwj,2015-07-13T10:37:20Z,"I think it is reasonable to show an error here before shutting down, but can just as well be a standard ""Initialization failed, check the error log for details"".\n",https://github.com/bitcoin/bitcoin/pull/6388#discussion_r34450777,34450777,src/rpcserver.cpp
