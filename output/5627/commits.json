[
  {
    "sha": "2fa9a8ec86033b809a1c48f0396c3482c0d5d33c",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyZmE5YThlYzg2MDMzYjgwOWExYzQ4ZjAzOTZjMzQ4MmMwZDVkMzNj",
    "commit": {
      "author": {
        "name": "Peter Todd",
        "email": "pete@petertodd.org",
        "date": "2015-01-09T10:52:57Z"
      },
      "committer": {
        "name": "Peter Todd",
        "email": "pete@petertodd.org",
        "date": "2015-01-09T11:03:22Z"
      },
      "message": "Make empty byte arrays pass CheckSignatureEncoding()\n\nMakes it possible to compactly provide a delibrately invalid signature\nfor use with CHECK(MULTI)SIG. For instance with BIP19 if m != n invalid\nsignatures need to be provided in the scriptSig; prior to this change\nthose invalid signatures would need to be large DER-encoded signatures.\n\nNote that we may want to further expand on this change in the future by\nsaying that only OP_0 is a \"valid\" invalid signature; BIP19 even with\nthis change is inherently malleable as the invalid signatures can be any\nvalidly encoded DER signature.",
      "tree": {
        "sha": "4cd6abf6979cf22bc9962accb7472083e6daa830",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4cd6abf6979cf22bc9962accb7472083e6daa830"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2fa9a8ec86033b809a1c48f0396c3482c0d5d33c",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGrBAABCACVBQJUr7V7XhSAAAAAABUAQGJsb2NraGFzaEBiaXRjb2luLm9yZzAw\nMDAwMDAwMDAwMDAwMDAwZTg0OTBjMmQyMGFjMTY0Y2I4MmMzMzAzYzlmZDZiODc5\nNDU2OWU5ZTBmYTk4Y2YvFIAAAAAAFQARcGthLWFkZHJlc3NAZ251cGcub3JncGV0\nZUBwZXRlcnRvZC5vcmcACgkQJIFAPaXwkful1gf9E42QZPHRi15xZNSrvvpWpJFN\n62AF6U+K5wuKPSKHw397k/diljDO18cjgjy77Vg+gvQGZ0TN0TPRXlsBqq+LtCjB\njD3SII84/id71IldgQwYwOqmhbReJou6WC4ENRGUjgs4Wnt7NYWcblirOktL83Q2\n1KTZQ7i9hXBSILQIz+lJqD2me2JenleKPpOqpBMAbCjxOHCMHDtbFzOvy4tuNcBo\nkuTPvE7DAKtO1q51ZIb5vpkiVW2SzA2jssaJB8Xb/bEZ/E+2feGT7zbDJ+3wWGDt\nvL10Os3oD3GhngBTGhdJBqhE42DZd3zb/2gUssEKuYrQggrUF24AHBZAFJkP1Q==\n=vvEg\n-----END PGP SIGNATURE-----",
        "payload": "tree 4cd6abf6979cf22bc9962accb7472083e6daa830\nparent d0c97bbe70a6876dadedfbf672387371c9c849d1\nauthor Peter Todd <pete@petertodd.org> 1420800777 -0500\ncommitter Peter Todd <pete@petertodd.org> 1420801402 -0500\n\nMake empty byte arrays pass CheckSignatureEncoding()\n\nMakes it possible to compactly provide a delibrately invalid signature\nfor use with CHECK(MULTI)SIG. For instance with BIP19 if m != n invalid\nsignatures need to be provided in the scriptSig; prior to this change\nthose invalid signatures would need to be large DER-encoded signatures.\n\nNote that we may want to further expand on this change in the future by\nsaying that only OP_0 is a \"valid\" invalid signature; BIP19 even with\nthis change is inherently malleable as the invalid signatures can be any\nvalidly encoded DER signature.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2fa9a8ec86033b809a1c48f0396c3482c0d5d33c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2fa9a8ec86033b809a1c48f0396c3482c0d5d33c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2fa9a8ec86033b809a1c48f0396c3482c0d5d33c/comments",
    "author": {
      "login": "petertodd",
      "id": 7042,
      "node_id": "MDQ6VXNlcjcwNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7042?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/petertodd",
      "html_url": "https://github.com/petertodd",
      "followers_url": "https://api.github.com/users/petertodd/followers",
      "following_url": "https://api.github.com/users/petertodd/following{/other_user}",
      "gists_url": "https://api.github.com/users/petertodd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/petertodd/subscriptions",
      "organizations_url": "https://api.github.com/users/petertodd/orgs",
      "repos_url": "https://api.github.com/users/petertodd/repos",
      "events_url": "https://api.github.com/users/petertodd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/petertodd/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "petertodd",
      "id": 7042,
      "node_id": "MDQ6VXNlcjcwNDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7042?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/petertodd",
      "html_url": "https://github.com/petertodd",
      "followers_url": "https://api.github.com/users/petertodd/followers",
      "following_url": "https://api.github.com/users/petertodd/following{/other_user}",
      "gists_url": "https://api.github.com/users/petertodd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/petertodd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/petertodd/subscriptions",
      "organizations_url": "https://api.github.com/users/petertodd/orgs",
      "repos_url": "https://api.github.com/users/petertodd/repos",
      "events_url": "https://api.github.com/users/petertodd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/petertodd/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "d0c97bbe70a6876dadedfbf672387371c9c849d1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/d0c97bbe70a6876dadedfbf672387371c9c849d1",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/d0c97bbe70a6876dadedfbf672387371c9c849d1"
      }
    ],
    "stats": {
      "total": 16,
      "additions": 11,
      "deletions": 5
    },
    "files": [
      {
        "sha": "8a06f3d1187827fc994a7f62ab7e3ad7b7d12909",
        "filename": "src/script/interpreter.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2fa9a8ec86033b809a1c48f0396c3482c0d5d33c/src/script/interpreter.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2fa9a8ec86033b809a1c48f0396c3482c0d5d33c/src/script/interpreter.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/script/interpreter.cpp?ref=2fa9a8ec86033b809a1c48f0396c3482c0d5d33c",
        "patch": "@@ -189,6 +189,11 @@ bool static IsDefinedHashtypeSignature(const valtype &vchSig) {\n }\n \n bool static CheckSignatureEncoding(const valtype &vchSig, unsigned int flags, ScriptError* serror) {\n+    // Empty signature. Not strictly DER encoded, but allowed to provide a\n+    // compact way to provide an invalid signature for use with CHECK(MULTI)SIG\n+    if (vchSig.size() == 0) {\n+        return true;\n+    }\n     if ((flags & (SCRIPT_VERIFY_DERSIG | SCRIPT_VERIFY_LOW_S | SCRIPT_VERIFY_STRICTENC)) != 0 && !IsDERSignature(vchSig)) {\n         return set_error(serror, SCRIPT_ERR_SIG_DER);\n     } else if ((flags & SCRIPT_VERIFY_LOW_S) != 0 && !IsLowDERSignature(vchSig, serror)) {"
      },
      {
        "sha": "9a8fe1ee889e5e59bf2ebc53ae35cac84fd2a169",
        "filename": "src/test/data/script_invalid.json",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2fa9a8ec86033b809a1c48f0396c3482c0d5d33c/src/test/data/script_invalid.json",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2fa9a8ec86033b809a1c48f0396c3482c0d5d33c/src/test/data/script_invalid.json",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/data/script_invalid.json?ref=2fa9a8ec86033b809a1c48f0396c3482c0d5d33c",
        "patch": "@@ -504,7 +504,7 @@\n     \"2-of-2 CHECKMULTISIG NOT with the first pubkey invalid, and both signatures validly encoded.\"\n ],\n [\n-    \"0 0x47 0x3044022044dc17b0887c161bb67ba9635bf758735bdde503e4b0a0987f587f14a4e1143d022009a215772d49a85dae40d8ca03955af26ad3978a0ff965faa12915e9586249a501 0\",\n+    \"0 0x47 0x3044022044dc17b0887c161bb67ba9635bf758735bdde503e4b0a0987f587f14a4e1143d022009a215772d49a85dae40d8ca03955af26ad3978a0ff965faa12915e9586249a501 1\",\n     \"2 0x21 0x02865c40293a680cb9c020e7b1e106d8c1916d3cef99aa431a56d253e69256dac0 0x21 0x02865c40293a680cb9c020e7b1e106d8c1916d3cef99aa431a56d253e69256dac0 2 CHECKMULTISIG NOT\",\n     \"STRICTENC\",\n     \"2-of-2 CHECKMULTISIG NOT with both pubkeys valid, but first signature invalid.\""
      },
      {
        "sha": "a187401cd4aafd66fa84d1e53b34326b73ee0ca7",
        "filename": "src/test/data/script_valid.json",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2fa9a8ec86033b809a1c48f0396c3482c0d5d33c/src/test/data/script_valid.json",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2fa9a8ec86033b809a1c48f0396c3482c0d5d33c/src/test/data/script_valid.json",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/data/script_valid.json?ref=2fa9a8ec86033b809a1c48f0396c3482c0d5d33c",
        "patch": "@@ -662,6 +662,11 @@\n [\"0 0 0x02 0x0000\", \"CHECKMULTISIGVERIFY 1\", \"\"],\n [\"0 0x02 0x0000 0\", \"CHECKMULTISIGVERIFY 1\", \"\"],\n \n+[\"While not really correctly DER encoded, the empty signature is allowed by\"],\n+[\"STRICTENC to provide a compact way to provide a delibrately invalid signature.\"],\n+[\"0\", \"0x21 0x02865c40293a680cb9c020e7b1e106d8c1916d3cef99aa431a56d253e69256dac0 CHECKSIG NOT\", \"STRICTENC\"],\n+[\"0 0\", \"1 0x21 0x02865c40293a680cb9c020e7b1e106d8c1916d3cef99aa431a56d253e69256dac0 1 CHECKMULTISIG NOT\", \"STRICTENC\"],\n+\n [\"CHECKMULTISIG evaluation order tests. CHECKMULTISIG evaluates signatures and\"],\n [\"pubkeys in a specific order, and will exit early if the number of signatures\"],\n [\"left to check is greater than the number of keys left. As STRICTENC fails the\"],"
      },
      {
        "sha": "9501169943d97d0c007e0ffe7159ae8d382d525c",
        "filename": "src/test/multisig_tests.cpp",
        "status": "modified",
        "additions": 0,
        "deletions": 4,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2fa9a8ec86033b809a1c48f0396c3482c0d5d33c/src/test/multisig_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2fa9a8ec86033b809a1c48f0396c3482c0d5d33c/src/test/multisig_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/multisig_tests.cpp?ref=2fa9a8ec86033b809a1c48f0396c3482c0d5d33c",
        "patch": "@@ -116,10 +116,6 @@ BOOST_AUTO_TEST_CASE(multisig_verify)\n         }\n     }\n     s.clear();\n-    s << OP_0 << OP_0;\n-    BOOST_CHECK(!VerifyScript(s, a_or_b, flags, SignatureChecker(txTo[1], 0), &err));\n-    BOOST_CHECK_MESSAGE(err == SCRIPT_ERR_SIG_DER, ScriptErrorString(err));\n-    s.clear();\n     s << OP_0 << OP_1;\n     BOOST_CHECK(!VerifyScript(s, a_or_b, flags, SignatureChecker(txTo[1], 0), &err));\n     BOOST_CHECK_MESSAGE(err == SCRIPT_ERR_SIG_DER, ScriptErrorString(err));"
      }
    ]
  }
]