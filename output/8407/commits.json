[
  {
    "sha": "893f379ba0befef5301208b6bee8206ac4e76329",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4OTNmMzc5YmEwYmVmZWY1MzAxMjA4YjZiZWU4MjA2YWM0ZTc2MzI5",
    "commit": {
      "author": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2016-07-26T12:01:36Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2016-07-28T08:57:24Z"
      },
      "message": "[Qt] Add dbcache migration path",
      "tree": {
        "sha": "87862e64ca5f17e9d12a584f45c25f8c22f20840",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/87862e64ca5f17e9d12a584f45c25f8c22f20840"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/893f379ba0befef5301208b6bee8206ac4e76329",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "expired_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJXmcj1AAoJECnUvLZBb1PsoyYP/0ohmXATYOImO6N3/C/Qw3WY\nbSfdNSWVU5Cfp0cqhHbs2kwt2x40XrmadMULP0NDeaf7MPYF2VFpakFluAYuaUer\n38MpYCO9ziwh0ifQelQl6IlOWNBNkc406aIpUX4KZRF5UyI4g4ZFpmhs8MsNUaWa\nNAphngrQ3/KdIPyIc5U6EFcFJWBrCNNN/AHD5BKDnTEq0WZP/ONxOFZlH8lzbark\nzFRzkCwvq2BoGT97bVmLXwopATqrKgD5uqeREqoF29m1uGfvzbR9cQAmyTECxXmt\ndaPDgdoc1dg8IUUROpmDN6rr8h3I5POttTqG/ctPvqzMutp/vHQtSjhwpJlw1tc+\nzXVJVJtKKOfgWT3GzNQ+M8WhURi+YEJlcnFltsFPCl0C4vIihVcNW9uXEOMBYTqb\nI9V7rcDhQk9voTjvl1Nwm8Gm8Z51wesoov+I/o7BRHSYXgKR1nKM23sEdh7nCmls\np0zUAKmaZbP2jN14LfGg8kBRdOYljXBPIlSXgo+UGB4ifW/DR1rIeeK7HTwEMvfm\nhzkzLm4h+qOXTcn5o1yhaOFIJCJSXkDBiEg1pplkrDQV1tYnEo8V1BAiG3Etecfj\nEmDCtt9KzDsDM652ObDO604yNPixxmzA9ZQJw7nY8Wrv7ZOlVNE1f2pD5nABco80\nLddMUxEd382fgeg3ZRd+\n=C0dE\n-----END PGP SIGNATURE-----",
        "payload": "tree 87862e64ca5f17e9d12a584f45c25f8c22f20840\nparent 618c9dd8c651f15ea37a09d3ee4fa4426c75ac02\nauthor Jonas Schnelli <dev@jonasschnelli.ch> 1469534496 +0200\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1469696244 +0200\n\n[Qt] Add dbcache migration path\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/893f379ba0befef5301208b6bee8206ac4e76329",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/893f379ba0befef5301208b6bee8206ac4e76329",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/893f379ba0befef5301208b6bee8206ac4e76329/comments",
    "author": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "618c9dd8c651f15ea37a09d3ee4fa4426c75ac02",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/618c9dd8c651f15ea37a09d3ee4fa4426c75ac02",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/618c9dd8c651f15ea37a09d3ee4fa4426c75ac02"
      }
    ],
    "stats": {
      "total": 25,
      "additions": 24,
      "deletions": 1
    },
    "files": [
      {
        "sha": "684db71a8ce0328920f9833a77eaa3e4599885eb",
        "filename": "src/qt/optionsmodel.cpp",
        "status": "modified",
        "additions": 21,
        "deletions": 0,
        "changes": 21,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/893f379ba0befef5301208b6bee8206ac4e76329/src/qt/optionsmodel.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/893f379ba0befef5301208b6bee8206ac4e76329/src/qt/optionsmodel.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/optionsmodel.cpp?ref=893f379ba0befef5301208b6bee8206ac4e76329",
        "patch": "@@ -43,6 +43,8 @@ void OptionsModel::Init(bool resetSettings)\n     if (resetSettings)\n         Reset();\n \n+    checkAndMigrate();\n+\n     QSettings settings;\n \n     // Ensure restart flag is unset on client startup\n@@ -429,3 +431,22 @@ bool OptionsModel::isRestartRequired()\n     QSettings settings;\n     return settings.value(\"fRestartRequired\", false).toBool();\n }\n+\n+void OptionsModel::checkAndMigrate()\n+{\n+    // Migration of default values\n+    // Check if the QSettings container was already loaded with this client version\n+    QSettings settings;\n+    static const char strSettingsVersionKey[] = \"nSettingsVersion\";\n+    int settingsVersion = settings.contains(strSettingsVersionKey) ? settings.value(strSettingsVersionKey).toInt() : 0;\n+    if (settingsVersion < CLIENT_VERSION)\n+    {\n+        // -dbcache was bumped from 100 to 300 in 0.13\n+        // see https://github.com/bitcoin/bitcoin/pull/8273\n+        // force people to upgrade to the new value if they are using 100MB\n+        if (settingsVersion < 130000 && settings.contains(\"nDatabaseCache\") && settings.value(\"nDatabaseCache\").toLongLong() == 100)\n+            settings.setValue(\"nDatabaseCache\", (qint64)nDefaultDbCache);\n+\n+        settings.setValue(strSettingsVersionKey, CLIENT_VERSION);\n+    }\n+}\n\\ No newline at end of file"
      },
      {
        "sha": "b23b5f2607a6c67814d40744764702cd8fc77138",
        "filename": "src/qt/optionsmodel.h",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/893f379ba0befef5301208b6bee8206ac4e76329/src/qt/optionsmodel.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/893f379ba0befef5301208b6bee8206ac4e76329/src/qt/optionsmodel.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/optionsmodel.h?ref=893f379ba0befef5301208b6bee8206ac4e76329",
        "patch": "@@ -84,9 +84,11 @@ class OptionsModel : public QAbstractListModel\n     /* settings that were overriden by command-line */\n     QString strOverriddenByCommandLine;\n \n-    /// Add option to list of GUI options overridden through command line/config file\n+    // Add option to list of GUI options overridden through command line/config file\n     void addOverriddenOption(const std::string &option);\n \n+    // Check settings version and upgrade default values if required\n+    void checkAndMigrate();\n Q_SIGNALS:\n     void displayUnitChanged(int unit);\n     void coinControlFeaturesChanged(bool);"
      }
    ]
  }
]