jonasschnelli,2016-07-26T12:08:05Z,Fixes #https://github.com/bitcoin/bitcoin/issues/8406\n,https://github.com/bitcoin/bitcoin/pull/8407#issuecomment-235248563,235248563,
laanwj,2016-07-26T12:31:05Z,I like this solution; can you please move the upgrader to a separate function? I'm sure this won't be the last time we need this.\n,https://github.com/bitcoin/bitcoin/pull/8407#issuecomment-235253144,235253144,
jonasschnelli,2016-07-26T13:51:51Z,"Factored out, fixed @laanwj finding (explicit < 130000 check).\n",https://github.com/bitcoin/bitcoin/pull/8407#issuecomment-235273705,235273705,
jonasschnelli,2016-07-26T14:01:07Z,Added another commit that will ensure that the current default value will never be written to the disk.\nThis would simplify future changes.\n,https://github.com/bitcoin/bitcoin/pull/8407#issuecomment-235276569,235276569,
laanwj,2016-07-26T14:16:29Z,"Not sure about the second commit. If we're going to do something like that, we need a structured solution that will never write the default value for any setting to disk - as it's likely that next time we want to change the default for another option, and then singling out dbcache won't help at all.\nI think the upgrade approach is fine really.\n",https://github.com/bitcoin/bitcoin/pull/8407#issuecomment-235281151,235281151,
jonasschnelli,2016-07-27T11:16:22Z,Removed the second commit after discussion with @laanwj on IRC.\n,https://github.com/bitcoin/bitcoin/pull/8407#issuecomment-235556734,235556734,
laanwj,2016-07-28T09:28:33Z,"Tested ACK 893f379:\n- Testing upgrader: In `~/.config/Bitcoin/Bitcoin-Qt-testnet.conf` I set `nDatabaseCache=100`, and remove any previous `nSettingsVersion` line. After starting and quitting `bitcoin-qt -testnet`, `nDatabaseCache=300` and `nSettingsVersion=139900` :white_check_mark:\n- User changed it from the default before upgrading: In `~/.config/Bitcoin/Bitcoin-Qt-testnet.conf` I set `nDatab",https://github.com/bitcoin/bitcoin/pull/8407#issuecomment-235845578,235845578,
MarcoFalke,2016-07-28T13:44:40Z,"Fine for 0.13, but I think for 0.14 we should aim to properly support\ndefault values in qt. I will try to look at this after catching up\nwith the IRC log...\n",https://github.com/bitcoin/bitcoin/pull/8407#issuecomment-235898429,235898429,
laanwj,2016-07-26T12:36:34Z,"To reduce the scope for spurious settings changes, I think it makes sense to compare the version to a specific version (where the default was changed) for each upgrader case.\nE.g.\n\n``` c++\nint settingsVersion = settings.value(strSettingsVersionKey);\nif (settingsVersion < 130000 && settings.contains(""nDatabaseCache"") && settings.value(""nDatabaseCache"") == 100)\n```\n",https://github.com/bitcoin/bitcoin/pull/8407#discussion_r72239826,72239826,src/qt/optionsmodel.cpp
sipa,2016-07-26T12:44:04Z,"Would it be possible to treat a value of 0 (on disk) as ""default"", and\nwhenever a value equal to the current software default is to be written,\nwrite 0 instead?\n\nThat would simplify future changes...\n",https://github.com/bitcoin/bitcoin/pull/8407#discussion_r72240943,72240943,src/qt/optionsmodel.cpp
laanwj,2016-07-26T14:14:43Z,"Just thought of this: we need to handle the case `!settings.contains(strSettingsVersionKey)` inside the if() as well.\n\n``` c++\nint settingsVersion = settings.contains(strSettingsVersionKey) ? settings.value(strSettingsVersionKey) : 0;\nif (settingsVersion < CLIENT_VERSION) {\n    if (settingsVersion < 130000 && settings.contains(""nDatabaseCache"") && settings.value(""nDatabaseCache"") == 100)\n   ",https://github.com/bitcoin/bitcoin/pull/8407#discussion_r72257114,72257114,src/qt/optionsmodel.cpp
