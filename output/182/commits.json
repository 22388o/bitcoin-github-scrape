[
  {
    "sha": "ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphZDk3ZjMwNjViNGM3MmZkZDBiMWU4Y2JjYTFjMGQ0ZjQ3ZjYyOWYx",
    "commit": {
      "author": {
        "name": "Matt Corallo",
        "email": "matt@bluematt.me",
        "date": "2011-06-06T10:49:45Z"
      },
      "committer": {
        "name": "Matt Corallo",
        "email": "matt@bluematt.me",
        "date": "2011-06-06T11:23:38Z"
      },
      "message": "URI Support.  Mostly written by Luke-Jr.",
      "tree": {
        "sha": "6caeb075d725dbcbfd9069fc616128613c80b76f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6caeb075d725dbcbfd9069fc616128613c80b76f"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "352b4ea5b924412f3485290123fdf538cfdd8aa8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/352b4ea5b924412f3485290123fdf538cfdd8aa8",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/352b4ea5b924412f3485290123fdf538cfdd8aa8"
      }
    ],
    "stats": {
      "total": 171,
      "additions": 164,
      "deletions": 7
    },
    "files": [
      {
        "sha": "666a02fb31f564a4a3ce3f2df9f269cd2ddc94a3",
        "filename": "share/setup.nsi",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/share/setup.nsi",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/share/setup.nsi",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/share/setup.nsi?ref=ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1",
        "patch": "@@ -89,6 +89,10 @@ Section -post SEC0001\n     WriteRegStr HKCU \"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\$(^Name)\" UninstallString $INSTDIR\\uninstall.exe\r\n     WriteRegDWORD HKCU \"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\$(^Name)\" NoModify 1\r\n     WriteRegDWORD HKCU \"SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall\\$(^Name)\" NoRepair 1\r\n+    WriteRegStr HKCR \"bitcoin\" \"URL Protocol\" \"\"\r\n+    WriteRegStr HKCR \"bitcoin\" \"\" \"URL:Bitcoin\"\r\n+    WriteRegStr HKCR \"bitcoin\\DefaultIcon\" \"\" $INSTDIR\\bitcoin.exe\r\n+    WriteRegStr HKCR \"bitcoin\\shell\\open\\command\" \"\" '\"$INSTDIR\\bitcoin.exe\" \"$$1\"'\r\n SectionEnd\r\n \r\n # Macro for selecting uninstaller sections\r\n@@ -127,6 +131,7 @@ Section -un.post UNSEC0001\n     DeleteRegValue HKCU \"${REGKEY}\" Path\r\n     DeleteRegKey /IfEmpty HKCU \"${REGKEY}\\Components\"\r\n     DeleteRegKey /IfEmpty HKCU \"${REGKEY}\"\r\n+    DeleteRegKey HKCR \"bitcoin\"\r\n     RmDir /REBOOTOK $SMPROGRAMS\\$StartMenuGroup\r\n     RmDir /REBOOTOK $INSTDIR\r\n     Push $R0\r"
      },
      {
        "sha": "fe18255dbc3ea374f835988fc65000a875937e08",
        "filename": "src/headers.h",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/src/headers.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/src/headers.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/headers.h?ref=ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1",
        "patch": "@@ -33,6 +33,7 @@\n #include <wx/utils.h>\n #include <wx/clipbrd.h>\n #include <wx/taskbar.h>\n+#include <boost/interprocess/ipc/message_queue.hpp>\n #endif\n #include <openssl/buffer.h>\n #include <openssl/ecdsa.h>\n@@ -126,6 +127,7 @@\n #ifdef GUI\n #include \"uibase.h\"\n #include \"ui.h\"\n+#include \"wxipcserver.h\"\n #else\n #include \"noui.h\"\n #endif"
      },
      {
        "sha": "e9c1dbfe2e5a73fa38f38334cecca57f17bd6fdb",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 38,
        "deletions": 1,
        "changes": 39,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1",
        "patch": "@@ -33,6 +33,7 @@ void Shutdown(void* parg)\n     if (fFirstThread)\n     {\n         fShutdown = true;\n+        ipcShutdown();\n         nTransactionsUpdated++;\n         DBFlush(false);\n         StopNode();\n@@ -230,7 +231,7 @@ bool AppInit2(int argc, char* argv[])\n     fLogTimestamps = GetBoolArg(\"-logtimestamps\");\n \n     for (int i = 1; i < argc; i++)\n-        if (!IsSwitchChar(argv[i][0]))\n+        if (!IsSwitchChar(argv[i][0]) && !(strlen(argv[i]) > 7 && strncasecmp(argv[i], \"bitcoin:\", 8) == 0))\n             fCommandLine = true;\n \n     if (fCommandLine)\n@@ -239,6 +240,24 @@ bool AppInit2(int argc, char* argv[])\n         exit(ret);\n     }\n \n+#ifdef GUI\n+    // Check for URI in argv\n+    for (int i = 1; i < argc; i++)\n+    {\n+        if (strlen(argv[i]) > 7 && strncasecmp(argv[i], \"bitcoin:\", 8) == 0)\n+        {\n+            const char *strURI = argv[i];\n+            try {\n+                boost::interprocess::message_queue mqIPC(boost::interprocess::open_only, \"Bitcoin\");\n+                if(mqIPC.try_send(strURI, strlen(strURI), 0))\n+                    exit(0);\n+            }\n+            catch (boost::interprocess::interprocess_exception &ex) {\n+            }\n+        }\n+    }\n+#endif\n+\n #ifndef __WXMSW__\n     if (fDaemon)\n     {\n@@ -516,5 +535,23 @@ bool AppInit2(int argc, char* argv[])\n         Sleep(5000);\n #endif\n \n+#ifdef GUI\n+    ipcInit();\n+    // Check for URI in argv\n+    for (int i = 1; i < argc; i++)\n+    {\n+        if (strlen(argv[i]) > 7 && strncasecmp(argv[i], \"bitcoin:\", 8) == 0)\n+        {\n+            const char *strURI = argv[i];\n+            try {\n+                boost::interprocess::message_queue mqIPC(boost::interprocess::open_only, \"Bitcoin\");\n+                mqIPC.try_send(strURI, strlen(strURI), 0);\n+            }\n+            catch (boost::interprocess::interprocess_exception &ex) {\n+            }\n+        }\n+    }\n+#endif\n+\n     return true;\n }"
      },
      {
        "sha": "20b9a4df6f5594dbcbe7d14097c03f1a50029adf",
        "filename": "src/makefile.mingw",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/src/makefile.mingw",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/src/makefile.mingw",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/makefile.mingw?ref=ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1",
        "patch": "@@ -69,7 +69,7 @@ cryptopp/obj/%.o: cryptopp/%.cpp\n obj/ui_res.o: ../share/ui.rc  ../share/pixmaps/bitcoin.ico ../share/pixmaps/check.ico ../share/pixmaps/send16.bmp ../share/pixmaps/send16mask.bmp ../share/pixmaps/send16masknoshadow.bmp ../share/pixmaps/send20.bmp ../share/pixmaps/send20mask.bmp ../share/pixmaps/addressbook16.bmp ../share/pixmaps/addressbook16mask.bmp ../share/pixmaps/addressbook20.bmp ../share/pixmaps/addressbook20mask.bmp\n \twindres $(DEFS) $(INCLUDEPATHS) -o $@ -i $<\n \n-bitcoin.exe: $(OBJS) obj/ui.o obj/uibase.o obj/ui_res.o\n+bitcoin.exe: $(OBJS) obj/ui.o obj/uibase.o obj/ui_res.o obj/wxipcserver.o\n \tg++ $(CFLAGS) -mwindows -Wl,--subsystem,windows -o $@ $(LIBPATHS) $^ $(WXLIBS) $(LIBS)\n \n "
      },
      {
        "sha": "b0ad2404649981a6b96cdef5672274e152bd02b2",
        "filename": "src/makefile.osx",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/src/makefile.osx",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/src/makefile.osx",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/makefile.osx?ref=ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1",
        "patch": "@@ -62,7 +62,7 @@ obj/%.o: %.cpp $(HEADERS)\n cryptopp/obj/%.o: cryptopp/%.cpp\n \t$(CXX) -c $(CFLAGS) -O3 -DCRYPTOPP_DISABLE_ASM -o $@ $<\n \n-bitcoin: $(OBJS) obj/ui.o obj/uibase.o\n+bitcoin: $(OBJS) obj/ui.o obj/uibase.o obj/wxipcserver.o\n \t$(CXX) $(CFLAGS) -o $@ $(LIBPATHS) $^ $(WXLIBS) $(LIBS)\n \n "
      },
      {
        "sha": "06c4fc7dc85a5051af1e8da547e7edbaf7d7f534",
        "filename": "src/makefile.unix",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/src/makefile.unix",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/src/makefile.unix",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/makefile.unix?ref=ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1",
        "patch": "@@ -63,7 +63,7 @@ obj/%.o: %.cpp $(HEADERS)\n cryptopp/obj/%.o: cryptopp/%.cpp\n \t$(CXX) -c $(CXXFLAGS) -O3 -o $@ $<\n \n-bitcoin: $(OBJS) obj/ui.o obj/uibase.o\n+bitcoin: $(OBJS) obj/ui.o obj/uibase.o  obj/wxipcserver.o\n \t$(CXX) $(CXXFLAGS) -o $@ $^ $(WXLIBS) $(LIBS)\n \n "
      },
      {
        "sha": "eb191c653cf383848eece01238734b64dbec366a",
        "filename": "src/ui.cpp",
        "status": "modified",
        "additions": 8,
        "deletions": 2,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/src/ui.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/src/ui.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/ui.cpp?ref=ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1",
        "patch": "@@ -1836,10 +1836,12 @@ void CAboutDialog::OnButtonOK(wxCommandEvent& event)\n // CSendDialog\n //\n \n-CSendDialog::CSendDialog(wxWindow* parent, const wxString& strAddress) : CSendDialogBase(parent)\n+CSendDialog::CSendDialog(wxWindow* parent, const wxString& strAddress, const int64 amount) : CSendDialogBase(parent)\n {\n     // Init\n     m_textCtrlAddress->SetValue(strAddress);\n+    if (amount)\n+        m_textCtrlAmount->SetValue(FormatMoney(amount));\n     m_choiceTransferType->SetSelection(0);\n     m_bitmapCheckMark->Show(false);\n     fEnabledPrev = true;\n@@ -2786,8 +2788,12 @@ IMPLEMENT_APP(CMyApp)\n bool CMyApp::Initialize(int& argc, wxChar** argv)\n {\n     for (int i = 1; i < argc; i++)\n-        if (!IsSwitchChar(argv[i][0]))\n+    {\n+        wxString str = argv[i];\n+        wxString str2 = \"bitcoin:\";\n+        if (!IsSwitchChar(argv[i][0]) && !(str.size() > 7 && str.Find(str2) != wxNOT_FOUND))\n             fCommandLine = true;\n+    }\n \n     if (!fCommandLine)\n     {"
      },
      {
        "sha": "36481089aa9056f9552584886be2bb34092cd3a1",
        "filename": "src/ui.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/src/ui.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/src/ui.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/ui.h?ref=ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1",
        "patch": "@@ -174,7 +174,7 @@ class CSendDialog : public CSendDialogBase\n \t\n public:\n     /** Constructor */\n-    CSendDialog(wxWindow* parent, const wxString& strAddress=\"\");\n+    CSendDialog(wxWindow* parent, const wxString& strAddress=\"\", const int64 amount=0);\n \n     // Custom\n     bool fEnabledPrev;"
      },
      {
        "sha": "c0528b3e6cd447230208775881d7d582a9f6afe3",
        "filename": "src/wxipcserver.cpp",
        "status": "added",
        "additions": 105,
        "deletions": 0,
        "changes": 105,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/src/wxipcserver.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/src/wxipcserver.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wxipcserver.cpp?ref=ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1",
        "patch": "@@ -0,0 +1,105 @@\n+// Copyright (c) 2011 Luke Dashjr\n+// Distributed under the MIT/X11 software license, see the accompanying\n+// file license.txt or http://www.opensource.org/licenses/mit-license.php.\n+\n+#include <boost/algorithm/string.hpp>\n+#include <boost/interprocess/ipc/message_queue.hpp>\n+#include <boost/tokenizer.hpp>\n+\n+#include \"headers.h\"\n+\n+using namespace boost::interprocess;\n+using namespace boost;\n+using namespace std;\n+\n+extern CMainFrame* pframeMain;\n+\n+void ipcHandleURI_wx(const string strAddress, int64 nAmount)\n+{\n+    CSendDialog dialogSend(pframeMain, strAddress, nAmount);\n+    dialogSend.ShowModal();\n+}\n+\n+const wxChar *ipcHandleURI_i(const string strURI)\n+{\n+    if (!boost::iequals(strURI.substr(0, 8), \"bitcoin:\"))\n+        return wxT(\"URI doesn't begin with 'bitcoin:'\");\n+    string strAddress;\n+    int64 nAmount = 0;\n+    size_t nPos;\n+\n+    nPos = strURI.find('?');\n+    if (nPos == string::npos)\n+    {\n+        strAddress = strURI.substr(8);\n+    }\n+    else\n+    {\n+        // Parse query string\n+        strAddress = strURI.substr(8, nPos - 8);\n+        char_separator<char> sepParams(\";?&\");\n+        tokenizer< char_separator<char> > tokParams(strURI.substr(nPos + 1), sepParams);\n+        string strKey, strValue;\n+        BOOST_FOREACH(string strKey, tokParams)\n+        {\n+            nPos = strKey.find('=');\n+            if (nPos == string::npos)\n+                strValue = \"1\";\n+            else\n+                strValue = strKey.substr(nPos + 1);\n+                strKey = strKey.substr(0, nPos);\n+            if (strKey == \"amount\")\n+                ParseMoney(strValue, nAmount);\n+        }\n+    }\n+\n+    UIThreadCall(bind(ipcHandleURI_wx, strAddress, nAmount));\n+\n+    return NULL;\n+}\n+\n+void ipcHandleURI(const string strURI) {\n+    const wxChar *strError = ipcHandleURI_i(strURI);\n+    if (!strError)\n+        return;\n+    UIThreadCall(bind(wxMessageBox, strError, wxT(\"Error\"), wxICON_ERROR | wxOK, (wxWindow*)NULL, -1, -1));\n+}\n+\n+void ipcShutdown();\n+\n+void ipcThread(void* parg)\n+{\n+    message_queue* mqIPC = (message_queue*)parg;\n+    char strBuf[256+1];\n+    size_t nSize;\n+    unsigned int nPriority;\n+    while (true)\n+    {\n+        mqIPC->receive(&strBuf, sizeof(strBuf), nSize, nPriority);\n+        strBuf[nSize] = '\\0';\n+        ipcHandleURI(strBuf);\n+    }\n+    ipcShutdown();\n+}\n+\n+int ipcInit()\n+{\n+    message_queue* mqIPC;\n+    try {\n+        mqIPC = new message_queue(open_or_create, \"Bitcoin\", 2, 256);\n+    }\n+    catch (interprocess_exception &ex) {\n+        return 1;\n+    }\n+    if (!CreateThread(ipcThread, mqIPC))\n+    {\n+        delete mqIPC;\n+        return 2;\n+    }\n+    return 0;\n+}\n+\n+void ipcShutdown()\n+{\n+    message_queue::remove(\"Bitcoin\");\n+}"
      },
      {
        "sha": "7663dd94358d901c26d9a1b9e7368c15b1a9e524",
        "filename": "src/wxipcserver.h",
        "status": "added",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/src/wxipcserver.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1/src/wxipcserver.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wxipcserver.h?ref=ad97f3065b4c72fdd0b1e8cbca1c0d4f47f629f1",
        "patch": "@@ -0,0 +1,2 @@\n+int ipcInit();\n+void ipcShutdown();"
      }
    ]
  }
]