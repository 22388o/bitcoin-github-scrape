[
  {
    "sha": "765e0be5347e9d85cee03255204d94119e4cbf38",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3NjVlMGJlNTM0N2U5ZDg1Y2VlMDMyNTUyMDRkOTQxMTllNGNiZjM4",
    "commit": {
      "author": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2021-03-17T04:06:29Z"
      },
      "committer": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2021-03-30T06:54:08Z"
      },
      "message": "build: split native_cctools",
      "tree": {
        "sha": "3651c9087b924bd13755f38f6659df62994b51dd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/3651c9087b924bd13755f38f6659df62994b51dd"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/765e0be5347e9d85cee03255204d94119e4cbf38",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEz7FuIclQ9n+pXlWPLuufXMCVJsEFAmBiyxIACgkQLuufXMCV\nJsFGXxAAh16N9AvofRk+hRcWWheX2MKaXq4V5G4UvCnNOXnQDe3n5ihLTUMaFekq\n9oNbZI0O/CY2P71eyyzbf+bjwq3XZPMMLpAem6aUBivmV+b3JJzcrQujcefYntyf\ni8PuX11CiBEkHDNQSgqZ3WXi/s+EDASKIKLjkvWQk2jI66XjFFWt+eiwBurc+UIe\njq+UVGDoq6XK/BwbTqKrbfn3PWldKKBe2lZz6JDzaUFm/nlBr60llWL4BhRlrhhB\npf+y60QhuHq+v6ldZGnZ7ubs6U/Q/tYrpGlKXLok8VkKFQB+PLl3yHA0UZ+hy0tU\nx21RO4fVcG/oNoFswZxrx8h2NnighdJvPmvLW/41fFBDWthnVBtdw3RB+R85jB74\n160nAe8R4L3DYwQsYVqop7p+SzlPxWZmAjxtF1+bpy8MHPo/jQ6xAieTZ07BsSxN\n43COAb4x9nqP6VBT+BswIUW+aG37jxppQ1MvmpV+CgM7Qz7pae+BhNqIJiQUIJEm\nOoCAIe/gCAgAYcJJGyt0LK2rSWP+v4qcsJQkap1T6iQJzazgKOd2IVQl9ZnbO2B7\nGj9l+uVOw3HtAsyrqBbE0MK4ouSfa82EIZwVjdssxNLp+tII1wbmJ9YoM9ZAbnmK\neJE9byIUMJS4ZMOxuFHz134Dl9jwq1NEO9oJMlNOgoWJPNxVSGE=\n=wpXx\n-----END PGP SIGNATURE-----",
        "payload": "tree 3651c9087b924bd13755f38f6659df62994b51dd\nparent 3ececa76b70cbc5b0eaba3a0ddf72f9bd681d906\nauthor fanquake <fanquake@gmail.com> 1615953989 +0800\ncommitter fanquake <fanquake@gmail.com> 1617087248 +0800\n\nbuild: split native_cctools\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/765e0be5347e9d85cee03255204d94119e4cbf38",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/765e0be5347e9d85cee03255204d94119e4cbf38",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/765e0be5347e9d85cee03255204d94119e4cbf38/comments",
    "author": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "3ececa76b70cbc5b0eaba3a0ddf72f9bd681d906",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3ececa76b70cbc5b0eaba3a0ddf72f9bd681d906",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3ececa76b70cbc5b0eaba3a0ddf72f9bd681d906"
      }
    ],
    "stats": {
      "total": 154,
      "additions": 63,
      "deletions": 91
    },
    "files": [
      {
        "sha": "dd71697f0fca49bcc37375ae57ec0441438bca53",
        "filename": "depends/hosts/darwin.mk",
        "status": "modified",
        "additions": 2,
        "deletions": 3,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/765e0be5347e9d85cee03255204d94119e4cbf38/depends/hosts/darwin.mk",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/765e0be5347e9d85cee03255204d94119e4cbf38/depends/hosts/darwin.mk",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/hosts/darwin.mk?ref=765e0be5347e9d85cee03255204d94119e4cbf38",
        "patch": "@@ -12,14 +12,13 @@ ifeq ($(strip $(FORCE_USE_SYSTEM_CLANG)),)\n # FORCE_USE_SYSTEM_CLANG is empty, so we use our depends-managed, pinned clang\n # from llvm.org\n \n-# The native_cctools package is what provides clang when FORCE_USE_SYSTEM_CLANG\n-# is empty\n+# Clang is a dependency of native_cctools when FORCE_USE_SYSTEM_CLANG is empty\n darwin_native_toolchain=native_cctools\n \n clang_prog=$(build_prefix)/bin/clang\n clangxx_prog=$(clang_prog)++\n \n-clang_resource_dir=$(build_prefix)/lib/clang/$(native_cctools_clang_version)\n+clang_resource_dir=$(build_prefix)/lib/clang/$(native_clang_version)\n else\n # FORCE_USE_SYSTEM_CLANG is non-empty, so we use the clang from the user's\n # system"
      },
      {
        "sha": "c789dab74cb814a1f01df4726a1270b5be2d3075",
        "filename": "depends/packages/native_cctools.mk",
        "status": "modified",
        "additions": 9,
        "deletions": 87,
        "changes": 96,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/765e0be5347e9d85cee03255204d94119e4cbf38/depends/packages/native_cctools.mk",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/765e0be5347e9d85cee03255204d94119e4cbf38/depends/packages/native_cctools.mk",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/packages/native_cctools.mk?ref=765e0be5347e9d85cee03255204d94119e4cbf38",
        "patch": "@@ -5,81 +5,19 @@ $(package)_file_name=$($(package)_version).tar.gz\n $(package)_sha256_hash=e51995a843533a3dac155dd0c71362dd471597a2d23f13dff194c6285362f875\n $(package)_build_subdir=cctools\n $(package)_patches=ld64_disable_threading.patch\n-\n-ifeq ($(strip $(FORCE_USE_SYSTEM_CLANG)),)\n-$(package)_clang_version=8.0.0\n-$(package)_clang_download_path=https://releases.llvm.org/$($(package)_clang_version)\n-$(package)_clang_download_file=clang+llvm-$($(package)_clang_version)-x86_64-linux-gnu-ubuntu-14.04.tar.xz\n-$(package)_clang_file_name=clang-llvm-$($(package)_clang_version)-x86_64-linux-gnu-ubuntu-14.04.tar.xz\n-$(package)_clang_sha256_hash=9ef854b71949f825362a119bf2597f744836cb571131ae6b721cd102ffea8cd0\n-endif\n-\n-$(package)_libtapi_version=3efb201881e7a76a21e0554906cf306432539cef\n-$(package)_libtapi_download_path=https://github.com/tpoechtrager/apple-libtapi/archive\n-$(package)_libtapi_download_file=$($(package)_libtapi_version).tar.gz\n-$(package)_libtapi_file_name=$($(package)_libtapi_version).tar.gz\n-$(package)_libtapi_sha256_hash=380c1ca37cfa04a8699d0887a8d3ee1ad27f3d08baba78887c73b09485c0fbd3\n-\n-$(package)_extra_sources=$($(package)_libtapi_file_name)\n-ifeq ($(strip $(FORCE_USE_SYSTEM_CLANG)),)\n-$(package)_extra_sources += $($(package)_clang_file_name)\n-endif\n-\n-ifeq ($(strip $(FORCE_USE_SYSTEM_CLANG)),)\n-define $(package)_fetch_cmds\n-$(call fetch_file,$(package),$($(package)_download_path),$($(package)_download_file),$($(package)_file_name),$($(package)_sha256_hash)) && \\\n-$(call fetch_file,$(package),$($(package)_clang_download_path),$($(package)_clang_download_file),$($(package)_clang_file_name),$($(package)_clang_sha256_hash)) && \\\n-$(call fetch_file,$(package),$($(package)_libtapi_download_path),$($(package)_libtapi_download_file),$($(package)_libtapi_file_name),$($(package)_libtapi_sha256_hash))\n-endef\n-else\n-define $(package)_fetch_cmds\n-$(call fetch_file,$(package),$($(package)_download_path),$($(package)_download_file),$($(package)_file_name),$($(package)_sha256_hash)) && \\\n-$(call fetch_file,$(package),$($(package)_libtapi_download_path),$($(package)_libtapi_download_file),$($(package)_libtapi_file_name),$($(package)_libtapi_sha256_hash))\n-endef\n-endif\n-\n-ifeq ($(strip $(FORCE_USE_SYSTEM_CLANG)),)\n-define $(package)_extract_cmds\n-  mkdir -p $($(package)_extract_dir) && \\\n-  echo \"$($(package)_sha256_hash)  $($(package)_source)\" > $($(package)_extract_dir)/.$($(package)_file_name).hash && \\\n-  echo \"$($(package)_clang_sha256_hash)  $($(package)_source_dir)/$($(package)_clang_file_name)\" >> $($(package)_extract_dir)/.$($(package)_file_name).hash && \\\n-  echo \"$($(package)_libtapi_sha256_hash)  $($(package)_source_dir)/$($(package)_libtapi_file_name)\" >> $($(package)_extract_dir)/.$($(package)_file_name).hash && \\\n-  $(build_SHA256SUM) -c $($(package)_extract_dir)/.$($(package)_file_name).hash && \\\n-  mkdir -p toolchain/bin toolchain/lib/clang/$($(package)_clang_version)/include && \\\n-  mkdir -p libtapi && \\\n-  tar --no-same-owner --strip-components=1 -C libtapi -xf $($(package)_source_dir)/$($(package)_libtapi_file_name) && \\\n-  tar --no-same-owner --strip-components=1 -C toolchain -xf $($(package)_source_dir)/$($(package)_clang_file_name) && \\\n-  rm -f toolchain/lib/libc++abi.so* && \\\n-  tar --no-same-owner --strip-components=1 -xf $($(package)_source)\n-endef\n-else\n-define $(package)_extract_cmds\n-  mkdir -p $($(package)_extract_dir) && \\\n-  echo \"$($(package)_sha256_hash)  $($(package)_source)\" > $($(package)_extract_dir)/.$($(package)_file_name).hash && \\\n-  echo \"$($(package)_libtapi_sha256_hash)  $($(package)_source_dir)/$($(package)_libtapi_file_name)\" >> $($(package)_extract_dir)/.$($(package)_file_name).hash && \\\n-  $(build_SHA256SUM) -c $($(package)_extract_dir)/.$($(package)_file_name).hash && \\\n-  mkdir -p libtapi && \\\n-  tar --no-same-owner --strip-components=1 -C libtapi -xf $($(package)_source_dir)/$($(package)_libtapi_file_name) && \\\n-  tar --no-same-owner --strip-components=1 -xf $($(package)_source)\n-endef\n-endif\n+$(package)_dependencies=native_libtapi\n \n define $(package)_set_vars\n-  $(package)_config_opts=--target=$(host) --with-libtapi=$($(package)_extract_dir)\n+  $(package)_config_opts=--target=$(host)\n   $(package)_ldflags+=-Wl,-rpath=\\\\$$$$$$$$\\$$$$$$$$ORIGIN/../lib\n   ifeq ($(strip $(FORCE_USE_SYSTEM_CLANG)),)\n-  $(package)_config_opts+=--enable-lto-support --with-llvm-config=$($(package)_extract_dir)/toolchain/bin/llvm-config\n-  $(package)_cc=$($(package)_extract_dir)/toolchain/bin/clang\n-  $(package)_cxx=$($(package)_extract_dir)/toolchain/bin/clang++\n-  else\n-  $(package)_cc=clang\n-  $(package)_cxx=clang++\n+  $(package)_config_opts+=--enable-lto-support --with-llvm-config=$(build_prefix)/bin/llvm-config\n   endif\n+  $(package)_cc=$(clang_prog)\n+  $(package)_cxx=$(clangxx_prog)\n endef\n \n define $(package)_preprocess_cmds\n-  CC=$($(package)_cc) CXX=$($(package)_cxx) INSTALLPREFIX=$($(package)_extract_dir) ./libtapi/build.sh && \\\n-  CC=$($(package)_cc) CXX=$($(package)_cxx) INSTALLPREFIX=$($(package)_extract_dir) ./libtapi/install.sh && \\\n   patch -p1 < $($(package)_patch_dir)/ld64_disable_threading.patch\n endef\n \n@@ -91,26 +29,10 @@ define $(package)_build_cmds\n   $(MAKE)\n endef\n \n-ifeq ($(strip $(FORCE_USE_SYSTEM_CLANG)),)\n define $(package)_stage_cmds\n-  $(MAKE) DESTDIR=$($(package)_staging_dir) install && \\\n-  mkdir -p $($(package)_staging_prefix_dir)/lib/ && \\\n-  cd $($(package)_extract_dir) && \\\n-  cp lib/libtapi.so.6 $($(package)_staging_prefix_dir)/lib/ && \\\n-  cd $($(package)_extract_dir)/toolchain && \\\n-  mkdir -p $($(package)_staging_prefix_dir)/lib/clang/$($(package)_clang_version)/include && \\\n-  mkdir -p $($(package)_staging_prefix_dir)/bin $($(package)_staging_prefix_dir)/include && \\\n-  cp bin/clang $($(package)_staging_prefix_dir)/bin/ &&\\\n-  cp -P bin/clang++ $($(package)_staging_prefix_dir)/bin/ &&\\\n-  cp lib/libLTO.so $($(package)_staging_prefix_dir)/lib/ && \\\n-  cp -rf lib/clang/$($(package)_clang_version)/include/* $($(package)_staging_prefix_dir)/lib/clang/$($(package)_clang_version)/include/ && \\\n-  cp bin/dsymutil $($(package)_staging_prefix_dir)/bin/$(host)-dsymutil\n+  $(MAKE) DESTDIR=$($(package)_staging_dir) install\n endef\n-else\n-define $(package)_stage_cmds\n-  $(MAKE) DESTDIR=$($(package)_staging_dir) install && \\\n-  mkdir -p $($(package)_staging_prefix_dir)/lib/ && \\\n-  cd $($(package)_extract_dir) && \\\n-  cp lib/libtapi.so.6 $($(package)_staging_prefix_dir)/lib/\n+\n+define $(package)_postprocess_cmds\n+  rm -rf share\n endef\n-endif"
      },
      {
        "sha": "741ddacf09946df9795317766dd838ef84e9c732",
        "filename": "depends/packages/native_clang.mk",
        "status": "added",
        "additions": 26,
        "deletions": 0,
        "changes": 26,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/765e0be5347e9d85cee03255204d94119e4cbf38/depends/packages/native_clang.mk",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/765e0be5347e9d85cee03255204d94119e4cbf38/depends/packages/native_clang.mk",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/packages/native_clang.mk?ref=765e0be5347e9d85cee03255204d94119e4cbf38",
        "patch": "@@ -0,0 +1,26 @@\n+package=native_clang\n+$(package)_version=8.0.0\n+$(package)_download_path=https://releases.llvm.org/$($(package)_version)\n+$(package)_download_file=clang+llvm-$($(package)_version)-x86_64-linux-gnu-ubuntu-14.04.tar.xz\n+$(package)_file_name=clang-llvm-$($(package)_version)-x86_64-linux-gnu-ubuntu-14.04.tar.xz\n+$(package)_sha256_hash=9ef854b71949f825362a119bf2597f744836cb571131ae6b721cd102ffea8cd0\n+\n+define $(package)_preprocess_cmds\n+  rm -f $($(package)_extract_dir)/lib/libc++abi.so*\n+endef\n+\n+define $(package)_stage_cmds\n+  mkdir -p $($(package)_staging_prefix_dir)/lib/clang/$($(package)_version)/include && \\\n+  mkdir -p $($(package)_staging_prefix_dir)/bin && \\\n+  mkdir -p $($(package)_staging_prefix_dir)/include && \\\n+  cp bin/clang $($(package)_staging_prefix_dir)/bin/ && \\\n+  cp -P bin/clang++ $($(package)_staging_prefix_dir)/bin/ && \\\n+  cp bin/dsymutil $($(package)_staging_prefix_dir)/bin/$(host)-dsymutil && \\\n+  cp bin/llvm-config $($(package)_staging_prefix_dir)/bin/ && \\\n+  cp lib/libLTO.so $($(package)_staging_prefix_dir)/lib/ && \\\n+  cp -rf lib/clang/$($(package)_version)/include/* $($(package)_staging_prefix_dir)/lib/clang/$($(package)_version)/include/\n+endef\n+\n+define $(package)_postprocess_cmds\n+  rmdir include\n+endef"
      },
      {
        "sha": "d7ac4156a7475002fbc9d90dadd72aa3f1f102d9",
        "filename": "depends/packages/native_libtapi.mk",
        "status": "added",
        "additions": 20,
        "deletions": 0,
        "changes": 20,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/765e0be5347e9d85cee03255204d94119e4cbf38/depends/packages/native_libtapi.mk",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/765e0be5347e9d85cee03255204d94119e4cbf38/depends/packages/native_libtapi.mk",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/packages/native_libtapi.mk?ref=765e0be5347e9d85cee03255204d94119e4cbf38",
        "patch": "@@ -0,0 +1,20 @@\n+package=native_libtapi\n+$(package)_version=3efb201881e7a76a21e0554906cf306432539cef\n+$(package)_download_path=https://github.com/tpoechtrager/apple-libtapi/archive\n+$(package)_download_file=$($(package)_version).tar.gz\n+$(package)_file_name=$($(package)_version).tar.gz\n+$(package)_sha256_hash=380c1ca37cfa04a8699d0887a8d3ee1ad27f3d08baba78887c73b09485c0fbd3\n+\n+ifeq ($(strip $(FORCE_USE_SYSTEM_CLANG)),)\n+$(package)_dependencies=native_clang\n+endif\n+\n+define $(package)_build_cmds\n+  CC=$(clang_prog) CXX=$(clangxx_prog) INSTALLPREFIX=$($(package)_staging_prefix_dir) ./build.sh\n+endef\n+\n+define $(package)_stage_cmds\n+  ./install.sh && \\\n+  mkdir -p $($(package)_staging_prefix_dir)/include/llvm-c && \\\n+  cp src/llvm/include/llvm-c/lto.h $($(package)_staging_prefix_dir)/include/llvm-c\n+endef"
      },
      {
        "sha": "9094e327ef5b0103c370916b7ee0cb074f950a03",
        "filename": "depends/packages/packages.mk",
        "status": "modified",
        "additions": 6,
        "deletions": 1,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/765e0be5347e9d85cee03255204d94119e4cbf38/depends/packages/packages.mk",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/765e0be5347e9d85cee03255204d94119e4cbf38/depends/packages/packages.mk",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/packages/packages.mk?ref=765e0be5347e9d85cee03255204d94119e4cbf38",
        "patch": "@@ -24,5 +24,10 @@ darwin_native_packages = native_ds_store native_mac_alias\n $(host_arch)_$(host_os)_native_packages += native_b2\n \n ifneq ($(build_os),darwin)\n-darwin_native_packages += native_cctools native_libdmg-hfsplus\n+darwin_native_packages += native_cctools native_libtapi native_libdmg-hfsplus\n+\n+ifeq ($(strip $(FORCE_USE_SYSTEM_CLANG)),)\n+darwin_native_packages+= native_clang\n+endif\n+\n endif"
      }
    ]
  }
]