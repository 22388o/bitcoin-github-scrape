[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/598535986",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-598535986",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 598535986,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5ODUzNTk4Ng==",
    "user": {
      "login": "DrahtBot",
      "id": 39886733,
      "node_id": "MDQ6VXNlcjM5ODg2NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39886733?u=3c1e73d828cf5a5850dfc25c8397c1cf751db5ac&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DrahtBot",
      "html_url": "https://github.com/DrahtBot",
      "followers_url": "https://api.github.com/users/DrahtBot/followers",
      "following_url": "https://api.github.com/users/DrahtBot/following{/other_user}",
      "gists_url": "https://api.github.com/users/DrahtBot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DrahtBot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DrahtBot/subscriptions",
      "organizations_url": "https://api.github.com/users/DrahtBot/orgs",
      "repos_url": "https://api.github.com/users/DrahtBot/repos",
      "events_url": "https://api.github.com/users/DrahtBot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DrahtBot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-13T03:54:59Z",
    "updated_at": "2020-03-30T13:45:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #18469 (Build: Move wallet RPCs to their own libbitcoin_walletrpcs module by luke-jr)\n* #18354 (Protect wallet by using shared pointers by bvbfan)\n* #15761 (Replace -upgradewallet startup option with upgradewallet RPC by achow101)\n* #10102 ([experimental] Multiprocess bitcoin by ryanofsky)\n\nIf you consider this pull request important, please also help to review the conflicting pull requests. Ideally, start with the one that should be merged first.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/598535986/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/598559646",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-598559646",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 598559646,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5ODU1OTY0Ng==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-13T05:42:19Z",
    "updated_at": "2020-03-13T05:42:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "I wrote a test for new register/unregister functions that could be added here: d65b4874fda47aad2e412f0e0cac27e8eafb3838 ([branch](https://github.com/ryanofsky/bitcoin/commits/review.18338.1-edit))",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/598559646/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/598721224",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-598721224",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 598721224,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5ODcyMTIyNA==",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?u=273eaa7bf010cbd99b0bb7364172b4870a830aba&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-13T13:31:59Z",
    "updated_at": "2020-03-13T13:35:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "> unregister from notifications earlier in UnloadWallet instead of\r\nReleaseWallet, and use a new RegisterSharedValidationInterface function to\r\nprevent the CValidationInterface shared_ptr from being deleted until the last\r\nnotification is actually finished.\r\n\r\nDoes not fix the root issue, which is notification thread hold mutex (no matter when notification is disconnected if it's the last instance of the wallet) then goes in Release wallet, flush, then deleting mutex while it's hold is SIGSEGV. Unit test does not do anything to ensure that.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/598721224/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/598742979",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-598742979",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 598742979,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5ODc0Mjk3OQ==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-13T14:19:11Z",
    "updated_at": "2020-03-13T14:19:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Does not fix the root issue, which is notification thread hold mutex (no matter when notification is disconnected if it's the last instance of the wallet) then goes in Release wallet, flush, then deleting mutex while it's hold is SIGSEGV. Unit test does not do anything to ensure that.\r\n\r\nCan you give instructions to reproduce the issue or post a backtrace of the SIGSEGV? ReleaseWallet should not be called during a notification because ReleaseWallet is only called when the shared pointer reference count reaches 0. The unit test verifies that the reference count doesn't reach 0 during a notification until after the notification callback method returns, by checking that the destructor is called only after the callback returns.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/598742979/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599022346",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-599022346",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 599022346,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTAyMjM0Ng==",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?u=273eaa7bf010cbd99b0bb7364172b4870a830aba&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-14T07:24:06Z",
    "updated_at": "2020-03-14T07:24:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "```\r\n#!/bin/bash\r\nwhile [ 1 ]\r\ndo\r\n    src/bitcoin-cli -testnet loadwallet test\r\n    src/bitcoin-cli -testnet unloadwallet test\r\ndone\r\n```\r\nRunning on testnet from scratch in parallel with this script it should not crash. Whole point of `EmptyQueue` was to not have notification holding wallet mutex while we delete it.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599022346/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599286541",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-599286541",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 599286541,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTI4NjU0MQ==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-16T00:17:46Z",
    "updated_at": "2020-03-16T00:17:46Z",
    "author_association": "MEMBER",
    "body": "@bvbfan that script crashes `bitcoin-qt -regtest -server -printtoconsole`.\r\n\r\nStill investigating but looking at call stack it's caused by queued connections \"in flight\" (like `WalletController::walletAdded(WalletModel*)`) while the wallet model is deleted in `WalletController::removeAndDeleteWallet`.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599286541/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599504930",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-599504930",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 599504930,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTUwNDkzMA==",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?u=273eaa7bf010cbd99b0bb7364172b4870a830aba&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-16T12:18:15Z",
    "updated_at": "2020-03-16T12:18:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "It looks like another issue, wallet model holds a unique_ptr to interface wallet which in other hand have a shared_ptr to actual wallet. Since `UnloadWallet` actually deletes wallet (it gets it from wallet map) unless wallet model outlive wallet. First make sure it works like that\r\n`bitcoind -testnet` (it's testnet because every few seconds new block is connected and notification is activated)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599504930/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599617151",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-599617151",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 599617151,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTYxNzE1MQ==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-16T15:59:33Z",
    "updated_at": "2020-03-16T15:59:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "> First make sure it works like that\r\n> `bitcoind -testnet` (it's testnet because every few seconds new block is connected and notification is activated)\r\n\r\nThanks for clarifying this. I had tried a bunch of ways to reproduce the issue with -regtest and could never get it to happen. But with cf4cb28efcf80c018a7f070c671f43cd172dbd86 and -testnet I was able to get the deadlock to happen in just a few minutes.\r\n\r\nI still haven't been able to reproduce a SIGSEGV or any problem with this current PR 73bd96206851aa88db79b8efbc844700630980e1, though. So again if you have a stack trace it would help. Or it would help if you could describe in a more step-by-step way how you see the SIGSEGV happening\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599617151/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599654176",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-599654176",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 599654176,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTY1NDE3Ng==",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?u=273eaa7bf010cbd99b0bb7364172b4870a830aba&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-16T17:06:41Z",
    "updated_at": "2020-03-16T17:06:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I still haven't been able to reproduce a SIGSEGV or any problem with this current PR 73bd962, though. So again if you have a stack trace it would help. Or it would help if you could describe in a more step-by-step way how you see the SIGSEGV happening\r\n\r\nSince `UnloadWallet` actively deletes wallet that's may not happen since `g_wallet_init_interface` is global and it's call `UnloadWallet` in its destructor.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599654176/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599667902",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-599667902",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 599667902,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTY2NzkwMg==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-16T17:32:43Z",
    "updated_at": "2020-03-16T17:32:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "> > I still haven't been able to reproduce a SIGSEGV or any problem with this current PR [73bd962](https://github.com/bitcoin/bitcoin/commit/73bd96206851aa88db79b8efbc844700630980e1), though. So again if you have a stack trace it would help. Or it would help if you could describe in a more step-by-step way how you see the SIGSEGV happening\r\n> \r\n> Since `UnloadWallet` actively deletes wallet that's may not happen since `g_wallet_init_interface` is global and it's call `UnloadWallet` in its destructor.\r\n\r\nWhat may not happen?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599667902/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599668968",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-599668968",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 599668968,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTY2ODk2OA==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-16T17:34:59Z",
    "updated_at": "2020-03-16T17:34:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "> What may not happen?\r\n\r\nOh, maybe you are referring to the bitcoin-qt bug. I haven't tried to reproduce that yet.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599668968/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599706438",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-599706438",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 599706438,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTcwNjQzOA==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-16T18:56:21Z",
    "updated_at": "2020-03-16T18:56:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "re: https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-599286541\r\n\r\n> @bvbfan that script crashes `bitcoin-qt -regtest -server -printtoconsole`.\r\n> \r\n> Still investigating but looking at call stack it's caused by queued connections \"in flight\" (like `WalletController::walletAdded(WalletModel*)`) while the wallet model is deleted in `WalletController::removeAndDeleteWallet`.\r\n\r\n@promag, I was able to reproduce this and I think it's basically a separate issue from the deadlock that happens with bitcoind. I created a bug report https://github.com/bitcoin/bitcoin/issues/18362. Would move any discussion of that issue there",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599706438/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599727503",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-599727503",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 599727503,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTcyNzUwMw==",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?u=273eaa7bf010cbd99b0bb7364172b4870a830aba&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-16T19:46:02Z",
    "updated_at": "2020-03-16T19:46:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "In #18362 the bug is mostly `horizontalHeader` is nullptr (invalid pointer).\r\nBasically i did not like transfer ownership of wallet to the notification that's not expected to me.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599727503/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599730693",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-599730693",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 599730693,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTczMDY5Mw==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-16T19:53:53Z",
    "updated_at": "2020-03-16T19:53:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "]> Basically i did not like transfer ownership of wallet to the notification that's not expected to me.\r\n\r\nSure, but if you are already using a shared_ptr to refer to an object some places, it makes sense to use it consistently. Combining shared pointers and raw pointers and asynchronous notifications is a recipe for bugs.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/599730693/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602113281",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-602113281",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 602113281,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMjExMzI4MQ==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-21T22:24:32Z",
    "updated_at": "2020-03-21T22:24:32Z",
    "author_association": "MEMBER",
    "body": "> I wrote a test for new register/unregister functions that could be added here: [d65b487](https://github.com/bitcoin/bitcoin/commit/d65b4874fda47aad2e412f0e0cac27e8eafb3838) ([branch](https://github.com/ryanofsky/bitcoin/commits/review.18338.1-edit))\r\n\r\nNo longer WIP, added 2 comments in the first commit, and included the above test, thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602113281/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602442557",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-602442557",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 602442557,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMjQ0MjU1Nw==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-23T08:03:25Z",
    "updated_at": "2020-03-23T08:03:25Z",
    "author_association": "MEMBER",
    "body": "@promag Why tests (d8102ce7c90378244fedbcf7e8cc81cb65d5ca0d) are dropped?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602442557/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602479073",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-602479073",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 602479073,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMjQ3OTA3Mw==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-23T09:26:32Z",
    "updated_at": "2020-03-23T09:26:32Z",
    "author_association": "MEMBER",
    "body": "> @promag Why tests ([d8102ce](https://github.com/bitcoin/bitcoin/commit/d8102ce7c90378244fedbcf7e8cc81cb65d5ca0d)) are dropped?\r\n\r\nTwo travis jobs are getting stuck, I'm trying to understand the problem.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602479073/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602525695",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-602525695",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 602525695,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMjUyNTY5NQ==",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?u=273eaa7bf010cbd99b0bb7364172b4870a830aba&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-23T11:05:16Z",
    "updated_at": "2020-03-23T11:05:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "To be architectural correct notification should hold a weak pointer, then should extend its lifetime for a particular call. ",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602525695/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602624814",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-602624814",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 602624814,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMjYyNDgxNA==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-23T14:18:26Z",
    "updated_at": "2020-03-23T14:18:26Z",
    "author_association": "MEMBER",
    "body": "Tested 179051c9e7835ba24baf623a2a37ba465792f1ad on Linux Mint 19.3:\r\n\r\n1) start `bitcoin-qt` without wallets\r\n2) load a wallet via menu\r\n3) close this wallet via menu\r\n4) open it again:\r\n\r\n![Screenshot from 2020-03-23 16-17-50](https://user-images.githubusercontent.com/32963518/77326052-e1ed6000-6d21-11ea-9801-257a603db9f4.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602624814/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602653804",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-602653804",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 602653804,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMjY1MzgwNA==",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?u=273eaa7bf010cbd99b0bb7364172b4870a830aba&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-23T15:00:32Z",
    "updated_at": "2020-03-23T15:00:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "@hebasto about duplicate wallet error, if you wait a bit it should work, the problem is extended wallet lifetime due to shared ownership, it can be fixed if weak pointer is introduced, but i'm 100% sure.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602653804/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602663928",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-602663928",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 602663928,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMjY2MzkyOA==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-23T15:12:28Z",
    "updated_at": "2020-03-26T19:57:20Z",
    "author_association": "MEMBER",
    "body": "> To be architectural correct notification should hold a weak pointer, then should extend its lifetime for a particular call.\r\n\r\nThe captured shared_ptr are only valid until the validation interface is unregistered *and* boost signal finishes calling all slots (if any) in the scheduler thread.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602663928/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602688096",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-602688096",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 602688096,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMjY4ODA5Ng==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-23T15:51:05Z",
    "updated_at": "2020-03-23T15:51:05Z",
    "author_association": "MEMBER",
    "body": "@bvbfan \r\n>  if you wait a bit it should work...\r\n\r\nIt keeps its state.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/602688096/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/603835234",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-603835234",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 603835234,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMzgzNTIzNA==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-25T13:21:04Z",
    "updated_at": "2020-03-25T13:21:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "Code review ACK 179051c9e7835ba24baf623a2a37ba465792f1ad. No changes since [last review](https://github.com/bitcoin/bitcoin/issues/18362#issuecomment-601501126) other than new comments and PR description\r\n\r\nNeeds rebase due to conflict, however.\r\n\r\nAlso, it would be good to mention in PR description that this fixes issues #16307 and #18362",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/603835234/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/603839402",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-603839402",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 603839402,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMzgzOTQwMg==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-25T13:29:01Z",
    "updated_at": "2020-03-25T13:29:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think this PR is good in its current form as a minimal bug fix. Future followups could also:\r\n\r\n- Unify RegisterSharedValidationInterface and RegisterValidationInterface in #18354 (requires changes to indexing code)\r\n- Add RegisterSharedValidationInterface unit test from https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-598559646",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/603839402/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/604627376",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-604627376",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 604627376,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNDYyNzM3Ng==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-26T19:07:28Z",
    "updated_at": "2020-03-26T19:07:28Z",
    "author_association": "MEMBER",
    "body": "@promag could https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-602624814 be addressed before merging ;)",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/604627376/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/604920071",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-604920071",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 604920071,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNDkyMDA3MQ==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-27T10:13:36Z",
    "updated_at": "2020-03-27T10:13:36Z",
    "author_association": "MEMBER",
    "body": "@hebasto nice catch, unloading from the GUI was relying on deleting the wallet model to bring down the reference count to zero. With this PR this is no longer true because those validation callbacks are capturing the wallet shared pointer. Temporarily pushed 240cf29 to address this issue.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/604920071/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605004183",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-605004183",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 605004183,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNTAwNDE4Mw==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-27T13:35:22Z",
    "updated_at": "2020-03-27T13:35:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "> @hebasto nice catch, unloading from the GUI was relying on deleting the wallet model to bring down the reference count to zero. With this PR this is no longer true because those validation callbacks are capturing the wallet shared pointer. Temporarily pushed [240cf29](https://github.com/bitcoin/bitcoin/commit/240cf29205815f5f5221b0cbb6c8f5829e5a46ff) to address this issue.\r\n\r\nThis is a good catch, and 240cf29205815f5f5221b0cbb6c8f5829e5a46ff looks like a good fix that stops notifications at a more appropriate place than the original fix.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605004183/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605020087",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-605020087",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 605020087,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNTAyMDA4Nw==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-27T14:07:58Z",
    "updated_at": "2020-03-27T14:07:58Z",
    "author_association": "MEMBER",
    "body": "Changed fix to f80e957 and squashed to e66da18.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605020087/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605060348",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-605060348",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 605060348,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNTA2MDM0OA==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-27T15:24:35Z",
    "updated_at": "2020-03-27T15:24:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "Some notes for future cleanup.\r\n\r\nI think we can clean up shutdown sequence after this PR, since right now it's confusing what responsibilities of different unloading functions are. I think I'd:\r\n\r\n- Move log print and flush out of ReleaseWallet into CWallet destructor\r\n- Rename ReleaseWallet to DeleteWallet since only thing it's doing is deleting the wallet pointer\r\n- Move handler.reset and NotifyUnload calls to new CWallet::Unload method, and call that method from RemoveWallet, so GUI is notified as early as possible and CWallet data members aren't being accessed from outside functions\r\n- Rename UnloadWallet to WaitForDeleteWallet since all it will be doing at that point is resetting the pointer and waiting for the gui and validation interfaces to let go their wallet references",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605060348/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605655215",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-605655215",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 605655215,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNTY1NTIxNQ==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-29T15:34:36Z",
    "updated_at": "2020-03-29T15:34:36Z",
    "author_association": "MEMBER",
    "body": "re-ACK 17316b3a6eb41204824111ea3cfeb2e1b7d80b1b, only suggested changes about class destructors.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605655215/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605920175",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-605920175",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 605920175,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNTkyMDE3NQ==",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?u=4a9af998e1a560b3f49c3827f453e1bcbe6a5cfb&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-30T10:32:49Z",
    "updated_at": "2020-03-30T10:32:49Z",
    "author_association": "MEMBER",
    "body": "Reverted.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605920175/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605920724",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-605920724",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 605920724,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNTkyMDcyNA==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-30T10:34:05Z",
    "updated_at": "2020-03-30T10:34:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "Code review ACK 17316b3a6eb41204824111ea3cfeb2e1b7d80b1b, but I did prefer 41b0baf43c243b64b394e774e336475a489cca2b with safe, intact destructors better. Either one is fine to merge though.\r\n\r\nBesides the destructors other things on the future cleanup list are:\r\n\r\n- https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399678666\r\n- https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-603839402\r\n- https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-605060348",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605920724/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605983072",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-605983072",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 605983072,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNTk4MzA3Mg==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-30T12:58:06Z",
    "updated_at": "2020-03-30T12:58:06Z",
    "author_association": "MEMBER",
    "body": "Is my previous [ACK](https://github.com/bitcoin/bitcoin/pull/18338#pullrequestreview-383334558) valid if a commit is reverted to the ACKed one?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/605983072/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/606060510",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-606060510",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 606060510,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNjA2MDUxMA==",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?u=7297e8aaf9188c0cb98bc549a8a02a1dc8d59e4c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-30T15:13:32Z",
    "updated_at": "2020-03-30T15:13:32Z",
    "author_association": "MEMBER",
    "body": "@promag \r\n> > @promag Why tests ([d8102ce](https://github.com/bitcoin/bitcoin/commit/d8102ce7c90378244fedbcf7e8cc81cb65d5ca0d)) are dropped?\r\n> \r\n> Two travis jobs are getting stuck, I'm trying to understand the problem.\r\n\r\nAny update about tests?",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/606060510/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/606153187",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#issuecomment-606153187",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/18338",
    "id": 606153187,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNjE1MzE4Nw==",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-30T18:03:22Z",
    "updated_at": "2020-03-30T18:03:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "Code review ACK 41b0baf43c243b64b394e774e336475a489cca2b (previously acked but just repeating for clarity).\r\n\r\nThis might be ready for merge. Lot of tweaking at the end but changes: f80e9574873c6091559ce5c4cba736d1b349319d -> e66da188cbbd70f0e1c2f9050680d9af4fdc0c97\r\n41b0baf43c243b64b394e774e336475a489cca2b -> 17316b3a6eb41204824111ea3cfeb2e1b7d80b1b -> 41b0baf43c243b64b394e774e336475a489cca2b were all trivial.\r\n\r\nThis is a minimal bugfix and good candidate for merging before branching or for backporting.",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/606153187/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393264763",
    "pull_request_review_id": 375524933,
    "id": 393264763,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI2NDc2Mw==",
    "diff_hunk": "@@ -137,6 +133,9 @@ void UnloadWallet(std::shared_ptr<CWallet>&& wallet)\n     // Notify the unload intent so that all remaining shared pointers are\n     // released.\n     wallet->NotifyUnload();\n+\n+    wallet->m_chain_notifications_handler.reset();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 19,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "73bd96206851aa88db79b8efbc844700630980e1",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "`BlockUntilSyncedToCurrentChain` is still needed, unless we can expect data loss",
    "created_at": "2020-03-16T19:32:30Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r393264763",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393264763"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r393264763"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393264763/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 137,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393265428",
    "pull_request_review_id": 375525771,
    "id": 393265428,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI2NTQyOA==",
    "diff_hunk": "@@ -151,7 +159,7 @@ class CMainSignals {\n private:\n     std::unique_ptr<MainSignalsInstance> m_internals;\n \n-    friend void ::RegisterValidationInterface(CValidationInterface*);\n+    friend void ::RegisterSharedValidationInterface(std::shared_ptr<CValidationInterface>);\n     friend void ::UnregisterValidationInterface(CValidationInterface*);",
    "path": "src/validationinterface.h",
    "position": 30,
    "original_position": 30,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "73bd96206851aa88db79b8efbc844700630980e1",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Why not shared_ptr here?",
    "created_at": "2020-03-16T19:33:52Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r393265428",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393265428"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r393265428"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393265428/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 185,
    "original_line": 185,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393266368",
    "pull_request_review_id": 375526926,
    "id": 393266368,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI2NjM2OA==",
    "diff_hunk": "@@ -137,6 +133,9 @@ void UnloadWallet(std::shared_ptr<CWallet>&& wallet)\n     // Notify the unload intent so that all remaining shared pointers are\n     // released.\n     wallet->NotifyUnload();\n+\n+    wallet->m_chain_notifications_handler.reset();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 19,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "73bd96206851aa88db79b8efbc844700630980e1",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/18338#discussion_r393264763\r\n\r\n> `BlockUntilSyncedToCurrentChain` is still needed, unless we can expect data loss\r\n\r\nBlockUntilSyncedToCurrentChain can't be called with locks held and it doesn't make sense here. It makes sense at beginning of RPC calls to ensure consistency between calls. It doesn't directly relate to writing or consolidating data.",
    "created_at": "2020-03-16T19:35:52Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r393266368",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393266368"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r393266368"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393266368/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 137,
    "side": "RIGHT",
    "in_reply_to_id": 393264763
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393267054",
    "pull_request_review_id": 375526926,
    "id": 393267054,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI2NzA1NA==",
    "diff_hunk": "@@ -151,7 +159,7 @@ class CMainSignals {\n private:\n     std::unique_ptr<MainSignalsInstance> m_internals;\n \n-    friend void ::RegisterValidationInterface(CValidationInterface*);\n+    friend void ::RegisterSharedValidationInterface(std::shared_ptr<CValidationInterface>);\n     friend void ::UnregisterValidationInterface(CValidationInterface*);",
    "path": "src/validationinterface.h",
    "position": 30,
    "original_position": 30,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "73bd96206851aa88db79b8efbc844700630980e1",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/18338#discussion_r393265428\r\n\r\n> Why not shared_ptr here?\r\n\r\nThis is an existing function the PR isn't changing (and there's no reason to change it)",
    "created_at": "2020-03-16T19:37:15Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r393267054",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393267054"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r393267054"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393267054/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 185,
    "original_line": 185,
    "side": "RIGHT",
    "in_reply_to_id": 393265428
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393464732",
    "pull_request_review_id": 375764667,
    "id": 393464732,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ2NDczMg==",
    "diff_hunk": "@@ -137,6 +133,9 @@ void UnloadWallet(std::shared_ptr<CWallet>&& wallet)\n     // Notify the unload intent so that all remaining shared pointers are\n     // released.\n     wallet->NotifyUnload();\n+\n+    wallet->m_chain_notifications_handler.reset();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 19,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "73bd96206851aa88db79b8efbc844700630980e1",
    "user": {
      "login": "bvbfan",
      "id": 8323581,
      "node_id": "MDQ6VXNlcjgzMjM1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8323581?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bvbfan",
      "html_url": "https://github.com/bvbfan",
      "followers_url": "https://api.github.com/users/bvbfan/followers",
      "following_url": "https://api.github.com/users/bvbfan/following{/other_user}",
      "gists_url": "https://api.github.com/users/bvbfan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bvbfan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bvbfan/subscriptions",
      "organizations_url": "https://api.github.com/users/bvbfan/orgs",
      "repos_url": "https://api.github.com/users/bvbfan/repos",
      "events_url": "https://api.github.com/users/bvbfan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bvbfan/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Where lock is held? If here it's, that's nasty bug.",
    "created_at": "2020-03-17T06:20:19Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r393464732",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393464732"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r393464732"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393464732/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 137,
    "side": "RIGHT",
    "in_reply_to_id": 393264763
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393520043",
    "pull_request_review_id": 375834093,
    "id": 393520043,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzUyMDA0Mw==",
    "diff_hunk": "@@ -137,6 +133,9 @@ void UnloadWallet(std::shared_ptr<CWallet>&& wallet)\n     // Notify the unload intent so that all remaining shared pointers are\n     // released.\n     wallet->NotifyUnload();\n+\n+    wallet->m_chain_notifications_handler.reset();",
    "path": "src/wallet/wallet.cpp",
    "position": null,
    "original_position": 19,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "73bd96206851aa88db79b8efbc844700630980e1",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Where lock is held? If here it's, that's nasty bug.\r\n\r\nRight, I don't think there is a nasty bug now. I think it is good to avoid nasty bugs by not calling BlockUntilSyncedToCurrentChain when it is not necessary.",
    "created_at": "2020-03-17T08:44:43Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r393520043",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393520043"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r393520043"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/393520043/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": null,
    "original_line": 137,
    "side": "RIGHT",
    "in_reply_to_id": 393264763
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396489464",
    "pull_request_review_id": 379478715,
    "id": 396489464,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ4OTQ2NA==",
    "diff_hunk": "@@ -87,6 +89,18 @@ void RegisterValidationInterface(CValidationInterface* pwalletIn) {\n     conns.NewPoWValidBlock = g_signals.m_internals->NewPoWValidBlock.connect(std::bind(&CValidationInterface::NewPoWValidBlock, pwalletIn, std::placeholders::_1, std::placeholders::_2));\n }\n \n+void RegisterValidationInterface(CValidationInterface* callbacks)\n+{\n+    // Create a shared_ptr with a no-op deleter - CValidationInterface lifecycle\n+    // is managed by the caller.\n+    RegisterSharedValidationInterface({callbacks, [](CValidationInterface*){}});",
    "path": "src/validationinterface.cpp",
    "position": 21,
    "original_position": 21,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "f593902aff3a50d3a1ef1786546d3532f294e243",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Approach -0\r\n\r\nThis makes reasoning about code behavior harder.",
    "created_at": "2020-03-23T14:25:08Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r396489464",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396489464"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r396489464"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396489464/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 94,
    "original_start_line": 94,
    "start_side": "RIGHT",
    "line": 96,
    "original_line": 96,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396533485",
    "pull_request_review_id": 379535637,
    "id": 396533485,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUzMzQ4NQ==",
    "diff_hunk": "@@ -87,6 +89,18 @@ void RegisterValidationInterface(CValidationInterface* pwalletIn) {\n     conns.NewPoWValidBlock = g_signals.m_internals->NewPoWValidBlock.connect(std::bind(&CValidationInterface::NewPoWValidBlock, pwalletIn, std::placeholders::_1, std::placeholders::_2));\n }\n \n+void RegisterValidationInterface(CValidationInterface* callbacks)\n+{\n+    // Create a shared_ptr with a no-op deleter - CValidationInterface lifecycle\n+    // is managed by the caller.\n+    RegisterSharedValidationInterface({callbacks, [](CValidationInterface*){}});",
    "path": "src/validationinterface.cpp",
    "position": 21,
    "original_position": 21,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "f593902aff3a50d3a1ef1786546d3532f294e243",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Approach -0\r\n> \r\n> This makes reasoning about code behavior harder.\r\n\r\nHarder than what? Harder than than the status quo? Or harder than an alternate solution? \r\n\r\nThis should clearly not be harder to reason about than the status quo. The status quo uses a combination of raw pointers and shared pointers and has a use-after-free bug as a result. Dropping raw pointers and using shared pointers consistently fixes the bug in the simplest way and makes it obvious and automatic that the pointer is only deleted when the last reference is deleted.\r\n\r\nThis approach is also not harder to reason about than the alternate approaches I've seen which have been to make the Unregister function blocking instead of nonblocking. Three PRs #18280 #18279 #18354 have tried that approach and encountered many bugs along the way. The approach is bad because you can no longer rely on reference counting to free the pointer after the last use, and instead have to manually think through every unload sequence and ensure that the new blocking behavior doesn't lead to deadlocks and invalid pointer accesses. It's also difficult because it changes the scheduler code in an invasive way compared to this PR which is just swapping out pointer type for another.",
    "created_at": "2020-03-23T15:23:04Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r396533485",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396533485"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r396533485"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396533485/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 94,
    "original_start_line": 94,
    "start_side": "RIGHT",
    "line": 96,
    "original_line": 96,
    "side": "RIGHT",
    "in_reply_to_id": 396489464
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396539619",
    "pull_request_review_id": 379543631,
    "id": 396539619,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUzOTYxOQ==",
    "diff_hunk": "@@ -87,6 +89,18 @@ void RegisterValidationInterface(CValidationInterface* pwalletIn) {\n     conns.NewPoWValidBlock = g_signals.m_internals->NewPoWValidBlock.connect(std::bind(&CValidationInterface::NewPoWValidBlock, pwalletIn, std::placeholders::_1, std::placeholders::_2));\n }\n \n+void RegisterValidationInterface(CValidationInterface* callbacks)\n+{\n+    // Create a shared_ptr with a no-op deleter - CValidationInterface lifecycle\n+    // is managed by the caller.\n+    RegisterSharedValidationInterface({callbacks, [](CValidationInterface*){}});",
    "path": "src/validationinterface.cpp",
    "position": 21,
    "original_position": 21,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "f593902aff3a50d3a1ef1786546d3532f294e243",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> Approach -0\r\n> \r\n> This makes reasoning about code behavior harder.\r\n\r\nIn case the comment is specifically about the RegisterValidationInterface function, this function and UnregisterValidationInterface could both be dropped in the future and replaced with RegisterShared functions. It wasn't done here just to keep the PR smaller and avoid having to change indexing code.",
    "created_at": "2020-03-23T15:30:54Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r396539619",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396539619"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r396539619"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/396539619/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 94,
    "original_start_line": 94,
    "start_side": "RIGHT",
    "line": 96,
    "original_line": 96,
    "side": "RIGHT",
    "in_reply_to_id": 396489464
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399327121",
    "pull_request_review_id": 382936392,
    "id": 399327121,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMyNzEyMQ==",
    "diff_hunk": "@@ -62,6 +62,8 @@ bool AddWallet(const std::shared_ptr<CWallet>& wallet)\n \n bool RemoveWallet(const std::shared_ptr<CWallet>& wallet)\n {\n+    // Unregister with the validation interface which also drops shared ponters.\n+    wallet->m_chain_notifications_handler.reset();",
    "path": "src/wallet/wallet.cpp",
    "position": 7,
    "original_position": 5,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "87379413c25c65074c1df7ee4aa3b10d900a4454",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "In commit \"gui: Handle WalletModel::unload asynchronous\" (e66da188cbbd70f0e1c2f9050680d9af4fdc0c97)\r\n\r\nDoesn't make a big a difference in practice, but it might be a good idea to move assert(wallet) below before this, so it doesn't look like this is dereferencing before checking for potential null",
    "created_at": "2020-03-27T14:59:16Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399327121",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399327121"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399327121"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399327121/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 67,
    "original_line": 67,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399672974",
    "pull_request_review_id": 383321016,
    "id": 399672974,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY3Mjk3NA==",
    "diff_hunk": "@@ -185,8 +175,26 @@ class NotificationsHandlerImpl : public Handler, CValidationInterface\n         m_notifications->updatedBlockTip();\n     }\n     void ChainStateFlushed(const CBlockLocator& locator) override { m_notifications->chainStateFlushed(locator); }\n-    Chain& m_chain;\n-    Chain::Notifications* m_notifications;\n+    std::shared_ptr<Chain::Notifications> m_notifications;\n+};\n+\n+class NotificationsHandlerImpl : public Handler\n+{\n+public:\n+    explicit NotificationsHandlerImpl(std::shared_ptr<Chain::Notifications> notifications)\n+        : m_proxy(std::make_shared<NotificationsProxy>(std::move(notifications)))\n+    {\n+        RegisterSharedValidationInterface(m_proxy);\n+    }\n+    ~NotificationsHandlerImpl() override { disconnect(); }",
    "path": "src/interfaces/chain.cpp",
    "position": 44,
    "original_position": 44,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "ab31b9d6fe7b39713682e3f52d11238dbe042c16",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: The destructor of the derived class should not be declared with `override`.",
    "created_at": "2020-03-28T15:13:23Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399672974",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399672974"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399672974"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399672974/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 189,
    "original_line": 189,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399674652",
    "pull_request_review_id": 383322360,
    "id": 399674652,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY3NDY1Mg==",
    "diff_hunk": "@@ -148,22 +148,12 @@ class LockImpl : public Chain::Lock, public UniqueLock<RecursiveMutex>\n     using UniqueLock::UniqueLock;\n };\n \n-class NotificationsHandlerImpl : public Handler, CValidationInterface\n+class NotificationsProxy : public CValidationInterface\n {\n public:\n-    explicit NotificationsHandlerImpl(Chain& chain, Chain::Notifications& notifications)\n-        : m_chain(chain), m_notifications(&notifications)\n-    {\n-        RegisterValidationInterface(this);\n-    }\n-    ~NotificationsHandlerImpl() override { disconnect(); }\n-    void disconnect() override\n-    {\n-        if (m_notifications) {\n-            m_notifications = nullptr;\n-            UnregisterValidationInterface(this);\n-        }\n-    }\n+    explicit NotificationsProxy(std::shared_ptr<Chain::Notifications> notifications)\n+        : m_notifications(std::move(notifications)) {}\n+    virtual ~NotificationsProxy() = default;",
    "path": "src/interfaces/chain.cpp",
    "position": 23,
    "original_position": 23,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "ab31b9d6fe7b39713682e3f52d11238dbe042c16",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: Is the `NotificationsProxy` class intended for subclassing? If not, why its destructor is declared with `virtual`?",
    "created_at": "2020-03-28T15:29:17Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399674652",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399674652"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399674652"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399674652/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 156,
    "original_line": 156,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399678666",
    "pull_request_review_id": 383325497,
    "id": 399678666,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY3ODY2Ng==",
    "diff_hunk": "@@ -75,8 +75,10 @@ CMainSignals& GetMainSignals()\n     return g_signals;\n }\n \n-void RegisterValidationInterface(CValidationInterface* pwalletIn) {\n-    ValidationInterfaceConnections& conns = g_signals.m_internals->m_connMainSignals[pwalletIn];\n+void RegisterSharedValidationInterface(std::shared_ptr<CValidationInterface> pwalletIn) {",
    "path": "src/validationinterface.cpp",
    "position": 6,
    "original_position": 6,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "ab31b9d6fe7b39713682e3f52d11238dbe042c16",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "nit: Mind identical parameter naming in the `RegisterSharedValidationInterface` declaration and definition:\r\n`pwalletIn` vs `callbacks` ?",
    "created_at": "2020-03-28T16:06:45Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399678666",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399678666"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399678666"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399678666/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 78,
    "original_line": 78,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399786583",
    "pull_request_review_id": 383402252,
    "id": 399786583,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc4NjU4Mw==",
    "diff_hunk": "@@ -87,6 +89,18 @@ void RegisterValidationInterface(CValidationInterface* pwalletIn) {\n     conns.NewPoWValidBlock = g_signals.m_internals->NewPoWValidBlock.connect(std::bind(&CValidationInterface::NewPoWValidBlock, pwalletIn, std::placeholders::_1, std::placeholders::_2));\n }\n \n+void RegisterValidationInterface(CValidationInterface* callbacks)\n+{\n+    // Create a shared_ptr with a no-op deleter - CValidationInterface lifecycle\n+    // is managed by the caller.\n+    RegisterSharedValidationInterface({callbacks, [](CValidationInterface*){}});",
    "path": "src/validationinterface.cpp",
    "position": 21,
    "original_position": 21,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "f593902aff3a50d3a1ef1786546d3532f294e243",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "IIUC, `std::shared_ptr` with a no-op custom deleter (and without leveraging of `use_count()`) works the same as a raw pointer, no?",
    "created_at": "2020-03-29T11:52:14Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399786583",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399786583"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399786583"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399786583/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 94,
    "original_start_line": 94,
    "start_side": "RIGHT",
    "line": 96,
    "original_line": 96,
    "side": "RIGHT",
    "in_reply_to_id": 396489464
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399787574",
    "pull_request_review_id": 383402950,
    "id": 399787574,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc4NzU3NA==",
    "diff_hunk": "@@ -87,6 +89,18 @@ void RegisterValidationInterface(CValidationInterface* pwalletIn) {\n     conns.NewPoWValidBlock = g_signals.m_internals->NewPoWValidBlock.connect(std::bind(&CValidationInterface::NewPoWValidBlock, pwalletIn, std::placeholders::_1, std::placeholders::_2));\n }\n \n+void RegisterValidationInterface(CValidationInterface* callbacks)\n+{\n+    // Create a shared_ptr with a no-op deleter - CValidationInterface lifecycle\n+    // is managed by the caller.\n+    RegisterSharedValidationInterface({callbacks, [](CValidationInterface*){}});",
    "path": "src/validationinterface.cpp",
    "position": 21,
    "original_position": 21,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "f593902aff3a50d3a1ef1786546d3532f294e243",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Right, that is intended for all validation interfaces except for wallets.",
    "created_at": "2020-03-29T12:00:07Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399787574",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399787574"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399787574"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399787574/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": 94,
    "original_start_line": 94,
    "start_side": "RIGHT",
    "line": 96,
    "original_line": 96,
    "side": "RIGHT",
    "in_reply_to_id": 396489464
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399813428",
    "pull_request_review_id": 383423681,
    "id": 399813428,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTgxMzQyOA==",
    "diff_hunk": "@@ -75,8 +75,10 @@ CMainSignals& GetMainSignals()\n     return g_signals;\n }\n \n-void RegisterValidationInterface(CValidationInterface* pwalletIn) {\n-    ValidationInterfaceConnections& conns = g_signals.m_internals->m_connMainSignals[pwalletIn];\n+void RegisterSharedValidationInterface(std::shared_ptr<CValidationInterface> pwalletIn) {",
    "path": "src/validationinterface.cpp",
    "position": 6,
    "original_position": 6,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "ab31b9d6fe7b39713682e3f52d11238dbe042c16",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Let's do that in one of Russel suggestions and avoid unnecessary changes here.",
    "created_at": "2020-03-29T15:30:50Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399813428",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399813428"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399813428"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399813428/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 78,
    "original_line": 78,
    "side": "RIGHT",
    "in_reply_to_id": 399678666
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399813446",
    "pull_request_review_id": 383423698,
    "id": 399813446,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTgxMzQ0Ng==",
    "diff_hunk": "@@ -148,22 +148,12 @@ class LockImpl : public Chain::Lock, public UniqueLock<RecursiveMutex>\n     using UniqueLock::UniqueLock;\n };\n \n-class NotificationsHandlerImpl : public Handler, CValidationInterface\n+class NotificationsProxy : public CValidationInterface\n {\n public:\n-    explicit NotificationsHandlerImpl(Chain& chain, Chain::Notifications& notifications)\n-        : m_chain(chain), m_notifications(&notifications)\n-    {\n-        RegisterValidationInterface(this);\n-    }\n-    ~NotificationsHandlerImpl() override { disconnect(); }\n-    void disconnect() override\n-    {\n-        if (m_notifications) {\n-            m_notifications = nullptr;\n-            UnregisterValidationInterface(this);\n-        }\n-    }\n+    explicit NotificationsProxy(std::shared_ptr<Chain::Notifications> notifications)\n+        : m_notifications(std::move(notifications)) {}\n+    virtual ~NotificationsProxy() = default;",
    "path": "src/interfaces/chain.cpp",
    "position": 23,
    "original_position": 23,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "ab31b9d6fe7b39713682e3f52d11238dbe042c16",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Removed.",
    "created_at": "2020-03-29T15:31:00Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399813446",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399813446"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399813446"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399813446/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 156,
    "original_line": 156,
    "side": "RIGHT",
    "in_reply_to_id": 399674652
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399813463",
    "pull_request_review_id": 383423721,
    "id": 399813463,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTgxMzQ2Mw==",
    "diff_hunk": "@@ -185,8 +175,26 @@ class NotificationsHandlerImpl : public Handler, CValidationInterface\n         m_notifications->updatedBlockTip();\n     }\n     void ChainStateFlushed(const CBlockLocator& locator) override { m_notifications->chainStateFlushed(locator); }\n-    Chain& m_chain;\n-    Chain::Notifications* m_notifications;\n+    std::shared_ptr<Chain::Notifications> m_notifications;\n+};\n+\n+class NotificationsHandlerImpl : public Handler\n+{\n+public:\n+    explicit NotificationsHandlerImpl(std::shared_ptr<Chain::Notifications> notifications)\n+        : m_proxy(std::make_shared<NotificationsProxy>(std::move(notifications)))\n+    {\n+        RegisterSharedValidationInterface(m_proxy);\n+    }\n+    ~NotificationsHandlerImpl() override { disconnect(); }",
    "path": "src/interfaces/chain.cpp",
    "position": 44,
    "original_position": 44,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "ab31b9d6fe7b39713682e3f52d11238dbe042c16",
    "user": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Done.",
    "created_at": "2020-03-29T15:31:12Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399813463",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399813463"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399813463"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/399813463/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 189,
    "original_line": 189,
    "side": "RIGHT",
    "in_reply_to_id": 399672974
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400085251",
    "pull_request_review_id": 383721619,
    "id": 400085251,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA4NTI1MQ==",
    "diff_hunk": "@@ -185,8 +175,26 @@ class NotificationsHandlerImpl : public Handler, CValidationInterface\n         m_notifications->updatedBlockTip();\n     }\n     void ChainStateFlushed(const CBlockLocator& locator) override { m_notifications->chainStateFlushed(locator); }\n-    Chain& m_chain;\n-    Chain::Notifications* m_notifications;\n+    std::shared_ptr<Chain::Notifications> m_notifications;\n+};\n+\n+class NotificationsHandlerImpl : public Handler\n+{\n+public:\n+    explicit NotificationsHandlerImpl(std::shared_ptr<Chain::Notifications> notifications)\n+        : m_proxy(std::make_shared<NotificationsProxy>(std::move(notifications)))\n+    {\n+        RegisterSharedValidationInterface(m_proxy);\n+    }\n+    ~NotificationsHandlerImpl() override { disconnect(); }",
    "path": "src/interfaces/chain.cpp",
    "position": 44,
    "original_position": 44,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "ab31b9d6fe7b39713682e3f52d11238dbe042c16",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399672974\r\n\r\n> nit: The destructor of the derived class should not be declared with `override`.\r\n\r\nThis is a strange suggestion and I would suggest reverting 17316b3a6eb41204824111ea3cfeb2e1b7d80b1b to 41b0baf43c243b64b394e774e336475a489cca2b to undo it. The point of override keyword is to get the compiler to enforce assumptions the derived class is making about the base class to avoid terrible bugs. In this case, override keyword makes it an error for the base class not to have a virtual destructor. This is important because if base destructor was made not virtual there would be a difficult to trace memory leak here with NotificationsHandlerImpl object getting freed but destructor never running and m_proxy member never being freed.",
    "created_at": "2020-03-30T10:26:42Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400085251",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400085251"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400085251"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400085251/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 189,
    "original_line": 189,
    "side": "RIGHT",
    "in_reply_to_id": 399672974
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400086442",
    "pull_request_review_id": 383723070,
    "id": 400086442,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA4NjQ0Mg==",
    "diff_hunk": "@@ -148,22 +148,12 @@ class LockImpl : public Chain::Lock, public UniqueLock<RecursiveMutex>\n     using UniqueLock::UniqueLock;\n };\n \n-class NotificationsHandlerImpl : public Handler, CValidationInterface\n+class NotificationsProxy : public CValidationInterface\n {\n public:\n-    explicit NotificationsHandlerImpl(Chain& chain, Chain::Notifications& notifications)\n-        : m_chain(chain), m_notifications(&notifications)\n-    {\n-        RegisterValidationInterface(this);\n-    }\n-    ~NotificationsHandlerImpl() override { disconnect(); }\n-    void disconnect() override\n-    {\n-        if (m_notifications) {\n-            m_notifications = nullptr;\n-            UnregisterValidationInterface(this);\n-        }\n-    }\n+    explicit NotificationsProxy(std::shared_ptr<Chain::Notifications> notifications)\n+        : m_notifications(std::move(notifications)) {}\n+    virtual ~NotificationsProxy() = default;",
    "path": "src/interfaces/chain.cpp",
    "position": 23,
    "original_position": 23,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "ab31b9d6fe7b39713682e3f52d11238dbe042c16",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "re: https://github.com/bitcoin/bitcoin/pull/18338#discussion_r399674652\r\n\r\n> nit: Is the `NotificationsProxy` class intended for subclassing? If not, why its destructor is declared with `virtual`?\r\n\r\nWould again suggest reverting 17316b3a6eb41204824111ea3cfeb2e1b7d80b1b to 41b0baf43c243b64b394e774e336475a489cca2b to undo this change. The point of declaring this virtual is to prevent memory leaks and incomplete destruction in case this is subclassed (whether intended or not). From https://isocpp.org/wiki/faq/virtual-functions#virtual-dtors:\r\n\r\n> Here\u2019s a simplified rule of thumb that usually protects you and usually doesn\u2019t cost you anything: make your destructor virtual if your class has any virtual functions. \r\n\r\nThis is an important rule to follow here and other places. Other alternatives would be to declare the class final or give it a protected nonvirtual destructor, but these are optimizations that are more fragile. Just having a virtual destructor when there are virtual functions is usually the simplest safe approach.",
    "created_at": "2020-03-30T10:28:54Z",
    "updated_at": "2020-03-30T10:33:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400086442",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400086442"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400086442"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400086442/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 156,
    "original_line": 156,
    "side": "RIGHT",
    "in_reply_to_id": 399674652
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400092897",
    "pull_request_review_id": 383730963,
    "id": 400092897,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5Mjg5Nw==",
    "diff_hunk": "@@ -148,22 +148,12 @@ class LockImpl : public Chain::Lock, public UniqueLock<RecursiveMutex>\n     using UniqueLock::UniqueLock;\n };\n \n-class NotificationsHandlerImpl : public Handler, CValidationInterface\n+class NotificationsProxy : public CValidationInterface\n {\n public:\n-    explicit NotificationsHandlerImpl(Chain& chain, Chain::Notifications& notifications)\n-        : m_chain(chain), m_notifications(&notifications)\n-    {\n-        RegisterValidationInterface(this);\n-    }\n-    ~NotificationsHandlerImpl() override { disconnect(); }\n-    void disconnect() override\n-    {\n-        if (m_notifications) {\n-            m_notifications = nullptr;\n-            UnregisterValidationInterface(this);\n-        }\n-    }\n+    explicit NotificationsProxy(std::shared_ptr<Chain::Notifications> notifications)\n+        : m_notifications(std::move(notifications)) {}\n+    virtual ~NotificationsProxy() = default;",
    "path": "src/interfaces/chain.cpp",
    "position": 23,
    "original_position": 23,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "ab31b9d6fe7b39713682e3f52d11238dbe042c16",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Sorry for noise. I forgot that member functions defined with `override` are still `virtual`.",
    "created_at": "2020-03-30T10:40:28Z",
    "updated_at": "2020-03-30T10:40:28Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400092897",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400092897"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400092897"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400092897/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 156,
    "original_line": 156,
    "side": "RIGHT",
    "in_reply_to_id": 399674652
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400094476",
    "pull_request_review_id": 383732946,
    "id": 400094476,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5NDQ3Ng==",
    "diff_hunk": "@@ -148,22 +148,12 @@ class LockImpl : public Chain::Lock, public UniqueLock<RecursiveMutex>\n     using UniqueLock::UniqueLock;\n };\n \n-class NotificationsHandlerImpl : public Handler, CValidationInterface\n+class NotificationsProxy : public CValidationInterface\n {\n public:\n-    explicit NotificationsHandlerImpl(Chain& chain, Chain::Notifications& notifications)\n-        : m_chain(chain), m_notifications(&notifications)\n-    {\n-        RegisterValidationInterface(this);\n-    }\n-    ~NotificationsHandlerImpl() override { disconnect(); }\n-    void disconnect() override\n-    {\n-        if (m_notifications) {\n-            m_notifications = nullptr;\n-            UnregisterValidationInterface(this);\n-        }\n-    }\n+    explicit NotificationsProxy(std::shared_ptr<Chain::Notifications> notifications)\n+        : m_notifications(std::move(notifications)) {}\n+    virtual ~NotificationsProxy() = default;",
    "path": "src/interfaces/chain.cpp",
    "position": 23,
    "original_position": 23,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "ab31b9d6fe7b39713682e3f52d11238dbe042c16",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@ryanofsky ibid:\r\n> Note: in a derived class, if your base class has a virtual destructor, your own destructor is automatically virtual. ",
    "created_at": "2020-03-30T10:43:32Z",
    "updated_at": "2020-03-30T10:43:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400094476",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400094476"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400094476"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400094476/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 156,
    "original_line": 156,
    "side": "RIGHT",
    "in_reply_to_id": 399674652
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400097167",
    "pull_request_review_id": 383736115,
    "id": 400097167,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDA5NzE2Nw==",
    "diff_hunk": "@@ -148,22 +148,12 @@ class LockImpl : public Chain::Lock, public UniqueLock<RecursiveMutex>\n     using UniqueLock::UniqueLock;\n };\n \n-class NotificationsHandlerImpl : public Handler, CValidationInterface\n+class NotificationsProxy : public CValidationInterface\n {\n public:\n-    explicit NotificationsHandlerImpl(Chain& chain, Chain::Notifications& notifications)\n-        : m_chain(chain), m_notifications(&notifications)\n-    {\n-        RegisterValidationInterface(this);\n-    }\n-    ~NotificationsHandlerImpl() override { disconnect(); }\n-    void disconnect() override\n-    {\n-        if (m_notifications) {\n-            m_notifications = nullptr;\n-            UnregisterValidationInterface(this);\n-        }\n-    }\n+    explicit NotificationsProxy(std::shared_ptr<Chain::Notifications> notifications)\n+        : m_notifications(std::move(notifications)) {}\n+    virtual ~NotificationsProxy() = default;",
    "path": "src/interfaces/chain.cpp",
    "position": 23,
    "original_position": 23,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "ab31b9d6fe7b39713682e3f52d11238dbe042c16",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> @ryanofsky ibid:\r\n> \r\n> > Note: in a derived class, if your base class has a virtual destructor, your own destructor is automatically virtual.\r\n\r\nYes, the problems happen when code changes over time. Without the override keyword somebody could make a change to the base class removing `virtual` and unknowingly cause memory leaks in the derived class. But with the override keyword, the compiler will show a \"does not override\" error building the derived class and not allow this.",
    "created_at": "2020-03-30T10:48:18Z",
    "updated_at": "2020-03-30T10:48:19Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400097167",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400097167"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400097167"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400097167/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 156,
    "original_line": 156,
    "side": "RIGHT",
    "in_reply_to_id": 399674652
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400106081",
    "pull_request_review_id": 383746728,
    "id": 400106081,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDEwNjA4MQ==",
    "diff_hunk": "@@ -148,22 +148,12 @@ class LockImpl : public Chain::Lock, public UniqueLock<RecursiveMutex>\n     using UniqueLock::UniqueLock;\n };\n \n-class NotificationsHandlerImpl : public Handler, CValidationInterface\n+class NotificationsProxy : public CValidationInterface\n {\n public:\n-    explicit NotificationsHandlerImpl(Chain& chain, Chain::Notifications& notifications)\n-        : m_chain(chain), m_notifications(&notifications)\n-    {\n-        RegisterValidationInterface(this);\n-    }\n-    ~NotificationsHandlerImpl() override { disconnect(); }\n-    void disconnect() override\n-    {\n-        if (m_notifications) {\n-            m_notifications = nullptr;\n-            UnregisterValidationInterface(this);\n-        }\n-    }\n+    explicit NotificationsProxy(std::shared_ptr<Chain::Notifications> notifications)\n+        : m_notifications(std::move(notifications)) {}\n+    virtual ~NotificationsProxy() = default;",
    "path": "src/interfaces/chain.cpp",
    "position": 23,
    "original_position": 23,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "ab31b9d6fe7b39713682e3f52d11238dbe042c16",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Yes, I [understand](16710) that consistent usage of `override` in derived classes protects from bugs caused by changes in base classes over time.\r\n\r\nBut how `virtual` could help for a desctructor in a derived class, if:\r\n> in a derived class, if your base class has a `virtual` destructor, your own destructor is _automatically_ `virtual`. You might need an explicitly defined destructor for other reasons, but there\u2019s _no need_ to redeclare a destructor simply to make sure it is `virtual`. No matter whether you declare it with the `virtual` keyword, declare it without the `virtual` keyword, or don\u2019t declare it at all, it\u2019s _still_ `virtual`.\r\n\r\n?",
    "created_at": "2020-03-30T11:04:20Z",
    "updated_at": "2020-03-30T11:04:21Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400106081",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400106081"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400106081"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400106081/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 156,
    "original_line": 156,
    "side": "RIGHT",
    "in_reply_to_id": 399674652
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400109450",
    "pull_request_review_id": 383750918,
    "id": 400109450,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDEwOTQ1MA==",
    "diff_hunk": "@@ -185,8 +175,26 @@ class NotificationsHandlerImpl : public Handler, CValidationInterface\n         m_notifications->updatedBlockTip();\n     }\n     void ChainStateFlushed(const CBlockLocator& locator) override { m_notifications->chainStateFlushed(locator); }\n-    Chain& m_chain;\n-    Chain::Notifications* m_notifications;\n+    std::shared_ptr<Chain::Notifications> m_notifications;\n+};\n+\n+class NotificationsHandlerImpl : public Handler\n+{\n+public:\n+    explicit NotificationsHandlerImpl(std::shared_ptr<Chain::Notifications> notifications)\n+        : m_proxy(std::make_shared<NotificationsProxy>(std::move(notifications)))\n+    {\n+        RegisterSharedValidationInterface(m_proxy);\n+    }\n+    ~NotificationsHandlerImpl() override { disconnect(); }",
    "path": "src/interfaces/chain.cpp",
    "position": 44,
    "original_position": 44,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "ab31b9d6fe7b39713682e3f52d11238dbe042c16",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "A desctructor is not a regular member function. So I was confused with the following opinions:\r\n- https://github.com/isocpp/CppCoreGuidelines/issues/721\r\n- https://github.com/isocpp/CppCoreGuidelines/pull/737",
    "created_at": "2020-03-30T11:10:50Z",
    "updated_at": "2020-03-30T11:10:51Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400109450",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400109450"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400109450"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400109450/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 189,
    "original_line": 189,
    "side": "RIGHT",
    "in_reply_to_id": 399672974
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400120047",
    "pull_request_review_id": 383763999,
    "id": 400120047,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDEyMDA0Nw==",
    "diff_hunk": "@@ -185,8 +175,26 @@ class NotificationsHandlerImpl : public Handler, CValidationInterface\n         m_notifications->updatedBlockTip();\n     }\n     void ChainStateFlushed(const CBlockLocator& locator) override { m_notifications->chainStateFlushed(locator); }\n-    Chain& m_chain;\n-    Chain::Notifications* m_notifications;\n+    std::shared_ptr<Chain::Notifications> m_notifications;\n+};\n+\n+class NotificationsHandlerImpl : public Handler\n+{\n+public:\n+    explicit NotificationsHandlerImpl(std::shared_ptr<Chain::Notifications> notifications)\n+        : m_proxy(std::make_shared<NotificationsProxy>(std::move(notifications)))\n+    {\n+        RegisterSharedValidationInterface(m_proxy);\n+    }\n+    ~NotificationsHandlerImpl() override { disconnect(); }",
    "path": "src/interfaces/chain.cpp",
    "position": 44,
    "original_position": 44,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "ab31b9d6fe7b39713682e3f52d11238dbe042c16",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "@ryanofsky \r\n> In this case, override keyword makes it an error for the base class not to have a virtual destructor.\r\n\r\nI've verified this statement with the following diff:\r\n```diff\r\n--- a/src/interfaces/handler.h\r\n+++ b/src/interfaces/handler.h\r\n@@ -22,7 +22,7 @@ namespace interfaces {\r\n class Handler\r\n {\r\n public:\r\n-    virtual ~Handler() {}\r\n+    ~Handler() {}\r\n \r\n     //! Disconnect the handler.\r\n     virtual void disconnect() = 0;\r\n```\r\n\r\nMy compiler raises an error. You are correct.\r\nTIL. Thank you.",
    "created_at": "2020-03-30T11:31:32Z",
    "updated_at": "2020-03-30T11:31:32Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400120047",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400120047"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400120047"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400120047/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 189,
    "original_line": 189,
    "side": "RIGHT",
    "in_reply_to_id": 399672974
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400142927",
    "pull_request_review_id": 383792255,
    "id": 400142927,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE0MjkyNw==",
    "diff_hunk": "@@ -148,22 +148,12 @@ class LockImpl : public Chain::Lock, public UniqueLock<RecursiveMutex>\n     using UniqueLock::UniqueLock;\n };\n \n-class NotificationsHandlerImpl : public Handler, CValidationInterface\n+class NotificationsProxy : public CValidationInterface\n {\n public:\n-    explicit NotificationsHandlerImpl(Chain& chain, Chain::Notifications& notifications)\n-        : m_chain(chain), m_notifications(&notifications)\n-    {\n-        RegisterValidationInterface(this);\n-    }\n-    ~NotificationsHandlerImpl() override { disconnect(); }\n-    void disconnect() override\n-    {\n-        if (m_notifications) {\n-            m_notifications = nullptr;\n-            UnregisterValidationInterface(this);\n-        }\n-    }\n+    explicit NotificationsProxy(std::shared_ptr<Chain::Notifications> notifications)\n+        : m_notifications(std::move(notifications)) {}\n+    virtual ~NotificationsProxy() = default;",
    "path": "src/interfaces/chain.cpp",
    "position": 23,
    "original_position": 23,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "ab31b9d6fe7b39713682e3f52d11238dbe042c16",
    "user": {
      "login": "ryanofsky",
      "id": 7133040,
      "node_id": "MDQ6VXNlcjcxMzMwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7133040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanofsky",
      "html_url": "https://github.com/ryanofsky",
      "followers_url": "https://api.github.com/users/ryanofsky/followers",
      "following_url": "https://api.github.com/users/ryanofsky/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanofsky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanofsky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanofsky/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanofsky/orgs",
      "repos_url": "https://api.github.com/users/ryanofsky/repos",
      "events_url": "https://api.github.com/users/ryanofsky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanofsky/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "> But how `virtual` could help for a desctructor in a derived class, if:\r\n> \r\n> > in a derived class, if your base class has a `virtual` destructor, your own destructor is _automatically_ `virtual`. You might need an explicitly defined destructor for other reasons, but there\u2019s _no need_ to redeclare a destructor simply to make sure it is `virtual`. No matter whether you declare it with the `virtual` keyword, declare it without the `virtual` keyword, or don\u2019t declare it at all, it\u2019s _still_ `virtual`.\r\n> \r\n> ?\r\n\r\nNone of that is applicable here. NotificationsProxy base class is CValidationInterface which does not have a virtual destructor. If it did have a virtual destructor, this could be declared with `override` instead of `virtual`, and registration would no longer require shared pointers with custom deleters. But these changes would increase size of the bugfix and are better saved for a followup PR. This PR is just trying to do the simple thing and\r\n\r\n- Declare virtual destructors where there are virtual functions\r\n- Use `override` instead of `virtual` where it prevents derived class code from being silently broken by future changes to the base class",
    "created_at": "2020-03-30T12:13:59Z",
    "updated_at": "2020-03-30T12:13:59Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400142927",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "CONTRIBUTOR",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400142927"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400142927"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400142927/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 156,
    "original_line": 156,
    "side": "RIGHT",
    "in_reply_to_id": 399674652
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400168170",
    "pull_request_review_id": 383823812,
    "id": 400168170,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE2ODE3MA==",
    "diff_hunk": "@@ -148,22 +148,12 @@ class LockImpl : public Chain::Lock, public UniqueLock<RecursiveMutex>\n     using UniqueLock::UniqueLock;\n };\n \n-class NotificationsHandlerImpl : public Handler, CValidationInterface\n+class NotificationsProxy : public CValidationInterface\n {\n public:\n-    explicit NotificationsHandlerImpl(Chain& chain, Chain::Notifications& notifications)\n-        : m_chain(chain), m_notifications(&notifications)\n-    {\n-        RegisterValidationInterface(this);\n-    }\n-    ~NotificationsHandlerImpl() override { disconnect(); }\n-    void disconnect() override\n-    {\n-        if (m_notifications) {\n-            m_notifications = nullptr;\n-            UnregisterValidationInterface(this);\n-        }\n-    }\n+    explicit NotificationsProxy(std::shared_ptr<Chain::Notifications> notifications)\n+        : m_notifications(std::move(notifications)) {}\n+    virtual ~NotificationsProxy() = default;",
    "path": "src/interfaces/chain.cpp",
    "position": 23,
    "original_position": 23,
    "commit_id": "41b0baf43c243b64b394e774e336475a489cca2b",
    "original_commit_id": "ab31b9d6fe7b39713682e3f52d11238dbe042c16",
    "user": {
      "login": "hebasto",
      "id": 32963518,
      "node_id": "MDQ6VXNlcjMyOTYzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/32963518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hebasto",
      "html_url": "https://github.com/hebasto",
      "followers_url": "https://api.github.com/users/hebasto/followers",
      "following_url": "https://api.github.com/users/hebasto/following{/other_user}",
      "gists_url": "https://api.github.com/users/hebasto/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hebasto/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hebasto/subscriptions",
      "organizations_url": "https://api.github.com/users/hebasto/orgs",
      "repos_url": "https://api.github.com/users/hebasto/repos",
      "events_url": "https://api.github.com/users/hebasto/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hebasto/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Oh, I missed that: https://github.com/bitcoin/bitcoin/blob/41b0baf43c243b64b394e774e336475a489cca2b/src/validationinterface.h#L77-L83",
    "created_at": "2020-03-30T12:55:36Z",
    "updated_at": "2020-03-30T12:55:36Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400168170",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400168170"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/18338#discussion_r400168170"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/18338"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/400168170/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 156,
    "original_line": 156,
    "side": "RIGHT",
    "in_reply_to_id": 399674652
  }
]