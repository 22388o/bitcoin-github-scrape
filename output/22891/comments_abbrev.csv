prayank23,2021-09-05 15:38:32,"@jonatack Thanks for review\n\n> is Add feerate histogram to getmempoolinfo #21422 enough; what is the added value of an additional CLI?\n\nI consider `-getinfo` as a dashboard for users who do not like GUI but still prefer to see a summary open in a terminal while using Bitcoin Core for several things. If used with `watch` it can also update regularly. \n\n> if a CLI command would add addit",https://github.com/bitcoin/bitcoin/pull/22891#issuecomment-913177387,913177387,
prayank23,2021-09-07 03:35:54,"Result for `bitcoin-cli -getinfo` after last commit:\n\n![image](https://user-images.githubusercontent.com/13405205/132280052-ff15d960-c965-4b12-85f4-9f6300e2961f.png)\n\nChanges:\n\n- Change feerate groups\n- Increment by 1000\n- Use L_BAR for vbytes less than 250k\n- Add RED color and use it for MEMPOOL\n- Fix fee_size in for loop\n- Only show fee distribution for a group if size>0\n",https://github.com/bitcoin/bitcoin/pull/22891#issuecomment-913965254,913965254,
lsilva01,2021-09-10 18:43:32,"Concept ACK. It's a really nice feature.\nIt would be great if the fee rate ranges were automatically calculated based on the minimum and maximum fees.",https://github.com/bitcoin/bitcoin/pull/22891#issuecomment-917129213,917129213,
prayank23,2021-09-10 23:24:17,"@lsilva01 Thanks for review. Made few changes in last commit. Let me know if this looks better. Will try few more things in next few days.\n\nResult for `bitcoin-cli -getinfo` after last commit: \n\n![image](https://user-images.githubusercontent.com/13405205/132926798-ea7fc16c-75a4-4f54-a521-e7c572c1e18f.png)\n\nChanges:\n\n1. Add one more group for fee rates above 200\n2. Change colors: ",https://github.com/bitcoin/bitcoin/pull/22891#issuecomment-917274308,917274308,
prayank23,2021-09-11 19:53:57,"I have made few changes and squashed commits. Also updated things in PR description. Please test and let me know if there are any issues and scope for improvement. \n\n@klementtan I tried adding you as co-author because PR is inspired by your work to add progress bar for sync, used lot of code from it and you helped in fixing JSON error initially. Maybe didn't add it correctly. Will have to comm",https://github.com/bitcoin/bitcoin/pull/22891#issuecomment-917468438,917468438,
klementtan,2021-09-12 05:22:41,"@prayank23 My email is klementtan@gmail.com. Thanks!\n\nWill review the PR soon üëç ",https://github.com/bitcoin/bitcoin/pull/22891#issuecomment-917559682,917559682,
DrahtBot,2021-11-02 13:57:45,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#23507](https://github.com/bitcoin/bitcoin/pull/23507) (Refactor: Improve API design of `ScriptToUniv`, `TxToUniv` etc to",https://github.com/bitcoin/bitcoin/pull/22891#issuecomment-957633221,957633221,
nopara73,2021-11-10 10:05:39,Feature ACK. Useful.,https://github.com/bitcoin/bitcoin/pull/22891#issuecomment-964977451,964977451,
jonatack,2021-09-05 12:45:37,These fee rate ranges seem arbitrary. Relevant real fee rates may evolve to be much higher or lower.,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r702419700,702419700,src/bitcoin-cli.cpp
prayank23,2021-09-05 15:38:27,"I used them to test. Was planning to add more once results are as expected. We can do one of these to improve:\n\n1. Add more groups: https://i.imgur.com/ffyusBA.png\n2. Define a MIN and MAX, MIN will be 1 and MAX can be highest fee rate used by transactions in mempool. And then divide this in two few groups.",https://github.com/bitcoin/bitcoin/pull/22891#discussion_r702441587,702441587,src/bitcoin-cli.cpp
klementtan,2021-09-06 19:56:27,"Updating the code to this solved the error for me.\n\n```suggestion\n        UniValue params{RPCConvertValues(""getmempoolinfo"", {""[1,10,20,30]""})};\n        result.push_back(JSONRPCRequestObj(""getmempoolinfo"", params, ID_MEMPOOLINFO));\n```\n\n![image](https://user-images.githubusercontent.com/49265907/132257557-5145c44a-5066-4e89-a336-556a39e0a8e9.png)\n\n",https://github.com/bitcoin/bitcoin/pull/22891#discussion_r703056412,703056412,src/bitcoin-cli.cpp
klementtan,2021-09-06 19:56:59,Maybe add color to standardize with the other headers? ,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r703056499,703056499,src/bitcoin-cli.cpp
prayank23,2021-09-07 03:37:23,Changed 'Feerate Distribution' to 'Mempool' and added RED color,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r703153491,703153491,src/bitcoin-cli.cpp
prayank23,2021-09-07 03:38:35,"Used different groups in last commit: 1-9, 10-99, 100-199 and Above 200",https://github.com/bitcoin/bitcoin/pull/22891#discussion_r703153854,703153854,src/bitcoin-cli.cpp
klementtan,2021-09-13 03:38:14,"Just checking, did you intentionally leave out `batch[ID_MEMPOOLINFO][""result""][""fee_histogram""][""fee_rate_groups""][""1000""][""size""]`?",https://github.com/bitcoin/bitcoin/pull/22891#discussion_r706983262,706983262,src/bitcoin-cli.cpp
klementtan,2021-09-13 03:48:46,nit: Possible to refactor this into a separate method? ,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r706985793,706985793,src/bitcoin-cli.cpp
klementtan,2021-09-13 03:51:32,Could add Doxygen documentation for this new function.,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r706986559,706986559,src/bitcoin-cli.cpp
prayank23,2021-09-13 05:42:28,"Yes. Because fee rate groups are:\n\n1 (from 1 to 9)\n10 (from 10 to 99)\n100 (from 100 to 199)\n200 (from 200 to 1000)\n\nYou can see them in the results for `bitcoin-cli getmempoolinfo ""[1,10,100,200,1000]""`",https://github.com/bitcoin/bitcoin/pull/22891#discussion_r707019664,707019664,src/bitcoin-cli.cpp
prayank23,2021-09-13 05:43:59,A function for whole thing? Yes. ,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r707020158,707020158,src/bitcoin-cli.cpp
prayank23,2021-09-13 05:44:14,Sure,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r707020247,707020247,src/bitcoin-cli.cpp
klementtan,2021-09-13 05:58:15,"Ah got it! Tx with fee >= 1000 sat/vB will not be displayed.\n\nWould it be better to update s/Above 200  |/200-1000   |/? IIUC `batch[ID_MEMPOOLINFO][""result""][""fee_histogram""][""fee_rate_groups""][""200""][""size""]` only considers fees from `200-1000`\n\n```\n./src/bitcoin-cli -signet getmempoolinfo ""[1,10,100,200,1000]""\n...\n      ""200"": {\n        ""size"": 0,\n        ""count"": 0,\n       ",https://github.com/bitcoin/bitcoin/pull/22891#discussion_r707025664,707025664,src/bitcoin-cli.cpp
klementtan,2021-09-13 06:02:54,Yup L1076-L1130 looks like it could be cleanly refactored into another function üëç ,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r707027581,707027581,src/bitcoin-cli.cpp
prayank23,2021-09-13 06:03:33,Possible. Or we can change 1000 to a higher number. Will see what other reviewers think and decide accordingly.,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r707027786,707027786,src/bitcoin-cli.cpp
prayank23,2021-11-03 19:14:41,Done,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r742256447,742256447,src/bitcoin-cli.cpp
prayank23,2021-11-03 19:16:41,Sorry Its been more than a month. I was waiting for some progress in PR 21422 before making any changes here as it depends on it. Anyways looked at the code today and this looks alright because everything is inside `ParseGetInfoResult()`,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r742257786,742257786,src/bitcoin-cli.cpp
prayank23,2021-11-03 19:18:22,Will keep this unchanged as nobody reviewed and had issues with it. Fee rates are normally less than 1000 sat/vB and we can ignore if someone uses higher in few transactions because this is just the fee rate distribution summary to help users and complete information.,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r742258915,742258915,src/bitcoin-cli.cpp
kiminuo,2021-11-09 20:50:28,"```suggestion\n    if (mempool_bytes > 0) {\n```",https://github.com/bitcoin/bitcoin/pull/22891#discussion_r746025964,746025964,src/bitcoin-cli.cpp
kiminuo,2021-11-09 20:50:46,"\n\n\nI can see mixing of tabs and spaces in the source code: \n![image](https://user-images.githubusercontent.com/58662979/141002352-bca9f6de-5a65-49e5-9afd-aabeddbe0be2.png) \n\n(This is actually interesting because if you use an editor that supports .editorconfig, it should be quite hard to get to this situation)",https://github.com/bitcoin/bitcoin/pull/22891#discussion_r746026278,746026278,src/bitcoin-cli.cpp
kiminuo,2021-11-09 20:52:21,I would consider naming the function `GetFeeRateBar` as I can see that we have `CFeeRate` class. But I may be wrong on this.,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r746027915,746027915,src/bitcoin-cli.cpp
kiminuo,2021-11-09 20:56:49,"```suggestion\n    	// Removing zero from numbers used in std::min to avoid division by zero in GetFeeRateBar()\n```",https://github.com/bitcoin/bitcoin/pull/22891#discussion_r746033022,746033022,src/bitcoin-cli.cpp
kiminuo,2021-11-09 20:57:20,"```suggestion\n    		if (fee_size > 0) {\n```",https://github.com/bitcoin/bitcoin/pull/22891#discussion_r746033614,746033614,src/bitcoin-cli.cpp
kiminuo,2021-11-09 21:02:28,Maybe the arguments can be re-ordered so that `in` params are first and the `out` param is last.,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r746039369,746039369,src/bitcoin-cli.cpp
kiminuo,2021-11-09 21:06:39,"Given that there so many very similar numbers differing in the number of zero digits, one may consider using `10'000` syntax to represent `10000` (https://en.cppreference.com/w/cpp/language/integer_literal). (I'm not sure if it is allowed in this repo though)",https://github.com/bitcoin/bitcoin/pull/22891#discussion_r746044132,746044132,src/bitcoin-cli.cpp
kiminuo,2021-11-09 21:07:17,"```suggestion\n    } else if (max_size > 10000000 && max_size < 100000000) {\n```",https://github.com/bitcoin/bitcoin/pull/22891#discussion_r746044853,746044853,src/bitcoin-cli.cpp
kiminuo,2021-11-09 21:10:12,What will happen for value `100000`? ,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r746048121,746048121,src/bitcoin-cli.cpp
kiminuo,2021-11-09 21:11:15,"All the for-cycles are the same basically, so maybe you can have one for-cycle after this set of conditions. That may actually be easier to review.",https://github.com/bitcoin/bitcoin/pull/22891#discussion_r746049296,746049296,src/bitcoin-cli.cpp
kiminuo,2021-11-09 21:12:47,"```suggestion\n        	if (0 == a || 0 == b)\n```",https://github.com/bitcoin/bitcoin/pull/22891#discussion_r746050610,746050610,src/bitcoin-cli.cpp
kiminuo,2021-11-09 21:19:36,What should happen when all values are zero?,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r746054948,746054948,src/bitcoin-cli.cpp
kiminuo,2021-11-09 21:20:07,This line makes me think that value `200` is not included neither in case 3 nor in case 4.,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r746055262,746055262,src/bitcoin-cli.cpp
kiminuo,2021-11-10 10:28:43,"Playing devil's advocate: Why to use these values and not different ones? \n\nI think it's very hard to argue that these values are the best possible. Without more information in PR's description, this feels arbitrary. And even if you can persuade people for Bitcoin mainnet chain, I would be surprised if these values were good for Bitcoin testnet chain.\n\nI don't really know how to approach t",https://github.com/bitcoin/bitcoin/pull/22891#discussion_r746454171,746454171,src/bitcoin-cli.cpp
prayank23,2021-11-11 00:44:00,I think I used different editor while working on this and my VS Code is behaving weird since few days. Will try to fix this.,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r747118637,747118637,src/bitcoin-cli.cpp
prayank23,2021-11-11 00:53:16,Done,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r747122131,747122131,src/bitcoin-cli.cpp
prayank23,2021-11-11 00:58:38,Not sure about this as I have not seen such format for any constants in this repository.,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r747124129,747124129,src/bitcoin-cli.cpp
prayank23,2021-11-11 01:03:19,Good catch. Will have to make some changes.,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r747125864,747125864,src/bitcoin-cli.cpp
prayank23,2021-11-11 01:07:05,Right this can be done. Will do later today.,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r747127196,747127196,src/bitcoin-cli.cpp
prayank23,2021-11-11 01:09:29,`mempool_bytes` will be zero in that case and mempool section will not be printed L1085,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r747128040,747128040,src/bitcoin-cli.cpp
prayank23,2021-11-11 01:11:22,200 is included in case 4. I wrote `Above 200` in short for `200 and Above 200`,https://github.com/bitcoin/bitcoin/pull/22891#discussion_r747128697,747128697,src/bitcoin-cli.cpp
prayank23,2021-11-11 01:19:16,"> Playing devil's advocate: Why to use these values and not different ones?\n\nDifferent can be either random values which is difficult to support in this feature as its just a summary of mempool. Or use more values in between which will use more space hence used all multiples of 10 until 100 and then trying to include everything else in 'Above 200' category.\n\n> And even if you can persuade ",https://github.com/bitcoin/bitcoin/pull/22891#discussion_r747131552,747131552,src/bitcoin-cli.cpp
kiminuo,2021-11-11 07:18:19,"> > And even if you can persuade people for Bitcoin mainnet chain, I would be surprised if these values were good for Bitcoin testnet chain.\n> \n> I tried them on testnet and mainnet. Works fine because it wont print a category if it has zero size.\n\nI'm not sure we understand each other. Anyway, I just wanted to point out that any fixed intervals may sooner or later become obsolete. Suppose",https://github.com/bitcoin/bitcoin/pull/22891#discussion_r747256562,747256562,src/bitcoin-cli.cpp
kiminuo,2021-11-11 07:20:27,"Yeah. Maybe one can use `‚â• 200` (https://www.fileformat.info/info/unicode/char/2265/index.htm) instead of ""Above 200"" to make the meaning absolutely clear.",https://github.com/bitcoin/bitcoin/pull/22891#discussion_r747257562,747257562,src/bitcoin-cli.cpp
kiminuo,2021-11-11 07:21:42,"IDK, maybe @jonatack would know. üôè ",https://github.com/bitcoin/bitcoin/pull/22891#discussion_r747258097,747258097,src/bitcoin-cli.cpp
