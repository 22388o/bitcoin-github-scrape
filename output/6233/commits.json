[
  {
    "sha": "3e9143386a90e508c8d41719294db11264f5f0a0",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozZTkxNDMzODZhOTBlNTA4YzhkNDE3MTkyOTRkYjExMjY0ZjVmMGEw",
    "commit": {
      "author": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2015-06-04T17:00:26Z"
      },
      "committer": {
        "name": "Suhas Daftuar",
        "email": "sdaftuar@gmail.com",
        "date": "2015-06-04T17:00:26Z"
      },
      "message": "Advance pindexLastCommonBlock for blocks in chainActive\n\nThis prevents an edge case where a block downloaded and pruned\nin-between successive calls to FindNextBlocksToDownload could\ncause the block to be unnecessarily re-requested.",
      "tree": {
        "sha": "40f4d24c61677f16b4f25a9b515e4730ae290e60",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/40f4d24c61677f16b4f25a9b515e4730ae290e60"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3e9143386a90e508c8d41719294db11264f5f0a0",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3e9143386a90e508c8d41719294db11264f5f0a0",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3e9143386a90e508c8d41719294db11264f5f0a0",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3e9143386a90e508c8d41719294db11264f5f0a0/comments",
    "author": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sdaftuar",
      "id": 7463573,
      "node_id": "MDQ6VXNlcjc0NjM1NzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7463573?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaftuar",
      "html_url": "https://github.com/sdaftuar",
      "followers_url": "https://api.github.com/users/sdaftuar/followers",
      "following_url": "https://api.github.com/users/sdaftuar/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaftuar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaftuar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaftuar/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaftuar/orgs",
      "repos_url": "https://api.github.com/users/sdaftuar/repos",
      "events_url": "https://api.github.com/users/sdaftuar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaftuar/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "dbd855023158e1c5ca2c5f0e8be552ecfb455834",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/dbd855023158e1c5ca2c5f0e8be552ecfb455834",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/dbd855023158e1c5ca2c5f0e8be552ecfb455834"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 3,
      "deletions": 2
    },
    "files": [
      {
        "sha": "dc9585b021a00ca722a1a231d971f328e3097f6f",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 2,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3e9143386a90e508c8d41719294db11264f5f0a0/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3e9143386a90e508c8d41719294db11264f5f0a0/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=3e9143386a90e508c8d41719294db11264f5f0a0",
        "patch": "@@ -433,13 +433,14 @@ void FindNextBlocksToDownload(NodeId nodeid, unsigned int count, std::vector<CBl\n \n         // Iterate over those blocks in vToFetch (in forward direction), adding the ones that\n         // are not yet downloaded and not in flight to vBlocks. In the mean time, update\n-        // pindexLastCommonBlock as long as all ancestors are already downloaded.\n+        // pindexLastCommonBlock as long as all ancestors are already downloaded, or if it's\n+        // already part of our chain (and therefore don't need it even if pruned).\n         BOOST_FOREACH(CBlockIndex* pindex, vToFetch) {\n             if (!pindex->IsValid(BLOCK_VALID_TREE)) {\n                 // We consider the chain that this peer is on invalid.\n                 return;\n             }\n-            if (pindex->nStatus & BLOCK_HAVE_DATA) {\n+            if (pindex->nStatus & BLOCK_HAVE_DATA || chainActive.Contains(pindex)) {\n                 if (pindex->nChainTx)\n                     state->pindexLastCommonBlock = pindex;\n             } else if (mapBlocksInFlight.count(pindex->GetBlockHash()) == 0) {"
      }
    ]
  }
]