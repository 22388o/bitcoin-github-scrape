[
  {
    "sha": "991193a07c438396bd0654e5e74ac33bfc81c455",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo5OTExOTNhMDdjNDM4Mzk2YmQwNjU0ZTVlNzRhYzMzYmZjODFjNDU1",
    "commit": {
      "author": {
        "name": "Mike Hearn",
        "email": "hearn@google.com",
        "date": "2012-03-11T22:13:09Z"
      },
      "committer": {
        "name": "Mike Hearn",
        "email": "hearn@google.com",
        "date": "2012-03-11T22:13:09Z"
      },
      "message": "Add a pong message that is sent in reply to a ping. It echoes back a nonce field that is now added to the ping message.",
      "tree": {
        "sha": "ced1d5599512075b660ba6735e3d2a547afffd5d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ced1d5599512075b660ba6735e3d2a547afffd5d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/991193a07c438396bd0654e5e74ac33bfc81c455",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/991193a07c438396bd0654e5e74ac33bfc81c455",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/991193a07c438396bd0654e5e74ac33bfc81c455",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/991193a07c438396bd0654e5e74ac33bfc81c455/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "4585d828b490f826cf863353d1cdf41ec4cb0724",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/4585d828b490f826cf863353d1cdf41ec4cb0724",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/4585d828b490f826cf863353d1cdf41ec4cb0724"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 17,
      "deletions": 0
    },
    "files": [
      {
        "sha": "02d04da578f13b05169b3e5f852357058ea0b2fc",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 17,
        "deletions": 0,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/991193a07c438396bd0654e5e74ac33bfc81c455/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/991193a07c438396bd0654e5e74ac33bfc81c455/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=991193a07c438396bd0654e5e74ac33bfc81c455",
        "patch": "@@ -2613,6 +2613,23 @@ bool static ProcessMessage(CNode* pfrom, string strCommand, CDataStream& vRecv)\n \n     else if (strCommand == \"ping\")\n     {\n+        if (pfrom->nVersion > 60000)\n+        {\n+            uint64 nonce = 0;\n+            vRecv >> nonce;\n+            // Echo the message back with the nonce. This allows for two useful features:\n+            //\n+            // 1) A remote node can quickly check if the connection is operational\n+            // 2) Remote nodes can measure the latency of the network thread. If this node\n+            //    is overloaded it won't respond to pings quickly and the remote node can\n+            //    avoid sending us more work, like chain download requests.\n+            //\n+            // The nonce stops the remote getting confused between different pings: without\n+            // it, if the remote node sends a ping once per second and this node takes 5\n+            // seconds to respond to each, the 5th ping the remote sends would appear to\n+            // return very quickly.\n+            pfrom->PushMessage(\"pong\", nonce);\n+        }\n     }\n \n "
      }
    ]
  },
  {
    "sha": "2fef9dac628524a528263e0ac1efcb719cd8a98d",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyZmVmOWRhYzYyODUyNGE1MjgyNjNlMGFjMWVmY2I3MTljZDhhOThk",
    "commit": {
      "author": {
        "name": "Mike Hearn",
        "email": "hearn@google.com",
        "date": "2012-03-13T17:44:30Z"
      },
      "committer": {
        "name": "Mike Hearn",
        "email": "hearn@google.com",
        "date": "2012-03-13T17:44:30Z"
      },
      "message": "Bump protocol version. Send a nonce of zero in ping messages.",
      "tree": {
        "sha": "d81bf7fdb9538c56ae4348ca486b49124d8a63d9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d81bf7fdb9538c56ae4348ca486b49124d8a63d9"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2fef9dac628524a528263e0ac1efcb719cd8a98d",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2fef9dac628524a528263e0ac1efcb719cd8a98d",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2fef9dac628524a528263e0ac1efcb719cd8a98d",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2fef9dac628524a528263e0ac1efcb719cd8a98d/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "991193a07c438396bd0654e5e74ac33bfc81c455",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/991193a07c438396bd0654e5e74ac33bfc81c455",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/991193a07c438396bd0654e5e74ac33bfc81c455"
      }
    ],
    "stats": {
      "total": 13,
      "additions": 9,
      "deletions": 4
    },
    "files": [
      {
        "sha": "022ab495342ec9c62b4428b9ce02f064b4cde475",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 8,
        "deletions": 3,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2fef9dac628524a528263e0ac1efcb719cd8a98d/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2fef9dac628524a528263e0ac1efcb719cd8a98d/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=2fef9dac628524a528263e0ac1efcb719cd8a98d",
        "patch": "@@ -2788,9 +2788,14 @@ bool SendMessages(CNode* pto, bool fSendTrickle)\n         if (pto->nVersion == 0)\n             return true;\n \n-        // Keep-alive ping\n-        if (pto->nLastSend && GetTime() - pto->nLastSend > 30 * 60 && pto->vSend.empty())\n-            pto->PushMessage(\"ping\");\n+        // Keep-alive ping. We send a nonce of zero because we don't use it anywhere \n+        // right now.\n+        if (pto->nLastSend && GetTime() - pto->nLastSend > 30 * 60 && pto->vSend.empty()) {\n+            if (pto->nVersion > 60000)\n+                pto->PushMessage(\"ping\", 0);\n+            else\n+                pto->PushMessage(\"ping\");\n+        }\n \n         // Resend wallet transactions that haven't gotten in a block yet\n         ResendWalletTransactions();"
      },
      {
        "sha": "050e910d1fe75843b41ff5bb8102839ddc80d8f0",
        "filename": "src/serialize.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2fef9dac628524a528263e0ac1efcb719cd8a98d/src/serialize.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2fef9dac628524a528263e0ac1efcb719cd8a98d/src/serialize.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/serialize.h?ref=2fef9dac628524a528263e0ac1efcb719cd8a98d",
        "patch": "@@ -53,7 +53,7 @@ class CDataStream;\n class CAutoFile;\n static const unsigned int MAX_SIZE = 0x02000000;\n \n-static const int PROTOCOL_VERSION = 60000;\n+static const int PROTOCOL_VERSION = 70000;\n \n // Used to bypass the rule against non-const reference to temporary\n // where it makes sense with wrappers such as CFlatData or CTxDB"
      }
    ]
  }
]