[
  {
    "sha": "a46484c8b3715725f5dc0b8ad1bf921880ed9af1",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzphNDY0ODRjOGIzNzE1NzI1ZjVkYzBiOGFkMWJmOTIxODgwZWQ5YWYx",
    "commit": {
      "author": {
        "name": "Ben Woosley",
        "email": "ben.woosley@gmail.com",
        "date": "2020-03-18T22:23:25Z"
      },
      "committer": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2020-04-02T04:31:54Z"
      },
      "message": "build: Detect gmtime_* definitions via configure\n\nThis improves the portability of the codebase and fixes compilation\nwith mingw-w64 7.0+.\n\nCo-authored-by: fanquake <fanquake@gmail.com>",
      "tree": {
        "sha": "c73218fdc972628f7fbba821de162267bed6af86",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c73218fdc972628f7fbba821de162267bed6af86"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/a46484c8b3715725f5dc0b8ad1bf921880ed9af1",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEz7FuIclQ9n+pXlWPLuufXMCVJsEFAl6FaroACgkQLuufXMCV\nJsEQtQ//RgRrLGNESAJw2zw7zlwGzaGGgLv1jei5uKZOoj4TCLe0hCcZSxjZmv6Q\nTv03gfrBnahzVWqDg6c8ptGYHu8IdZuxG4WiWaElnfUL/C0Js5j6JrRZqS7pFCuX\n4/Dy9FsmY3usGJoQhRM/aqhPxCxhAlEz24XJUZBkH0cgtGndv5wLUbbVQ1Pm0tks\n71thlba3EnHjSv42vbdK5nxLPl83M8XQf8HdzmizDZWg0/mh98DmFrq1zLCF+T8K\nE1yh/THA127FYHfQOD1FI5KM3RQTEMttr6gu3Brty+zt8zVP1JsePmmUss9EQ26k\nKZ6xuU3uuk756wgQ9dEcxN4emOFYf3gdTVZHpdGaZVcpgIJ5I5PvXk66oOQJFyXQ\n5oUZWvEGgngyAs7IkHVDupB5ua1zakSg48py5vrQ/J/HeaG+VEH5Q/Mub6+5NP0y\nc78jv14MtTst0C+ggmmlQ66sKYQDQ6NCSdtCKDdVk9rshmd3F+0H3BB0jmPiKe8J\nU/xwKVVakYbZtG+UB6OSyGDlweUFXlF6kpeRq+n8Jh+2PrPRNZF3KSuAtUis1/m7\nZlXhvXaoN44Y2VPLNOequPgPxNxW2jnz19ptFIV+S0D4jfDJuHV4ftPhM/ITu7e8\nH5kRhJjrpx7prQBeI3iuIk0MiBUazEu8t/puhqjQ9T4+ZMX4RGA=\n=lzXW\n-----END PGP SIGNATURE-----",
        "payload": "tree c73218fdc972628f7fbba821de162267bed6af86\nparent 41fa2926d86a57c9623d34debef20746ee2f454a\nauthor Ben Woosley <ben.woosley@gmail.com> 1584570205 -0700\ncommitter fanquake <fanquake@gmail.com> 1585801914 +0800\n\nbuild: Detect gmtime_* definitions via configure\n\nThis improves the portability of the codebase and fixes compilation\nwith mingw-w64 7.0+.\n\nCo-authored-by: fanquake <fanquake@gmail.com>\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a46484c8b3715725f5dc0b8ad1bf921880ed9af1",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/a46484c8b3715725f5dc0b8ad1bf921880ed9af1",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a46484c8b3715725f5dc0b8ad1bf921880ed9af1/comments",
    "author": {
      "login": "Empact",
      "id": 5470,
      "node_id": "MDQ6VXNlcjU0NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Empact",
      "html_url": "https://github.com/Empact",
      "followers_url": "https://api.github.com/users/Empact/followers",
      "following_url": "https://api.github.com/users/Empact/following{/other_user}",
      "gists_url": "https://api.github.com/users/Empact/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Empact/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Empact/subscriptions",
      "organizations_url": "https://api.github.com/users/Empact/orgs",
      "repos_url": "https://api.github.com/users/Empact/repos",
      "events_url": "https://api.github.com/users/Empact/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Empact/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "41fa2926d86a57c9623d34debef20746ee2f454a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/41fa2926d86a57c9623d34debef20746ee2f454a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/41fa2926d86a57c9623d34debef20746ee2f454a"
      }
    ],
    "stats": {
      "total": 29,
      "additions": 23,
      "deletions": 6
    },
    "files": [
      {
        "sha": "4cfd5c9274e33b7ba2c5b9191f4e817ed0f4aed7",
        "filename": "configure.ac",
        "status": "modified",
        "additions": 17,
        "deletions": 0,
        "changes": 17,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a46484c8b3715725f5dc0b8ad1bf921880ed9af1/configure.ac",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a46484c8b3715725f5dc0b8ad1bf921880ed9af1/configure.ac",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/configure.ac?ref=a46484c8b3715725f5dc0b8ad1bf921880ed9af1",
        "patch": "@@ -906,6 +906,22 @@ if test \"x$use_thread_local\" = xyes || { test \"x$use_thread_local\" = xauto && te\n   LDFLAGS=\"$TEMP_LDFLAGS\"\n fi\n \n+dnl check for gmtime_r(), fallback to gmtime_s() if that is unavailable\n+dnl fail if neither are available.\n+AC_MSG_CHECKING(for gmtime_r)\n+AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[#include <ctime>]],\n+  [[ gmtime_r((const time_t *) nullptr, (struct tm *) nullptr); ]])],\n+  [ AC_MSG_RESULT(yes); AC_DEFINE(HAVE_GMTIME_R, 1, [Define this symbol if gmtime_r is available]) ],\n+  [ AC_MSG_RESULT(no);\n+    AC_MSG_CHECKING(for gmtime_s);\n+    AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[#include <ctime>]],\n+       [[ gmtime_s((struct tm *) nullptr, (const time_t *) nullptr); ]])],\n+       [ AC_MSG_RESULT(yes)],\n+       [ AC_MSG_RESULT(no); AC_MSG_ERROR(Both gmtime_r and gmtime_s are unavailable) ]\n+    )\n+  ]\n+)\n+\n dnl Check for different ways of gathering OS randomness\n AC_MSG_CHECKING(for Linux getrandom syscall)\n AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[#include <unistd.h>\n@@ -1596,6 +1612,7 @@ AC_SUBST(EVENT_LIBS)\n AC_SUBST(EVENT_PTHREADS_LIBS)\n AC_SUBST(ZMQ_LIBS)\n AC_SUBST(QR_LIBS)\n+AC_SUBST(HAVE_GMTIME_R)\n AC_SUBST(HAVE_FDATASYNC)\n AC_SUBST(HAVE_FULLFSYNC)\n AC_SUBST(HAVE_O_CLOEXEC)"
      },
      {
        "sha": "0938ff36a69bd9a04087c98d5ef194f8c3a2f6e4",
        "filename": "src/util/time.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 6,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/a46484c8b3715725f5dc0b8ad1bf921880ed9af1/src/util/time.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/a46484c8b3715725f5dc0b8ad1bf921880ed9af1/src/util/time.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util/time.cpp?ref=a46484c8b3715725f5dc0b8ad1bf921880ed9af1",
        "patch": "@@ -78,10 +78,10 @@ int64_t GetSystemTimeInSeconds()\n std::string FormatISO8601DateTime(int64_t nTime) {\n     struct tm ts;\n     time_t time_val = nTime;\n-#ifdef _MSC_VER\n-    if (gmtime_s(&ts, &time_val) != 0) {\n-#else\n+#ifdef HAVE_GMTIME_R\n     if (gmtime_r(&time_val, &ts) == nullptr) {\n+#else\n+    if (gmtime_s(&ts, &time_val) != 0) {\n #endif\n         return {};\n     }\n@@ -91,10 +91,10 @@ std::string FormatISO8601DateTime(int64_t nTime) {\n std::string FormatISO8601Date(int64_t nTime) {\n     struct tm ts;\n     time_t time_val = nTime;\n-#ifdef _MSC_VER\n-    if (gmtime_s(&ts, &time_val) != 0) {\n-#else\n+#ifdef HAVE_GMTIME_R\n     if (gmtime_r(&time_val, &ts) == nullptr) {\n+#else\n+    if (gmtime_s(&ts, &time_val) != 0) {\n #endif\n         return {};\n     }"
      }
    ]
  }
]