[
  {
    "sha": "2c811880239ec6d5cdf6870c1f648f02ef908e37",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyYzgxMTg4MDIzOWVjNmQ1Y2RmNjg3MGMxZjY0OGYwMmVmOTA4ZTM3",
    "commit": {
      "author": {
        "name": "Brandon Dahler",
        "email": "brandon.dahler@gmail.com",
        "date": "2014-03-24T01:14:43Z"
      },
      "committer": {
        "name": "Brandon Dahler",
        "email": "brandon.dahler@gmail.com",
        "date": "2014-03-25T23:24:58Z"
      },
      "message": "Wrap create_directory calls in try...catch blocks.\n\nIgnores any exceptions thrown if directory exists, otherwise re-throws exception.",
      "tree": {
        "sha": "0d91feda07af9855d303e4ec30d49b05e274f12d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0d91feda07af9855d303e4ec30d49b05e274f12d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/2c811880239ec6d5cdf6870c1f648f02ef908e37",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2c811880239ec6d5cdf6870c1f648f02ef908e37",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/2c811880239ec6d5cdf6870c1f648f02ef908e37",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/2c811880239ec6d5cdf6870c1f648f02ef908e37/comments",
    "author": {
      "login": "brandondahler",
      "id": 1155895,
      "node_id": "MDQ6VXNlcjExNTU4OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1155895?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brandondahler",
      "html_url": "https://github.com/brandondahler",
      "followers_url": "https://api.github.com/users/brandondahler/followers",
      "following_url": "https://api.github.com/users/brandondahler/following{/other_user}",
      "gists_url": "https://api.github.com/users/brandondahler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brandondahler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brandondahler/subscriptions",
      "organizations_url": "https://api.github.com/users/brandondahler/orgs",
      "repos_url": "https://api.github.com/users/brandondahler/repos",
      "events_url": "https://api.github.com/users/brandondahler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brandondahler/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "brandondahler",
      "id": 1155895,
      "node_id": "MDQ6VXNlcjExNTU4OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1155895?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brandondahler",
      "html_url": "https://github.com/brandondahler",
      "followers_url": "https://api.github.com/users/brandondahler/followers",
      "following_url": "https://api.github.com/users/brandondahler/following{/other_user}",
      "gists_url": "https://api.github.com/users/brandondahler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brandondahler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brandondahler/subscriptions",
      "organizations_url": "https://api.github.com/users/brandondahler/orgs",
      "repos_url": "https://api.github.com/users/brandondahler/repos",
      "events_url": "https://api.github.com/users/brandondahler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brandondahler/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e3f5d4338d0305a398817279e36ef2d0cfd2fd2b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e3f5d4338d0305a398817279e36ef2d0cfd2fd2b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e3f5d4338d0305a398817279e36ef2d0cfd2fd2b"
      }
    ],
    "stats": {
      "total": 26,
      "additions": 22,
      "deletions": 4
    },
    "files": [
      {
        "sha": "05cd657f1f6232932f6d7b3e2561cf12eeec66b7",
        "filename": "src/db.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2c811880239ec6d5cdf6870c1f648f02ef908e37/src/db.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2c811880239ec6d5cdf6870c1f648f02ef908e37/src/db.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/db.cpp?ref=2c811880239ec6d5cdf6870c1f648f02ef908e37",
        "patch": "@@ -72,7 +72,7 @@ bool CDBEnv::Open(const boost::filesystem::path& pathIn)\n \n     path = pathIn;\n     filesystem::path pathLogDir = path / \"database\";\n-    filesystem::create_directory(pathLogDir);\n+    TryCreateDirectory(pathLogDir);\n     filesystem::path pathErrorFile = path / \"db.log\";\n     LogPrintf(\"dbenv.open LogDir=%s ErrorFile=%s\\n\", pathLogDir.string(), pathErrorFile.string());\n "
      },
      {
        "sha": "5b4a9c147b7e260754890312f93d396826eb1471",
        "filename": "src/leveldbwrapper.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2c811880239ec6d5cdf6870c1f648f02ef908e37/src/leveldbwrapper.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2c811880239ec6d5cdf6870c1f648f02ef908e37/src/leveldbwrapper.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/leveldbwrapper.cpp?ref=2c811880239ec6d5cdf6870c1f648f02ef908e37",
        "patch": "@@ -51,7 +51,7 @@ CLevelDBWrapper::CLevelDBWrapper(const boost::filesystem::path &path, size_t nCa\n             LogPrintf(\"Wiping LevelDB in %s\\n\", path.string());\n             leveldb::DestroyDB(path.string(), options);\n         }\n-        boost::filesystem::create_directory(path);\n+        TryCreateDirectory(path);\n         LogPrintf(\"Opening LevelDB in %s\\n\", path.string());\n     }\n     leveldb::Status status = leveldb::DB::Open(options, path.string(), &pdb);"
      },
      {
        "sha": "ae940d5af282e3fae005eefbab324c1767eeb556",
        "filename": "src/qt/intro.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2c811880239ec6d5cdf6870c1f648f02ef908e37/src/qt/intro.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2c811880239ec6d5cdf6870c1f648f02ef908e37/src/qt/intro.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/intro.cpp?ref=2c811880239ec6d5cdf6870c1f648f02ef908e37",
        "patch": "@@ -175,7 +175,7 @@ void Intro::pickDataDirectory()\n             }\n             dataDir = intro.getDataDirectory();\n             try {\n-                fs::create_directory(dataDir.toStdString());\n+                TryCreateDirectory(dataDir.toStdString());\n                 break;\n             } catch(fs::filesystem_error &e) {\n                 QMessageBox::critical(0, tr(\"Bitcoin\"),"
      },
      {
        "sha": "0d1200928cd9e995d8d97625b106a306c7e43f89",
        "filename": "src/util.cpp",
        "status": "modified",
        "additions": 18,
        "deletions": 1,
        "changes": 19,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2c811880239ec6d5cdf6870c1f648f02ef908e37/src/util.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2c811880239ec6d5cdf6870c1f648f02ef908e37/src/util.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util.cpp?ref=2c811880239ec6d5cdf6870c1f648f02ef908e37",
        "patch": "@@ -976,7 +976,7 @@ boost::filesystem::path GetDefaultDataDir()\n #ifdef MAC_OSX\n     // Mac\n     pathRet /= \"Library/Application Support\";\n-    fs::create_directory(pathRet);\n+    TryCreateDirectory(pathRet);\n     return pathRet / \"Bitcoin\";\n #else\n     // Unix\n@@ -1090,6 +1090,23 @@ bool RenameOver(boost::filesystem::path src, boost::filesystem::path dest)\n #endif /* WIN32 */\n }\n \n+\n+// Ignores exceptions thrown by boost's create_directory if the requested directory exists.\n+//   Specifically handles case where path p exists, but it wasn't possible for the user to write to the parent directory.\n+bool TryCreateDirectory(const boost::filesystem::path& p)\n+{\n+    try\n+    {\n+        return boost::filesystem::create_directory(p);\n+    } catch (boost::filesystem::filesystem_error) {\n+        if (!boost::filesystem::exists(p) || !boost::filesystem::is_directory(p))\n+            throw;\n+    }\n+\n+    // create_directory didn't create the directory, it had to have existed already\n+    return false;\n+}\n+\n void FileCommit(FILE *fileout)\n {\n     fflush(fileout); // harmless if redundantly called"
      },
      {
        "sha": "8e9f2d230be008094e1e2b9a7f58552efc8fb24a",
        "filename": "src/util.h",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/2c811880239ec6d5cdf6870c1f648f02ef908e37/src/util.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/2c811880239ec6d5cdf6870c1f648f02ef908e37/src/util.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util.h?ref=2c811880239ec6d5cdf6870c1f648f02ef908e37",
        "patch": "@@ -190,6 +190,7 @@ bool TruncateFile(FILE *file, unsigned int length);\n int RaiseFileDescriptorLimit(int nMinFD);\n void AllocateFileRange(FILE *file, unsigned int offset, unsigned int length);\n bool RenameOver(boost::filesystem::path src, boost::filesystem::path dest);\n+bool TryCreateDirectory(const boost::filesystem::path& p);\n boost::filesystem::path GetDefaultDataDir();\n const boost::filesystem::path &GetDataDir(bool fNetSpecific = true);\n boost::filesystem::path GetConfigFile();"
      }
    ]
  }
]