promag,2018-05-24T14:15:17Z,Not sure about disabling the limit.,https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-391730865,391730865,
jonasschnelli,2018-05-24T14:18:53Z,"I think a viable long term alternative is replacing ZMQ with a stateless longpolling similar to #13262.\nSomething like a `list_blocks_since_block` where it idles if the newest block was requested. Seems to be much saner then hoping ZMQ messages arrive.",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-391732108,391732108,
Alex-CodeLab,2018-05-24T14:19:16Z,"@promag I tried a 10000 limit first, and that also works (for now). But the default of 1000 seems too low.\n\nIn older versions of ZMQ the default was ""no limit"" anyway. \n\nThe queue is per SUBscriber, so if you have thousands of listeners to the node you might see some increase in memory usage.  I was not able to see an increase in memory usage on my system with 6 subscribers on different co",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-391732229,391732229,
promag,2018-05-24T14:24:17Z,Make it an option?,https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-391733964,391733964,
practicalswift,2018-05-24T14:53:39Z,"@FeedTheWeb Thanks for addressing this issue. Messages being dropped silently under normal circumstances when running with default settings sounds very confusing for the user.\n\nWould it make sense to bump the limit to say 2 * ""expected maximum under normal operations"" instead of removing the limit?\n\nThat way we won't drop messages under normal circumstances while still getting the ""avoid g",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-391744440,391744440,
promag,2018-05-24T15:00:43Z,"What is the ""expected maximum under normal operations""?",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-391747047,391747047,
practicalswift,2018-05-24T15:25:47Z,@promag Sorry for being vague. I meant the maximum number of buffered messages that can be expected under normal operations :-),https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-391756107,391756107,
promag,2018-05-24T15:34:48Z,"@practicalswift reorgs and rescans will trigger the notifiers so I don't know if we should go that way. \n\nAlso, from the docs:\n> If this limit has been reached the socket shall enter an exceptional state and\n> depending on the socket type, 0MQ shall take appropriate action such as\n> blocking or dropping sent messages\n\nIMO making this configurable is the best bet and ideally should be",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-391759396,391759396,
laanwj,2018-05-31T06:54:25Z,Ping @jmcorgan ,https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-393427478,393427478,
Alex-CodeLab,2018-06-06T09:05:54Z,"@promag, it could only be made configurable per socket (not per notifier), but tbh I don't see why that would be useful. \n\n@practicalswift the 'normal circumstances' is not relevant here, this is only about peaks (with a duration of usually a few ms). In normal situations there never is a queue; the queue grows only when bitcoind pushes the messages faster then your network can handle (note: '",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-394999110,394999110,
jmcorgan,2018-06-08T18:52:42Z,I agree on having a config option to set this. The reason for leaving the default in the original implementation was to ensure that there were no performance impact or other side effects on bitcoind operation from malicious or poorly executing clients.,https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-395855308,395855308,
jmcorgan,2018-06-08T21:44:27Z,"To elaborate--ZMQ's high watermark buffered message limit prevents the ZMQ sending process from blocking when downstream resources (network bandwidth) are insufficient to handle the message volume. (The remote end can detect this when sequence numbers get skipped.) \n\nThis was originally chosen by design to be left at the default in order to be *conservative*--enabling ZMQ notifications and con",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-395899508,395899508,
sangaman,2018-06-19T21:32:33Z,"Making this configurable seems like the way to go. And if it spikes around 3000 messages per new block, raising the default to slightly higher than that (maybe 5000?) might be good as well.",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-398553280,398553280,
reel,2018-06-26T20:43:00Z,"I had 3 subscribers on commodity HW and they were missing packets (they were LND nodes) and desycing every 2-3 blocks. Since I applied this PR, I can easily run 7-8 clients and not missing anything. Make it configurable or disable it. \n\nGreat PR!",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-400455458,400455458,
jmcorgan,2018-06-27T20:41:33Z,@FeedTheWeb Are you planning to update this to make this configurable?,https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-400822051,400822051,
Alex-CodeLab,2018-06-28T08:22:46Z,"@jmcorgan , we still need to agree on setting a different default value .\n(10k is reasonable, imo. But I would like others to test and see if this has any positive effect )",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-400953844,400953844,
reel,2018-06-28T12:38:30Z,"Is there any way we can poll to see the actual usage? As I understand, this is affected by the slowest peer?",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-401020170,401020170,
reel,2018-06-28T12:51:24Z,"The ZMQ api is well documented. (http://api.zeromq.org/2-1:zmq-setsockopt)\n\nZMQ_HWM and ZMQ_SWAP could be configurable (advanced mode).\n\nHWM default could stay at 1000 or be increased to 10000\nSWAP could still default to 0 but it could be a good safety net for delicate operations\n\nLet me know if you want me to give it a try or collaborate on this.",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-401023427,401023427,
Alex-CodeLab,2018-06-28T15:38:29Z,"@reel no, that is version 2.1 we use 4.*  and it does not use SWAP anymore. http://api.zeromq.org/4-1:zmq-setsockopt",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-401078362,401078362,
reel,2018-06-28T15:58:44Z,"Correct, I need a coffee fix.\n\nDefaults were set to 1000 7 years ago...\n\nhttps://github.com/zeromq/libzmq/commit/d31792e652cc9fd3bc84e2abd89f232d273b7ede\n",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-401085035,401085035,
jmcorgan,2018-07-03T22:57:49Z,"In addition to the individual comments above, there also needs to be some changes related to adding a new config option (documentation, mostly.) I suggest you do a 'git grep zmqpub' from the top-level directory (above src) to see where this is necessary.",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-402315052,402315052,
Alex-CodeLab,2018-07-03T23:07:07Z,"pls improve the code if you have any suggestions.\n(I'm not a C++ coder, so my knowledge kinda ends here anyway)",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-402316651,402316651,
jmcorgan,2018-07-04T16:04:17Z,"This would have needed a clean rebase for merge anyway, so if you don't mind I'll just implement this from scratch in a new PR.",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-402517570,402517570,
Alex-CodeLab,2018-08-22T20:02:58Z,"@jmcorgan , \nit has a been a few months, and I have not seen your PR. \nAs I told you also in private, I welcome any improvement. \nHowever, your comment:  ""ensure that there were no performance impact or other side effects on bitcoind operation from malicious or poorly executing clients"" tells me that you don' t really understand how ZMQ works, since (when implemented correctly) these are com",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-415161139,415161139,
promag,2018-08-23T01:12:20Z,"> But now it seems any progress on this part is halted by you, for unknown reasons.\n\n@FeedTheWeb if you need this then feel free to implement it, I'd review it too.",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-415239355,415239355,
jmcorgan,2018-08-24T00:29:11Z,"@FeedTheWeb Your understanding of how to motivate others to do free work to your liking seems lacking.\n\nYou made a pull request, and when I reviewed and suggested simple changes that would be needed, you immediately gave up. \n\nI offered to do it, and when it wasn't done in the time frame you wanted, you then made odd claims about my level of understanding of something completely unrelated ",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-415613858,415613858,
Alex-CodeLab,2018-08-24T20:47:18Z,"thanks for the reply, @jmcorgan \nFirst of all, it is a volunteer project for me as well. Tbh, I'm not even that interested in this change, but \nthe LND folks have been complaining about it for over a year, and it seems important, so I investigated the issue, made a case and provided evidence. \n(Why? because I worked with ZMQ before, so I knew about this issue for some years already.  And I l",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-415878160,415878160,
mruddy,2018-08-25T00:48:48Z,"@FeedTheWeb chillax bro, we're all in this together. i built on your work and, i believe, covered all of the feedback so far on my branch in one commit at https://github.com/mruddy/bitcoin/tree/zmqhwm.\n\n@jmcorgan does my commit cover your feedback? my changes create a configurable hwm option for each notification type. i left the default at 1000 since it's configurable and people that don't co",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-415916824,415916824,
reel,2018-08-25T01:32:37Z,"Enough with the drama.\n\n@mruddy can you please make a new PR referencing this one so we can comment/review?\n\nGood work everyone!\n\nOne a side note, work done on the LND side to limit the amount of connections and broadcast internally really helped. This PR will really close this issue and prevent maintaining Bitcoin forks for many of us. Thanks again!",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-415921026,415921026,
mruddy,2018-08-25T07:19:43Z,@reel done https://github.com/bitcoin/bitcoin/pull/14060,https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-415947940,415947940,
DrahtBot,2018-09-07T18:52:38Z,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#14060](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/14060.html) (ZMQ: add options to configure outbound mess",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-419532795,419532795,
DrahtBot,2018-09-07T21:00:54Z,"<!--5d09a71f8925f3f132321140b44b946d-->The last travis run for this pull request was 69 days ago and is thus outdated. To trigger a fresh travis build, this pull request should be closed and re-opened.",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-419564581,419564581,
laanwj,2018-11-05T13:02:14Z,"Closed by #14060, I guess.",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-435866014,435866014,
mruddy,2018-11-05T13:07:35Z,"yes, thanks!",https://github.com/bitcoin/bitcoin/pull/13315#issuecomment-435867405,435867405,
jmcorgan,2018-07-03T22:33:06Z,This will need a hidden_args entry.,https://github.com/bitcoin/bitcoin/pull/13315#discussion_r199967695,199967695,src/init.cpp
jmcorgan,2018-07-03T22:55:53Z,The error return should be checked here in case an invalid value is set by the user config.,https://github.com/bitcoin/bitcoin/pull/13315#discussion_r199971127,199971127,src/zmq/zmqpublishnotifier.cpp
Alex-CodeLab,2018-07-03T23:02:25Z,"if any invalid value is given, it defaults to1000. \n",https://github.com/bitcoin/bitcoin/pull/13315#discussion_r199972010,199972010,src/zmq/zmqpublishnotifier.cpp
practicalswift,2018-09-23T08:20:14Z,"```\n2018-09-22 22:19:29 cpplint(pr=13315): src/zmq/zmqpublishnotifier.cpp:83:  Extra space before ( in function call  [whitespace/parens] [4]\n```",https://github.com/bitcoin/bitcoin/pull/13315#discussion_r219691706,219691706,src/zmq/zmqpublishnotifier.cpp
practicalswift,2018-10-05T07:52:33Z,Make this explicit conversion explicit :-),https://github.com/bitcoin/bitcoin/pull/13315#discussion_r222919375,222919375,src/zmq/zmqpublishnotifier.cpp
