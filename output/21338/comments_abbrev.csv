michaelfolkson,2021-03-02 14:10:29,"Concept ACK\n\nI was thinking this should be a `p2p_` test rather than a `feature_` test but maybe you're right...\n\n",https://github.com/bitcoin/bitcoin/pull/21338#issuecomment-788935905,788935905,
brunoerg,2021-03-02 14:54:00,I added feature_anchors.py in BASE_SCRIPTS,https://github.com/bitcoin/bitcoin/pull/21338#issuecomment-788965587,788965587,
jaonoctus,2021-03-02 14:54:30,"CI Tests are failing for two reasons so far:\n\n1. The following scripts are not being run: `['feature_anchors.py']`. Check the test lists in `test_runner.py`\n2. Some lint errors\n```\nfeature_anchors.py:31:1: W293 blank line contains whitespace\nfeature_anchors.py:77:25: W292 no newline at end of file\n```",https://github.com/bitcoin/bitcoin/pull/21338#issuecomment-788965917,788965917,
brunoerg,2021-03-02 14:57:14,"Thanks, @jaonoctus. Fixed!",https://github.com/bitcoin/bitcoin/pull/21338#issuecomment-788967916,788967916,
hebasto,2021-03-02 15:55:48,Concept ACK.,https://github.com/bitcoin/bitcoin/pull/21338#issuecomment-789011205,789011205,
brunoerg,2021-03-02 21:00:25,@leonardojobim Amazing review! I'm working on it at this moment! Thank you!,https://github.com/bitcoin/bitcoin/pull/21338#issuecomment-789212085,789212085,
brunoerg,2021-03-02 21:04:31,@leonardojobim fixed! could you please test it again?,https://github.com/bitcoin/bitcoin/pull/21338#issuecomment-789214460,789214460,
DrahtBot,2021-03-02 21:31:07,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* #19521 (Coinstats Index by fjahr)\n* #18795 (Test: wallet issue with orphaned rewards by domob1812)\n\nIf you consider thi",https://github.com/bitcoin/bitcoin/pull/21338#issuecomment-789230281,789230281,
brunoerg,2021-03-06 13:43:21,Thanks for the review @jonatack. Just pushed some fixes!,https://github.com/bitcoin/bitcoin/pull/21338#issuecomment-791944309,791944309,
ottosch,2021-03-20 01:16:48,"Tested ACK. I ran it 100x and they all passed.\nOS: Archlinux.\n\n![tack-21338](https://user-images.githubusercontent.com/17476/111854920-b2efd700-8900-11eb-8f10-e0fc0bb166dc.png)\n",https://github.com/bitcoin/bitcoin/pull/21338#issuecomment-803214989,803214989,
MarcoFalke,2021-03-20 07:36:17,Concept ACK 581791c62067403fbeb4e1fd88c1d80549627c94,https://github.com/bitcoin/bitcoin/pull/21338#issuecomment-803266423,803266423,
jaonoctus,2021-03-02 15:14:06,"```suggestion\n        for line in open(os.path.join(self.nodes[0].datadir + '/regtest', 'anchors.dat'), 'rb', encoding='utf8'):\n```",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r585649640,585649640,test/functional/feature_anchors.py
brunoerg,2021-03-02 15:48:12,I think it won't work because it's binary mode.,https://github.com/bitcoin/bitcoin/pull/21338#discussion_r585680413,585680413,test/functional/feature_anchors.py
hebasto,2021-03-02 15:55:37,"Anyway, all of the linters must pass.",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r585686937,585686937,test/functional/feature_anchors.py
jaonoctus,2021-03-02 17:20:45,"Tested ACK. I'm pretty sure It's a false-flag.\n- OS: Ubuntu 20.10\n\n### Without `encoding` - passes\n![Screenshot from 2021-03-02 14-07-31](https://user-images.githubusercontent.com/7918067/109687248-d32e4080-7b61-11eb-86d5-0e73cb6de557.png)\n\n### With `encoding` - fail\n![Screenshot from 2021-03-02 14-15-21](https://user-images.githubusercontent.com/7918067/109687265-d6c1c780-7b61-11eb-",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r585758757,585758757,test/functional/feature_anchors.py
MarcoFalke,2021-03-02 18:59:40,could make the path a named variable to avoid repeating the join three times?,https://github.com/bitcoin/bitcoin/pull/21338#discussion_r585828542,585828542,test/functional/feature_anchors.py
brunoerg,2021-03-02 19:26:38,"Yeah, no problem! thanks!",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r585845419,585845419,test/functional/feature_anchors.py
brunoerg,2021-03-02 19:35:12,Done! ,https://github.com/bitcoin/bitcoin/pull/21338#discussion_r585851030,585851030,test/functional/feature_anchors.py
jonatack,2021-03-06 12:40:38,"nit, per PEP8 and `test/functional/README.md`, this import should be before the framework ones (separated by a blank line)",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r588877690,588877690,test/functional/feature_anchors.py
jonatack,2021-03-06 12:41:36,"```suggestion\n            self.log.debug(f""block-relay-only: {i}"")\n```",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r588877760,588877760,test/functional/feature_anchors.py
jonatack,2021-03-06 12:41:52,"```suggestion\n            self.debug.info(f""inbound: {i}"")\n```",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r588877772,588877772,test/functional/feature_anchors.py
jonatack,2021-03-06 12:47:59,"```suggestion\n        # It should contain only the block-relay-only addresses\n```",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r588878404,588878404,test/functional/feature_anchors.py
jonatack,2021-03-06 12:54:02,"https://www.python.org/dev/peps/pep-0008/#imports\n\nImports should be grouped in the following order:\n\n-   Standard library imports.\n-    Related third party imports.\n-    Local application/library specific imports.\n\nYou should put a blank line between each group of imports.",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r588878990,588878990,test/functional/feature_anchors.py
brunoerg,2021-03-06 13:24:05,"Thanks, just fixed! ",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r588881992,588881992,test/functional/feature_anchors.py
brunoerg,2021-03-06 13:35:46,"Just changed it, it's better _debug_ instead of _info_ for this case.",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r588883189,588883189,test/functional/feature_anchors.py
brunoerg,2021-03-06 13:42:08,"Just changed it, but the right format is `self.log.debug` as you suggested above I guess.",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r588883796,588883796,test/functional/feature_anchors.py
aarmoa,2021-03-07 22:29:28,"Hello Bruno. I think we should concatenate regtest sub directory using the os.path.join() function instead of using + ""/regtest"" (just to avoid assuming the test is running in a Unix based OS).\n` node0_anchors_path = os.path.join(\n            self.nodes[0].datadir, ""regtest"", ""anchors.dat""\n)`",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r589098479,589098479,test/functional/feature_anchors.py
jonatack,2021-03-07 23:30:56,"Good point.\n\nIn general, don't hesitate to refer to `test/functional/feature_asmap.py` for an example of a similar kind of test file.\n\n```python\n    self.datadir = os.path.join(self.node.datadir, self.chain)\n    self.default_asmap = os.path.join(self.datadir, DEFAULT_ASMAP_FILENAME)\n    self.asmap_raw = os.path.join(os.path.dirname(os.path.realpath(__file__)), ASMAP)\n```",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r589106093,589106093,test/functional/feature_anchors.py
brunoerg,2021-03-08 00:02:19,"Hello, Abel.. Thanks a lot for the review! Just changed it.",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r589109865,589109865,test/functional/feature_anchors.py
MarcoFalke,2021-03-15 14:45:10,wouldn't it make more sense for this to be an array?,https://github.com/bitcoin/bitcoin/pull/21338#discussion_r594398865,594398865,test/functional/feature_anchors.py
MarcoFalke,2021-03-15 14:46:14,I think this check can be skipped (will be checked by `open` already),https://github.com/bitcoin/bitcoin/pull/21338#discussion_r594399939,594399939,test/functional/feature_anchors.py
brunoerg,2021-03-16 21:32:50,I don't think so. I am concatenating the lines to verify if the addresses are into this. I don't think an array would be useful here.,https://github.com/bitcoin/bitcoin/pull/21338#discussion_r595555591,595555591,test/functional/feature_anchors.py
brunoerg,2021-03-16 21:34:02,"Make sense. \nWhen the file doesn't exit in the node directory the `open` function will return a FileNotFoundError.\nThanks!",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r595556246,595556246,test/functional/feature_anchors.py
brunoerg,2021-03-16 21:56:43,Done!,https://github.com/bitcoin/bitcoin/pull/21338#discussion_r595568560,595568560,test/functional/feature_anchors.py
MarcoFalke,2021-03-17 07:27:00,"Let's assume ip_port is `aa` and anchors is `['fa', 'af']`\n\nWith array:\n\n```\n>>> 'aa' in ['fa', 'af']\nFalse\n```\n\nWith string\n\n```\n>>> 'aa' in 'faaf'\nTrue\n```\n\nAm I missing something?",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r595767873,595767873,test/functional/feature_anchors.py
brunoerg,2021-03-18 00:02:09,"I'm using string for the reason you're showing with your example. I think the question about using array or string is: how is anchors.dat structured?\n\nLet's suppose:\n\nip_port is 7f0000013e01 and the file content is:\nfabfb5da02fc5a030000e1f505000000000000000000000000000000000000ffff7f0000013e01fc5a030000e1f505000000000000000000000000000000000000ffff7f0000013e0075f7d7cf33e71e42f8add50c305f",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r596462558,596462558,test/functional/feature_anchors.py
MarcoFalke,2021-03-18 07:03:11,"anchors.dat is binary data, so why would newlines matter and what is the point of `rstrip`?",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r596597263,596597263,test/functional/feature_anchors.py
brunoerg,2021-03-19 00:34:06,"I can remove `rstrip` I guess, it doesn't affect anything, thanks.\n ",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r597331052,597331052,test/functional/feature_anchors.py
brunoerg,2021-03-19 00:43:14,"So, can I read only the first line?\n I was using `array` but the test `was failing, assuming:\n```\nitem (first line): fabfb5da02fc5a030000e1f505000000000000000000000000000000000000ffff7f0000012b6efc5a030000e1f505000000000000000000000000000000000000ffff7f0000012b6d1c665ef1c1d383c4869170e021306a945bdbfb9f39c12bb2e0\nip_port: 7f0000012b6e\nip_port in item: True\nip_port: 7f0000012b6d\nip_por",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r597333829,597333829,test/functional/feature_anchors.py
MarcoFalke,2021-03-19 06:40:33,"If newlines don't have a meaning, they shouldn't be interpreted. You can just use `read()`?",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r597438655,597438655,test/functional/feature_anchors.py
brunoerg,2021-03-19 23:33:38,"Yes, just pushed the changes. It makes sense. Could you please check?",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r598022059,598022059,test/functional/feature_anchors.py
hebasto,2021-03-22 03:34:13,This code is used once only. What are benefits of the separated function here?,https://github.com/bitcoin/bitcoin/pull/21338#discussion_r598405319,598405319,test/functional/feature_anchors.py
hebasto,2021-03-22 03:35:28,"nit:\n```suggestion\n""""""Test block-relay-only anchors functionality""""""\n```",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r598405613,598405613,test/functional/feature_anchors.py
hebasto,2021-03-22 03:36:48,"nit: here and after s/""node 0""/""node""/ as it is the only node in this test.",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r598405887,598405887,test/functional/feature_anchors.py
hebasto,2021-03-22 03:37:51,"nit: Numbers of connections, i.e., 2 and 5, could be named variables.",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r598406187,598406187,test/functional/feature_anchors.py
hebasto,2021-03-22 03:40:09,"The same assertion seems reasonable to place in the test beginning too, no?",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r598406712,598406712,test/functional/feature_anchors.py
brunoerg,2021-05-27 22:00:01,"Yes, make sense. ",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r640998845,640998845,test/functional/feature_anchors.py
brunoerg,2021-05-27 22:37:57,"Perfect, thanks!",https://github.com/bitcoin/bitcoin/pull/21338#discussion_r641017242,641017242,test/functional/feature_anchors.py
