DrahtBot,2020-02-06 07:56:11,"<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nReviewers, this pull request conflicts with the following ones:\n\n* [#18077](https://drahtbot.github.io/bitcoin_core_issue_redirect/r/18077.html) (net: Add NAT-PMP port forwarding support by",https://github.com/bitcoin/bitcoin/pull/18081#issuecomment-582780813,582780813,
hebasto,2020-02-06 09:32:14,What are the actual benefits of exporting `DOCKER_NAME` variable? Do we _use_ it somehow?,https://github.com/bitcoin/bitcoin/pull/18081#issuecomment-582814607,582814607,
theStack,2020-02-06 12:41:32,"Concept ACK.\n\n\n\n> What are the actual benefits of exporting `DOCKER_NAME` variable? Do we _use_ it somehow?\n\nIt is used as argument for Docker (`--name $DOCKER_NAME`) to give the containers a concrete name instead of generating a random one, see https://github.com/bitcoin/bitcoin/pull/16623#pullrequestreview-275768283.",https://github.com/bitcoin/bitcoin/pull/18081#issuecomment-582888148,582888148,
hebasto,2020-02-06 12:44:30,"> It is used as argument for Docker (`--name $DOCKER_NAME`) to give the containers a concrete name instead of generating a random one, see [#16623 (review)](https://github.com/bitcoin/bitcoin/pull/16623#pullrequestreview-275768283).\n\nI know it ;)\nWhat are container concrete names used for? What is wrong with random ones? (All questions are in context of CI)",https://github.com/bitcoin/bitcoin/pull/18081#issuecomment-582889259,582889259,
theStack,2020-02-06 13:29:22,"> What are container concrete names used for? What is wrong with random ones? (All questions are in context of CI)\n\nFrom my perspective it would be a convenience feature right now: whenever as developer you make non-trivial changes in the CI scripts you very likely need to reproduce the travis build locally (as described in e.g. https://github.com/erdc/proteus/wiki/Replicating-the-TravisCI-Env",https://github.com/bitcoin/bitcoin/pull/18081#issuecomment-582905836,582905836,
hebasto,2020-02-06 13:38:00,"> From my perspective it would be a convenience feature right now: whenever as developer you make non-trivial changes in the CI scripts you very likely need to reproduce the travis build locally (as described in e.g. https://github.com/erdc/proteus/wiki/Replicating-the-TravisCI-Environment-on-your-Local-Machine) to dig deeper and inspect the container in some way (show logs, kill it, restart it, e",https://github.com/bitcoin/bitcoin/pull/18081#issuecomment-582909255,582909255,
MarcoFalke,2020-02-06 13:50:43,"Just a hint that how to run locally is described here: https://github.com/bitcoin/bitcoin/tree/master/ci#running-a-stage-locally\n\nTravis only provides the compute to use, we don't rely on any of its software",https://github.com/bitcoin/bitcoin/pull/18081#issuecomment-582914204,582914204,
theStack,2020-02-06 15:00:12,"> In case a developer keeps travis docker containers locally, it is up to her to patch scripts locally.\n> \n> IMHO, no need for these changes to the repository (if the only use case is local running).\n\nWhile I agree that the changes are not strictly _needed_ right now, I'd always prefer a reproducible behaviour to random behaviour in CI/testing, even if it concerns only something trivial as",https://github.com/bitcoin/bitcoin/pull/18081#issuecomment-582945230,582945230,
MarcoFalke,2020-02-06 17:00:30,"> Quick counter-example: from where would the testing scripts get the variable $TRAVIS_OS_NAME from without Travis (set in .travis.yml)? I highly doubt that the CI setup as it is right now is as decoupled from Travis than most people think (primarily because it is almost never run locally by anyone, only from people making changes).\n\nI do test all linux builds locally on an arm machine continu",https://github.com/bitcoin/bitcoin/pull/18081#issuecomment-583004923,583004923,
fanquake,2020-02-07 00:21:50,"I don't really understand the push back here. This is straightforward, and makes it easier to identify containers when you're running tests locally. I can't see why that's something you should have to ""`patch scripts locally.`"" to do. However if this is so controversial it can just be closed.",https://github.com/bitcoin/bitcoin/pull/18081#issuecomment-583175979,583175979,
hebasto,2020-02-07 07:03:55,"@fanquake \n> However if this is so controversial it can just be closed.\n\nPlease don't close.\n\n> This is straightforward, and makes it easier to identify containers when you're running tests locally.\n\nIt was not clear for me from the OP. Now I'm convinced that these changes are useful.\n\nConcept ACK.\nCould the PR description be more descriptive with adding ""makes it easier to ide",https://github.com/bitcoin/bitcoin/pull/18081#issuecomment-583262006,583262006,
fanquake,2020-02-07 23:18:02,"> Could the PR description be more descriptive\n\nI've updated the PR description.",https://github.com/bitcoin/bitcoin/pull/18081#issuecomment-583657141,583657141,
fanquake,2020-02-10 12:05:31,"> though I'd prefer to use the ci_ prefix for the name\n\nDone, and addressed other comments.",https://github.com/bitcoin/bitcoin/pull/18081#issuecomment-584091382,584091382,
MarcoFalke,2020-02-10 12:47:35,ACK 9e111db088e4137865ae068d206c769994ea0a29,https://github.com/bitcoin/bitcoin/pull/18081#issuecomment-584105880,584105880,
theStack,2020-02-06 12:36:54,"Note that this line is without affect, as the native macOS native build doesn't use Docker (more detailled explanation: the script of this build sets `export RUN_CI_ON_HOST=true` a few lines below, and the install script `04_install.sh` only starts Docker if `RUN_CI_ON_HOST` is _not_ set.)",https://github.com/bitcoin/bitcoin/pull/18081#discussion_r375809496,375809496,ci/test/00_setup_env_mac_host.sh
fanquake,2020-02-06 12:41:15,"Thanks, I've fixed this up.",https://github.com/bitcoin/bitcoin/pull/18081#discussion_r375811174,375811174,ci/test/00_setup_env_mac_host.sh
MarcoFalke,2020-02-09 18:43:07,"```suggestion\nexport DOCKER_NAME=${DOCKER_NAME:-ci_unnamed}\n```\n\nBecause not all unnamed docker containers might be running Ubuntu",https://github.com/bitcoin/bitcoin/pull/18081#discussion_r376805538,376805538,ci/test/00_setup_env.sh
MarcoFalke,2020-02-09 18:43:29,"```suggestion\nexport DOCKER_NAME=ci_arm_linux\n```",https://github.com/bitcoin/bitcoin/pull/18081#discussion_r376805562,376805562,ci/test/00_setup_env_arm.sh
MarcoFalke,2020-02-09 18:44:00,"```suggestion\nexport DOCKER_NAME=ci_i686_centos_7\n```\n\nto avoid name collisions with other local containers named centos_7",https://github.com/bitcoin/bitcoin/pull/18081#discussion_r376805589,376805589,ci/test/00_setup_env_i686_centos.sh
MarcoFalke,2020-02-09 18:45:48,"```suggestion\nexport DOCKER_NAME=ci_macos_cross\n```",https://github.com/bitcoin/bitcoin/pull/18081#discussion_r376805676,376805676,ci/test/00_setup_env_mac.sh
MarcoFalke,2020-02-09 18:46:11,"```suggestion\nexport DOCKER_NAME=ci_native_asan\n```",https://github.com/bitcoin/bitcoin/pull/18081#discussion_r376805718,376805718,ci/test/00_setup_env_native_asan.sh
MarcoFalke,2020-02-09 18:50:19,"Oh, and this line should be moved, because the above comment applies to `DOCKER_NAME_TAG`",https://github.com/bitcoin/bitcoin/pull/18081#discussion_r376806005,376806005,ci/test/00_setup_env_arm.sh
MarcoFalke,2020-02-09 20:34:23,"If you feel extra fancy, you might even rename the variable to `CONTAINER_NAME` to not cause confusion with `DOCKER_NAME_TAG`.",https://github.com/bitcoin/bitcoin/pull/18081#discussion_r376813109,376813109,ci/test/00_setup_env.sh
