[
  {
    "sha": "8103b0bb622a927a07d0bbd2696469eb5969e246",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4MTAzYjBiYjYyMmE5MjdhMDdkMGJiZDI2OTY0NjllYjU5NjllMjQ2",
    "commit": {
      "author": {
        "name": "Philip Kaufmann",
        "email": "phil.kaufmann@t-online.de",
        "date": "2012-05-21T12:13:16Z"
      },
      "committer": {
        "name": "Philip Kaufmann",
        "email": "phil.kaufmann@t-online.de",
        "date": "2012-06-01T09:13:44Z"
      },
      "message": "change verifymessagepage behaviour to match RPC-call \"verifymessage\" (input address, signature and message) / display messages in status label (remove message boxes) / resize window to make signature fully readable / change signature font to BC-address font (like in messagepage) / remove checkAddress() and place code directly in on_verifyMessage_clicked() / add visual feedback to LineEdits / remove AddressTableModel references, as they are now unused / add addr.GetKeyID(keyID) check",
      "tree": {
        "sha": "500729164275e75e40d8972d7f0542356e8f318a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/500729164275e75e40d8972d7f0542356e8f318a"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/8103b0bb622a927a07d0bbd2696469eb5969e246",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8103b0bb622a927a07d0bbd2696469eb5969e246",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/8103b0bb622a927a07d0bbd2696469eb5969e246",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/8103b0bb622a927a07d0bbd2696469eb5969e246/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "98474d3d6f07ff03f25f59f2016baf1f1385fbed",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/98474d3d6f07ff03f25f59f2016baf1f1385fbed",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/98474d3d6f07ff03f25f59f2016baf1f1385fbed"
      }
    ],
    "stats": {
      "total": 185,
      "additions": 105,
      "deletions": 80
    },
    "files": [
      {
        "sha": "546a39f43de9478b9cebe242eb5f1da706ae9ae8",
        "filename": "src/qt/bitcoingui.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8103b0bb622a927a07d0bbd2696469eb5969e246/src/qt/bitcoingui.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8103b0bb622a927a07d0bbd2696469eb5969e246/src/qt/bitcoingui.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoingui.cpp?ref=8103b0bb622a927a07d0bbd2696469eb5969e246",
        "patch": "@@ -849,7 +849,7 @@ void BitcoinGUI::changePassphrase()\n \n void BitcoinGUI::verifyMessage()\n {\n-    VerifyMessageDialog *dlg = new VerifyMessageDialog(walletModel->getAddressTableModel(), this);\n+    VerifyMessageDialog *dlg = new VerifyMessageDialog(this);\n     dlg->setAttribute(Qt::WA_DeleteOnClose);\n     dlg->show();\n }"
      },
      {
        "sha": "afe98b05ab552890b82821d968468a8e616edc5b",
        "filename": "src/qt/forms/verifymessagedialog.ui",
        "status": "modified",
        "additions": 46,
        "deletions": 31,
        "changes": 77,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8103b0bb622a927a07d0bbd2696469eb5969e246/src/qt/forms/verifymessagedialog.ui",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8103b0bb622a927a07d0bbd2696469eb5969e246/src/qt/forms/verifymessagedialog.ui",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/forms/verifymessagedialog.ui?ref=8103b0bb622a927a07d0bbd2696469eb5969e246",
        "patch": "@@ -6,8 +6,8 @@\n    <rect>\n     <x>0</x>\n     <y>0</y>\n-    <width>494</width>\n-    <height>342</height>\n+    <width>650</width>\n+    <height>380</height>\n    </rect>\n   </property>\n   <property name=\"windowTitle\">\n@@ -17,7 +17,7 @@\n    <item>\n     <widget class=\"QLabel\" name=\"label\">\n      <property name=\"text\">\n-      <string>Enter the message and signature below (be careful to correctly copy newlines, spaces, tabs and other invisible characters) to obtain the Bitcoin address used to sign the message.</string>\n+      <string>Enter the signing address, signature and message below (be careful to correctly copy newlines, spaces, tabs and other invisible characters) to verify the message.</string>\n      </property>\n      <property name=\"alignment\">\n       <set>Qt::AlignLeading|Qt::AlignLeft|Qt::AlignTop</set>\n@@ -28,38 +28,28 @@\n     </widget>\n    </item>\n    <item>\n-    <widget class=\"QPlainTextEdit\" name=\"edMessage\"/>\n-   </item>\n-   <item>\n-    <widget class=\"QLineEdit\" name=\"lnSig\">\n+    <widget class=\"QValidatedLineEdit\" name=\"lnAddress\">\n      <property name=\"text\">\n       <string/>\n      </property>\n     </widget>\n    </item>\n    <item>\n-    <widget class=\"QLineEdit\" name=\"lnAddress\">\n+    <widget class=\"QValidatedLineEdit\" name=\"lnSig\">\n      <property name=\"text\">\n       <string/>\n      </property>\n-     <property name=\"readOnly\">\n-      <bool>true</bool>\n-     </property>\n     </widget>\n    </item>\n    <item>\n-    <widget class=\"QLabel\" name=\"lblStatus\">\n-     <property name=\"text\">\n-      <string/>\n-     </property>\n-    </widget>\n+    <widget class=\"QPlainTextEdit\" name=\"edMessage\"/>\n    </item>\n    <item>\n     <layout class=\"QHBoxLayout\" name=\"horizontalLayout\">\n      <item>\n       <widget class=\"QPushButton\" name=\"verifyMessage\">\n        <property name=\"toolTip\">\n-        <string>Verify a message and obtain the Bitcoin address used to sign the message</string>\n+        <string>Verify a message to ensure it was signed with the specified Bitcoin address</string>\n        </property>\n        <property name=\"text\">\n         <string>&amp;Verify Message</string>\n@@ -71,33 +61,51 @@\n       </widget>\n      </item>\n      <item>\n-      <widget class=\"QPushButton\" name=\"copyToClipboard\">\n-       <property name=\"enabled\">\n-        <bool>false</bool>\n-       </property>\n+      <widget class=\"QPushButton\" name=\"clearButton\">\n        <property name=\"toolTip\">\n-        <string>Copy the currently selected address to the system clipboard</string>\n+        <string>Reset all verify message fields</string>\n        </property>\n        <property name=\"text\">\n-        <string>&amp;Copy Address</string>\n+        <string>Clear &amp;All</string>\n        </property>\n        <property name=\"icon\">\n         <iconset resource=\"../bitcoin.qrc\">\n-         <normaloff>:/icons/editcopy</normaloff>:/icons/editcopy</iconset>\n+         <normaloff>:/icons/remove</normaloff>:/icons/remove</iconset>\n        </property>\n       </widget>\n      </item>\n      <item>\n-      <widget class=\"QPushButton\" name=\"clearButton\">\n-       <property name=\"toolTip\">\n-        <string>Reset all verify message fields</string>\n+      <spacer name=\"horizontalSpacer_2\">\n+       <property name=\"orientation\">\n+        <enum>Qt::Horizontal</enum>\n+       </property>\n+       <property name=\"sizeHint\" stdset=\"0\">\n+        <size>\n+         <width>40</width>\n+         <height>20</height>\n+        </size>\n+       </property>\n+      </spacer>\n+     </item>\n+     <item>\n+      <widget class=\"QLabel\" name=\"lblStatus\">\n+       <property name=\"minimumSize\">\n+        <size>\n+         <width>0</width>\n+         <height>48</height>\n+        </size>\n+       </property>\n+       <property name=\"font\">\n+        <font>\n+         <weight>75</weight>\n+         <bold>true</bold>\n+        </font>\n        </property>\n        <property name=\"text\">\n-        <string>Clear &amp;All</string>\n+        <string/>\n        </property>\n-       <property name=\"icon\">\n-        <iconset resource=\"../bitcoin.qrc\">\n-         <normaloff>:/icons/remove</normaloff>:/icons/remove</iconset>\n+       <property name=\"wordWrap\">\n+        <bool>true</bool>\n        </property>\n       </widget>\n      </item>\n@@ -118,6 +126,13 @@\n    </item>\n   </layout>\n  </widget>\n+ <customwidgets>\n+  <customwidget>\n+   <class>QValidatedLineEdit</class>\n+   <extends>QLineEdit</extends>\n+   <header>qvalidatedlineedit.h</header>\n+  </customwidget>\n+ </customwidgets>\n  <resources>\n   <include location=\"../bitcoin.qrc\"/>\n  </resources>"
      },
      {
        "sha": "92f58328a47569bb5cb2e79dacc98ba1035f9573",
        "filename": "src/qt/verifymessagedialog.cpp",
        "status": "modified",
        "additions": 57,
        "deletions": 43,
        "changes": 100,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8103b0bb622a927a07d0bbd2696469eb5969e246/src/qt/verifymessagedialog.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8103b0bb622a927a07d0bbd2696469eb5969e246/src/qt/verifymessagedialog.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/verifymessagedialog.cpp?ref=8103b0bb622a927a07d0bbd2696469eb5969e246",
        "patch": "@@ -4,100 +4,114 @@\n #include <string>\n #include <vector>\n \n-#include <QDialogButtonBox>\n-#include <QAbstractButton>\n-#include <QClipboard>\n-#include <QMessageBox>\n+#include <QDialog>\n+#include <QLabel>\n+#include <QLineEdit>\n+#include <QPlainTextEdit>\n+#include <QPushButton>\n \n #include \"main.h\"\n #include \"wallet.h\"\n #include \"walletmodel.h\"\n-#include \"addresstablemodel.h\"\n #include \"guiutil.h\"\n #include \"base58.h\"\n \n-VerifyMessageDialog::VerifyMessageDialog(AddressTableModel *addressModel, QWidget *parent) :\n+VerifyMessageDialog::VerifyMessageDialog(QWidget *parent) :\n     QDialog(parent),\n-    ui(new Ui::VerifyMessageDialog),\n-    model(addressModel)\n+    ui(new Ui::VerifyMessageDialog)\n {\n     ui->setupUi(this);\n \n #if (QT_VERSION >= 0x040700)\n     /* Do not move this to the XML file, Qt before 4.7 will choke on it */\n+    ui->lnAddress->setPlaceholderText(tr(\"Enter a Bitcoin address (e.g. 1NS17iag9jJgTHD1VXjvLCEnZuQ3rJDE9L)\"));\n     ui->lnSig->setPlaceholderText(tr(\"Enter Bitcoin signature\"));\n-    ui->lnAddress->setPlaceholderText(tr(\"Click \\\"Verify Message\\\" to obtain address\"));\n #endif\n \n     GUIUtil::setupAddressWidget(ui->lnAddress, this);\n     ui->lnAddress->installEventFilter(this);\n \n-    ui->edMessage->setFocus();\n+    ui->lnSig->setFont(GUIUtil::bitcoinAddressFont());\n+\n+    ui->lnAddress->setFocus();\n }\n \n VerifyMessageDialog::~VerifyMessageDialog()\n {\n     delete ui;\n }\n \n-bool VerifyMessageDialog::checkAddress()\n+void VerifyMessageDialog::on_verifyMessage_clicked()\n {\n-    CDataStream ss(SER_GETHASH, 0);\n-    ss << strMessageMagic;\n-    ss << ui->edMessage->document()->toPlainText().toStdString();\n-    uint256 hash = Hash(ss.begin(), ss.end());\n+    CBitcoinAddress addr(ui->lnAddress->text().toStdString());\n+    if (!addr.IsValid())\n+    {\n+        ui->lnAddress->setValid(false);\n+        ui->lblStatus->setStyleSheet(\"QLabel { color: red; }\");\n+        ui->lblStatus->setText(tr(\"\\\"%1\\\" is not a valid address.\").arg(ui->lnAddress->text()) + QString(\" \") + tr(\"Please check the address and try again.\"));\n+        return;\n+    }\n+    CKeyID keyID;\n+    if (!addr.GetKeyID(keyID))\n+    {\n+        ui->lnAddress->setValid(false);\n+        ui->lblStatus->setStyleSheet(\"QLabel { color: red; }\");\n+        ui->lblStatus->setText(tr(\"\\\"%1\\\" does not refer to a key.\").arg(ui->lnAddress->text()) + QString(\" \") + tr(\"Please check the address and try again.\"));\n+        return;\n+    }\n \n-    bool invalid = true;\n-    std::vector<unsigned char> vchSig = DecodeBase64(ui->lnSig->text().toStdString().c_str(), &invalid);\n+    bool fInvalid = false;\n+    std::vector<unsigned char> vchSig = DecodeBase64(ui->lnSig->text().toStdString().c_str(), &fInvalid);\n \n-    if(invalid)\n+    if (fInvalid)\n     {\n-        QMessageBox::warning(this, tr(\"Invalid Signature\"), tr(\"The signature could not be decoded. Please check the signature and try again.\"));\n-        return false;\n+        ui->lnSig->setValid(false);\n+        ui->lblStatus->setStyleSheet(\"QLabel { color: red; }\");\n+        ui->lblStatus->setText(tr(\"The signature could not be decoded.\") + QString(\" \") + tr(\"Please check the signature and try again.\"));\n+        return;\n     }\n \n+    CDataStream ss(SER_GETHASH, 0);\n+    ss << strMessageMagic;\n+    ss << ui->edMessage->document()->toPlainText().toStdString();\n+\n     CKey key;\n-    if(!key.SetCompactSignature(hash, vchSig))\n+    if (!key.SetCompactSignature(Hash(ss.begin(), ss.end()), vchSig))\n     {\n-        QMessageBox::warning(this, tr(\"Invalid Signature\"), tr(\"The signature did not match the message digest. Please check the signature and try again.\"));\n-        return false;\n+        ui->lnSig->setValid(false);\n+        ui->lblStatus->setStyleSheet(\"QLabel { color: red; }\");\n+        ui->lblStatus->setText(tr(\"The signature did not match the message digest.\")+ QString(\" \") + tr(\"Please check the signature and try again.\"));\n+        return;\n     }\n \n-    CBitcoinAddress address(key.GetPubKey().GetID());\n-    QString qStringAddress = QString::fromStdString(address.ToString());\n-    ui->lnAddress->setText(qStringAddress);\n-    ui->copyToClipboard->setEnabled(true);\n-\n-    QString label = model->labelForAddress(qStringAddress);\n-    ui->lblStatus->setText(label.isEmpty() ? tr(\"Address not found in address book.\") : tr(\"Address found in address book: %1\").arg(label));\n-    return true;\n-}\n-\n-void VerifyMessageDialog::on_verifyMessage_clicked()\n-{\n-    checkAddress();\n-}\n+    if (!(CBitcoinAddress(key.GetPubKey().GetID()) == addr))\n+    {\n+        ui->lblStatus->setStyleSheet(\"QLabel { color: red; }\");\n+        ui->lblStatus->setText(QString(\"<nobr>\") + tr(\"Message verification failed.\") + QString(\"</nobr>\"));\n+        return;\n+    }\n \n-void VerifyMessageDialog::on_copyToClipboard_clicked()\n-{\n-    QApplication::clipboard()->setText(ui->lnAddress->text());\n+    ui->lblStatus->setStyleSheet(\"QLabel { color: green; }\");\n+    ui->lblStatus->setText(QString(\"<nobr>\") + tr(\"Message verified.\") + QString(\"</nobr>\"));\n }\n \n void VerifyMessageDialog::on_clearButton_clicked()\n {\n-    ui->edMessage->clear();\n-    ui->lnSig->clear();\n     ui->lnAddress->clear();\n+    ui->lnSig->clear();\n+    ui->edMessage->clear();\n     ui->lblStatus->clear();\n \n     ui->edMessage->setFocus();\n }\n \n bool VerifyMessageDialog::eventFilter(QObject *object, QEvent *event)\n {\n-    if(object == ui->lnAddress && (event->type() == QEvent::MouseButtonPress ||\n+    if (object == ui->lnAddress && (event->type() == QEvent::MouseButtonPress ||\n                                    event->type() == QEvent::FocusIn))\n     {\n+        // set lnAddress to valid, as QEvent::FocusIn would not reach QValidatedLineEdit::focusInEvent\n+        ui->lnAddress->setValid(true);\n         ui->lnAddress->selectAll();\n         return true;\n     }"
      },
      {
        "sha": "0bed442d4ce82df94628f895331f83a1acff0574",
        "filename": "src/qt/verifymessagedialog.h",
        "status": "modified",
        "additions": 1,
        "deletions": 5,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/8103b0bb622a927a07d0bbd2696469eb5969e246/src/qt/verifymessagedialog.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/8103b0bb622a927a07d0bbd2696469eb5969e246/src/qt/verifymessagedialog.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/verifymessagedialog.h?ref=8103b0bb622a927a07d0bbd2696469eb5969e246",
        "patch": "@@ -16,21 +16,17 @@ class VerifyMessageDialog : public QDialog\n     Q_OBJECT\n \n public:\n-    explicit VerifyMessageDialog(AddressTableModel *addressModel, QWidget *parent = 0);\n+    explicit VerifyMessageDialog(QWidget *parent);\n     ~VerifyMessageDialog();\n \n protected:\n     bool eventFilter(QObject *object, QEvent *event);\n \n private:\n-    bool checkAddress();\n-\n     Ui::VerifyMessageDialog *ui;\n-    AddressTableModel *model;\n \n private slots:\n     void on_verifyMessage_clicked();\n-    void on_copyToClipboard_clicked();\n     void on_clearButton_clicked();\n };\n "
      }
    ]
  }
]