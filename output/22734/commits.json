[
  {
    "sha": "fae5c633dc05a045aaac370b383e4799cb0e0590",
    "node_id": "C_kwDOABII59oAKGZhZTVjNjMzZGMwNWEwNDVhYWFjMzcwYjM4M2U0Nzk5Y2IwZTA1OTA",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-08-18T07:07:18Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-09-21T08:07:38Z"
      },
      "message": "move-only: Move CAddrMan::Check to cpp file\n\nThis speeds up compilation of the whole program because the included\nheader file is smaller.\n\nCan be reviewed with --color-moved=dimmed-zebra --color-moved-ws=ignore-all-space",
      "tree": {
        "sha": "f165c299d76113d6742f31f0f1c02dabf88c9b66",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f165c299d76113d6742f31f0f1c02dabf88c9b66"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fae5c633dc05a045aaac370b383e4799cb0e0590",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUgg9gv+MEE0h0F/YQZmvvKycAz+mObgN3lv1WHgiOc7IqHxz7UiO1X50ujbZqC1\nwGKSpiGgL61nA7LD43mnBFoCrESQha5ch2S8BaIf1Z2ihw9YVSA2EpLYnp1jExeV\nx1g2iEpvWrINpunRLLzFECooUrWpNSe65n4GfLx4XFb8Dn5MKkbavi2Y591Bo6/2\nmoZZY23yLWeIgfJESlBa6X+OqWMPWfER+7UMKXYUlIaEDoOoq1kdGBlD+IGC8gTY\nh7aHHbTBqo5hiperKa3qs8PbZrqRlMU0qO8bM0U7bJCXINTURylcohUsGeSQzOrI\n9vji3wf8XbNPeJY0u2aiPz8EF5qbuStxku58XDPAmU7zkYT1l1ollaX9dFNQfbmc\nk/Z27hfI0WMi4UtoAvdteEh43e2Sx90qOSl5Ew/CwWA2WCj0JMZgRff8L/GpRJET\nN+NpmzKlxu2uAbQbyMBO2R9YeBs8pv+ynJbmsC1Garo9wh9/73aimtxk4gZ4KiWm\nkqzbsLcg\n=LeCw\n-----END PGP SIGNATURE-----",
        "payload": "tree f165c299d76113d6742f31f0f1c02dabf88c9b66\nparent 223ad2fd0d355a9caf3c12fe2a286030d7f3190f\nauthor MarcoFalke <falke.marco@gmail.com> 1629270438 +0200\ncommitter MarcoFalke <falke.marco@gmail.com> 1632211658 +0200\n\nmove-only: Move CAddrMan::Check to cpp file\n\nThis speeds up compilation of the whole program because the included\nheader file is smaller.\n\nCan be reviewed with --color-moved=dimmed-zebra --color-moved-ws=ignore-all-space\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fae5c633dc05a045aaac370b383e4799cb0e0590",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fae5c633dc05a045aaac370b383e4799cb0e0590",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fae5c633dc05a045aaac370b383e4799cb0e0590/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "223ad2fd0d355a9caf3c12fe2a286030d7f3190f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/223ad2fd0d355a9caf3c12fe2a286030d7f3190f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/223ad2fd0d355a9caf3c12fe2a286030d7f3190f"
      }
    ],
    "stats": {
      "total": 22,
      "additions": 12,
      "deletions": 10
    },
    "files": [
      {
        "sha": "e3f370134f15bc979988a5f863b86ad2d1b27899",
        "filename": "src/addrman.cpp",
        "status": "modified",
        "additions": 11,
        "deletions": 0,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fae5c633dc05a045aaac370b383e4799cb0e0590/src/addrman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fae5c633dc05a045aaac370b383e4799cb0e0590/src/addrman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.cpp?ref=fae5c633dc05a045aaac370b383e4799cb0e0590",
        "patch": "@@ -743,6 +743,17 @@ CAddrInfo CAddrMan::Select_(bool newOnly) const\n     }\n }\n \n+void CAddrMan::Check() const\n+{\n+    AssertLockHeld(cs);\n+\n+    const int err = Check_();\n+    if (err) {\n+        LogPrintf(\"ADDRMAN CONSISTENCY CHECK FAILED!!! err=%i\\n\", err);\n+        assert(false);\n+    }\n+}\n+\n int CAddrMan::Check_() const\n {\n     AssertLockHeld(cs);"
      },
      {
        "sha": "ca291d60ab325e4216aa1cdaa8f5b4e4bc74e6e5",
        "filename": "src/addrman.h",
        "status": "modified",
        "additions": 1,
        "deletions": 10,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fae5c633dc05a045aaac370b383e4799cb0e0590/src/addrman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fae5c633dc05a045aaac370b383e4799cb0e0590/src/addrman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.h?ref=fae5c633dc05a045aaac370b383e4799cb0e0590",
        "patch": "@@ -392,16 +392,7 @@ class CAddrMan\n     CAddrInfo SelectTriedCollision_() EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n     //! Consistency check\n-    void Check() const EXCLUSIVE_LOCKS_REQUIRED(cs)\n-    {\n-        AssertLockHeld(cs);\n-\n-        const int err = Check_();\n-        if (err) {\n-            LogPrintf(\"ADDRMAN CONSISTENCY CHECK FAILED!!! err=%i\\n\", err);\n-            assert(false);\n-        }\n-    }\n+    void Check() const EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n     //! Perform consistency check. Returns an error code or zero.\n     int Check_() const EXCLUSIVE_LOCKS_REQUIRED(cs);"
      }
    ]
  },
  {
    "sha": "fa298971e6890715e2b0b93f2a7f445d32d6622f",
    "node_id": "C_kwDOABII59oAKGZhMjk4OTcxZTY4OTA3MTVlMmIwYjkzZjJhN2Y0NDVkMzJkNjYyMmY",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-08-18T07:17:06Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-09-21T08:07:48Z"
      },
      "message": "Refactor: Turn the internal addrman check helper into a forced check",
      "tree": {
        "sha": "ff3f0226efbeaead1a766aa5f134b3eaf76a1cb6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/ff3f0226efbeaead1a766aa5f134b3eaf76a1cb6"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa298971e6890715e2b0b93f2a7f445d32d6622f",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUg0Egv+Ly5l0y4F77bRE5dP0kf94lQmYkQ6kQ5xdAqWOYLMgh+0zM+Exe7lLm3x\nD52zXY4Lqx9Cs/x4O+g9XFG4PnBv6R5TE/4T8rOE9+/bqR5mFjMBIx1iI9WlXMBK\nmM+cdmCFS3Y3eobywOOwsgiwu++MdEwrFp6HqEObCCITiPW3cS9TnW44mhh+i55R\ng9TwA4B1u5wgHhDrcIuHH+2WOxGXcdTs7rxBfiCwRKu305w/MewHPKhDUnfR1Upx\nds0UEN1hPdVLs4JdVLecPRvXmxkKWyC7xzZDnmtEoqbYq+JpHNLoS+VOFz+xVi33\n2Q6zdKxjCTHnh0fh79T2Lf4aMWY8zRQdMVX1FztryBR5dHq07juK7DelOJJbRO4b\ny3pr+sFSeVfEnMhi1/1zsyRfq/IVbHMQ4I3Z1Gec5NRi2MnkkFlWgdHaJazVx+pC\n9+huZ+T9PMpfFHU1VknkzdCbB2k2fmsWCvujgfAL9Ft7gLHisMcXH1W6D0QSxyn0\nwHiQzPvB\n=7SQR\n-----END PGP SIGNATURE-----",
        "payload": "tree ff3f0226efbeaead1a766aa5f134b3eaf76a1cb6\nparent fae5c633dc05a045aaac370b383e4799cb0e0590\nauthor MarcoFalke <falke.marco@gmail.com> 1629271026 +0200\ncommitter MarcoFalke <falke.marco@gmail.com> 1632211668 +0200\n\nRefactor: Turn the internal addrman check helper into a forced check\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa298971e6890715e2b0b93f2a7f445d32d6622f",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa298971e6890715e2b0b93f2a7f445d32d6622f",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa298971e6890715e2b0b93f2a7f445d32d6622f/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fae5c633dc05a045aaac370b383e4799cb0e0590",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fae5c633dc05a045aaac370b383e4799cb0e0590",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fae5c633dc05a045aaac370b383e4799cb0e0590"
      }
    ],
    "stats": {
      "total": 19,
      "additions": 10,
      "deletions": 9
    },
    "files": [
      {
        "sha": "a6f38075d81145bc3a7c4248737a74575062ecd0",
        "filename": "src/addrman.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 6,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa298971e6890715e2b0b93f2a7f445d32d6622f/src/addrman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa298971e6890715e2b0b93f2a7f445d32d6622f/src/addrman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.cpp?ref=fa298971e6890715e2b0b93f2a7f445d32d6622f",
        "patch": "@@ -747,21 +747,21 @@ void CAddrMan::Check() const\n {\n     AssertLockHeld(cs);\n \n-    const int err = Check_();\n+    // Run consistency checks 1 in m_consistency_check_ratio times if enabled\n+    if (m_consistency_check_ratio == 0) return;\n+    if (insecure_rand.randrange(m_consistency_check_ratio) >= 1) return;\n+\n+    const int err{ForceCheckAddrman()};\n     if (err) {\n         LogPrintf(\"ADDRMAN CONSISTENCY CHECK FAILED!!! err=%i\\n\", err);\n         assert(false);\n     }\n }\n \n-int CAddrMan::Check_() const\n+int CAddrMan::ForceCheckAddrman() const\n {\n     AssertLockHeld(cs);\n \n-    // Run consistency checks 1 in m_consistency_check_ratio times if enabled\n-    if (m_consistency_check_ratio == 0) return 0;\n-    if (insecure_rand.randrange(m_consistency_check_ratio) >= 1) return 0;\n-\n     LogPrint(BCLog::ADDRMAN, \"Addrman checks started: new %i, tried %i, total %u\\n\", nNew, nTried, vRandom.size());\n \n     std::unordered_set<int> setTried;"
      },
      {
        "sha": "7dd8528bef1dcd6c43883396d4ab9e73456bd3c4",
        "filename": "src/addrman.h",
        "status": "modified",
        "additions": 4,
        "deletions": 3,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa298971e6890715e2b0b93f2a7f445d32d6622f/src/addrman.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa298971e6890715e2b0b93f2a7f445d32d6622f/src/addrman.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.h?ref=fa298971e6890715e2b0b93f2a7f445d32d6622f",
        "patch": "@@ -391,11 +391,12 @@ class CAddrMan\n     //! Return a random to-be-evicted tried table address.\n     CAddrInfo SelectTriedCollision_() EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n-    //! Consistency check\n+    //! Consistency check, taking into account m_consistency_check_ratio. Will std::abort if an inconsistency is detected.\n     void Check() const EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n-    //! Perform consistency check. Returns an error code or zero.\n-    int Check_() const EXCLUSIVE_LOCKS_REQUIRED(cs);\n+    //! Perform consistency check, regardless of m_consistency_check_ratio.\n+    //! @returns an error code or zero.\n+    int ForceCheckAddrman() const EXCLUSIVE_LOCKS_REQUIRED(cs);\n \n     /**\n      * Return all or many randomly selected addresses, optionally by network."
      }
    ]
  },
  {
    "sha": "fa7a883f5a219d5f3c2f992b090db4e6c279db12",
    "node_id": "C_kwDOABII59oAKGZhN2E4ODNmNWEyMTlkNWYzYzJmOTkyYjA5MGRiNGU2YzI3OWRiMTI",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-08-18T07:57:56Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-09-21T08:09:45Z"
      },
      "message": "addrman: Replace assert with throw on corrupt data\n\nAssert should only be used for program internal logic errors, not to\nsanitize external user input.",
      "tree": {
        "sha": "6b6660bc9fb7f0d00c2a13a30ff47204f7927144",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6b6660bc9fb7f0d00c2a13a30ff47204f7927144"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa7a883f5a219d5f3c2f992b090db4e6c279db12",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUi02AwArn7qdNeb5w6XHPcqdJf8pWzxWTqCUjLSS1nRdznbI83QkyZUa50d+6rT\nqSsR3dQSYAiPFEu4kqwTPvIbb1wfxzaJfSBE+DgSdqcRMxw0lAHoTMju8wqgWFVQ\nj1Pq9RdL+d4EXiEKFqalmo7XyfOIOEUCQL4PZ/NP810pxVhpOsJeBYgpYL8Es/ee\nE5BiorvIzy7yiAvTFT//j8guYSasu28BijdDHChq5LRbToubfLgueedJza2DB5/P\nCSx5y4fMBu90aaaoh4yJroU5W4aEEbbb5SXrrW8vWid9jCkQwZkQ7jPq7aE0ro02\nYszkE7r87HouCbz3TTcXQNuPv7jobUA3hmuarClD46sFQMRtjwskYZmdFjWk7r9G\ncEPV/6xosA+0pfGavwwUxQ+cs8rGyGArvz6HS/bwUm9pZvARhPtYXtm77NuZ2eLk\nxHYatf0Jjqxw+0F48NHiNvJVtYE75eR8EBBigZ90qMmqvlQEr9HKameIjkXnwOax\nPfwYkfEd\n=z4mz\n-----END PGP SIGNATURE-----",
        "payload": "tree 6b6660bc9fb7f0d00c2a13a30ff47204f7927144\nparent fa298971e6890715e2b0b93f2a7f445d32d6622f\nauthor MarcoFalke <falke.marco@gmail.com> 1629273476 +0200\ncommitter MarcoFalke <falke.marco@gmail.com> 1632211785 +0200\n\naddrman: Replace assert with throw on corrupt data\n\nAssert should only be used for program internal logic errors, not to\nsanitize external user input.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa7a883f5a219d5f3c2f992b090db4e6c279db12",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa7a883f5a219d5f3c2f992b090db4e6c279db12",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa7a883f5a219d5f3c2f992b090db4e6c279db12/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fa298971e6890715e2b0b93f2a7f445d32d6622f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa298971e6890715e2b0b93f2a7f445d32d6622f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fa298971e6890715e2b0b93f2a7f445d32d6622f"
      }
    ],
    "stats": {
      "total": 18,
      "additions": 16,
      "deletions": 2
    },
    "files": [
      {
        "sha": "7c6b8fe64db5ed73a0d0ba7eaf42da9864601cd5",
        "filename": "src/addrman.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 1,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa7a883f5a219d5f3c2f992b090db4e6c279db12/src/addrman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa7a883f5a219d5f3c2f992b090db4e6c279db12/src/addrman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/addrman.cpp?ref=fa7a883f5a219d5f3c2f992b090db4e6c279db12",
        "patch": "@@ -386,7 +386,12 @@ void CAddrMan::Unserialize(Stream& s_)\n         LogPrint(BCLog::ADDRMAN, \"addrman lost %i new and %i tried addresses due to collisions or invalid addresses\\n\", nLostUnk, nLost);\n     }\n \n-    Check();\n+    const int check_code{ForceCheckAddrman()};\n+    if (check_code != 0) {\n+        throw std::ios_base::failure(strprintf(\n+            \"Corrupt data. Consistency check failed with code %s\",\n+            check_code));\n+    }\n }\n \n // explicit instantiation"
      },
      {
        "sha": "55d3e48c64f21c388e177e6487764bc2061aef2b",
        "filename": "test/functional/feature_addrman.py",
        "status": "modified",
        "additions": 10,
        "deletions": 1,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa7a883f5a219d5f3c2f992b090db4e6c279db12/test/functional/feature_addrman.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa7a883f5a219d5f3c2f992b090db4e6c279db12/test/functional/feature_addrman.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_addrman.py?ref=fa7a883f5a219d5f3c2f992b090db4e6c279db12",
        "patch": "@@ -19,6 +19,7 @@ def serialize_addrman(\n     format=1,\n     lowest_compatible=3,\n     net_magic=\"regtest\",\n+    bucket_key=1,\n     len_new=None,\n     len_tried=None,\n     mock_checksum=None,\n@@ -29,7 +30,7 @@ def serialize_addrman(\n     r = MAGIC_BYTES[net_magic]\n     r += struct.pack(\"B\", format)\n     r += struct.pack(\"B\", INCOMPATIBILITY_BASE + lowest_compatible)\n-    r += ser_uint256(1)\n+    r += ser_uint256(bucket_key)\n     r += struct.pack(\"i\", len_new or len(new))\n     r += struct.pack(\"i\", len_tried or len(tried))\n     ADDRMAN_NEW_BUCKET_COUNT = 1 << 10\n@@ -119,6 +120,14 @@ def run_test(self):\n             match=ErrorMatch.FULL_REGEX,\n         )\n \n+        self.log.info(\"Check that corrupt addrman cannot be read (failed check)\")\n+        self.stop_node(0)\n+        write_addrman(peers_dat, bucket_key=0)\n+        self.nodes[0].assert_start_raises_init_error(\n+            expected_msg=init_error(\"Corrupt data. Consistency check failed with code -16: .*\"),\n+            match=ErrorMatch.FULL_REGEX,\n+        )\n+\n         self.log.info(\"Check that missing addrman is recreated\")\n         self.stop_node(0)\n         os.remove(peers_dat)"
      }
    ]
  },
  {
    "sha": "fa3669f72f69662049b55ad1a482b4a0f9f7ae40",
    "node_id": "C_kwDOABII59oAKGZhMzY2OWY3MmY2OTY2MjA0OWI1NWFkMWE0ODJiNGEwZjlmN2FlNDA",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-09-10T14:37:03Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2021-09-21T08:09:56Z"
      },
      "message": "fuzz: Move all addrman fuzz targets to one file\n\nCan be reviewed with --color-moved=dimmed-zebra",
      "tree": {
        "sha": "d27bb746d07e98ee1afd165323c10a4e898695ac",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/d27bb746d07e98ee1afd165323c10a4e898695ac"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa3669f72f69662049b55ad1a482b4a0f9f7ae40",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGzBAABCgAdFiEE+rVPoUahrI9sLGYTzit1aX5ppUgFAlwqrYAACgkQzit1aX5p\npUjfugv7BIa7z9jJ+Qefoc5PVyKIcUzu3OjyGSjcaspYWwHGJOJME1lJERouo+Oa\n506IiyO8Pn5A5mdoZu01bSrUZ/E/HLwHTKRmUXVWpGKXb2zumwS0Knq+0k1txd8p\n2BdB4V5EOieppUO5CWZm6lJIajLCISm8s1XWKXJNeeFTvYYnoV8DxM9/5r2MzPMd\n/JUxpzsvYYYt7DCd7qr4BXo6aUqhz/vkLCLh8sjKC8ZAZ7BtTUiOrY7HGZFWx+ts\n7bZSchKL7GzywUT5To+L47oSD07vkkjEoL1JIATBa+q2dSgCgvJqVUVTMwQCnBTi\n6vWFeA1lWZ3N4qPq82CDOYfkB9Yp09PWzm4SALaMGf3Ve0cSl35lTRTLNUL5ArW9\noQKROBv8sqoN+HtHFGRkhUiWuLvUlWty/4VrtU2KFuFlTbUd7MuDPYf53RKiVoF0\nsnZDo9M+PrZAgulEVGDfPTygHaJEtO5S0Lx4vXPBJQXj7Y2akXSypJaRkAcB7TJD\nHBnd7KrW\n=X+ts\n-----END PGP SIGNATURE-----",
        "payload": "tree d27bb746d07e98ee1afd165323c10a4e898695ac\nparent fa7a883f5a219d5f3c2f992b090db4e6c279db12\nauthor MarcoFalke <falke.marco@gmail.com> 1631284623 +0200\ncommitter MarcoFalke <falke.marco@gmail.com> 1632211796 +0200\n\nfuzz: Move all addrman fuzz targets to one file\n\nCan be reviewed with --color-moved=dimmed-zebra\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa3669f72f69662049b55ad1a482b4a0f9f7ae40",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa3669f72f69662049b55ad1a482b4a0f9f7ae40",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa3669f72f69662049b55ad1a482b4a0f9f7ae40/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fa7a883f5a219d5f3c2f992b090db4e6c279db12",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa7a883f5a219d5f3c2f992b090db4e6c279db12",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fa7a883f5a219d5f3c2f992b090db4e6c279db12"
      }
    ],
    "stats": {
      "total": 42,
      "additions": 11,
      "deletions": 31
    },
    "files": [
      {
        "sha": "be63214c238ead64ab07f503ef64ee8b79bad19f",
        "filename": "src/Makefile.test.include",
        "status": "modified",
        "additions": 0,
        "deletions": 1,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa3669f72f69662049b55ad1a482b4a0f9f7ae40/src/Makefile.test.include",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa3669f72f69662049b55ad1a482b4a0f9f7ae40/src/Makefile.test.include",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/Makefile.test.include?ref=fa3669f72f69662049b55ad1a482b4a0f9f7ae40",
        "patch": "@@ -232,7 +232,6 @@ test_fuzz_fuzz_SOURCES = \\\n  test/fuzz/crypto_hkdf_hmac_sha256_l32.cpp \\\n  test/fuzz/crypto_poly1305.cpp \\\n  test/fuzz/cuckoocache.cpp \\\n- test/fuzz/data_stream.cpp \\\n  test/fuzz/decode_tx.cpp \\\n  test/fuzz/descriptor_parse.cpp \\\n  test/fuzz/deserialize.cpp \\"
      },
      {
        "sha": "45ee778b871dd66e68421ae884593194ef3a6c86",
        "filename": "src/test/fuzz/addrman.cpp",
        "status": "modified",
        "additions": 11,
        "deletions": 0,
        "changes": 11,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa3669f72f69662049b55ad1a482b4a0f9f7ae40/src/test/fuzz/addrman.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa3669f72f69662049b55ad1a482b4a0f9f7ae40/src/test/fuzz/addrman.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/addrman.cpp?ref=fa3669f72f69662049b55ad1a482b4a0f9f7ae40",
        "patch": "@@ -23,6 +23,17 @@ void initialize_addrman()\n     SelectParams(CBaseChainParams::REGTEST);\n }\n \n+FUZZ_TARGET_INIT(data_stream_addr_man, initialize_addrman)\n+{\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+    CDataStream data_stream = ConsumeDataStream(fuzzed_data_provider);\n+    CAddrMan addr_man(/* asmap */ std::vector<bool>(), /* deterministic */ false, /* consistency_check_ratio */ 0);\n+    try {\n+        ReadFromStream(addr_man, data_stream);\n+    } catch (const std::exception&) {\n+    }\n+}\n+\n class CAddrManDeterministic : public CAddrMan\n {\n public:"
      },
      {
        "sha": "323090e04103533e3cee2542ec5102dfa3b24a72",
        "filename": "src/test/fuzz/data_stream.cpp",
        "status": "removed",
        "additions": 0,
        "deletions": 30,
        "changes": 30,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa7a883f5a219d5f3c2f992b090db4e6c279db12/src/test/fuzz/data_stream.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa7a883f5a219d5f3c2f992b090db4e6c279db12/src/test/fuzz/data_stream.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/data_stream.cpp?ref=fa7a883f5a219d5f3c2f992b090db4e6c279db12",
        "patch": "@@ -1,30 +0,0 @@\n-// Copyright (c) 2020-2021 The Bitcoin Core developers\n-// Distributed under the MIT software license, see the accompanying\n-// file COPYING or http://www.opensource.org/licenses/mit-license.php.\n-\n-#include <addrdb.h>\n-#include <addrman.h>\n-#include <net.h>\n-#include <test/fuzz/FuzzedDataProvider.h>\n-#include <test/fuzz/fuzz.h>\n-#include <test/fuzz/util.h>\n-#include <test/util/setup_common.h>\n-\n-#include <cstdint>\n-#include <vector>\n-\n-void initialize_data_stream_addr_man()\n-{\n-    static const auto testing_setup = MakeNoLogFileContext<>();\n-}\n-\n-FUZZ_TARGET_INIT(data_stream_addr_man, initialize_data_stream_addr_man)\n-{\n-    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n-    CDataStream data_stream = ConsumeDataStream(fuzzed_data_provider);\n-    CAddrMan addr_man(/* asmap */ std::vector<bool>(), /* deterministic */ false, /* consistency_check_ratio */ 0);\n-    try {\n-        ReadFromStream(addr_man, data_stream);\n-    } catch (const std::exception&) {\n-    }\n-}"
      }
    ]
  }
]