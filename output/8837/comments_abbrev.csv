fivepiece,2016-09-29T17:56:35Z,"`adding my comment here instead of on the files changed tab`\n\nIs this 01000000000100000000000000000000000000 supposed to be parsed as a zero input, one output to `0x00` transaction?\n\n```\n01000000\n00\n01\n  0000000000000000\n  00\n00000000\n```\n\nWouldn't `010000000001000000000000` (which currently fails) be more suitable?\n\n```\n01000000\n00\n01\n00\n00\n00000000\n```\n\nFollowing `0100000",https://github.com/bitcoin/bitcoin/pull/8837#issuecomment-250542708,250542708,
jnewbery,2016-09-29T19:36:39Z,"@fivepiece , I believe your second transaction is invalid. Commented transactions:\n\n`01000000000100000000000000000000000000` is a valid partial transaction with 0 inputs and 1 output:\n\n```\n01000000 // version (4 bytes)\n00 // number of inputs (varint - 1 byte if value is 0)\n01 // number of outputs (varint - 1 byte if value is 1)\n  0000000000000000 // output 1 amount (8 bytes)\n  00 // outpu",https://github.com/bitcoin/bitcoin/pull/8837#issuecomment-250568871,250568871,
fivepiece,2016-09-29T19:52:16Z,"@jnewbery I guess I should clarify my question then.  I was wondering why `01000000000100000000000000000000000000` was given as a test case at all, as it seems very specific.\n\nMy understanding was that you were out to implement a ""blank"" segwit transaction in that test, and I think `010000000001000000000000` is a better representation, because it's very similar to the non-segwit bank tx `0100000",https://github.com/bitcoin/bitcoin/pull/8837#issuecomment-250572634,250572634,
fivepiece,2016-09-29T21:18:16Z,"Anyway thinking about this some more, feel free to disregard my suggestion.  It's too ambiguous.  Maybe the correct way is to fall back to parsing a non segwit transaction, as no inputs mean no witnesses too.\n",https://github.com/bitcoin/bitcoin/pull/8837#issuecomment-250594332,250594332,
jnewbery,2016-09-29T21:41:08Z,"Correct. If none of the inputs have witnesses or if the witnesses are all empty, then there shouldn't be a witness structure attached to the transaction\n\nFrom `transaction.h`:\n\n```\n            /* It's illegal to encode a witness when all vtxinwit entries are empty. */\n            throw std::ios_base::failure(""Superfluous witness record"");\n```\n\nIn this case there are no transaction inputs,",https://github.com/bitcoin/bitcoin/pull/8837#issuecomment-250599502,250599502,
fivepiece,2016-09-29T22:03:11Z,"Right re. `transaction.h`, also I've asked a related question about this in -dev yesterday.  Initially I read that comment as a reference to actual witness data (sigs, scripts), but I see the point of not needing segwit markers at all for no input transactions.\n\nThanks for clearing it up.\n",https://github.com/bitcoin/bitcoin/pull/8837#issuecomment-250604127,250604127,
jnewbery,2016-10-24T09:45:23Z,@laanwj - this very small change allows bitcoin-tx to parse partial transactions and includes a test case to cover the new functionality. Are you happy to merge this?\n,https://github.com/bitcoin/bitcoin/pull/8837#issuecomment-255695433,255695433,
laanwj,2016-10-24T10:38:23Z,"I don't like ""try to parse the transaction as pre-segwit transaction"" much - This implies ambiguity, can the ambiguity cause problems here?\n\nIf so I'd prefer if this was an explicit flag somewhere.\n",https://github.com/bitcoin/bitcoin/pull/8837#issuecomment-255706374,255706374,
fivepiece,2016-10-24T10:51:36Z,"I'll paste this here as well, commented in #-core-dev\n\nso specifically re. parsing partial transactions as pre-segwit (#8837), I actually hit this issue in my own toy parser and it shows in core too: http://paste.debian.net/plainh/8c80d8cd  so having some flag would be great\n- I should add that with this PR the transaction from the pastebin is parsed as a zero input pay to multisig on **both** ",https://github.com/bitcoin/bitcoin/pull/8837#issuecomment-255708754,255708754,
sipa,2016-10-24T18:32:02Z,"The issue is that segwit only guarantees unambiguous encoding for valid complete transactions. In places where raw transactions are expected that consume inputs that are not necessarily complete, ambiguity is possible. This is the case for the decoderawtransaction and fundrawtransaction RPCs, and for bitcoin-tx. Since inputs to those are usually in fact not signed, they should usually not have any",https://github.com/bitcoin/bitcoin/pull/8837#issuecomment-255825752,255825752,
laanwj,2016-10-25T08:33:32Z,"> I do agree it's undesirable to have ambiguity in the first place, but I think a longer term solution will include a separate encoding for incomplete transactions.\n\nNot only a separate encoding, but it needs to be distinguishable non-ambiguously from completed transactions.\n",https://github.com/bitcoin/bitcoin/pull/8837#issuecomment-255971986,255971986,
fivepiece,2016-10-25T19:13:48Z,"Right ^, the difficulty is a 0 inputs, unfunded transaction looks a lot like segwit at first, then you might fail after it stops making sense, or like in the case I linked, maybe never fail.. unless there was a context to what this transaction was passed in for.  (just my personal experience parsing partial transactions)\n",https://github.com/bitcoin/bitcoin/pull/8837#issuecomment-256146412,256146412,
jnewbery,2016-11-04T09:00:30Z,"The conversation in this PR seems to have wandered a bit into the desirability of having a separate encoding for partial transactions. I agree that's a good idea, but it seems out of scope for this PR.\n\nTo clarify what this PR achieves:\n- pre V0.13.1, both `bitcoin-tx` and `bitcoin-cli decoderawtransaction` were able to parse partial transactions\n- V0.13.1 introduced ambiguity in encoding for ",https://github.com/bitcoin/bitcoin/pull/8837#issuecomment-258375839,258375839,
laanwj,2016-11-07T12:11:04Z,"Yes, fair enough, it's an improvement.\nutACK https://github.com/bitcoin/bitcoin/pull/8837/commits/7451cf59cd7b3a917fe7e4c7210d43b2f5adaad3\n",https://github.com/bitcoin/bitcoin/pull/8837#issuecomment-258820140,258820140,
