theuni,2017-04-19T17:07:12Z,Nice find. Though I can't think of a good reason why we'd ever want a stale list coming out of GetBanned(). Why not just sweep there?,https://github.com/bitcoin/bitcoin/pull/10234#issuecomment-295348002,295348002,
jonasschnelli,2017-04-19T17:12:57Z,"utACK ea2c925c99969d06320495afbf1188f54e25e015\nCalling sweep from within `GetBanned()` looks simpler in the first place but would break the assumption that `GetBanned()` can never change the `setBannedIsDirty` to `true`.\nNo strong opinion though.",https://github.com/bitcoin/bitcoin/pull/10234#issuecomment-295350315,295350315,
jnewbery,2017-04-19T17:25:24Z,"> Calling sweep from within GetBanned() looks simpler in the first place but would break the assumption that GetBanned() can never change the setBannedIsDirty to true.\n\nRight. `CConnman::DumpBanlist()` sets `SetBannedSetDirty` and then calls `GetBanned()` (I believe making the assumption that `GetBanned()` wouldn't change `SetBannedSetDirty`). I didn't know whether it was safe to change that.",https://github.com/bitcoin/bitcoin/pull/10234#issuecomment-295354958,295354958,
MarcoFalke,2017-04-23T15:22:42Z,Needs rebase,https://github.com/bitcoin/bitcoin/pull/10234#issuecomment-296450687,296450687,
laanwj,2017-04-25T13:49:50Z,"Discussion on IRC: the `disconnect_ban.py` test is slow until this is merged, due to  https://github.com/bitcoin/bitcoin/blob/master/test/functional/disconnect_ban.py#L67",https://github.com/bitcoin/bitcoin/pull/10234#issuecomment-297036031,297036031,
jnewbery,2017-04-25T14:12:07Z,rebased with fix to disconnect_ban.py test suite.,https://github.com/bitcoin/bitcoin/pull/10234#issuecomment-297042925,297042925,
theuni,2017-04-25T14:48:36Z,"@jnewbery Yea, I'd prefer to see this moved to GetBanned(). Otherwise correct usage just isn't obvious enough (as evidenced by this bug).\n\nIdeally the sweep would be a static function operating on a banlist_t rather than this, but I don't think it's worth worrying about.\n\nLooks like the only other change needed would be:\n```c++\n@@ -496,10 +499,9 @@ void CConnman::DumpBanlist()\n \n  ",https://github.com/bitcoin/bitcoin/pull/10234#issuecomment-297054613,297054613,
jnewbery,2017-04-28T15:25:33Z,thanks @theuni - that's definitely cleaner. I've changed this PR to use your fix.,https://github.com/bitcoin/bitcoin/pull/10234#issuecomment-298028602,298028602,
laanwj,2017-05-01T10:28:48Z,"It fails locally here (every time, not just intermittently):\n```\ndisconnect_ban.py failed, Duration: 26 s\n\nstdout:\n2017-05-01 08:21:38.048000 TestFramework (INFO): Initializing test directory /tmp/testh_zvdgd7/435\n2017-05-01 08:21:39.087000 TestFramework (INFO): Test setban and listbanned RPCs\n2017-05-01 08:21:39.087000 TestFramework (INFO): setban: successfully ban single IP address",https://github.com/bitcoin/bitcoin/pull/10234#issuecomment-298316271,298316271,
jnewbery,2017-05-01T17:48:41Z,"@laanwj that's very strange. The test passes for me consistently, and also passes on travis. Can you try rebuilding and clearing the functional test cache. If it's still failing, can you send me the test logs?",https://github.com/bitcoin/bitcoin/pull/10234#issuecomment-298385556,298385556,
laanwj,2017-05-02T16:35:58Z,Seems to work now. Strange.,https://github.com/bitcoin/bitcoin/pull/10234#issuecomment-298689531,298689531,
