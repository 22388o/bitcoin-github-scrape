[
  {
    "sha": "ceeb317cded22cc1c5270155c3afda8bf74db3f4",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpjZWViMzE3Y2RlZDIyY2MxYzUyNzAxNTVjM2FmZGE4YmY3NGRiM2Y0",
    "commit": {
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-08-02T16:54:06Z"
      },
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-09-16T06:41:28Z"
      },
      "message": "net: don't extra bind for Tor if binds are restricted\n\nIf only `-bind=addr:port` is given (without `-bind=...=onion`) then we\nwould bind to `addr:port` _and_ to `127.0.0.1:8334` in addition which\nmay be unexpected, assuming the semantic of `-bind=addr:port` is\n\"bind _only_ to `addr:port`\".\n\nChange the above to not do the additional bind: if only\n`-bind=addr:port` is given (without `-bind=...=onion`) then bind to\n`addr:port` (only). If we are creating a Tor hidden service then use\n`addr:port` as target (same behavior as before\nhttps://github.com/bitcoin/bitcoin/pull/19991).\n\nThis allows disabling binding on the onion port.\n\nFixes https://github.com/bitcoin/bitcoin/issues/22726",
      "tree": {
        "sha": "af76052c8c96f890a9f54e5379dfbd66e5ab29f2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/af76052c8c96f890a9f54e5379dfbd66e5ab29f2"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/ceeb317cded22cc1c5270155c3afda8bf74db3f4",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmFC5xgACgkQVN8G9ktV\ny78mqR/9GR4asLChnvshHZlQrCiqrdeqWGFvfrpMJmL5Rjw4X3kLiAgiyL+PTytI\nB837ZLgfdClHewhf47g9rAFG4f6g7H9cJ0C3fxQreWM2+ikXttCjxsKsKj4d3WCf\nGgsVq4l4K3JVJbjlNAL0iuSUxBHO++PVnlEer4ZQSt31B3JROW8U+4Jd/NAi0W5H\nAFl+uleWVyNRP5b3mg4u91e+MmAwCnhfUwAiTScE4LIPliCCGs1IHNCJQTOuS82C\n3+ICaW3JgviW6p82ZBXoprDCl0X7K5sU0nImtq9BjXKQacKjXTWHcyKywFCmm0hR\nNsjpf0mPqkkZyYIMSqsgGpKSR3F20K+096Btt5/HILIB3mOX4ChbI7WHysn/mYu+\n8FjXAXhjmkGG638Upgdaj8a0RP22IwsvqdTbn6TZpUIA0uNp5DysNpKpeuoH9Iyw\nsctzSe60eLM3s17s65mQcp1QmCx2VtKo+YBvmB0rXgVzDafy4jt67KOiE6iB7TXE\n5becLtT4GW8BMvPL2NnBm6NdcLjhO08lrnmgify7AoYz/1DZhT5dzw/PePb2L4jN\nkvU2V9eoefvH7MIpUd224bq7ZAk2RRSiYvPBkUsjaca92IErH9Qey/VzKIV/o1aM\nrg1xUrBPxz72kOMzGb8E2t8OWvuSnwyipE96yOuy04aawXFQRN3QYaI7istQb1m3\nAYy0YhmZ/ELqHGGUU2gMY4XiKDU/CNgLwxv3yFbgWKP0gX76dcSwWEGedSyxCj+n\nJDBCSlZmOZot5Kbs5qBQ9D56hbsxz6QEDQysNzmTQUCQ9O3dcDTXUzHxtupFz4j+\nanqjiQA0l/yWOZKjL+WU0rAyJg1ni5rcJOJZSHkAe40wn+rR2MIJJsjM7q4ox9+c\nmg9RbvRz1Ut/wB9fnYfdWodaI1QxixsptCqZ31Prjn6GjBCvjWMwpBC5+vZh1Yax\n8sCaF60/cJ48NP8EXZSbCA3KPl2ZgZjCqd5lHOzW0mfuAPQZgQoIXqzZuX8wRYxJ\nNv5YHQzAtV+Upj7YH50offSPxtK5c9R6+Yx0Zk6eIW7ILyEC29fYETGdGWVY0038\nZxdmkPoDFinQpS/1G1W3RW9N0GEWJuk/U4d/rxMFz0MCse4adH6+mb/FdaZoDy9I\nIsAYf94HZ0XFQgnLhE9Nn7kT4LpyIq3mBvV/GXqFlEYfKBomNmnPiKgkzztdSWp1\nLWIKR73pOtEYRhZIPeXkPsz4d3ui5uOwmsQeY1OVznX1mZGQSBUXhMkBfAta8/wy\naSqEVMvNtW9qTT/2DEgL5eKISGNPMLXNn5i6wF2RrrGjCJStHN0E+YyyQP2Kafox\nt9zzPlBQB1BmFNw4scr5l3d9dsOYJQ==\n=lxjC\n-----END PGP SIGNATURE-----",
        "payload": "tree af76052c8c96f890a9f54e5379dfbd66e5ab29f2\nparent 9424e78f34da991de488c2f7c2409a4196f2819a\nauthor Vasil Dimov <vd@FreeBSD.org> 1627923246 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1631774488 +0200\n\nnet: don't extra bind for Tor if binds are restricted\n\nIf only `-bind=addr:port` is given (without `-bind=...=onion`) then we\nwould bind to `addr:port` _and_ to `127.0.0.1:8334` in addition which\nmay be unexpected, assuming the semantic of `-bind=addr:port` is\n\"bind _only_ to `addr:port`\".\n\nChange the above to not do the additional bind: if only\n`-bind=addr:port` is given (without `-bind=...=onion`) then bind to\n`addr:port` (only). If we are creating a Tor hidden service then use\n`addr:port` as target (same behavior as before\nhttps://github.com/bitcoin/bitcoin/pull/19991).\n\nThis allows disabling binding on the onion port.\n\nFixes https://github.com/bitcoin/bitcoin/issues/22726\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ceeb317cded22cc1c5270155c3afda8bf74db3f4",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/ceeb317cded22cc1c5270155c3afda8bf74db3f4",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ceeb317cded22cc1c5270155c3afda8bf74db3f4/comments",
    "author": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "9424e78f34da991de488c2f7c2409a4196f2819a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9424e78f34da991de488c2f7c2409a4196f2819a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9424e78f34da991de488c2f7c2409a4196f2819a"
      }
    ],
    "stats": {
      "total": 34,
      "additions": 27,
      "deletions": 7
    },
    "files": [
      {
        "sha": "443d137618189636f9e0ca3342a65975d62a3238",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ceeb317cded22cc1c5270155c3afda8bf74db3f4/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ceeb317cded22cc1c5270155c3afda8bf74db3f4/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=ceeb317cded22cc1c5270155c3afda8bf74db3f4",
        "patch": "@@ -1747,6 +1747,8 @@ bool AppInitMain(NodeContext& node, interfaces::BlockAndHeaderTipInfo* tip_info)\n     CService onion_service_target;\n     if (!connOptions.onion_binds.empty()) {\n         onion_service_target = connOptions.onion_binds.front();\n+    } else if (!connOptions.vBinds.empty()) {\n+        onion_service_target = connOptions.vBinds.front();\n     } else {\n         onion_service_target = DefaultOnionServiceTarget();\n         connOptions.onion_binds.push_back(onion_service_target);"
      },
      {
        "sha": "ca8717ad66fc8b4d2f44295b20ef5f6f9d0296a5",
        "filename": "test/functional/feature_bind_extra.py",
        "status": "modified",
        "additions": 25,
        "deletions": 7,
        "changes": 32,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/ceeb317cded22cc1c5270155c3afda8bf74db3f4/test/functional/feature_bind_extra.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/ceeb317cded22cc1c5270155c3afda8bf74db3f4/test/functional/feature_bind_extra.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_bind_extra.py?ref=ceeb317cded22cc1c5270155c3afda8bf74db3f4",
        "patch": "@@ -21,16 +21,20 @@\n     PORT_MIN,\n     PORT_RANGE,\n     assert_equal,\n+    p2p_port,\n     rpc_port,\n )\n \n+# From chainparamsbase.cpp:CreateBaseChainParams().\n+REGTEST_TOR_TARGET_PORT = 18445\n+\n class BindExtraTest(BitcoinTestFramework):\n     def set_test_params(self):\n         self.setup_clean_chain = True\n         # Avoid any -bind= on the command line. Force the framework to avoid\n         # adding -bind=127.0.0.1.\n         self.bind_to_localhost_only = False\n-        self.num_nodes = 2\n+        self.num_nodes = 4\n \n     def setup_network(self):\n         # Override setup_network() because we want to put the result of\n@@ -43,6 +47,7 @@ def setup_network(self):\n         if not sys.platform.startswith('linux'):\n             raise SkipTest(\"This test can only be run on Linux.\")\n \n+        any_ipv4 = addr_to_hex('0.0.0.0')\n         loopback_ipv4 = addr_to_hex(\"127.0.0.1\")\n \n         # Start custom ports after p2p and rpc ports.\n@@ -69,14 +74,29 @@ def setup_network(self):\n         )\n         port += 2\n \n+        # Node2, no -bind, expected to bind on any + tor target.\n+        self.expected.append(\n+            [\n+                [\"-listen=1\"],\n+                [(any_ipv4, p2p_port(2)), (loopback_ipv4, REGTEST_TOR_TARGET_PORT)]\n+            ]\n+        )\n+\n+        # Node3, no -bind=...=onion, thus no extra port for Tor target.\n+        self.expected.append(\n+            [\n+                ['-bind=127.0.0.1:{}'.format(port)],\n+                [(loopback_ipv4, port)]\n+            ],\n+        )\n+        port += 1\n+\n         self.extra_args = list(map(lambda e: e[0], self.expected))\n-        self.add_nodes(self.num_nodes, self.extra_args)\n-        # Don't start the nodes, as some of them would collide trying to bind on the same port.\n+        self.setup_nodes()\n \n     def run_test(self):\n         for i in range(len(self.expected)):\n-            self.log.info(f\"Starting node {i} with {self.expected[i][0]}\")\n-            self.start_node(i)\n+            self.log.info(f\"Checking listening ports of node {i} with {self.expected[i][0]}\")\n             pid = self.nodes[i].process.pid\n             binds = set(get_bind_addrs(pid))\n             # Remove IPv6 addresses because on some CI environments \"::1\" is not configured\n@@ -88,8 +108,6 @@ def run_test(self):\n             # Remove RPC ports. They are not relevant for this test.\n             binds = set(filter(lambda e: e[1] != rpc_port(i), binds))\n             assert_equal(binds, set(self.expected[i][1]))\n-            self.stop_node(i)\n-            self.log.info(f\"Stopped node {i}\")\n \n if __name__ == '__main__':\n     BindExtraTest().main()"
      }
    ]
  },
  {
    "sha": "56a082d6645eaa410070df958c8d789e00ea562a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1NmEwODJkNjY0NWVhYTQxMDA3MGRmOTU4YzhkNzg5ZTAwZWE1NjJh",
    "commit": {
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-08-02T17:05:35Z"
      },
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-09-16T06:41:32Z"
      },
      "message": "net: report an error if unable to bind on the Tor listening addr:port",
      "tree": {
        "sha": "eca38c9616663fecca57bbafb2186ca1a07c51f9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/eca38c9616663fecca57bbafb2186ca1a07c51f9"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/56a082d6645eaa410070df958c8d789e00ea562a",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmFC5xwACgkQVN8G9ktV\ny7+p/B/9GFRhZjz8XfKe78m85wA58EmDpi1Bxj8fIqz3yStvvu50aedwDrlXPDBa\nsaFWX4StvU6qzuYSKbmSENOYgW0xI16HtAXQ9yPHfs6AEhHhQH3qmj2KorMs/faq\n3De+zLi3bUr1MFgBKkgUvfvk8glWloFlH1jbY6YHmRmVkaQZedMMCanJFkKZF6Xt\n0sze2hrBDOUZqI3g1ClRQyvkmU2HBkmJPWrlN++0RZL6ZRYgufH7+SDCA2426Lk4\nQccdweYUO52tBicNRnDi4MBGRHh+XnAgVYo4MYbGEKiQhvaAgtLTfuGGXii2tyc6\n7QJNpeipHLhzopQbpa6ebsxPQhfpqAce7awazxhIcdGrkIQppZKqCCn3NlW5qWNz\nRmy0Mgkh0UhHRTfLO7F1lde/NIw4S/lA6gAGgOo/G3b0AQLVww3Q5aW2f1KOq45u\n/lhEqceizgXhs9kOLDLHBm4Oui3jTEc3TSf4ouuPxT9kqPGIEfm9og3tV8v0Rmv5\n8RKL5d+1XpiaNnaunZfLABJQZoyU9bAmstmDl903VKX10ueSSe/qlLRoYXClTy/U\ndxzKhExzsD/VMK1NcCYZXGm1FJP7Xq0Vkfa66zHn2N7xldrzbeuTu1cPhQrVvbMg\n3ZrWM+PVEriAhIu8vaM1C6IF0JJeqCsg3ZmlvDQM3Nd4HVqxhJmDLNkLYWBlkdFl\nfSrGhUNKZAiyhetqdhVCLHI/VwX96b4hi30PWXNFDwJ1xN4lq7TmmoLCjU/HKOwZ\nPH3j3RyQRwqvr4sUcaFli1AqwMunJ7i7pyApyxseBg7mgEOl9om6ngGCGL7O9LAK\n4+DPg3LqFYaNtl1Zuo1lQjGOpMHzXvqJpxrDZWa2oy0xFIyzvN8fPzMRa7+t7C9f\nfbTcyD1kr5DXc8cfvGC7IscJXGEBrYkYQh1i6Xw4STOBpDOINITcOSOMC6uS0ttR\nc0qoYFJXOweUXuNrywnYO+R3S0TQ52mgebz9gTHJfMmT+27MtHZ3+rTTo9lcIbm1\nOBReeSNK/hLdaKUNcyebT8fQbXz65WYFYRoP55xzh1RAxxiw/VRuvRKjhUYFygo5\nPgBPFJi1ARN5rkf+lt/kFc7EP9bN1OXBp3ibuB+CFOCJReVYS9DpvEWKulup5+oe\n2w6bBzi2IR6EQRWTJvgQMusRUtyTM5LWF/QotijAywvyWU8wcvKwAP0lDmT9qCJg\nE4L7UD2OxxMeZ03HnAccQ0nbjni5B5zRb2UYSTGMCEUZz8SNWgBsAjiupHME5zsq\nUy27k+cYhwauFyJlHuMUzPjXcGEgtdnr5MKTyg20t6kEYileQst/+pLtt1wk/ecC\nx6osgZRgRxToUkMZM4t1mG9t26CbAQ==\n=N1o/\n-----END PGP SIGNATURE-----",
        "payload": "tree eca38c9616663fecca57bbafb2186ca1a07c51f9\nparent ceeb317cded22cc1c5270155c3afda8bf74db3f4\nauthor Vasil Dimov <vd@FreeBSD.org> 1627923935 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1631774492 +0200\n\nnet: report an error if unable to bind on the Tor listening addr:port\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/56a082d6645eaa410070df958c8d789e00ea562a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/56a082d6645eaa410070df958c8d789e00ea562a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/56a082d6645eaa410070df958c8d789e00ea562a/comments",
    "author": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "ceeb317cded22cc1c5270155c3afda8bf74db3f4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/ceeb317cded22cc1c5270155c3afda8bf74db3f4",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/ceeb317cded22cc1c5270155c3afda8bf74db3f4"
      }
    ],
    "stats": {
      "total": 2,
      "additions": 1,
      "deletions": 1
    },
    "files": [
      {
        "sha": "608a41522b94112bbff204509ba741d0702d8cc5",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/56a082d6645eaa410070df958c8d789e00ea562a/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/56a082d6645eaa410070df958c8d789e00ea562a/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=56a082d6645eaa410070df958c8d789e00ea562a",
        "patch": "@@ -2484,7 +2484,7 @@ bool CConnman::InitBinds(const Options& options)\n         fBound |= Bind(addrBind.m_service, (BF_EXPLICIT | BF_REPORT_ERROR), addrBind.m_flags);\n     }\n     for (const auto& addr_bind : options.onion_binds) {\n-        fBound |= Bind(addr_bind, BF_EXPLICIT | BF_DONT_ADVERTISE, NetPermissionFlags::None);\n+        fBound |= Bind(addr_bind, BF_EXPLICIT | BF_REPORT_ERROR | BF_DONT_ADVERTISE, NetPermissionFlags::None);\n     }\n     if (options.bind_on_any) {\n         struct in_addr inaddr_any;"
      }
    ]
  },
  {
    "sha": "57e0c5d32e7a1d86c9d8bccf088773b96029c338",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1N2UwYzVkMzJlN2ExZDg2YzlkOGJjY2YwODg3NzNiOTYwMjljMzM4",
    "commit": {
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-08-13T08:33:24Z"
      },
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2021-09-16T06:59:54Z"
      },
      "message": "net: require P2P binds to succeed\n\nIn the Tor case, this prevents us from telling the Tor daemon to send\nour incoming connections from the Tor network to an address where we\ndo not listen (probably another application is listening).\n\nIn the other cases (IPv4/IPv6 binds) this also prevents unpleasant\nsurprises caused by continuing operations even on bind failure. For\nexample, another application may be listening on portX, bitcoind tries\nto bind on portX and portY, only succeeds with portY and continues\noperation leaving the user thinking that his bitcoind is listening on\nportX whereas another application is listening (the error message in\nthe log could easily be missed).\n\nFixes https://github.com/bitcoin/bitcoin/issues/22727",
      "tree": {
        "sha": "5522f3eba3d237b20ae082c15481b45b80198433",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/5522f3eba3d237b20ae082c15481b45b80198433"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/57e0c5d32e7a1d86c9d8bccf088773b96029c338",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAmFC62sACgkQVN8G9ktV\ny7/7giAAiVX0xwm+ETiQwNT9QbUjaCVNb2FZoUsagiKEMYTeZe+umH/z0t9q02od\nPghvu7oEmBXuB2Uw8+f0rpcwBrvEnQmGJs8+T+279mqmu5r1cYLAZsUji/Cut4Ox\nAnaToAN8I8+/0guk4koWWIjNPiEbKcQe4K18NsJ+VbIGPMadaA5q6vpg7oYgcFT7\nYL3GnQsHyPcnMRmg1IST5tPzXU/fjZkeQZ1SBuvUOWpHp0scjYRU+pBXdHuQ3SdX\nu2hUQ2r6QHcHMoxjKYnuqlXXvwsMRH9TjeeqQALJEnYKHBCUmw2PHXZ/WYOW65BP\nMsCkRB+q5n8gRI2G0JaqSCaXI2kRdW3dZ2nvGCV4LSi9Be2AYpaBwE0FRnVBDXZA\nD2yxJz2s0ctASQq2e1uMBpdBsG1TZh4z7rN/w0NBOmfLuyIaRd1HOVsjuz07fzlF\nc6UM2F66eVmbfD7+MsmDFyW8kqjhorNRf1CrPNjfRAS10lVB5f5zov5Y4JWPtAU+\ns0KsrCNthVcrCdf6ZoiutlRvMMM2QKj6gpfyfLoygFZvSO3e+d8WXTk/Y2XWZChn\nBGRTTF1hnN6sN5ygHyyOE8jCPd6F65LBQA1nS0H1k0ONCHAiaUrxkU786/KWQwfG\nITpkF8R3hk76Gylw8kmH0G1S/VTfChIipcCbeZxBgHlJ0shPzfwpqXBW1kjVH3pM\na0MVVH3gLlRjYjcrkHToR6HyYhzX1g+Cqw+vmB1OTG5gM+0g2OhL8Y7ydJ4/HcAc\naIQZYOIQGqprV4xm6iJpYIdK27k5tBBxYHeqrR4u98HEuJ98499n5Hi2P/ds+utL\n52LZQ27b5O/U8AyKx0K5J2R9gAz9OARx98SCCqpCtgNWM0PzsnAktu7q5ADqp92l\n5FRmpP5uOlg2cKldWeJvkKy5WCQ9/6Mz6GSa+Y5ZJDVaBx0ugFL4R1+Vl+mEfnVq\nVUb0SkkLi7UYwUOlKDq24zsAiNZQtCgt1jijf6YmfKY2GqJvEPWd8jsUDnEXg8bK\nFamoHusuPPK509FrIruEwgE6yfFMUDd4FpHTLXeYe5wmvKI0MxTUy4XrrRZ1UpbT\nOrnmsgtkSi/FIuKNpZVwKgO17OE5YmyufEQF6KbkxNV6GHLqs/Zjeqe4Aqiwg/ta\nLLMNeVtff5y5nafhrGzby0fpzoOKrVJzK0Rp63jC6/L1LLWRaJ76gurxWbxgj9vm\nwhKXvR/NpnOJIjltwHze4ZNce/U1+Yx4a+4wJxUw9DZj54K+Hn3rzNyxXXnYr6R7\nmb86pLaZ6Z+5G9bVP58SZICEEqyfnNzqFSNZ1Kl0/Cfz7SpRnX93pnG8XscekJHf\nbdTnuZ2VNZydpCVbccORfSLw24kuYQ==\n=Y7op\n-----END PGP SIGNATURE-----",
        "payload": "tree 5522f3eba3d237b20ae082c15481b45b80198433\nparent 56a082d6645eaa410070df958c8d789e00ea562a\nauthor Vasil Dimov <vd@FreeBSD.org> 1628843604 +0200\ncommitter Vasil Dimov <vd@FreeBSD.org> 1631775594 +0200\n\nnet: require P2P binds to succeed\n\nIn the Tor case, this prevents us from telling the Tor daemon to send\nour incoming connections from the Tor network to an address where we\ndo not listen (probably another application is listening).\n\nIn the other cases (IPv4/IPv6 binds) this also prevents unpleasant\nsurprises caused by continuing operations even on bind failure. For\nexample, another application may be listening on portX, bitcoind tries\nto bind on portX and portY, only succeeds with portY and continues\noperation leaving the user thinking that his bitcoind is listening on\nportX whereas another application is listening (the error message in\nthe log could easily be missed).\n\nFixes https://github.com/bitcoin/bitcoin/issues/22727\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/57e0c5d32e7a1d86c9d8bccf088773b96029c338",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/57e0c5d32e7a1d86c9d8bccf088773b96029c338",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/57e0c5d32e7a1d86c9d8bccf088773b96029c338/comments",
    "author": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "56a082d6645eaa410070df958c8d789e00ea562a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/56a082d6645eaa410070df958c8d789e00ea562a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/56a082d6645eaa410070df958c8d789e00ea562a"
      }
    ],
    "stats": {
      "total": 28,
      "additions": 20,
      "deletions": 8
    },
    "files": [
      {
        "sha": "5e2e7cba5a8ebc50ad314d9a857f065d5401ac77",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 20,
        "deletions": 8,
        "changes": 28,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/57e0c5d32e7a1d86c9d8bccf088773b96029c338/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/57e0c5d32e7a1d86c9d8bccf088773b96029c338/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=57e0c5d32e7a1d86c9d8bccf088773b96029c338",
        "patch": "@@ -2476,24 +2476,36 @@ bool CConnman::Bind(const CService &addr, unsigned int flags, NetPermissionFlags\n \n bool CConnman::InitBinds(const Options& options)\n {\n-    bool fBound = false;\n     for (const auto& addrBind : options.vBinds) {\n-        fBound |= Bind(addrBind, (BF_EXPLICIT | BF_REPORT_ERROR), NetPermissionFlags::None);\n+        if (!Bind(addrBind, (BF_EXPLICIT | BF_REPORT_ERROR), NetPermissionFlags::None)) {\n+            return false;\n+        }\n     }\n     for (const auto& addrBind : options.vWhiteBinds) {\n-        fBound |= Bind(addrBind.m_service, (BF_EXPLICIT | BF_REPORT_ERROR), addrBind.m_flags);\n+        if (!Bind(addrBind.m_service, (BF_EXPLICIT | BF_REPORT_ERROR), addrBind.m_flags)) {\n+            return false;\n+        }\n     }\n     for (const auto& addr_bind : options.onion_binds) {\n-        fBound |= Bind(addr_bind, BF_EXPLICIT | BF_REPORT_ERROR | BF_DONT_ADVERTISE, NetPermissionFlags::None);\n+        if (!Bind(addr_bind, BF_EXPLICIT | BF_REPORT_ERROR | BF_DONT_ADVERTISE, NetPermissionFlags::None)) {\n+            return false;\n+        }\n     }\n     if (options.bind_on_any) {\n+        // Don't consider errors to bind on IPv6 \"::\" fatal because the host OS\n+        // may not have IPv6 support and the user did not explicitly ask us to\n+        // bind on that.\n+        const CService ipv6_any{in6_addr(IN6ADDR_ANY_INIT), GetListenPort()}; // ::\n+        Bind(ipv6_any, BF_NONE, NetPermissionFlags::None);\n+\n         struct in_addr inaddr_any;\n         inaddr_any.s_addr = htonl(INADDR_ANY);\n-        struct in6_addr inaddr6_any = IN6ADDR_ANY_INIT;\n-        fBound |= Bind(CService(inaddr6_any, GetListenPort()), BF_NONE, NetPermissionFlags::None);\n-        fBound |= Bind(CService(inaddr_any, GetListenPort()), !fBound ? BF_REPORT_ERROR : BF_NONE, NetPermissionFlags::None);\n+        const CService ipv4_any{inaddr_any, GetListenPort()}; // 0.0.0.0\n+        if (!Bind(ipv4_any, BF_REPORT_ERROR, NetPermissionFlags::None)) {\n+            return false;\n+        }\n     }\n-    return fBound;\n+    return true;\n }\n \n bool CConnman::Start(CScheduler& scheduler, const Options& connOptions)"
      }
    ]
  }
]