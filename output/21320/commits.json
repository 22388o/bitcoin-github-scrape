[
  {
    "sha": "bd49ac416881ede3e5132789defd3fec4c6f8685",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiZDQ5YWM0MTY4ODFlZGUzZTUxMzI3ODlkZWZkM2ZlYzRjNmY4Njg1",
    "commit": {
      "author": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2021-03-01T06:00:36Z"
      },
      "committer": {
        "name": "fanquake",
        "email": "fanquake@gmail.com",
        "date": "2021-03-01T06:00:36Z"
      },
      "message": "build: fix libnatpmp macos cross compile\n\nCurrently, our cross-compile of libnatpmp for macOS doesn't work at all.\nThe wrong archiver is used, which produces an archive the linker doesn't like.\nThis becomes clear when configuring:\n```bash\nconfigure:25722: checking for initnatpmp in -lnatpmp\nconfigure:25747: env -u C_INCLUDE_PATH -u CPLUS_INCLUDE_PATH -u OBJC_INCLUDE_PATH -u OBJCPLUS_INCLUDE_PATH -u CPATH -u LIBRARY_PATH /home/ubuntu/bitcoin/depends/x86_64-apple-darwin18/native/bin/clang++ --target=x86_64-apple-darwin18 <trim>  -Wl,-headerpad_max_install_names -Wl,-dead_strip -Wl,-dead_strip_dylibs conftest.cpp -lnatpmp   >&5\nld: archive has no table of contents for architecture x86_64\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n```\n\nFix this by using the right `ar` (we do the same for upnp).\n\nWhile we're at it, we fixe the build so that we are using our c/ppflags.\nThis  means building with `-O2` rather than `-Os`.\n\nNote that this fixes an issue that is also fixed by #21209.\nHowever, given there are reservations about updating to use a newer libnatpmp source, we should just fix this for now.",
      "tree": {
        "sha": "b1515fa8edb2aa50b6b4088c513f7a949649d193",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b1515fa8edb2aa50b6b4088c513f7a949649d193"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bd49ac416881ede3e5132789defd3fec4c6f8685",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEz7FuIclQ9n+pXlWPLuufXMCVJsEFAmA8koYACgkQLuufXMCV\nJsGHCw/+K3yQD+/jahBMqp62Ix0kkVF97A9UziNV2OP71lUNYMRZ1339L1Rj2cGX\nIqo9xN1S+H/XcIacWT8WaaXmUkztOM8zmYURaRFnincV9mALmIix8Mv1SRFBA64g\nI/YKvk5c2FN57UrKj4a3Vq2x7RHFyfBFmi2sOXCen+znNX/IChW94L2NFOTqMTJR\nWS2LcwC5IrK/MYPCtH2T8xNhCjbcYM1RoHMvHtpWK5p3ZCP6pl7WkEESHP++X1Cy\nyIg61exmqGn8nilpxpVi/gYXam6Zi0rTlHiRpB7gREEJ4R+CGKLLFCRd4Fxz1eOW\nMc96q2MS7T00GkwFnKKEHIloV0Xb7HjEp2gSrRgAvN73q1pVkWj/X7re03FZrijy\nPVUzeMZqXx4VF7wbZclTraz2WpSGLoBcPjZ84CNffXWOqMmLwsSfUkMQ17TiZhSb\nGYveZefcXawqQrYBFz+cU7CYSWS+c2Wxli+BmVXIz0BLbgViFEk6GIfc2yWmgpsT\nV8AYVc9L3LXrdSjrlOWR3Gylq/HYC+GifDwCwCoTwp+C8c41hSGj9ayQP9DFvQdw\naZ89AV9EhRElNDAxgpAqgx7HnzQBrjXsLLSqRGMkbsYvm1RpMCp85310Uf3sS7zf\nrXazhqrqMRT40+h5GiZZqdQXBe033pULgTGnL5I2nn+7hvAkwM8=\n=pxqz\n-----END PGP SIGNATURE-----",
        "payload": "tree b1515fa8edb2aa50b6b4088c513f7a949649d193\nparent e52ce9f2b312b3cf3b0837918e07d7603e241d63\nauthor fanquake <fanquake@gmail.com> 1614578436 +0800\ncommitter fanquake <fanquake@gmail.com> 1614578436 +0800\n\nbuild: fix libnatpmp macos cross compile\n\nCurrently, our cross-compile of libnatpmp for macOS doesn't work at all.\nThe wrong archiver is used, which produces an archive the linker doesn't like.\nThis becomes clear when configuring:\n```bash\nconfigure:25722: checking for initnatpmp in -lnatpmp\nconfigure:25747: env -u C_INCLUDE_PATH -u CPLUS_INCLUDE_PATH -u OBJC_INCLUDE_PATH -u OBJCPLUS_INCLUDE_PATH -u CPATH -u LIBRARY_PATH /home/ubuntu/bitcoin/depends/x86_64-apple-darwin18/native/bin/clang++ --target=x86_64-apple-darwin18 <trim>  -Wl,-headerpad_max_install_names -Wl,-dead_strip -Wl,-dead_strip_dylibs conftest.cpp -lnatpmp   >&5\nld: archive has no table of contents for architecture x86_64\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\n```\n\nFix this by using the right `ar` (we do the same for upnp).\n\nWhile we're at it, we fixe the build so that we are using our c/ppflags.\nThis  means building with `-O2` rather than `-Os`.\n\nNote that this fixes an issue that is also fixed by #21209.\nHowever, given there are reservations about updating to use a newer libnatpmp source, we should just fix this for now.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bd49ac416881ede3e5132789defd3fec4c6f8685",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/bd49ac416881ede3e5132789defd3fec4c6f8685",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bd49ac416881ede3e5132789defd3fec4c6f8685/comments",
    "author": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "fanquake",
      "id": 863730,
      "node_id": "MDQ6VXNlcjg2MzczMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/863730?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fanquake",
      "html_url": "https://github.com/fanquake",
      "followers_url": "https://api.github.com/users/fanquake/followers",
      "following_url": "https://api.github.com/users/fanquake/following{/other_user}",
      "gists_url": "https://api.github.com/users/fanquake/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fanquake/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fanquake/subscriptions",
      "organizations_url": "https://api.github.com/users/fanquake/orgs",
      "repos_url": "https://api.github.com/users/fanquake/repos",
      "events_url": "https://api.github.com/users/fanquake/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fanquake/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e52ce9f2b312b3cf3b0837918e07d7603e241d63",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e52ce9f2b312b3cf3b0837918e07d7603e241d63",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e52ce9f2b312b3cf3b0837918e07d7603e241d63"
      }
    ],
    "stats": {
      "total": 1,
      "additions": 1,
      "deletions": 0
    },
    "files": [
      {
        "sha": "391b9337b725027a706499854fd34daad6e811c1",
        "filename": "depends/packages/libnatpmp.mk",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bd49ac416881ede3e5132789defd3fec4c6f8685/depends/packages/libnatpmp.mk",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bd49ac416881ede3e5132789defd3fec4c6f8685/depends/packages/libnatpmp.mk",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/depends/packages/libnatpmp.mk?ref=bd49ac416881ede3e5132789defd3fec4c6f8685",
        "patch": "@@ -6,6 +6,7 @@ $(package)_sha256_hash=e1aa9c4c4219bc06943d6b2130f664daee213fb262fcb94dd355815b8\n \n define $(package)_set_vars\n   $(package)_build_opts=CC=\"$($(package)_cc)\"\n+  $(package)_build_env+=CFLAGS=\"$($(package)_cflags) $($(package)_cppflags)\" AR=\"$($(package)_ar)\"\n endef\n \n define $(package)_build_cmds"
      }
    ]
  }
]