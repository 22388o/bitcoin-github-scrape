[
  {
    "sha": "e9adb96f8854d21a02d80b4295f1a2e57579cc18",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplOWFkYjk2Zjg4NTRkMjFhMDJkODBiNDI5NWYxYTJlNTc1NzljYzE4",
    "commit": {
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2019-06-29T02:44:38Z"
      },
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2019-08-19T14:15:07Z"
      },
      "message": "[wallet] abort when attempting to fund a transaction above maxtxfee\n\nFundTransaction calls GetMinimumFee which, when the fee rate is absurdly high, quietly reduced the fee to -maxtxfee. Becaue an absurdly high fee rate is usually the result of a fat finger, aborting seems safer behavior.\n\nGithub-Pull: #16257\nRebased-From: 806b0052c3b45415862f74f20ba5f389e5b673de",
      "tree": {
        "sha": "f71935ecce27e5ae4898ed5a67366aec970c5ab3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/f71935ecce27e5ae4898ed5a67366aec970c5ab3"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e9adb96f8854d21a02d80b4295f1a2e57579cc18",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAl1arzoACgkQV/+b28ww\nEAlGOQ//QGPdcD1GaoogMxkcMUvYoNCAcoYYyzGIId8ViQHWqwrTQLF/h2TgLE9T\nc4ej3Gq5u7m1r1bRbCm5I3UffBqPgy2/lj4ruD0QEUt9rBOTpcQE4rWLiigP/3OC\nWFbCiLwMnLUkxRfmztx5TVbVRLrQ2uO/bj3Tv60D6o6/hc3y+i23bep8Ntass7mG\na+ry5d1W6ni0hTGMkcA8ZxHl1YRZ+lQQ7547VtrMogSP6BRbWdXAEl0KVuvSlA09\nVlbO66KPMt+286oxTWX2AKMOhP8zWX1/0ph/qUQ+0mEyvQr4j24uNwR2qJ4q3cKI\n4m/tkZFklGKJufWo5TLaLGiR2NS6EEbWUGyEEiq5B6VUPePjHWLxx8j+wLZlDYGm\nE4sil4oVt/1/bExJLnUfP3EWcGGkFgOu1b+Dr+/ONADPCzVGznlMkQmiWTlIlKrU\n1Eci0zbsE6HyfdBC22fEroOQsk3y+AKyNDWdKmtKJfEXzj2bnOjKP9VQDTEzXM40\n3+9oZHSMI4/q3y7mrqWmN75vI6662iEq66QOUGlKAOoC5k+Z3GaSJ6lnPlTZ1EHy\n8DpWKhDor2SqYEo4Ew7ntOcZiyFyCzec4+zTu3SMEesl5sfpIUjPP00pN8PX/NYL\nffobDsdr0CJR16VgMAAu944k9cpgcXljLcd8DwgDcUMITaechKQ=\n=2Dsm\n-----END PGP SIGNATURE-----",
        "payload": "tree f71935ecce27e5ae4898ed5a67366aec970c5ab3\nparent c165df198d6e9ea7292af0578024113803b8a6a2\nauthor Sjors Provoost <sjors@sprovoost.nl> 1561776278 -0400\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1566224107 +0200\n\n[wallet] abort when attempting to fund a transaction above maxtxfee\n\nFundTransaction calls GetMinimumFee which, when the fee rate is absurdly high, quietly reduced the fee to -maxtxfee. Becaue an absurdly high fee rate is usually the result of a fat finger, aborting seems safer behavior.\n\nGithub-Pull: #16257\nRebased-From: 806b0052c3b45415862f74f20ba5f389e5b673de\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e9adb96f8854d21a02d80b4295f1a2e57579cc18",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e9adb96f8854d21a02d80b4295f1a2e57579cc18",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e9adb96f8854d21a02d80b4295f1a2e57579cc18/comments",
    "author": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "c165df198d6e9ea7292af0578024113803b8a6a2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c165df198d6e9ea7292af0578024113803b8a6a2",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/c165df198d6e9ea7292af0578024113803b8a6a2"
      }
    ],
    "stats": {
      "total": 41,
      "additions": 31,
      "deletions": 10
    },
    "files": [
      {
        "sha": "21867b7fb2f5245abe3c9748c0619358082cf7c8",
        "filename": "doc/release-notes-0.18.1-16257.md",
        "status": "added",
        "additions": 6,
        "deletions": 0,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e9adb96f8854d21a02d80b4295f1a2e57579cc18/doc/release-notes-0.18.1-16257.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e9adb96f8854d21a02d80b4295f1a2e57579cc18/doc/release-notes-0.18.1-16257.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/release-notes-0.18.1-16257.md?ref=e9adb96f8854d21a02d80b4295f1a2e57579cc18",
        "patch": "@@ -0,0 +1,6 @@\n+Wallet changes\n+--------------\n+When creating a transaction with a fee above `-maxtxfee` (default 0.1 BTC),\n+the RPC commands `walletcreatefundedpsbt` and  `fundrawtransaction` will now fail\n+instead of rounding down the fee. Beware that the `feeRate` argument is specified\n+in BTC per kilobyte, not satoshi per byte."
      },
      {
        "sha": "d9a5474056549b294049bbe23be874fee96a3e62",
        "filename": "src/policy/fees.cpp",
        "status": "modified",
        "additions": 0,
        "deletions": 1,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e9adb96f8854d21a02d80b4295f1a2e57579cc18/src/policy/fees.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e9adb96f8854d21a02d80b4295f1a2e57579cc18/src/policy/fees.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/policy/fees.cpp?ref=e9adb96f8854d21a02d80b4295f1a2e57579cc18",
        "patch": "@@ -38,7 +38,6 @@ std::string StringForFeeReason(FeeReason reason) {\n         {FeeReason::PAYTXFEE, \"PayTxFee set\"},\n         {FeeReason::FALLBACK, \"Fallback fee\"},\n         {FeeReason::REQUIRED, \"Minimum Required Fee\"},\n-        {FeeReason::MAXTXFEE, \"MaxTxFee limit\"}\n     };\n     auto reason_string = fee_reason_strings.find(reason);\n "
      },
      {
        "sha": "d46738cefba9fcd506ddbad56a2245791f3f5b65",
        "filename": "src/policy/fees.h",
        "status": "modified",
        "additions": 0,
        "deletions": 1,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e9adb96f8854d21a02d80b4295f1a2e57579cc18/src/policy/fees.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e9adb96f8854d21a02d80b4295f1a2e57579cc18/src/policy/fees.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/policy/fees.h?ref=e9adb96f8854d21a02d80b4295f1a2e57579cc18",
        "patch": "@@ -88,7 +88,6 @@ enum class FeeReason {\n     PAYTXFEE,\n     FALLBACK,\n     REQUIRED,\n-    MAXTXFEE,\n };\n \n std::string StringForFeeReason(FeeReason reason);"
      },
      {
        "sha": "0cac42ba72eb5437d5f81d9a5d17c3cfec8274e9",
        "filename": "src/wallet/fees.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 7,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e9adb96f8854d21a02d80b4295f1a2e57579cc18/src/wallet/fees.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e9adb96f8854d21a02d80b4295f1a2e57579cc18/src/wallet/fees.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/fees.cpp?ref=e9adb96f8854d21a02d80b4295f1a2e57579cc18",
        "patch": "@@ -21,13 +21,7 @@ CAmount GetRequiredFee(const CWallet& wallet, unsigned int nTxBytes)\n \n CAmount GetMinimumFee(const CWallet& wallet, unsigned int nTxBytes, const CCoinControl& coin_control, const CTxMemPool& pool, const CBlockPolicyEstimator& estimator, FeeCalculation* feeCalc)\n {\n-    CAmount fee_needed = GetMinimumFeeRate(wallet, coin_control, pool, estimator, feeCalc).GetFee(nTxBytes);\n-    // Always obey the maximum\n-    if (fee_needed > maxTxFee) {\n-        fee_needed = maxTxFee;\n-        if (feeCalc) feeCalc->reason = FeeReason::MAXTXFEE;\n-    }\n-    return fee_needed;\n+    return GetMinimumFeeRate(wallet, coin_control, pool, estimator, feeCalc).GetFee(nTxBytes);\n }\n \n CFeeRate GetRequiredFeeRate(const CWallet& wallet)"
      },
      {
        "sha": "92dc0f5d3138a674be32faa63d08c7b52b9fe739",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e9adb96f8854d21a02d80b4295f1a2e57579cc18/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e9adb96f8854d21a02d80b4295f1a2e57579cc18/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=e9adb96f8854d21a02d80b4295f1a2e57579cc18",
        "patch": "@@ -2671,6 +2671,11 @@ bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nC\n         }\n     }\n \n+    if (nFeeRet > maxTxFee) {\n+        strFailReason = _(\"Fee exceeds maximum configured by -maxtxfee\");\n+        return false;\n+    }\n+\n     return true;\n }\n "
      },
      {
        "sha": "019a9d401222109d6ff1aa58057845d926081209",
        "filename": "test/functional/rpc_fundrawtransaction.py",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e9adb96f8854d21a02d80b4295f1a2e57579cc18/test/functional/rpc_fundrawtransaction.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e9adb96f8854d21a02d80b4295f1a2e57579cc18/test/functional/rpc_fundrawtransaction.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/rpc_fundrawtransaction.py?ref=e9adb96f8854d21a02d80b4295f1a2e57579cc18",
        "patch": "@@ -662,6 +662,7 @@ def run_test(self):\n         result = self.nodes[3].fundrawtransaction(rawtx) # uses min_relay_tx_fee (set by settxfee)\n         result2 = self.nodes[3].fundrawtransaction(rawtx, {\"feeRate\": 2*min_relay_tx_fee})\n         result3 = self.nodes[3].fundrawtransaction(rawtx, {\"feeRate\": 10*min_relay_tx_fee})\n+        assert_raises_rpc_error(-4, \"Fee exceeds maximum configured by -maxtxfee\", self.nodes[3].fundrawtransaction, rawtx, {\"feeRate\": 1})\n         result_fee_rate = result['fee'] * 1000 / count_bytes(result['hex'])\n         assert_fee_amount(result2['fee'], count_bytes(result2['hex']), 2 * result_fee_rate)\n         assert_fee_amount(result3['fee'], count_bytes(result3['hex']), 10 * result_fee_rate)"
      },
      {
        "sha": "24ac14162c4b839ab374e5879eb9c21f6f16de7b",
        "filename": "test/functional/rpc_psbt.py",
        "status": "modified",
        "additions": 18,
        "deletions": 1,
        "changes": 19,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e9adb96f8854d21a02d80b4295f1a2e57579cc18/test/functional/rpc_psbt.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e9adb96f8854d21a02d80b4295f1a2e57579cc18/test/functional/rpc_psbt.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/rpc_psbt.py?ref=e9adb96f8854d21a02d80b4295f1a2e57579cc18",
        "patch": "@@ -6,7 +6,15 @@\n \"\"\"\n \n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal, assert_raises_rpc_error, find_output, disconnect_nodes, connect_nodes_bi, sync_blocks\n+from test_framework.util import (\n+    assert_equal,\n+    assert_greater_than,\n+    assert_raises_rpc_error,\n+    connect_nodes_bi,\n+    disconnect_nodes,\n+    find_output,\n+    sync_blocks,\n+)\n \n import json\n import os\n@@ -122,6 +130,15 @@ def run_test(self):\n         assert_equal(walletprocesspsbt_out['complete'], True)\n         self.nodes[1].sendrawtransaction(self.nodes[1].finalizepsbt(walletprocesspsbt_out['psbt'])['hex'])\n \n+        # feeRate of 0.1 BTC / KB produces a total fee slightly below -maxtxfee (~0.05280000):\n+        res = self.nodes[1].walletcreatefundedpsbt([{\"txid\":txid,\"vout\":p2wpkh_pos},{\"txid\":txid,\"vout\":p2sh_p2wpkh_pos},{\"txid\":txid,\"vout\":p2pkh_pos}], {self.nodes[1].getnewaddress():29.99}, 0, {\"feeRate\": 0.1})\n+        assert_greater_than(res[\"fee\"], 0.05)\n+        assert_greater_than(0.06, res[\"fee\"])\n+\n+        # feeRate of 10 BTC / KB produces a total fee well above -maxtxfee\n+        # previously this was silenty capped at -maxtxfee\n+        assert_raises_rpc_error(-4, \"Fee exceeds maximum configured by -maxtxfee\", self.nodes[1].walletcreatefundedpsbt, [{\"txid\":txid,\"vout\":p2wpkh_pos},{\"txid\":txid,\"vout\":p2sh_p2wpkh_pos},{\"txid\":txid,\"vout\":p2pkh_pos}], {self.nodes[1].getnewaddress():29.99}, 0, {\"feeRate\": 10})\n+\n         # partially sign multisig things with node 1\n         psbtx = self.nodes[1].walletcreatefundedpsbt([{\"txid\":txid,\"vout\":p2wsh_pos},{\"txid\":txid,\"vout\":p2sh_pos},{\"txid\":txid,\"vout\":p2sh_p2wsh_pos}], {self.nodes[1].getnewaddress():29.99})['psbt']\n         walletprocesspsbt_out = self.nodes[1].walletprocesspsbt(psbtx)"
      }
    ]
  },
  {
    "sha": "0e7c7465bf2b9911da094d9790480f94e158f9a5",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzowZTdjNzQ2NWJmMmI5OTExZGEwOTRkOTc5MDQ4MGY5NGUxNThmOWE1",
    "commit": {
      "author": {
        "name": "Jo\u00e3o Barbosa",
        "email": "joao.paulo.barbosa@gmail.com",
        "date": "2019-07-02T14:16:36Z"
      },
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2019-08-19T14:19:00Z"
      },
      "message": "wallet: Fix -maxtxfee check by moving it to CWallet::CreateTransaction\n\nGithub-Pull: #16322\nRebased-From: 5c1b9714cb0a13be28324f91f4ec9ca66a1de8c7",
      "tree": {
        "sha": "9ed3154604d16f6a60e2a55a41a5197f61d1b7dd",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9ed3154604d16f6a60e2a55a41a5197f61d1b7dd"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/0e7c7465bf2b9911da094d9790480f94e158f9a5",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAl1ar9kACgkQV/+b28ww\nEAmEOw/8CQI+k4ax0dozRBHmqsvOjJTUqXVE3/rTKvCIM5qaLMAXLZwFqiQADFD1\nWgIYvkViOlVvdpce7Y50MH4s34rbeh8Re3np/kY/Ow18DHvBxtkjV0G9QQSyS5SF\n0OjD6FfbxyTOxRpAOn7C3WS4tJllve3MTsbcuSDClU3LJZLoXL0axxhDagTTbVbD\nbAoSom4bdtdu3nXzbGTw3J0N1w8HhUAyFJ/DQR2cPaKxJ5L5strYpBW+chyBhw1U\nLDKTd6QUzZIWI2nBTbc7sOe/RvqwgkgKKVgC3xePdM/qpNMsZF5r5UkSCCbqb17n\n6OqAq5gQIh8RSiLugBlJfNQU+8cqY2cH94Bs9WQ67nFejiFpkEk3TAG2lgY87/j+\nx5ngnWZiIA7O3dPsJiEeWCmuG4+aGf/PNDB21TXZ8CHTXKnUHk00/iOqwovV5sQU\nUGtU3XlMV59n8o1usAyp8PATz8DUV64V7//n26U3eEAzSwxv1Udhu4Ki7gCecqIL\n/QCooAy878WChvJYB5ftKQXetveiA+nW7TJVMvF0h33YciSO2Xusx4iWWYqWgv9O\np5RRTlD3idw2x6Sgk0RqmmthIOLXw+KwLMg37fpdR7pd3HE7PM+rNlzXoUqYy+Kp\nRVZRJYNb3Sa1xep4ELdsqZhEHvOI0gXTVA3hVsqiL5NwvqFLNCM=\n=KKgP\n-----END PGP SIGNATURE-----",
        "payload": "tree 9ed3154604d16f6a60e2a55a41a5197f61d1b7dd\nparent e9adb96f8854d21a02d80b4295f1a2e57579cc18\nauthor Jo\u00e3o Barbosa <joao.paulo.barbosa@gmail.com> 1562076996 +0100\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1566224340 +0200\n\nwallet: Fix -maxtxfee check by moving it to CWallet::CreateTransaction\n\nGithub-Pull: #16322\nRebased-From: 5c1b9714cb0a13be28324f91f4ec9ca66a1de8c7\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0e7c7465bf2b9911da094d9790480f94e158f9a5",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/0e7c7465bf2b9911da094d9790480f94e158f9a5",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/0e7c7465bf2b9911da094d9790480f94e158f9a5/comments",
    "author": {
      "login": "promag",
      "id": 3534524,
      "node_id": "MDQ6VXNlcjM1MzQ1MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3534524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/promag",
      "html_url": "https://github.com/promag",
      "followers_url": "https://api.github.com/users/promag/followers",
      "following_url": "https://api.github.com/users/promag/following{/other_user}",
      "gists_url": "https://api.github.com/users/promag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/promag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/promag/subscriptions",
      "organizations_url": "https://api.github.com/users/promag/orgs",
      "repos_url": "https://api.github.com/users/promag/repos",
      "events_url": "https://api.github.com/users/promag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/promag/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e9adb96f8854d21a02d80b4295f1a2e57579cc18",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e9adb96f8854d21a02d80b4295f1a2e57579cc18",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e9adb96f8854d21a02d80b4295f1a2e57579cc18"
      }
    ],
    "stats": {
      "total": 22,
      "additions": 16,
      "deletions": 6
    },
    "files": [
      {
        "sha": "d5f5df381a72d5a85a41e523121a002a81fc339f",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 5,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0e7c7465bf2b9911da094d9790480f94e158f9a5/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0e7c7465bf2b9911da094d9790480f94e158f9a5/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=0e7c7465bf2b9911da094d9790480f94e158f9a5",
        "patch": "@@ -2671,11 +2671,6 @@ bool CWallet::FundTransaction(CMutableTransaction& tx, CAmount& nFeeRet, int& nC\n         }\n     }\n \n-    if (nFeeRet > maxTxFee) {\n-        strFailReason = _(\"Fee exceeds maximum configured by -maxtxfee\");\n-        return false;\n-    }\n-\n     return true;\n }\n \n@@ -3080,6 +3075,11 @@ bool CWallet::CreateTransaction(const std::vector<CRecipient>& vecSend, CTransac\n         }\n     }\n \n+    if (nFeeRet > maxTxFee) {\n+        strFailReason = _(\"Fee exceeds maximum configured by -maxtxfee\");\n+        return false;\n+    }\n+\n     if (gArgs.GetBoolArg(\"-walletrejectlongchains\", DEFAULT_WALLET_REJECT_LONG_CHAINS)) {\n         // Lastly, ensure this tx will pass the mempool's chain limits\n         LockPoints lp;"
      },
      {
        "sha": "1beda6e832a84834acc6108728d79b8be45c246f",
        "filename": "test/functional/rpc_psbt.py",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0e7c7465bf2b9911da094d9790480f94e158f9a5/test/functional/rpc_psbt.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0e7c7465bf2b9911da094d9790480f94e158f9a5/test/functional/rpc_psbt.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/rpc_psbt.py?ref=0e7c7465bf2b9911da094d9790480f94e158f9a5",
        "patch": "@@ -136,7 +136,7 @@ def run_test(self):\n         assert_greater_than(0.06, res[\"fee\"])\n \n         # feeRate of 10 BTC / KB produces a total fee well above -maxtxfee\n-        # previously this was silenty capped at -maxtxfee\n+        # previously this was silently capped at -maxtxfee\n         assert_raises_rpc_error(-4, \"Fee exceeds maximum configured by -maxtxfee\", self.nodes[1].walletcreatefundedpsbt, [{\"txid\":txid,\"vout\":p2wpkh_pos},{\"txid\":txid,\"vout\":p2sh_p2wpkh_pos},{\"txid\":txid,\"vout\":p2pkh_pos}], {self.nodes[1].getnewaddress():29.99}, 0, {\"feeRate\": 10})\n \n         # partially sign multisig things with node 1"
      },
      {
        "sha": "944fc7b1316cfdbaa6f8dc8d0342d4a2734f7add",
        "filename": "test/functional/wallet_bumpfee.py",
        "status": "modified",
        "additions": 10,
        "deletions": 0,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/0e7c7465bf2b9911da094d9790480f94e158f9a5/test/functional/wallet_bumpfee.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/0e7c7465bf2b9911da094d9790480f94e158f9a5/test/functional/wallet_bumpfee.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_bumpfee.py?ref=0e7c7465bf2b9911da094d9790480f94e158f9a5",
        "patch": "@@ -76,6 +76,7 @@ def run_test(self):\n         test_unconfirmed_not_spendable(rbf_node, rbf_node_address)\n         test_bumpfee_metadata(rbf_node, dest_address)\n         test_locked_wallet_fails(rbf_node, dest_address)\n+        test_maxtxfee_fails(self, rbf_node, dest_address)\n         self.log.info(\"Success\")\n \n \n@@ -206,6 +207,15 @@ def test_settxfee(rbf_node, dest_address):\n     rbf_node.settxfee(Decimal(\"0.00000000\"))  # unset paytxfee\n \n \n+def test_maxtxfee_fails(test, rbf_node, dest_address):\n+    test.restart_node(1, ['-maxtxfee=0.00003'] + test.extra_args[1])\n+    rbf_node.walletpassphrase(WALLET_PASSPHRASE, WALLET_PASSPHRASE_TIMEOUT)\n+    rbfid = spend_one_input(rbf_node, dest_address)\n+    assert_raises_rpc_error(-4, \"Specified or calculated fee 0.0000332 is too high (cannot be higher than maxTxFee 0.00003)\", rbf_node.bumpfee, rbfid)\n+    test.restart_node(1, test.extra_args[1])\n+    rbf_node.walletpassphrase(WALLET_PASSPHRASE, WALLET_PASSPHRASE_TIMEOUT)\n+\n+\n def test_rebumping(rbf_node, dest_address):\n     # check that re-bumping the original tx fails, but bumping the bumper succeeds\n     rbfid = spend_one_input(rbf_node, dest_address)"
      }
    ]
  }
]