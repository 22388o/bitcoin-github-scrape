[
  {
    "sha": "425473c056424574f73935add3f110fbce770273",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0MjU0NzNjMDU2NDI0NTc0ZjczOTM1YWRkM2YxMTBmYmNlNzcwMjcz",
    "commit": {
      "author": {
        "name": "Ryan Havar",
        "email": "ryan@moneypot.com",
        "date": "2015-02-08T23:12:48Z"
      },
      "committer": {
        "name": "Ryan Havar",
        "email": "ryan@moneypot.com",
        "date": "2015-02-08T23:12:48Z"
      },
      "message": "Fix bug where rescan doesn't do a full rescan",
      "tree": {
        "sha": "2467e40101ea82eb64cf4d6596455620c07c87aa",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/2467e40101ea82eb64cf4d6596455620c07c87aa"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/425473c056424574f73935add3f110fbce770273",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/425473c056424574f73935add3f110fbce770273",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/425473c056424574f73935add3f110fbce770273",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/425473c056424574f73935add3f110fbce770273/comments",
    "author": null,
    "committer": null,
    "parents": [
      {
        "sha": "fb6140b54bad51e3b063dfb005bfde13aca64eb4",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fb6140b54bad51e3b063dfb005bfde13aca64eb4",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fb6140b54bad51e3b063dfb005bfde13aca64eb4"
      }
    ],
    "stats": {
      "total": 25,
      "additions": 15,
      "deletions": 10
    },
    "files": [
      {
        "sha": "e5da2ee6cd7d35e4674dc1a80a1fccb3bb11fc0b",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 2,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/425473c056424574f73935add3f110fbce770273/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/425473c056424574f73935add3f110fbce770273/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=425473c056424574f73935add3f110fbce770273",
        "patch": "@@ -1209,8 +1209,11 @@ bool AppInit2(boost::thread_group& threadGroup)\n         RegisterValidationInterface(pwalletMain);\n \n         CBlockIndex *pindexRescan = chainActive.Tip();\n-        if (GetBoolArg(\"-rescan\", false))\n+        bool fullRescan = false;\n+        if (GetBoolArg(\"-rescan\", false)) {\n             pindexRescan = chainActive.Genesis();\n+            fullRescan = true;\n+        }\n         else\n         {\n             CWalletDB walletdb(strWalletFile);\n@@ -1225,7 +1228,7 @@ bool AppInit2(boost::thread_group& threadGroup)\n             uiInterface.InitMessage(_(\"Rescanning...\"));\n             LogPrintf(\"Rescanning last %i blocks (from block %i)...\\n\", chainActive.Height() - pindexRescan->nHeight, pindexRescan->nHeight);\n             nStart = GetTimeMillis();\n-            pwalletMain->ScanForWalletTransactions(pindexRescan, true);\n+            pwalletMain->ScanForWalletTransactions(pindexRescan, true, fullRescan);\n             LogPrintf(\" rescan      %15dms\\n\", GetTimeMillis() - nStart);\n             pwalletMain->SetBestChain(chainActive.GetLocator());\n             nWalletDBUpdated++;"
      },
      {
        "sha": "520cf2cfa70a243af48b30ad6b4c8205bcc0c71d",
        "filename": "src/rpcdump.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/425473c056424574f73935add3f110fbce770273/src/rpcdump.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/425473c056424574f73935add3f110fbce770273/src/rpcdump.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/rpcdump.cpp?ref=425473c056424574f73935add3f110fbce770273",
        "patch": "@@ -133,7 +133,7 @@ Value importprivkey(const Array& params, bool fHelp)\n         pwalletMain->nTimeFirstKey = 1; // 0 would be considered 'no value'\n \n         if (fRescan) {\n-            pwalletMain->ScanForWalletTransactions(chainActive.Genesis(), true);\n+            pwalletMain->ScanForWalletTransactions(chainActive.Genesis(), true, fRescan);\n         }\n     }\n \n@@ -202,7 +202,7 @@ Value importaddress(const Array& params, bool fHelp)\n \n         if (fRescan)\n         {\n-            pwalletMain->ScanForWalletTransactions(chainActive.Genesis(), true);\n+            pwalletMain->ScanForWalletTransactions(chainActive.Genesis(), true, fRescan);\n             pwalletMain->ReacceptWalletTransactions();\n         }\n     }"
      },
      {
        "sha": "d40d50e079a660f1b214a0d747db145d8575ce17",
        "filename": "src/wallet.cpp",
        "status": "modified",
        "additions": 7,
        "deletions": 5,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/425473c056424574f73935add3f110fbce770273/src/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/425473c056424574f73935add3f110fbce770273/src/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet.cpp?ref=425473c056424574f73935add3f110fbce770273",
        "patch": "@@ -932,7 +932,7 @@ bool CWalletTx::WriteToDisk(CWalletDB *pwalletdb)\n  * from or to us. If fUpdate is true, found transactions that already\n  * exist in the wallet will be updated.\n  */\n-int CWallet::ScanForWalletTransactions(CBlockIndex* pindexStart, bool fUpdate)\n+int CWallet::ScanForWalletTransactions(CBlockIndex* pindexStart, bool fUpdate, bool fullRescan)\n {\n     int ret = 0;\n     int64_t nNow = GetTime();\n@@ -941,10 +941,12 @@ int CWallet::ScanForWalletTransactions(CBlockIndex* pindexStart, bool fUpdate)\n     {\n         LOCK2(cs_main, cs_wallet);\n \n-        // no need to read and scan block, if block was created before\n-        // our wallet birthday (as adjusted for block time variability)\n-        while (pindex && nTimeFirstKey && (pindex->GetBlockTime() < (nTimeFirstKey - 7200)))\n-            pindex = chainActive.Next(pindex);\n+        if (!fullRescan) {\n+            // no need to read and scan block, if block was created before\n+            // our wallet birthday (as adjusted for block time variability)\n+            while (pindex && nTimeFirstKey && (pindex->GetBlockTime() < (nTimeFirstKey - 7200)))\n+                pindex = chainActive.Next(pindex);\n+        }\n \n         ShowProgress(_(\"Rescanning...\"), 0); // show rescan progress in GUI as dialog or on splashscreen, if -rescan on startup\n         double dProgressStart = Checkpoints::GuessVerificationProgress(pindex, false);"
      },
      {
        "sha": "3ae28c630448dcac74a686da81917adbd1f492fb",
        "filename": "src/wallet.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/425473c056424574f73935add3f110fbce770273/src/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/425473c056424574f73935add3f110fbce770273/src/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet.h?ref=425473c056424574f73935add3f110fbce770273",
        "patch": "@@ -602,7 +602,7 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n     void SyncTransaction(const CTransaction& tx, const CBlock* pblock);\n     bool AddToWalletIfInvolvingMe(const CTransaction& tx, const CBlock* pblock, bool fUpdate);\n     void EraseFromWallet(const uint256 &hash);\n-    int ScanForWalletTransactions(CBlockIndex* pindexStart, bool fUpdate = false);\n+    int ScanForWalletTransactions(CBlockIndex* pindexStart, bool fUpdate = false, bool fullRescan = false);\n     void ReacceptWalletTransactions();\n     void ResendWalletTransactions();\n     CAmount GetBalance() const;"
      }
    ]
  }
]