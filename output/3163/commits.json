[
  {
    "sha": "170e02deaf2bb1f8f79ffafbb4ff7f62cb933c62",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxNzBlMDJkZWFmMmJiMWY4Zjc5ZmZhZmJiNGZmN2Y2MmNiOTMzYzYy",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2013-10-26T19:26:29Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "sipa@ulyssis.org",
        "date": "2013-10-28T14:00:43Z"
      },
      "message": "Generalize the remove-outputs check for fully-prunable transactions.\n\nInstead of explicitly testing for the presence of any output, and\ndealing with this case specially, just interpret it as an empty\nCCoins.\n\nThe case previously caught using the HaveCoins check, is now handled\nby the generic outs != outsBlock test.",
      "tree": {
        "sha": "1f4585e24c7331b6bd7010eb1bf536fae7d812f5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/1f4585e24c7331b6bd7010eb1bf536fae7d812f5"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/170e02deaf2bb1f8f79ffafbb4ff7f62cb933c62",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/170e02deaf2bb1f8f79ffafbb4ff7f62cb933c62",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/170e02deaf2bb1f8f79ffafbb4ff7f62cb933c62",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/170e02deaf2bb1f8f79ffafbb4ff7f62cb933c62/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "7ae454084ba395c9957c008a66360d3cbfd139a1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7ae454084ba395c9957c008a66360d3cbfd139a1",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/7ae454084ba395c9957c008a66360d3cbfd139a1"
      }
    ],
    "stats": {
      "total": 15,
      "additions": 9,
      "deletions": 6
    },
    "files": [
      {
        "sha": "70e62716f34da9fda9b4b1ad5e016c386d1102ae",
        "filename": "src/core.h",
        "status": "modified",
        "additions": 3,
        "deletions": 0,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/170e02deaf2bb1f8f79ffafbb4ff7f62cb933c62/src/core.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/170e02deaf2bb1f8f79ffafbb4ff7f62cb933c62/src/core.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/core.h?ref=170e02deaf2bb1f8f79ffafbb4ff7f62cb933c62",
        "patch": "@@ -421,6 +421,9 @@ class CCoins\n \n     // equality test\n     friend bool operator==(const CCoins &a, const CCoins &b) {\n+         // Empty CCoins objects are always equal.\n+         if (a.IsPruned() && b.IsPruned())\n+             return true;\n          return a.fCoinBase == b.fCoinBase &&\n                 a.nHeight == b.nHeight &&\n                 a.nVersion == b.nVersion &&"
      },
      {
        "sha": "49fc7abbaf2d036acc7c04970c4cea86f18374ab",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 6,
        "changes": 12,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/170e02deaf2bb1f8f79ffafbb4ff7f62cb933c62/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/170e02deaf2bb1f8f79ffafbb4ff7f62cb933c62/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=170e02deaf2bb1f8f79ffafbb4ff7f62cb933c62",
        "patch": "@@ -1750,12 +1750,12 @@ bool DisconnectBlock(CBlock& block, CValidationState& state, CBlockIndex* pindex\n         const CTransaction &tx = block.vtx[i];\n         uint256 hash = tx.GetHash();\n \n-        // check that all outputs are available\n-        if (!view.HaveCoins(hash)) {\n-            fClean = fClean && error(\"DisconnectBlock() : outputs still spent? database corrupted\");\n-            view.SetCoins(hash, CCoins());\n-        }\n-        CCoins &outs = view.GetCoins(hash);\n+        // Check that all outputs are available and match the outputs in the block itself\n+        // exactly. Note that transactions with only provably unspendable outputs won't\n+        // have outputs available even in the block itself, so we handle that case\n+        // specially with outsEmpty.\n+        CCoins outsEmpty;\n+        CCoins &outs = view.HaveCoins(hash) ? view.GetCoins(hash) : outsEmpty;\n         outs.ClearUnspendable();\n \n         CCoins outsBlock = CCoins(tx, pindex->nHeight);"
      }
    ]
  }
]