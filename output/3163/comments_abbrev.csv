sipa,2013-10-26T20:23:25Z,"Tested it myself. I can reproduce the failed disconnect at startup in master, but no problem appears with this patch.\n",https://github.com/bitcoin/bitcoin/pull/3163#issuecomment-27154905,27154905,
gmaxwell,2013-10-26T20:37:50Z,"I can also confirm that it makes the startup problem go away.  Perhaps we should add a couple of test cases with these in a reorg in pulltester before we call it cured?  (E.g. four transactions: 1 op_return, 2 op_return, 1 op_return and one regular, in both orders. Mine them, reorg them out, put them back in later.)\n",https://github.com/bitcoin/bitcoin/pull/3163#issuecomment-27155235,27155235,
sipa,2013-10-26T21:35:11Z,@gmaxwell PullTester doesn't seem to be running the comparison tool anymore.\n,https://github.com/bitcoin/bitcoin/pull/3163#issuecomment-27156326,27156326,
petertodd,2013-10-28T04:01:55Z,"Odd, I tried to reproduce the problem in git master with ./bitcoind -checkblocks=10500, which is more than enough to check the failing block, but I'm not seeing the error. Tried default checklevel, and checklevel=4 as well.\n",https://github.com/bitcoin/bitcoin/pull/3163#issuecomment-27188408,27188408,
gmaxwell,2013-10-28T04:09:10Z,"@petertodd not odd at all, the reorg test is memory limited and only goes as far back as the dbcache size allows. Effectively the checklevel is lower for blocks further back than that.\n",https://github.com/bitcoin/bitcoin/pull/3163#issuecomment-27188535,27188535,
petertodd,2013-10-28T04:31:16Z,"Ah. With -dbcache set appropriately I can reproduce the bug on master, and this pull-req fixes it.\n\nI think this patch needs some comments explaining what's going on re: the immediately pruned case, but otherwise looks good. Maybe something like the following:\n\n```\nCheck that all outputs are available and match the outputs in the block itself\nexactly. Note that transactions with only provabl",https://github.com/bitcoin/bitcoin/pull/3163#issuecomment-27188960,27188960,
jgarzik,2013-10-28T13:41:13Z,ACK... let's get this merged.\n\nThis fixes testnet for me.\n,https://github.com/bitcoin/bitcoin/pull/3163#issuecomment-27211942,27211942,
sipa,2013-10-28T13:57:36Z,@petertodd An empty CCoins cannot even be serialized - there is no storage format that corresponds to. Enough as a guarantee that it doesn't occur in the database? :)\n,https://github.com/bitcoin/bitcoin/pull/3163#issuecomment-27213186,27213186,
sipa,2013-10-28T14:01:07Z,Updated with peter's suggestions.\n,https://github.com/bitcoin/bitcoin/pull/3163#issuecomment-27213484,27213484,
petertodd,2013-10-28T14:08:31Z,@sipa That's a pretty good guarantee!\n\nACK\n,https://github.com/bitcoin/bitcoin/pull/3163#issuecomment-27214065,27214065,
Diapolo,2013-10-28T14:11:29Z,Currently integrating this in a local build to also see if it helps :).\n,https://github.com/bitcoin/bitcoin/pull/3163#issuecomment-27214294,27214294,
jgarzik,2013-10-28T14:11:47Z,retested and re-ACK w/ updated equality check\n,https://github.com/bitcoin/bitcoin/pull/3163#issuecomment-27214315,27214315,
BitcoinPullTester,2013-10-28T15:24:21Z,"Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/170e02deaf2bb1f8f79ffafbb4ff7f62cb933c62 for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/cu",https://github.com/bitcoin/bitcoin/pull/3163#issuecomment-27221314,27221314,
gmaxwell,2013-10-28T15:34:16Z,ACK\n,https://github.com/bitcoin/bitcoin/pull/3163#issuecomment-27222254,27222254,
