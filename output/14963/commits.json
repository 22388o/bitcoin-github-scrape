[
  {
    "sha": "fac4558462cb668581c1a6564876f58093901b9c",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYWM0NTU4NDYyY2I2Njg1ODFjMWE2NTY0ODc2ZjU4MDkzOTAxYjlj",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2018-12-14T21:28:01Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2018-12-14T21:26:13Z"
      },
      "message": "sync: Add RecursiveMutex type alias",
      "tree": {
        "sha": "25096e275855a67f195a52307ba0964e503ab48e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/25096e275855a67f195a52307ba0964e503ab48e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fac4558462cb668581c1a6564876f58093901b9c",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGcBAABCgAGBQJcFB/1AAoJEM4rdWl+aaVIvoIMAK+z98xWVi0PuB6Ee5ISfzVy\ntVpFHXHzY7ZXrNPWIpR3oyfumIF9vw4JJgsW5LYI1B0cRUdlPGvDYwSZhDppZWZh\n8TQc0qsnZ/jls+36Sd2S+AnL9X3V/sufYldghGHBx85/fXfaqaPJ85ivPWm2LkQD\nWOdI9JVSMt+CTHlE2XswOUlXS5yKMO/mRiDMuthO4LCFihP6WT83lpFoKLfIVAma\nuD4qFlWKmw+j7k2nz+78go5NG0ZDeH9oyTV4ESZvnTnveeLHHCsAzgoG5tkg9fKW\nE3jGzG5Gks37ofCs8GEITHxKFAPQdTG53Giu3goX5LAFcKWMUwqg1EkZM8WXOOZm\nSbSuV9OpOHZObxH0gJ5Qgmc9s6Y65hgVjV4anfdhGXqoNZjLpgy04RNCyRbWo74I\nsSUtrDDS6oADdPyyPBE5qCDA6TEIsBBxR1Jot525qLFRb2Cs2JbOdWpsm0/DqP3m\nmMTPTFx4+xjiQSra7Km/G2XwZgeqR7hZR0BWA+hjPA==\n=OdhO\n-----END PGP SIGNATURE-----",
        "payload": "tree 25096e275855a67f195a52307ba0964e503ab48e\nparent b53573e5c6c7cac3086cbfd22311b31cbc8140ec\nauthor MarcoFalke <falke.marco@gmail.com> 1544822881 -0500\ncommitter MarcoFalke <falke.marco@gmail.com> 1544822773 -0500\n\nsync: Add RecursiveMutex type alias\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fac4558462cb668581c1a6564876f58093901b9c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fac4558462cb668581c1a6564876f58093901b9c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fac4558462cb668581c1a6564876f58093901b9c/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "b53573e5c6c7cac3086cbfd22311b31cbc8140ec",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/b53573e5c6c7cac3086cbfd22311b31cbc8140ec",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/b53573e5c6c7cac3086cbfd22311b31cbc8140ec"
      }
    ],
    "stats": {
      "total": 3,
      "additions": 2,
      "deletions": 1
    },
    "files": [
      {
        "sha": "3857eda56b6c86e3a3018377058390de62f6a136",
        "filename": "src/sync.h",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fac4558462cb668581c1a6564876f58093901b9c/src/sync.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fac4558462cb668581c1a6564876f58093901b9c/src/sync.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/sync.h?ref=fac4558462cb668581c1a6564876f58093901b9c",
        "patch": "@@ -20,7 +20,7 @@\n ////////////////////////////////////////////////\n \n /*\n-CCriticalSection mutex;\n+RecursiveMutex mutex;\n     std::recursive_mutex mutex;\n \n LOCK(mutex);\n@@ -104,6 +104,7 @@ class LOCKABLE AnnotatedMixin : public PARENT\n  * Wrapped mutex: supports recursive locking, but no waiting\n  * TODO: We should move away from using the recursive lock by default.\n  */\n+using RecursiveMutex = AnnotatedMixin<std::recursive_mutex>;\n typedef AnnotatedMixin<std::recursive_mutex> CCriticalSection;\n \n /** Wrapped mutex: supports waiting but not recursive locking */"
      }
    ]
  },
  {
    "sha": "fafe941bdd4572b5b9200457a2267888d7efd9bb",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYWZlOTQxYmRkNDU3MmI1YjkyMDA0NTdhMjI2Nzg4OGQ3ZWZkOWJi",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2018-12-17T19:27:43Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2018-12-17T19:27:29Z"
      },
      "message": "test: Add missing validation locks",
      "tree": {
        "sha": "77e48cd8829ce5c27e0aa0ff1321a59ae5af10cc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/77e48cd8829ce5c27e0aa0ff1321a59ae5af10cc"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fafe941bdd4572b5b9200457a2267888d7efd9bb",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGcBAABCgAGBQJcF/ihAAoJEM4rdWl+aaVIlEML/j4fLugZniUHNnk1CIPQqvob\npiB9XZEcQRORn3VjjWtdmbkD0snou95Mz7NPK7BrARzvTVVPozfY+KvFpM/H6+Po\nQ7tDVPdP7cqLvAcIkDFFbmlHS1M3L4l2rY6Uyxq+7MbrD36hitTcbOUjyQmNVnQV\nQwgRq+ajgKRh0rkVZ9Ij/HiJ1Cyf7XPclZMgc9efuknmzZurG2yd47CeKDkfb07z\n1LQs4rvN5nBA+zHv/PQm1IxyiRK6hf4YvAzMo4O1nXhILwAJEzhCEGPaVQETWx/c\nSmHw80GGciefvYgQ1m4hpu3HrvpmvhqZuO0pVUg3u9/k2E//wUWENWAxDbaeNesU\n23DfsgXKmAEPKKsc+rHOy61gsZPfijV7JyZDd1+svm1nWb04+hP95C2n5fsqoWyx\n4MKnbhe4nRhXhbswgPwzT14Zsw/L/Vkhg/7BnaCrE9Xuiw9+63YqOb32GIuPv8aS\niA4Y+gm5T/ZkK6p7V5OKIU4M/CBBbWDOBCNKj8Zocg==\n=d4Hn\n-----END PGP SIGNATURE-----",
        "payload": "tree 77e48cd8829ce5c27e0aa0ff1321a59ae5af10cc\nparent fac4558462cb668581c1a6564876f58093901b9c\nauthor MarcoFalke <falke.marco@gmail.com> 1545074863 -0500\ncommitter MarcoFalke <falke.marco@gmail.com> 1545074849 -0500\n\ntest: Add missing validation locks\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fafe941bdd4572b5b9200457a2267888d7efd9bb",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fafe941bdd4572b5b9200457a2267888d7efd9bb",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fafe941bdd4572b5b9200457a2267888d7efd9bb/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fac4558462cb668581c1a6564876f58093901b9c",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fac4558462cb668581c1a6564876f58093901b9c",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fac4558462cb668581c1a6564876f58093901b9c"
      }
    ],
    "stats": {
      "total": 24,
      "additions": 12,
      "deletions": 12
    },
    "files": [
      {
        "sha": "ac8a1823583543356ee31c5436438b329c4a4366",
        "filename": "src/bench/mempool_eviction.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fafe941bdd4572b5b9200457a2267888d7efd9bb/src/bench/mempool_eviction.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fafe941bdd4572b5b9200457a2267888d7efd9bb/src/bench/mempool_eviction.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bench/mempool_eviction.cpp?ref=fafe941bdd4572b5b9200457a2267888d7efd9bb",
        "patch": "@@ -9,7 +9,7 @@\n #include <list>\n #include <vector>\n \n-static void AddTx(const CTransactionRef& tx, const CAmount& nFee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(pool.cs)\n+static void AddTx(const CTransactionRef& tx, const CAmount& nFee, CTxMemPool& pool) EXCLUSIVE_LOCKS_REQUIRED(cs_main, pool.cs)\n {\n     int64_t nTime = 0;\n     unsigned int nHeight = 1;\n@@ -108,7 +108,7 @@ static void MempoolEviction(benchmark::State& state)\n     tx7.vout[1].nValue = 10 * COIN;\n \n     CTxMemPool pool;\n-    LOCK(pool.cs);\n+    LOCK2(cs_main, pool.cs);\n     // Create transaction references outside the \"hot loop\"\n     const CTransactionRef tx1_r{MakeTransactionRef(tx1)};\n     const CTransactionRef tx2_r{MakeTransactionRef(tx2)};"
      },
      {
        "sha": "607af8a32ab2b5b404dd172a352412ee7908b3dc",
        "filename": "src/test/blockencodings_tests.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 3,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fafe941bdd4572b5b9200457a2267888d7efd9bb/src/test/blockencodings_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fafe941bdd4572b5b9200457a2267888d7efd9bb/src/test/blockencodings_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/blockencodings_tests.cpp?ref=fafe941bdd4572b5b9200457a2267888d7efd9bb",
        "patch": "@@ -62,7 +62,7 @@ BOOST_AUTO_TEST_CASE(SimpleRoundTripTest)\n     TestMemPoolEntryHelper entry;\n     CBlock block(BuildBlockTestCase());\n \n-    LOCK(pool.cs);\n+    LOCK2(cs_main, pool.cs);\n     pool.addUnchecked(entry.FromTx(block.vtx[2]));\n     BOOST_CHECK_EQUAL(pool.mapTx.find(block.vtx[2]->GetHash())->GetSharedTx().use_count(), SHARED_TX_OFFSET + 0);\n \n@@ -162,7 +162,7 @@ BOOST_AUTO_TEST_CASE(NonCoinbasePreforwardRTTest)\n     TestMemPoolEntryHelper entry;\n     CBlock block(BuildBlockTestCase());\n \n-    LOCK(pool.cs);\n+    LOCK2(cs_main, pool.cs);\n     pool.addUnchecked(entry.FromTx(block.vtx[2]));\n     BOOST_CHECK_EQUAL(pool.mapTx.find(block.vtx[2]->GetHash())->GetSharedTx().use_count(), SHARED_TX_OFFSET + 0);\n \n@@ -232,7 +232,7 @@ BOOST_AUTO_TEST_CASE(SufficientPreforwardRTTest)\n     TestMemPoolEntryHelper entry;\n     CBlock block(BuildBlockTestCase());\n \n-    LOCK(pool.cs);\n+    LOCK2(cs_main, pool.cs);\n     pool.addUnchecked(entry.FromTx(block.vtx[1]));\n     BOOST_CHECK_EQUAL(pool.mapTx.find(block.vtx[1]->GetHash())->GetSharedTx().use_count(), SHARED_TX_OFFSET + 0);\n "
      },
      {
        "sha": "23ca9d89aee50a1e288b754a262de24d45725f1d",
        "filename": "src/test/mempool_tests.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 5,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fafe941bdd4572b5b9200457a2267888d7efd9bb/src/test/mempool_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fafe941bdd4572b5b9200457a2267888d7efd9bb/src/test/mempool_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/mempool_tests.cpp?ref=fafe941bdd4572b5b9200457a2267888d7efd9bb",
        "patch": "@@ -55,7 +55,7 @@ BOOST_AUTO_TEST_CASE(MempoolRemoveTest)\n \n \n     CTxMemPool testPool;\n-    LOCK(testPool.cs);\n+    LOCK2(cs_main, testPool.cs);\n \n     // Nothing in pool, remove should do nothing:\n     unsigned int poolSize = testPool.size();\n@@ -120,7 +120,7 @@ static void CheckSort(CTxMemPool &pool, std::vector<std::string> &sortedOrder) E\n BOOST_AUTO_TEST_CASE(MempoolIndexingTest)\n {\n     CTxMemPool pool;\n-    LOCK(pool.cs);\n+    LOCK2(cs_main, pool.cs);\n     TestMemPoolEntryHelper entry;\n \n     /* 3rd highest fee */\n@@ -293,7 +293,7 @@ BOOST_AUTO_TEST_CASE(MempoolIndexingTest)\n BOOST_AUTO_TEST_CASE(MempoolAncestorIndexingTest)\n {\n     CTxMemPool pool;\n-    LOCK(pool.cs);\n+    LOCK2(cs_main, pool.cs);\n     TestMemPoolEntryHelper entry;\n \n     /* 3rd highest fee */\n@@ -422,7 +422,7 @@ BOOST_AUTO_TEST_CASE(MempoolAncestorIndexingTest)\n BOOST_AUTO_TEST_CASE(MempoolSizeLimitTest)\n {\n     CTxMemPool pool;\n-    LOCK(pool.cs);\n+    LOCK2(cs_main, pool.cs);\n     TestMemPoolEntryHelper entry;\n \n     CMutableTransaction tx1 = CMutableTransaction();\n@@ -595,7 +595,7 @@ BOOST_AUTO_TEST_CASE(MempoolAncestryTests)\n     size_t ancestors, descendants;\n \n     CTxMemPool pool;\n-    LOCK(pool.cs);\n+    LOCK2(cs_main, pool.cs);\n     TestMemPoolEntryHelper entry;\n \n     /* Base transaction */"
      },
      {
        "sha": "5ba1df2ec2ff3758ad9c4cbd58edc2f54baa558b",
        "filename": "src/test/miner_tests.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fafe941bdd4572b5b9200457a2267888d7efd9bb/src/test/miner_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fafe941bdd4572b5b9200457a2267888d7efd9bb/src/test/miner_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/miner_tests.cpp?ref=fafe941bdd4572b5b9200457a2267888d7efd9bb",
        "patch": "@@ -99,7 +99,7 @@ static bool TestSequenceLocks(const CTransaction &tx, int flags) EXCLUSIVE_LOCKS\n // Test suite for ancestor feerate transaction selection.\n // Implemented as an additional function, rather than a separate test case,\n // to allow reusing the blockchain created in CreateNewBlock_validity.\n-static void TestPackageSelection(const CChainParams& chainparams, const CScript& scriptPubKey, const std::vector<CTransactionRef>& txFirst) EXCLUSIVE_LOCKS_REQUIRED(::mempool.cs)\n+static void TestPackageSelection(const CChainParams& chainparams, const CScript& scriptPubKey, const std::vector<CTransactionRef>& txFirst) EXCLUSIVE_LOCKS_REQUIRED(cs_main, ::mempool.cs)\n {\n     // Test the ancestor feerate transaction selection.\n     TestMemPoolEntryHelper entry;"
      },
      {
        "sha": "7b274a16581a3e8a434ff6993d0d1fb88f251ee1",
        "filename": "src/test/policyestimator_tests.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fafe941bdd4572b5b9200457a2267888d7efd9bb/src/test/policyestimator_tests.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fafe941bdd4572b5b9200457a2267888d7efd9bb/src/test/policyestimator_tests.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/policyestimator_tests.cpp?ref=fafe941bdd4572b5b9200457a2267888d7efd9bb",
        "patch": "@@ -18,7 +18,7 @@ BOOST_AUTO_TEST_CASE(BlockPolicyEstimates)\n {\n     CBlockPolicyEstimator feeEst;\n     CTxMemPool mpool(&feeEst);\n-    LOCK(mpool.cs);\n+    LOCK2(cs_main, mpool.cs);\n     TestMemPoolEntryHelper entry;\n     CAmount basefee(2000);\n     CAmount deltaFee(100);"
      }
    ]
  },
  {
    "sha": "fa5c346c5a336ccdce8e50befb53746c280f053e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTVjMzQ2YzVhMzM2Y2NkY2U4ZTUwYmVmYjUzNzQ2YzI4MGYwNTNl",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2018-12-14T22:25:05Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2018-12-19T19:13:50Z"
      },
      "message": "doc: Add comment to cs_main and mempool::cs",
      "tree": {
        "sha": "0d5a7478695a449bae42c14a4e2546678a3ecbcc",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/0d5a7478695a449bae42c14a4e2546678a3ecbcc"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa5c346c5a336ccdce8e50befb53746c280f053e",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGcBAABCgAGBQJcGphuAAoJEM4rdWl+aaVIh1wL/1npi4EVXTy9iSfHbBp4OwsN\nFXlCMapAZT9mJQeQJg7IKXky+FgfnXqa2RrEm061g1fL1uHVjpWjznrQjybUAiit\nsEjBwsPumKtCYwrgmwHwxFCne6cxgaTHpMvCcG6nmfs1VDnr/IgLlxqVG7kPC2AY\nmw2G+al9Wv/Q45q0gbwatQqMVaxMyyBlCskWaOModjxWHGWiVGI+iSwNhry21SKi\n1MVbPrhaf5TiGeXUvmG/yKtZCKs6NahJ035wJ+QAND6iaM0KklMsn35FKt2zVZNw\n19eQQykU8RpsP9jU9dV67disbkhr4o3siWafKQvSrCsmMdRZcf6FTwaTKYiZUFHg\nUi9FGKhNVOKl7fMpievURHJwI4xm+ViSL1YH0LIqTeUN3jlVlyJfKpYHI4HUz4Oe\nYse1g6RzJNaGjaFyfaSuvafd2eAD/bVymmh6jbXZzoDRllT16U1ju1kQea72dpCo\nIZXhywSR2C+uorRTEoLpGMQ1DnLyJkLYLz8C5CVlWQ==\n=p12P\n-----END PGP SIGNATURE-----",
        "payload": "tree 0d5a7478695a449bae42c14a4e2546678a3ecbcc\nparent fafe941bdd4572b5b9200457a2267888d7efd9bb\nauthor MarcoFalke <falke.marco@gmail.com> 1544826305 +1300\ncommitter MarcoFalke <falke.marco@gmail.com> 1545246830 +1300\n\ndoc: Add comment to cs_main and mempool::cs\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa5c346c5a336ccdce8e50befb53746c280f053e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa5c346c5a336ccdce8e50befb53746c280f053e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa5c346c5a336ccdce8e50befb53746c280f053e/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fafe941bdd4572b5b9200457a2267888d7efd9bb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fafe941bdd4572b5b9200457a2267888d7efd9bb",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fafe941bdd4572b5b9200457a2267888d7efd9bb"
      }
    ],
    "stats": {
      "total": 52,
      "additions": 48,
      "deletions": 4
    },
    "files": [
      {
        "sha": "94168851255e0af95e5d7ffdf39d898c05a2c2c7",
        "filename": "src/txmempool.h",
        "status": "modified",
        "additions": 37,
        "deletions": 1,
        "changes": 38,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa5c346c5a336ccdce8e50befb53746c280f053e/src/txmempool.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa5c346c5a336ccdce8e50befb53746c280f053e/src/txmempool.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/txmempool.h?ref=fa5c346c5a336ccdce8e50befb53746c280f053e",
        "patch": "@@ -485,7 +485,43 @@ class CTxMemPool\n         >\n     > indexed_transaction_set;\n \n-    mutable CCriticalSection cs;\n+    /**\n+     * This mutex needs to be locked when accessing `mapTx` or other members\n+     * that are guarded by it.\n+     *\n+     * @par Consistency guarantees\n+     *\n+     * By design, it is guaranteed that:\n+     *\n+     * 1. Locking both `cs_main` and `mempool.cs` will give a view of mempool\n+     *    that is consistent with current chain tip (`chainActive` and\n+     *    `pcoinsTip`) and is fully populated. Fully populated means that if the\n+     *    current active chain is missing transactions that were present in a\n+     *    previously active chain, all the missing transactions will have been\n+     *    re-added to the mempool and should be present if they meet size and\n+     *    consistency constraints.\n+     *\n+     * 2. Locking `mempool.cs` without `cs_main` will give a view of a mempool\n+     *    consistent with some chain that was active since `cs_main` was last\n+     *    locked, and that is fully populated as described above. It is ok for\n+     *    code that only needs to query or remove transactions from the mempool\n+     *    to lock just `mempool.cs` without `cs_main`.\n+     *\n+     * To provide these guarantees, it is necessary to lock both `cs_main` and\n+     * `mempool.cs` whenever adding transactions to the mempool and whenever\n+     * changing the chain tip. It's necessary to keep both mutexes locked until\n+     * the mempool is consistent with the new chain tip and fully populated.\n+     *\n+     * @par Consistency bug\n+     *\n+     * The second guarantee above is not currently enforced, but\n+     * https://github.com/bitcoin/bitcoin/pull/14193 will fix it. No known code\n+     * in bitcoin currently depends on second guarantee, but it is important to\n+     * fix for third party code that needs be able to frequently poll the\n+     * mempool without locking `cs_main` and without encountering missing\n+     * transactions during reorgs.\n+     */\n+    mutable RecursiveMutex cs;\n     indexed_transaction_set mapTx GUARDED_BY(cs);\n \n     using txiter = indexed_transaction_set::nth_index<0>::type::const_iterator;"
      },
      {
        "sha": "25818e496d4028ab6f5b2149a2db5af88373f9f3",
        "filename": "src/validation.cpp",
        "status": "modified",
        "additions": 11,
        "deletions": 3,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa5c346c5a336ccdce8e50befb53746c280f053e/src/validation.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa5c346c5a336ccdce8e50befb53746c280f053e/src/validation.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/validation.cpp?ref=fa5c346c5a336ccdce8e50befb53746c280f053e",
        "patch": "@@ -210,9 +210,17 @@ class CChainState {\n     bool RollforwardBlock(const CBlockIndex* pindex, CCoinsViewCache& inputs, const CChainParams& params) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n } g_chainstate;\n \n-\n-\n-CCriticalSection cs_main;\n+/**\n+ * Mutex to guard access to validation specific variables, such as reading\n+ * or changing the chainstate.\n+ *\n+ * This may also need to be locked when updating the transaction pool, e.g. on\n+ * AcceptToMemoryPool. See CTxMemPool::cs comment for details.\n+ *\n+ * The transaction pool has a separate lock to allow reading from it and the\n+ * chainstate at the same time.\n+ */\n+RecursiveMutex cs_main;\n \n BlockMap& mapBlockIndex = g_chainstate.mapBlockIndex;\n CChain& chainActive = g_chainstate.chainActive;"
      }
    ]
  },
  {
    "sha": "fa5e373365b8e88fc9894f53f618d3e89f1bec14",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTVlMzczMzY1YjhlODhmYzk4OTRmNTNmNjE4ZDNlODlmMWJlYzE0",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2018-12-19T19:31:00Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2018-12-22T14:23:03Z"
      },
      "message": "validation: Add cs_main locking annotations",
      "tree": {
        "sha": "8ad9d765c47c285f21f0d251295ff64dc10a68a5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8ad9d765c47c285f21f0d251295ff64dc10a68a5"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa5e373365b8e88fc9894f53f618d3e89f1bec14",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unknown_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQGcBAABCgAGBQJcHkjHAAoJEM4rdWl+aaVI4C4L/jSFwGXuVpQ5syByi22YTxzH\nPOWP+K+1fg/SQSRZhU8GlAQr9lUJjpqKw4z6stZ03PBmlZL9JgmZsvhW+y+E4Egk\n6pGxrJJZvX7EsvdPECGQgLMrirXzVNw/GuiXOsrqKOu71lfLTUq8xyUIyC0KQ686\nGB4AxyI1RI8oDouqal0c02qVTsmRd1KClNqfLwH6nngMO1aJeIXvY6txxO0CKgzv\n8s+LIxfwN2HVEBr4YZS9gCq6umylD9A2wCZaT949aj8y2b2zfv4riFCQtmfI9NhI\nR/5owcUR6y6delvtyGQ3ErpQ2nHkXksrjcB/OI1gXAWTc5HmGoSgCPwlKkvfqoHQ\nhR9HtQZ+eMsGIItCGbq2SgnI8ZQNVHadKm6bESYn4koWGsw4pxY8j3X4K7l4Sdrv\n5B5eCpuPAjYwsQ8rUC2kJvOFsmVoD+OxEL65gDWWvYZ4wzkCCKNBe89v5PstPMcJ\nEkszfcaIw1P+dQvfsD56Pae7iSUUj4hq6n25AvuL1g==\n=6UMc\n-----END PGP SIGNATURE-----",
        "payload": "tree 8ad9d765c47c285f21f0d251295ff64dc10a68a5\nparent fa5c346c5a336ccdce8e50befb53746c280f053e\nauthor MarcoFalke <falke.marco@gmail.com> 1545247860 +0100\ncommitter MarcoFalke <falke.marco@gmail.com> 1545488583 +0100\n\nvalidation: Add cs_main locking annotations\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa5e373365b8e88fc9894f53f618d3e89f1bec14",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa5e373365b8e88fc9894f53f618d3e89f1bec14",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa5e373365b8e88fc9894f53f618d3e89f1bec14/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fa5c346c5a336ccdce8e50befb53746c280f053e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa5c346c5a336ccdce8e50befb53746c280f053e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fa5c346c5a336ccdce8e50befb53746c280f053e"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 5,
      "deletions": 5
    },
    "files": [
      {
        "sha": "b10c9f099f4c42b29596e2e617c32cdf744357e3",
        "filename": "src/txmempool.h",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa5e373365b8e88fc9894f53f618d3e89f1bec14/src/txmempool.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa5e373365b8e88fc9894f53f618d3e89f1bec14/src/txmempool.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/txmempool.h?ref=fa5e373365b8e88fc9894f53f618d3e89f1bec14",
        "patch": "@@ -577,8 +577,8 @@ class CTxMemPool\n     // Note that addUnchecked is ONLY called from ATMP outside of tests\n     // and any other callers may break wallet's in-mempool tracking (due to\n     // lack of CValidationInterface::TransactionAddedToMempool callbacks).\n-    void addUnchecked(const CTxMemPoolEntry& entry, bool validFeeEstimate = true) EXCLUSIVE_LOCKS_REQUIRED(cs);\n-    void addUnchecked(const CTxMemPoolEntry& entry, setEntries& setAncestors, bool validFeeEstimate = true) EXCLUSIVE_LOCKS_REQUIRED(cs);\n+    void addUnchecked(const CTxMemPoolEntry& entry, bool validFeeEstimate = true) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main);\n+    void addUnchecked(const CTxMemPoolEntry& entry, setEntries& setAncestors, bool validFeeEstimate = true) EXCLUSIVE_LOCKS_REQUIRED(cs, cs_main);\n \n     void removeRecursive(const CTransaction &tx, MemPoolRemovalReason reason = MemPoolRemovalReason::UNKNOWN);\n     void removeForReorg(const CCoinsViewCache *pcoins, unsigned int nMemPoolHeight, int flags) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n@@ -630,7 +630,7 @@ class CTxMemPool\n      *  for).  Note: vHashesToUpdate should be the set of transactions from the\n      *  disconnected block that have been accepted back into the mempool.\n      */\n-    void UpdateTransactionsFromBlock(const std::vector<uint256> &vHashesToUpdate);\n+    void UpdateTransactionsFromBlock(const std::vector<uint256>& vHashesToUpdate) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n     /** Try to calculate all in-mempool ancestors of entry.\n      *  (these are all calculated including the tx itself)\n@@ -672,7 +672,7 @@ class CTxMemPool\n      */\n     void GetTransactionAncestry(const uint256& txid, size_t& ancestors, size_t& descendants) const;\n \n-    unsigned long size()\n+    unsigned long size() const\n     {\n         LOCK(cs);\n         return mapTx.size();"
      },
      {
        "sha": "ee7cb1177960a70c61be31d6a603a121479c3f7c",
        "filename": "src/validation.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa5e373365b8e88fc9894f53f618d3e89f1bec14/src/validation.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa5e373365b8e88fc9894f53f618d3e89f1bec14/src/validation.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/validation.cpp?ref=fa5e373365b8e88fc9894f53f618d3e89f1bec14",
        "patch": "@@ -173,7 +173,7 @@ class CChainState {\n                       CCoinsViewCache& view, const CChainParams& chainparams, bool fJustCheck = false) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n     // Block disconnection on our pcoinsTip:\n-    bool DisconnectTip(CValidationState& state, const CChainParams& chainparams, DisconnectedBlockTransactions *disconnectpool);\n+    bool DisconnectTip(CValidationState& state, const CChainParams& chainparams, DisconnectedBlockTransactions* disconnectpool) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n     // Manual block validity manipulation:\n     bool PreciousBlock(CValidationState& state, const CChainParams& params, CBlockIndex* pindex) LOCKS_EXCLUDED(cs_main);"
      }
    ]
  }
]