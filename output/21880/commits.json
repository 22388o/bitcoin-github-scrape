[
  {
    "sha": "87ce05c619c022fcf0a314d0ae5f68edca3d89e6",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4N2NlMDVjNjE5YzAyMmZjZjBhMzE0ZDBhZTVmNjhlZGNhM2Q4OWU2",
    "commit": {
      "author": {
        "name": "Klement Tan",
        "email": "klementtan@gmail.com",
        "date": "2021-05-07T16:44:19Z"
      },
      "committer": {
        "name": "Klement Tan",
        "email": "klementtan@gmail.com",
        "date": "2021-05-07T16:44:19Z"
      },
      "message": "wallet: remove GetScriptPubKeyMan spam",
      "tree": {
        "sha": "c756ab813b2ef3fefe224544adc4eb474827da69",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/c756ab813b2ef3fefe224544adc4eb474827da69"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/87ce05c619c022fcf0a314d0ae5f68edca3d89e6",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEdzBbFgjg1umjfk4MZcjk/steXaIFAmCVbmMACgkQZcjk/ste\nXaJifhAAnOBGyLKc1TZ/+41Bx2fLsYGVFl7ixHZFpsmogp5DeRc1WA3rzwr/JMXb\nIppyF3TJTRcILoTMxvUoncl8ZFURVML2iJJgH9v1i0vvlZbUtZ+Bse2SdEREqkyP\nfnBoIediaITyLfolCk8a481wGGLdCQRQrY2c/7BNUYo64bEsF86pFW3UFhKD2tk7\nD7W93bKJhpYYRZOtNhlK6aWhT0uNR5xpfSnmYNoiublOVa9bRqCSnF4sigPjJha/\njMGC72iZnXF1sfQL/nyzNIBoa5GKkcjY74Qa7dMR2VxuvDGDe/ZyrdEjAm8mHKC1\nVhBI+8J3BCALG0LZFdg/kpqOQxDdFEZUUYcSueyAPIz4C4i1OB9Mvtvxzes9NiEm\nSwAOOiwdedKlCPdlUXiOGKPUh/KAf3+cGCeLG5TklVGlSKcxTNzfuVNJotsUh/oZ\n80fnixrNkFEa0Ixp2SUvMeqr+E3s28Dr/z1KtTN5ZkHkSvHRAmxCUOJ/PAKH+dgR\ncRQf8gQNWTRBHVtN5ytSD1K99B47Ssb8OP1TJHJA+LUqsK2bdpovxmDYsAB851lR\nUNMs8VCEtjEu44+xTJmnE2Q/RnHzU37YVhOSpExyvJLu7FZEHA200O2JNAuZ4FsV\nhXqFUF8lWu5lwxnDYjyOj76kteMVo4mu631kkGhzBR1VKjOwegU=\n=fGl0\n-----END PGP SIGNATURE-----",
        "payload": "tree c756ab813b2ef3fefe224544adc4eb474827da69\nparent eb9a1fe03779bf05062b70f14190cb23ff42b46f\nauthor Klement Tan <klementtan@gmail.com> 1620405859 +0800\ncommitter Klement Tan <klementtan@gmail.com> 1620405859 +0800\n\nwallet: remove GetScriptPubKeyMan spam\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/87ce05c619c022fcf0a314d0ae5f68edca3d89e6",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/87ce05c619c022fcf0a314d0ae5f68edca3d89e6",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/87ce05c619c022fcf0a314d0ae5f68edca3d89e6/comments",
    "author": {
      "login": "klementtan",
      "id": 49265907,
      "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
      "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/klementtan",
      "html_url": "https://github.com/klementtan",
      "followers_url": "https://api.github.com/users/klementtan/followers",
      "following_url": "https://api.github.com/users/klementtan/following{/other_user}",
      "gists_url": "https://api.github.com/users/klementtan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/klementtan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
      "organizations_url": "https://api.github.com/users/klementtan/orgs",
      "repos_url": "https://api.github.com/users/klementtan/repos",
      "events_url": "https://api.github.com/users/klementtan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/klementtan/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "klementtan",
      "id": 49265907,
      "node_id": "MDQ6VXNlcjQ5MjY1OTA3",
      "avatar_url": "https://avatars.githubusercontent.com/u/49265907?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/klementtan",
      "html_url": "https://github.com/klementtan",
      "followers_url": "https://api.github.com/users/klementtan/followers",
      "following_url": "https://api.github.com/users/klementtan/following{/other_user}",
      "gists_url": "https://api.github.com/users/klementtan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/klementtan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/klementtan/subscriptions",
      "organizations_url": "https://api.github.com/users/klementtan/orgs",
      "repos_url": "https://api.github.com/users/klementtan/repos",
      "events_url": "https://api.github.com/users/klementtan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/klementtan/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "eb9a1fe03779bf05062b70f14190cb23ff42b46f",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/eb9a1fe03779bf05062b70f14190cb23ff42b46f",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/eb9a1fe03779bf05062b70f14190cb23ff42b46f"
      }
    ],
    "stats": {
      "total": 23,
      "additions": 14,
      "deletions": 9
    },
    "files": [
      {
        "sha": "9c9f11950a772b186121ef180d5424de61fafe69",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 14,
        "deletions": 9,
        "changes": 23,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/87ce05c619c022fcf0a314d0ae5f68edca3d89e6/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/87ce05c619c022fcf0a314d0ae5f68edca3d89e6/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=87ce05c619c022fcf0a314d0ae5f68edca3d89e6",
        "patch": "@@ -4678,15 +4678,20 @@ ScriptPubKeyMan* CWallet::AddWalletDescriptor(WalletDescriptor& desc, const Flat\n \n         // Remove from maps of active spkMans\n         auto old_spk_man_id = old_spk_man->GetID();\n-        for (bool internal : {false, true}) {\n-            for (OutputType t : OUTPUT_TYPES) {\n-                auto active_spk_man = GetScriptPubKeyMan(t, internal);\n-                if (active_spk_man && active_spk_man->GetID() == old_spk_man_id) {\n-                    if (internal) {\n-                        m_internal_spk_managers.erase(t);\n-                    } else {\n-                        m_external_spk_managers.erase(t);\n-                    }\n+\n+        // Search through m_internal_spk_managers and m_external_spk_managers to find and erase old_spk_man\n+        bool is_old_spk_man_removed = false;\n+        for (std::pair<OutputType, ScriptPubKeyMan*> out_type_spk_manager : m_internal_spk_managers) {\n+            if (out_type_spk_manager.second->GetID() == old_spk_man_id) {\n+                m_internal_spk_managers.erase(out_type_spk_manager.first);\n+                is_old_spk_man_removed = true;\n+                break;\n+            }\n+        }\n+        if (!is_old_spk_man_removed) {\n+            for (std::pair<OutputType, ScriptPubKeyMan*> out_type_spk_manager : m_external_spk_managers) {\n+                if (out_type_spk_manager.second->GetID() == old_spk_man_id) {\n+                    m_external_spk_managers.erase(out_type_spk_manager.first);\n                     break;\n                 }\n             }"
      }
    ]
  }
]