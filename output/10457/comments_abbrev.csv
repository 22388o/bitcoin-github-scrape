laanwj,2017-06-01T08:30:12Z,"utACK https://github.com/bitcoin/bitcoin/pull/10457/commits/f4823abad5bd2c9a556f3ebf2b87160c94f693ed.\n\nIf I read correctly this will change the name to `<something>.dat.<timestamp>.bak` but that's okay.",https://github.com/bitcoin/bitcoin/pull/10457#issuecomment-305426494,305426494,
jnewbery,2017-06-02T18:49:57Z,"Concept ACK. Not having this blocks multi-wallet.\n\nI'd be a lot happier if the -salvagewallet test was being run. It's currently commented out of wallet.py because of intermittent failure (#7463). I'll spend some time seeing if I can fix those failures.",https://github.com/bitcoin/bitcoin/pull/10457#issuecomment-305879195,305879195,
sipa,2017-06-03T18:23:28Z,Concept ACK,https://github.com/bitcoin/bitcoin/pull/10457#issuecomment-305992707,305992707,
laanwj,2017-06-05T12:31:55Z,"> It's currently commented out of wallet.py because of intermittent failure (#7463)\n\nYes I narrowed it down to a berkeleydb issue last time, and wasn't sure how to proceed:\n\nhttps://github.com/bitcoin/bitcoin/issues/7463#issuecomment-201319622",https://github.com/bitcoin/bitcoin/pull/10457#issuecomment-306176251,306176251,
MarcoFalke,2017-06-05T16:51:18Z,utACK f4823abad5bd2c9a556f3ebf2b87160c94f693ed (uncommented the salvagewallet check and run in a loop without issues),https://github.com/bitcoin/bitcoin/pull/10457#issuecomment-306240996,306240996,
jnewbery,2017-06-05T16:57:01Z,"> uncommented the salvagewallet check and run in a loop without issues\n\nI can reproduce this by running `wallet.py` 50 times through test_runner.py. From debug.log:\n\n```\n2017-06-05 15:46:54.510473 CDBEnv::Salvage: Database salvage found errors, all data may not be recoverable.\n2017-06-05 15:46:54.510639 CDBEnv::Salvage: WARNING: Number of keys in data does not match number of values.\",https://github.com/bitcoin/bitcoin/pull/10457#issuecomment-306242564,306242564,
jnewbery,2017-06-06T17:11:28Z,"Tested ACK with one small nit:\n\nPlease update the comment at the top of CDB::Recover() from:\n`    // move wallet file to wallet.timestamp.bak`\n\nto:\n`    // move wallet file to <wallet_name>.<timestamp>.bak`\n\nOtherwise looks good. I've tested f4823abad5bd2c9a556f3ebf2b87160c94f693ed and it renames the wallet backups correctly.",https://github.com/bitcoin/bitcoin/pull/10457#issuecomment-306554226,306554226,
laanwj,2017-06-12T13:34:52Z,Needs rebase after #8694,https://github.com/bitcoin/bitcoin/pull/10457#issuecomment-307790800,307790800,
jnewbery,2017-06-12T13:46:16Z,I think this is a much cleaner solution than was implemented in #8694. There's no need to pass around the wallet name just so it can be printed in a warning message. I think it's worth rebasing this on master and reverting the changes in https://github.com/bitcoin/bitcoin/pull/8694/commits/b823a4c9f6836c802803dbd265cb7451fb93b8e7,https://github.com/bitcoin/bitcoin/pull/10457#issuecomment-307794068,307794068,
jonasschnelli,2017-06-12T19:57:33Z,"Changed:\nThis now reverts https://github.com/bitcoin/bitcoin/commit/b823a4c9f6836c802803dbd265cb7451fb93b8e7 and adds the identical simple fix for the static wallet name.",https://github.com/bitcoin/bitcoin/pull/10457#issuecomment-307906379,307906379,
ryanofsky,2017-06-12T20:24:06Z,"PR title and summary are misleading because now this PR only does code cleanup without actually changing the filename.\n\nAlso, I prefer b823a4c9f6836c802803dbd265cb7451fb93b8e7 to this PR, because it prints a more meaningful log message, and I don't think it is a big deal that the recover function now takes 2 arguments instead of 1.\n\nI think if you wanted to clean up this code, you would ju",https://github.com/bitcoin/bitcoin/pull/10457#issuecomment-307913308,307913308,
jnewbery,2017-06-14T17:49:03Z,Tested ACK e9d09f23e3a097605730988f2dcb818a57dee745. I think this is definitely an improvement.,https://github.com/bitcoin/bitcoin/pull/10457#issuecomment-308507768,308507768,
ryanofsky,2017-07-26T07:32:00Z,"PR description and title are misleading and need to be updated (especially now that PR description will go into git history) to say this is only changing the `Wallet file corrupt, data salvaged!` error message (by removing the recovered filename), and making a slight code simplification.\n\nThis PR is **not** fixing any current bug. It's just temporarily reintroducing a bug that was fixed a whil",https://github.com/bitcoin/bitcoin/pull/10457#issuecomment-317972915,317972915,
luke-jr,2017-07-26T09:02:38Z,"I think it's better to show the actual filename, but so long as this is refactored cleanly (ie, keep the typedef), I don't care to argue against it.",https://github.com/bitcoin/bitcoin/pull/10457#issuecomment-317994128,317994128,
jnewbery,2017-07-26T09:20:06Z,I'm marginally for this change because it's a worthwhile simplification to not pass the wallet name around simply for printing in an error message. I agree with @ryanofsky that PR comment should be changed and commits squashed.,https://github.com/bitcoin/bitcoin/pull/10457#issuecomment-317998410,317998410,
laanwj,2017-10-02T13:25:35Z,"Closing this for now. I think the change in itself is worthwhile, but the diff itself seems to be controversial, the PR seems to be abandoned for a while, and it seems low priority.",https://github.com/bitcoin/bitcoin/pull/10457#issuecomment-333533356,333533356,
luke-jr,2017-06-14T18:51:10Z,"Why show a filename at all, if it's not even going to tell you which one?",https://github.com/bitcoin/bitcoin/pull/10457#discussion_r122034298,122034298,src/wallet/db.cpp
jonasschnelli,2017-06-30T08:19:43Z,I think it won't hurt. But no strong opinion.,https://github.com/bitcoin/bitcoin/pull/10457#discussion_r124987003,124987003,src/wallet/db.cpp
laanwj,2017-07-26T06:52:08Z,"Not sure what the state of this PR is, but I just saw this change: isn't it clearer to define a type here, instead of make the function type definition in-line in the parameter definition?",https://github.com/bitcoin/bitcoin/pull/10457#discussion_r129493131,129493131,src/wallet/db.h
laanwj,2017-07-26T08:24:33Z,"And maybe use a std::function, that's more c++11 than a function pointer.",https://github.com/bitcoin/bitcoin/pull/10457#discussion_r129509331,129509331,src/wallet/db.h
