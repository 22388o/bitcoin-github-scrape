[
  {
    "sha": "182dbdf0f4b6e6484b0d4588aaefacc75862a99c",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxODJkYmRmMGY0YjZlNjQ4NGIwZDQ1ODhhYWVmYWNjNzU4NjJhOTlj",
    "commit": {
      "author": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2020-03-26T09:59:46Z"
      },
      "committer": {
        "name": "Vasil Dimov",
        "email": "vd@FreeBSD.org",
        "date": "2020-04-14T07:49:45Z"
      },
      "message": "util: Detect posix_fallocate() instead of assuming\n\nDon't assume that `posix_fallocate()` is available on Linux and not\navailable on other operating systems. At least FreeBSD has it and we\nare not using it.\n\nProperly check whether `posix_fallocate()` is present and use it if it\nis.",
      "tree": {
        "sha": "4e4a612a329ed8a3af42bb789c824474cf678ec5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/4e4a612a329ed8a3af42bb789c824474cf678ec5"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/182dbdf0f4b6e6484b0d4588aaefacc75862a99c",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQQzBAABCAAdFiEE5k2NRWFNsHVF2czBVN8G9ktVy78FAl6VaxoACgkQVN8G9ktV\ny79SrSAAhjY9Aw9U414PeRgRls78AttbeKGiCt3I1tUBow6nMzF/ViBZdWZXdYaV\nxjmAA6xoSIgmViMxGEQQKM1zwboBEBkOn2xoGQyTRMhiL1oR7+xoOZjSBIZ8W8rU\n9LT81LxxuMfk30OOGfiHooFFqkPFgeHjZV+AAoa4ksBZapJ5gyLYJgeWyjkmifVH\n19fyIy029H8qizA0IFVD/LOlH9al87tH2DScOSo05auPB/QOetVnDI2EG+Bm8nkE\n1IzRbxoaq0boqo9ad4nm/91Td3U3e0X1bByIetl7yyA3SA6wMjrU8o+b4tUVg1Yh\nE1J2vfpY0vXSp6MwCX+vBlw9evhqNlbkuZB8R6R0JHxKjKJRCXj/U8K+R1akvYkc\nN/QdFM7KUIHpnfgPS2ElMoCEgKIR8ehO9FJ57BUCP5qpfaCjxQp+iKbk6wBQ5e4u\nyU5zZ8eNyKGPSWtfxe9iE2Ba+KeVrcmvsIVZ0UAp7iw1nQ6EazhwulsBVusegoc7\nG9PAEOhhU4WgxJT6IoBa78ZTrmvXlBk67cGkkS1t5NUIpfcpEmg4TVOrg20kpC4T\nHEcvot3BzFyfsyiCa4rJUEkAIjNRO0Tz/sv5E70iZoPxA1sZV5vdE2/T33HyUn2d\ntbsCoJDCpkUCE3lEYFFKWTqx5QKKXLJNbd8XGmFNBdoVZcATr9zCR4DwmdgujoTK\nGjybacnBmkYYGkBfXGGgMt18jWR3k1TzQZAkKai4w4iSUHo3Qve2LFckSYp60/k9\nR3kF7oBBDn9VSh0Nn58OX2r7aj0+a2csjzbQ4A4ae9j3cKw5dYWHB//wBr9/wrSn\nirAtnKSKBIZN8HqdGXkAsrtiMMy569ckM+Z30eCHX2gkBJj5f0KD2NIsEiqzJqRo\nh3jHbX/mls7dXQeVgVTNyB6FUq0Zf7cHiOYPLLenin6qfb9vUrXceQctEbnwueQr\nFamG9V9dmky601HoJ7x6cXc5QXyBJI/qw5A4kaiQvn7ycJrdqm7nyezU+Ot/Gkt2\nJC5FqyIbEve1/xbGlmHzR5QzXjeRxVwiYtAihK4f85eVcj1fqtuhypeqK+yEZdR6\nwGWR2ZFYlcaTwjvxBs4DdUf+AN2W0rL7pf3OZqT012aDWpjg83SK6D/8AFE6NUTT\nXOyM3P626ZhsRhd34Ig541RSNaGtI3zrHFTF1WFmELM0koQX3yi+RESg7TcrIuWk\nIhIVbjsjkdwt0hjoONvg/Z1IeoJ9OV/iXDOekR3NCjSb4ERPCphqDCZ6ICzYWZz9\nHa6AUdr2rKudWw2Y5H+ZjdmXTlmqTnnaV5e2q8zH2G0fQ7BcY4+yilxud45j+sTl\nnfOpwTIhm0shLmA0aGtjnDW5kP0nlw==\n=xj+D\n-----END PGP SIGNATURE-----",
        "payload": "tree 4e4a612a329ed8a3af42bb789c824474cf678ec5\nparent 7eed413e72a236b6f1475a198f7063fd24929e23\nauthor Vasil Dimov <vd@FreeBSD.org> 1585216786 +0100\ncommitter Vasil Dimov <vd@FreeBSD.org> 1586850585 +0200\n\nutil: Detect posix_fallocate() instead of assuming\n\nDon't assume that `posix_fallocate()` is available on Linux and not\navailable on other operating systems. At least FreeBSD has it and we\nare not using it.\n\nProperly check whether `posix_fallocate()` is present and use it if it\nis.\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/182dbdf0f4b6e6484b0d4588aaefacc75862a99c",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/182dbdf0f4b6e6484b0d4588aaefacc75862a99c",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/182dbdf0f4b6e6484b0d4588aaefacc75862a99c/comments",
    "author": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "vasild",
      "id": 266751,
      "node_id": "MDQ6VXNlcjI2Njc1MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/266751?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vasild",
      "html_url": "https://github.com/vasild",
      "followers_url": "https://api.github.com/users/vasild/followers",
      "following_url": "https://api.github.com/users/vasild/following{/other_user}",
      "gists_url": "https://api.github.com/users/vasild/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vasild/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vasild/subscriptions",
      "organizations_url": "https://api.github.com/users/vasild/orgs",
      "repos_url": "https://api.github.com/users/vasild/repos",
      "events_url": "https://api.github.com/users/vasild/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vasild/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "7eed413e72a236b6f1475a198f7063fd24929e23",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7eed413e72a236b6f1475a198f7063fd24929e23",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/7eed413e72a236b6f1475a198f7063fd24929e23"
      }
    ],
    "stats": {
      "total": 20,
      "additions": 18,
      "deletions": 2
    },
    "files": [
      {
        "sha": "c8984c83c373a6571804d1a6f9d102c383dbbb29",
        "filename": "configure.ac",
        "status": "modified",
        "additions": 16,
        "deletions": 0,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/182dbdf0f4b6e6484b0d4588aaefacc75862a99c/configure.ac",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/182dbdf0f4b6e6484b0d4588aaefacc75862a99c/configure.ac",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/configure.ac?ref=182dbdf0f4b6e6484b0d4588aaefacc75862a99c",
        "patch": "@@ -851,6 +851,22 @@ AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[#include <malloc.h>]],\n  [ AC_MSG_RESULT(no)]\n )\n \n+dnl Check for posix_fallocate\n+AC_MSG_CHECKING(for posix_fallocate)\n+AC_COMPILE_IFELSE([AC_LANG_PROGRAM([[\n+                   // same as in src/util/system.cpp\n+                   #ifdef __linux__\n+                   #ifdef _POSIX_C_SOURCE\n+                   #undef _POSIX_C_SOURCE\n+                   #endif\n+                   #define _POSIX_C_SOURCE 200112L\n+                   #endif // __linux__\n+                   #include <fcntl.h>]],\n+                   [[ int f = posix_fallocate(0, 0, 0); ]])],\n+ [ AC_MSG_RESULT(yes); AC_DEFINE(HAVE_POSIX_FALLOCATE, 1,[Define this symbol if you have posix_fallocate]) ],\n+ [ AC_MSG_RESULT(no)]\n+)\n+\n AC_MSG_CHECKING([for visibility attribute])\n AC_LINK_IFELSE([AC_LANG_SOURCE([\n   int foo_def( void ) __attribute__((visibility(\"default\")));"
      },
      {
        "sha": "b4df0680af997f0a598e06e7f27f905f0155af7b",
        "filename": "src/util/system.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 2,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/182dbdf0f4b6e6484b0d4588aaefacc75862a99c/src/util/system.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/182dbdf0f4b6e6484b0d4588aaefacc75862a99c/src/util/system.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util/system.cpp?ref=182dbdf0f4b6e6484b0d4588aaefacc75862a99c",
        "patch": "@@ -17,7 +17,7 @@\n #endif\n \n #ifndef WIN32\n-// for posix_fallocate\n+// for posix_fallocate, in configure.ac we check if it is present after this\n #ifdef __linux__\n \n #ifdef _POSIX_C_SOURCE\n@@ -1012,7 +1012,7 @@ void AllocateFileRange(FILE *file, unsigned int offset, unsigned int length) {\n     }\n     ftruncate(fileno(file), static_cast<off_t>(offset) + length);\n #else\n-    #if defined(__linux__)\n+    #if defined(HAVE_POSIX_FALLOCATE)\n     // Version using posix_fallocate\n     off_t nEndPos = (off_t)offset + length;\n     if (0 == posix_fallocate(fileno(file), 0, nEndPos)) return;"
      }
    ]
  }
]