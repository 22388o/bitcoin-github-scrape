[
  {
    "sha": "654472a461bc9d1603c46dcb7a5b2dc87a44045a",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2NTQ0NzJhNDYxYmM5ZDE2MDNjNDZkY2I3YTViMmRjODdhNDQwNDVh",
    "commit": {
      "author": {
        "name": "Dhruv Mehta",
        "email": "856960+dhruv@users.noreply.github.com",
        "date": "2021-05-23T15:10:25Z"
      },
      "committer": {
        "name": "Dhruv Mehta",
        "email": "856960+dhruv@users.noreply.github.com",
        "date": "2021-05-25T15:08:34Z"
      },
      "message": "[fuzz] Add serialization to deserialization test\n\nBefore commit:\n306853\tREDUCE cov: 798 ft: 5820 corp: 150/375Kb lim: 68333 exec/s: 1382 rss: 461Mb L: 254/63171 MS: 1 EraseBytes-\n1453105\tREDUCE cov: 798 ft: 5820 corp: 150/369Kb lim: 79613 exec/s: 1467 rss: 461Mb L: 6027/60873 MS: 1 EraseBytes-\n\nAfter commit:\n303389\tNEW    cov: 1202 ft: 8382 corp: 157/382Kb lim: 68189 exec/s: 1451 rss: 447Mb L: 1386/65459 MS: 1 CopyPart-\n1428759\tREDUCE cov: 1202 ft: 8512 corp: 169/389Kb lim: 78749 exec/s: 1528 rss: 463Mb L: 1627/60488 MS: 1 EraseBytes-",
      "tree": {
        "sha": "9f764382d46ccb2a843b3af25a94ea2e905779d6",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9f764382d46ccb2a843b3af25a94ea2e905779d6"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/654472a461bc9d1603c46dcb7a5b2dc87a44045a",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/654472a461bc9d1603c46dcb7a5b2dc87a44045a",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/654472a461bc9d1603c46dcb7a5b2dc87a44045a",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/654472a461bc9d1603c46dcb7a5b2dc87a44045a/comments",
    "author": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "be4171679b8eab8205e04ff86140329bd67878a0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/be4171679b8eab8205e04ff86140329bd67878a0",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/be4171679b8eab8205e04ff86140329bd67878a0"
      }
    ],
    "stats": {
      "total": 12,
      "additions": 9,
      "deletions": 3
    },
    "files": [
      {
        "sha": "35bff51438b6597603b636113fcfc04f34a1d6fe",
        "filename": "src/Makefile.test.include",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/654472a461bc9d1603c46dcb7a5b2dc87a44045a/src/Makefile.test.include",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/654472a461bc9d1603c46dcb7a5b2dc87a44045a/src/Makefile.test.include",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/Makefile.test.include?ref=654472a461bc9d1603c46dcb7a5b2dc87a44045a",
        "patch": "@@ -257,7 +257,7 @@ test_fuzz_fuzz_SOURCES = \\\n  test/fuzz/netaddress.cpp \\\n  test/fuzz/netbase_dns_lookup.cpp \\\n  test/fuzz/node_eviction.cpp \\\n- test/fuzz/p2p_transport_deserializer.cpp \\\n+ test/fuzz/p2p_transport_serialization.cpp \\\n  test/fuzz/parse_hd_keypath.cpp \\\n  test/fuzz/parse_iso8601.cpp \\\n  test/fuzz/parse_numbers.cpp \\"
      },
      {
        "sha": "2618a2a3986d8f541ba47b1abbeed638bfd876eb",
        "filename": "src/test/fuzz/p2p_transport_serialization.cpp",
        "status": "renamed",
        "additions": 8,
        "deletions": 2,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/654472a461bc9d1603c46dcb7a5b2dc87a44045a/src/test/fuzz/p2p_transport_serialization.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/654472a461bc9d1603c46dcb7a5b2dc87a44045a/src/test/fuzz/p2p_transport_serialization.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/p2p_transport_serialization.cpp?ref=654472a461bc9d1603c46dcb7a5b2dc87a44045a",
        "patch": "@@ -4,6 +4,7 @@\n \n #include <chainparams.h>\n #include <net.h>\n+#include <netmessagemaker.h>\n #include <protocol.h>\n #include <test/fuzz/fuzz.h>\n \n@@ -13,15 +14,16 @@\n #include <optional>\n #include <vector>\n \n-void initialize_p2p_transport_deserializer()\n+void initialize_p2p_transport_serialization()\n {\n     SelectParams(CBaseChainParams::REGTEST);\n }\n \n-FUZZ_TARGET_INIT(p2p_transport_deserializer, initialize_p2p_transport_deserializer)\n+FUZZ_TARGET_INIT(p2p_transport_serialization, initialize_p2p_transport_serialization)\n {\n     // Construct deserializer, with a dummy NodeId\n     V1TransportDeserializer deserializer{Params(), (NodeId)0, SER_NETWORK, INIT_PROTO_VERSION};\n+    V1TransportSerializer serializer{};\n     Span<const uint8_t> msg_bytes{buffer};\n     while (msg_bytes.size() > 0) {\n         const int handled = deserializer.Read(msg_bytes);\n@@ -37,6 +39,10 @@ FUZZ_TARGET_INIT(p2p_transport_deserializer, initialize_p2p_transport_deserializ\n                 assert(result->m_raw_message_size <= buffer.size());\n                 assert(result->m_raw_message_size == CMessageHeader::HEADER_SIZE + result->m_message_size);\n                 assert(result->m_time == m_time);\n+\n+                std::vector<unsigned char> header;\n+                auto msg = CNetMsgMaker{result->m_recv.GetVersion()}.Make(result->m_command, MakeUCharSpan(result->m_recv));\n+                serializer.prepareForTransport(msg, header);\n             }\n         }\n     }",
        "previous_filename": "src/test/fuzz/p2p_transport_deserializer.cpp"
      }
    ]
  },
  {
    "sha": "35571d8d9ec112bd7b6741d10052dded08410c77",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozNTU3MWQ4ZDllYzExMmJkN2I2NzQxZDEwMDUyZGRlZDA4NDEwYzc3",
    "commit": {
      "author": {
        "name": "Dhruv Mehta",
        "email": "856960+dhruv@users.noreply.github.com",
        "date": "2021-05-25T03:11:44Z"
      },
      "committer": {
        "name": "Dhruv Mehta",
        "email": "856960+dhruv@users.noreply.github.com",
        "date": "2021-05-25T15:09:14Z"
      },
      "message": "[fuzz] Occasional valid checksum for transport serialization fuzz test\n\nBefore commit:\nUnable to deserialize: 0%\nWrong message start  : ~1.27%\nHeader too large     : ~0.5%\nWrong checksum       : ~67.99%\nInvalid message type : ~30.1%\n\n303389\tNEW    cov: 1202 ft: 8382 corp: 157/382Kb lim: 68189 exec/s: 1451 rss: 447Mb L: 1386/65459 MS: 1 CopyPart-\n1428759\tREDUCE cov: 1202 ft: 8512 corp: 169/389Kb lim: 78749 exec/s: 1528 rss: 463Mb L: 1627/60488 MS: 1 EraseBytes-\n\nAfter commit(new seeds; old seeds invalidated):\nUnable to deserialize: 0%\nWrong message start  : ~45.62%\nHeader too large     : ~14.5%\nWrong checksum       : ~38.13%\nInvalid message type : ~1.78%\n\n304820\tNEW    cov: 1440 ft: 4452 corp: 92/12551b lim: 2237 exec/s: 3386 rss: 486Mb L: 47/1111 MS: 1 ChangeByte-\n1416181\tREDUCE cov: 1442 ft: 5681 corp: 125/59Kb lim: 4096 exec/s: 3522 rss: 535Mb L: 2164/4049 MS: 1 EraseBytes-",
      "tree": {
        "sha": "9df9a1271d3c3bb4dffd44eb0f4325d5f402ed3b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/9df9a1271d3c3bb4dffd44eb0f4325d5f402ed3b"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/35571d8d9ec112bd7b6741d10052dded08410c77",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/35571d8d9ec112bd7b6741d10052dded08410c77",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/35571d8d9ec112bd7b6741d10052dded08410c77",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/35571d8d9ec112bd7b6741d10052dded08410c77/comments",
    "author": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "654472a461bc9d1603c46dcb7a5b2dc87a44045a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/654472a461bc9d1603c46dcb7a5b2dc87a44045a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/654472a461bc9d1603c46dcb7a5b2dc87a44045a"
      }
    ],
    "stats": {
      "total": 24,
      "additions": 22,
      "deletions": 2
    },
    "files": [
      {
        "sha": "c29d8e70396d4213b5b05319ab7a4b58eb056b50",
        "filename": "src/test/fuzz/p2p_transport_serialization.cpp",
        "status": "modified",
        "additions": 22,
        "deletions": 2,
        "changes": 24,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/35571d8d9ec112bd7b6741d10052dded08410c77/src/test/fuzz/p2p_transport_serialization.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/35571d8d9ec112bd7b6741d10052dded08410c77/src/test/fuzz/p2p_transport_serialization.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/p2p_transport_serialization.cpp?ref=35571d8d9ec112bd7b6741d10052dded08410c77",
        "patch": "@@ -3,9 +3,11 @@\n // file COPYING or http://www.opensource.org/licenses/mit-license.php.\n \n #include <chainparams.h>\n+#include <hash.h>\n #include <net.h>\n #include <netmessagemaker.h>\n #include <protocol.h>\n+#include <test/fuzz/FuzzedDataProvider.h>\n #include <test/fuzz/fuzz.h>\n \n #include <cassert>\n@@ -24,7 +26,25 @@ FUZZ_TARGET_INIT(p2p_transport_serialization, initialize_p2p_transport_serializa\n     // Construct deserializer, with a dummy NodeId\n     V1TransportDeserializer deserializer{Params(), (NodeId)0, SER_NETWORK, INIT_PROTO_VERSION};\n     V1TransportSerializer serializer{};\n-    Span<const uint8_t> msg_bytes{buffer};\n+    FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n+\n+    auto checksum_assist = fuzzed_data_provider.ConsumeBool();\n+    int header_random_bytes_count = checksum_assist ? CMessageHeader::CHECKSUM_OFFSET : CMessageHeader :: HEADER_SIZE;\n+    auto mutable_msg_bytes = fuzzed_data_provider.ConsumeBytes<uint8_t>(header_random_bytes_count);\n+    auto payload_bytes = fuzzed_data_provider.ConsumeRemainingBytes<uint8_t>();\n+\n+    if (checksum_assist && mutable_msg_bytes.size() == CMessageHeader::CHECKSUM_OFFSET) {\n+        CHash256 hasher;\n+        unsigned char hsh[32];\n+        hasher.Write(payload_bytes);\n+        hasher.Finalize(hsh);\n+        for (size_t i = 0; i < CMessageHeader::CHECKSUM_SIZE; ++i) {\n+           mutable_msg_bytes.push_back(hsh[i]);\n+        }\n+    }\n+\n+    mutable_msg_bytes.insert(mutable_msg_bytes.end(), payload_bytes.begin(), payload_bytes.end());\n+    Span<const uint8_t> msg_bytes{mutable_msg_bytes};\n     while (msg_bytes.size() > 0) {\n         const int handled = deserializer.Read(msg_bytes);\n         if (handled < 0) {\n@@ -36,7 +56,7 @@ FUZZ_TARGET_INIT(p2p_transport_serialization, initialize_p2p_transport_serializa\n             std::optional<CNetMessage> result{deserializer.GetMessage(m_time, out_err_raw_size)};\n             if (result) {\n                 assert(result->m_command.size() <= CMessageHeader::COMMAND_SIZE);\n-                assert(result->m_raw_message_size <= buffer.size());\n+                assert(result->m_raw_message_size <= mutable_msg_bytes.size());\n                 assert(result->m_raw_message_size == CMessageHeader::HEADER_SIZE + result->m_message_size);\n                 assert(result->m_time == m_time);\n "
      }
    ]
  },
  {
    "sha": "e33714557747dd479f123425aa2dd08d272ef377",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzplMzM3MTQ1NTc3NDdkZDQ3OWYxMjM0MjVhYTJkZDA4ZDI3MmVmMzc3",
    "commit": {
      "author": {
        "name": "Dhruv Mehta",
        "email": "856960+dhruv@users.noreply.github.com",
        "date": "2021-05-25T05:14:23Z"
      },
      "committer": {
        "name": "Dhruv Mehta",
        "email": "856960+dhruv@users.noreply.github.com",
        "date": "2021-05-25T15:20:43Z"
      },
      "message": "[fuzz] Occasional valid magic bytes for transport serialization test\n\nBefore commit:\nUnable to deserialize : 0%\nWrong message start   : ~45.62%\nHeader too large      : ~14.5%\nWrong checksum        : ~38.13%\nInvalid message type  : ~1.78%\n\n304820\tNEW    cov: 1440 ft: 4452 corp: 92/12551b lim: 2237 exec/s: 3386 rss: 486Mb L: 47/1111 MS: 1 ChangeByte-\n1416181\tREDUCE cov: 1442 ft: 5681 corp: 125/59Kb lim: 4096 exec/s: 3522 rss: 535Mb L: 2164/4049 MS: 1 EraseBytes-\n\nAfter commit:\nUnable to deserialize : 0%\nWrong message start   : ~39.6%\nHeader too large      : ~30.85%\nWrong checksum        : ~25.54%\nInvalid message type  : ~4.01%\n\n302684\tNEW    cov: 1454 ft: 3936 corp: 84/7056b lim: 2424 exec/s: 4146 rss: 477Mb L: 65/1108 MS: 3 CopyPart-CrossOver-CMP- DE: \"\\x0e\\x00\\x00\\x00\"-\n1383925\tREDUCE cov: 1454 ft: 4828 corp: 102/14573b lim: 4096 exec/s: 3954 rss: 534Mb L: 116/4050 MS: 2 EraseBytes-ChangeByte-",
      "tree": {
        "sha": "a45b10677369691609e19b99297ee129f37a29d5",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a45b10677369691609e19b99297ee129f37a29d5"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/e33714557747dd479f123425aa2dd08d272ef377",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e33714557747dd479f123425aa2dd08d272ef377",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/e33714557747dd479f123425aa2dd08d272ef377",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e33714557747dd479f123425aa2dd08d272ef377/comments",
    "author": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "dhruv",
      "id": 856960,
      "node_id": "MDQ6VXNlcjg1Njk2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/856960?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhruv",
      "html_url": "https://github.com/dhruv",
      "followers_url": "https://api.github.com/users/dhruv/followers",
      "following_url": "https://api.github.com/users/dhruv/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhruv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhruv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhruv/subscriptions",
      "organizations_url": "https://api.github.com/users/dhruv/orgs",
      "repos_url": "https://api.github.com/users/dhruv/repos",
      "events_url": "https://api.github.com/users/dhruv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhruv/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "35571d8d9ec112bd7b6741d10052dded08410c77",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/35571d8d9ec112bd7b6741d10052dded08410c77",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/35571d8d9ec112bd7b6741d10052dded08410c77"
      }
    ],
    "stats": {
      "total": 20,
      "additions": 18,
      "deletions": 2
    },
    "files": [
      {
        "sha": "edee5aeef73df49fb0bb8f989b9f80d5d143013a",
        "filename": "src/test/fuzz/p2p_transport_serialization.cpp",
        "status": "modified",
        "additions": 18,
        "deletions": 2,
        "changes": 20,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/e33714557747dd479f123425aa2dd08d272ef377/src/test/fuzz/p2p_transport_serialization.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/e33714557747dd479f123425aa2dd08d272ef377/src/test/fuzz/p2p_transport_serialization.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/test/fuzz/p2p_transport_serialization.cpp?ref=e33714557747dd479f123425aa2dd08d272ef377",
        "patch": "@@ -29,8 +29,24 @@ FUZZ_TARGET_INIT(p2p_transport_serialization, initialize_p2p_transport_serializa\n     FuzzedDataProvider fuzzed_data_provider{buffer.data(), buffer.size()};\n \n     auto checksum_assist = fuzzed_data_provider.ConsumeBool();\n-    int header_random_bytes_count = checksum_assist ? CMessageHeader::CHECKSUM_OFFSET : CMessageHeader :: HEADER_SIZE;\n-    auto mutable_msg_bytes = fuzzed_data_provider.ConsumeBytes<uint8_t>(header_random_bytes_count);\n+    auto magic_bytes_assist = fuzzed_data_provider.ConsumeBool();\n+    std::vector<uint8_t> mutable_msg_bytes;\n+\n+    auto header_bytes_remaining = CMessageHeader::HEADER_SIZE;\n+    if (magic_bytes_assist) {\n+        auto msg_start = Params().MessageStart();\n+        for (size_t i = 0; i < CMessageHeader::MESSAGE_SIZE_SIZE; ++i) {\n+            mutable_msg_bytes.push_back(msg_start[i]);\n+        }\n+        header_bytes_remaining -= CMessageHeader::MESSAGE_SIZE_SIZE;\n+    }\n+\n+    if (checksum_assist) {\n+        header_bytes_remaining -= CMessageHeader::CHECKSUM_SIZE;\n+    }\n+\n+    auto header_random_bytes = fuzzed_data_provider.ConsumeBytes<uint8_t>(header_bytes_remaining);\n+    mutable_msg_bytes.insert(mutable_msg_bytes.end(), header_random_bytes.begin(), header_random_bytes.end());\n     auto payload_bytes = fuzzed_data_provider.ConsumeRemainingBytes<uint8_t>();\n \n     if (checksum_assist && mutable_msg_bytes.size() == CMessageHeader::CHECKSUM_OFFSET) {"
      }
    ]
  }
]