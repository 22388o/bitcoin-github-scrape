[
  {
    "sha": "380c843217139b180457889699c65b37ae3b4a87",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozODBjODQzMjE3MTM5YjE4MDQ1Nzg4OTY5OWM2NWIzN2FlM2I0YTg3",
    "commit": {
      "author": {
        "name": "Chun Kuan Lee",
        "email": "ken2812221@gmail.com",
        "date": "2018-08-05T16:38:25Z"
      },
      "committer": {
        "name": "Chun Kuan Lee",
        "email": "ken2812221@gmail.com",
        "date": "2018-09-30T07:08:16Z"
      },
      "message": "utils: Convert Windows args to utf-8 string",
      "tree": {
        "sha": "14f563548a07e34860364c8046e83ef8671730a9",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/14f563548a07e34860364c8046e83ef8671730a9"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/380c843217139b180457889699c65b37ae3b4a87",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/380c843217139b180457889699c65b37ae3b4a87",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/380c843217139b180457889699c65b37ae3b4a87",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/380c843217139b180457889699c65b37ae3b4a87/comments",
    "author": {
      "login": "ken2812221",
      "id": 11154118,
      "node_id": "MDQ6VXNlcjExMTU0MTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/11154118?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ken2812221",
      "html_url": "https://github.com/ken2812221",
      "followers_url": "https://api.github.com/users/ken2812221/followers",
      "following_url": "https://api.github.com/users/ken2812221/following{/other_user}",
      "gists_url": "https://api.github.com/users/ken2812221/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ken2812221/subscriptions",
      "organizations_url": "https://api.github.com/users/ken2812221/orgs",
      "repos_url": "https://api.github.com/users/ken2812221/repos",
      "events_url": "https://api.github.com/users/ken2812221/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ken2812221/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "ken2812221",
      "id": 11154118,
      "node_id": "MDQ6VXNlcjExMTU0MTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/11154118?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ken2812221",
      "html_url": "https://github.com/ken2812221",
      "followers_url": "https://api.github.com/users/ken2812221/followers",
      "following_url": "https://api.github.com/users/ken2812221/following{/other_user}",
      "gists_url": "https://api.github.com/users/ken2812221/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ken2812221/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ken2812221/subscriptions",
      "organizations_url": "https://api.github.com/users/ken2812221/orgs",
      "repos_url": "https://api.github.com/users/ken2812221/repos",
      "events_url": "https://api.github.com/users/ken2812221/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ken2812221/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "9b8bb5f1402a07736be7d649c2253253672d04e1",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/9b8bb5f1402a07736be7d649c2253253672d04e1",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/9b8bb5f1402a07736be7d649c2253253672d04e1"
      }
    ],
    "stats": {
      "total": 63,
      "additions": 62,
      "deletions": 1
    },
    "files": [
      {
        "sha": "f46650511426e925aeff46c0c2440ab0c62f0410",
        "filename": "src/bitcoin-cli.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 0,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/380c843217139b180457889699c65b37ae3b4a87/src/bitcoin-cli.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/380c843217139b180457889699c65b37ae3b4a87/src/bitcoin-cli.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoin-cli.cpp?ref=380c843217139b180457889699c65b37ae3b4a87",
        "patch": "@@ -17,6 +17,7 @@\n \n #include <memory>\n #include <stdio.h>\n+#include <tuple>\n \n #include <event2/buffer.h>\n #include <event2/keyvalq_struct.h>\n@@ -511,6 +512,10 @@ static int CommandLineRPC(int argc, char *argv[])\n \n int main(int argc, char* argv[])\n {\n+#ifdef WIN32\n+    util::WinCmdLineArgs winArgs;\n+    std::tie(argc, argv) = winArgs.get();\n+#endif\n     SetupEnvironment();\n     if (!SetupNetworking()) {\n         fprintf(stderr, \"Error: Initializing networking failed\\n\");"
      },
      {
        "sha": "18fcd9bc2a9701035ab6b4ce529e430d3188a0f9",
        "filename": "src/bitcoind.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/380c843217139b180457889699c65b37ae3b4a87/src/bitcoind.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/380c843217139b180457889699c65b37ae3b4a87/src/bitcoind.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/bitcoind.cpp?ref=380c843217139b180457889699c65b37ae3b4a87",
        "patch": "@@ -185,6 +185,10 @@ static bool AppInit(int argc, char* argv[])\n \n int main(int argc, char* argv[])\n {\n+#ifdef WIN32\n+    util::WinCmdLineArgs winArgs;\n+    std::tie(argc, argv) = winArgs.get();\n+#endif\n     SetupEnvironment();\n \n     // Connect bitcoind signal handlers"
      },
      {
        "sha": "61a9f390e92bd63ac45a90b33a4f3536edb9f473",
        "filename": "src/qt/bitcoin.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/380c843217139b180457889699c65b37ae3b4a87/src/qt/bitcoin.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/380c843217139b180457889699c65b37ae3b4a87/src/qt/bitcoin.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/qt/bitcoin.cpp?ref=380c843217139b180457889699c65b37ae3b4a87",
        "patch": "@@ -552,6 +552,10 @@ static void SetupUIArgs()\n #ifndef BITCOIN_QT_TEST\n int main(int argc, char *argv[])\n {\n+#ifdef WIN32\n+    util::WinCmdLineArgs winArgs;\n+    std::tie(argc, argv) = winArgs.get();\n+#endif\n     SetupEnvironment();\n \n     std::unique_ptr<interfaces::Node> node = interfaces::MakeNode();"
      },
      {
        "sha": "100230290476426691440e45a42b4fed15ed1a32",
        "filename": "src/util.cpp",
        "status": "modified",
        "additions": 32,
        "deletions": 0,
        "changes": 32,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/380c843217139b180457889699c65b37ae3b4a87/src/util.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/380c843217139b180457889699c65b37ae3b4a87/src/util.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util.cpp?ref=380c843217139b180457889699c65b37ae3b4a87",
        "patch": "@@ -61,6 +61,7 @@\n #include <codecvt>\n \n #include <io.h> /* for _commit */\n+#include <shellapi.h>\n #include <shlobj.h>\n #endif\n \n@@ -1200,6 +1201,10 @@ void SetupEnvironment()\n     } catch (const std::runtime_error&) {\n         setenv(\"LC_ALL\", \"C\", 1);\n     }\n+#elif defined(WIN32)\n+    // Set the default input/output charset is utf-8\n+    SetConsoleCP(CP_UTF8);\n+    SetConsoleOutputCP(CP_UTF8);\n #endif\n     // The path locale is lazy initialized and to avoid deinitialization errors\n     // in multithreading environments, it is set explicitly by the main thread.\n@@ -1265,3 +1270,30 @@ int ScheduleBatchPriority()\n     return 1;\n #endif\n }\n+\n+namespace util {\n+#ifdef WIN32\n+WinCmdLineArgs::WinCmdLineArgs()\n+{\n+    wchar_t** wargv = CommandLineToArgvW(GetCommandLineW(), &argc);\n+    std::wstring_convert<std::codecvt_utf8_utf16<wchar_t>, wchar_t> utf8_cvt;\n+    argv = new char*[argc];\n+    args.resize(argc);\n+    for (int i = 0; i < argc; i++) {\n+        args[i] = utf8_cvt.to_bytes(wargv[i]);\n+        argv[i] = &*args[i].begin();\n+    }\n+    LocalFree(wargv);\n+}\n+\n+WinCmdLineArgs::~WinCmdLineArgs()\n+{\n+    delete[] argv;\n+}\n+\n+std::pair<int, char**> WinCmdLineArgs::get()\n+{\n+    return std::make_pair(argc, argv);\n+}\n+#endif\n+} // namespace util"
      },
      {
        "sha": "fa6d2cd4891c0881dcd77c9413472dad30211c8f",
        "filename": "src/util.h",
        "status": "modified",
        "additions": 16,
        "deletions": 0,
        "changes": 16,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/380c843217139b180457889699c65b37ae3b4a87/src/util.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/380c843217139b180457889699c65b37ae3b4a87/src/util.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util.h?ref=380c843217139b180457889699c65b37ae3b4a87",
        "patch": "@@ -29,6 +29,7 @@\n #include <stdint.h>\n #include <string>\n #include <unordered_set>\n+#include <utility>\n #include <vector>\n \n #include <boost/thread/condition_variable.hpp> // for boost::thread_interrupted\n@@ -361,6 +362,21 @@ inline void insert(std::set<TsetT>& dst, const Tsrc& src) {\n     dst.insert(src.begin(), src.end());\n }\n \n+#ifdef WIN32\n+class WinCmdLineArgs\n+{\n+public:\n+    WinCmdLineArgs();\n+    ~WinCmdLineArgs();\n+    std::pair<int, char**> get();\n+\n+private:\n+    int argc;\n+    char** argv;\n+    std::vector<std::string> args;\n+};\n+#endif\n+\n } // namespace util\n \n #endif // BITCOIN_UTIL_H"
      },
      {
        "sha": "fb4ad213596cd891e18e7f476a528f9c1db50811",
        "filename": "test/functional/feature_uacomment.py",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/380c843217139b180457889699c65b37ae3b4a87/test/functional/feature_uacomment.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/380c843217139b180457889699c65b37ae3b4a87/test/functional/feature_uacomment.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/feature_uacomment.py?ref=380c843217139b180457889699c65b37ae3b4a87",
        "patch": "@@ -31,7 +31,7 @@ def run_test(self):\n         self.nodes[0].assert_start_raises_init_error([\"-uacomment=\" + 'a' * 256], expected, match=ErrorMatch.FULL_REGEX)\n \n         self.log.info(\"test -uacomment unsafe characters\")\n-        for unsafe_char in ['/', ':', '(', ')']:\n+        for unsafe_char in ['/', ':', '(', ')', '\u20bf', '\ud83c\udfc3']:\n             expected = \"Error: User Agent comment \\(\" + re.escape(unsafe_char) + \"\\) contains unsafe characters.\"\n             self.nodes[0].assert_start_raises_init_error([\"-uacomment=\" + unsafe_char], expected, match=ErrorMatch.FULL_REGEX)\n "
      }
    ]
  }
]