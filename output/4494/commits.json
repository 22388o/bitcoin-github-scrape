[
  {
    "sha": "bc42503f6ab304608c321986a870795e45f5a016",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpiYzQyNTAzZjZhYjMwNDYwOGMzMjE5ODZhODcwNzk1ZTQ1ZjVhMDE2",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2014-07-09T15:25:09Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2014-07-14T14:13:08Z"
      },
      "message": "Use unordered_map for CCoinsViewCache with salted hash",
      "tree": {
        "sha": "cbb104bd5010fd817a460c89b10470e8b60f9ea7",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/cbb104bd5010fd817a460c89b10470e8b60f9ea7"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/bc42503f6ab304608c321986a870795e45f5a016",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bc42503f6ab304608c321986a870795e45f5a016",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/bc42503f6ab304608c321986a870795e45f5a016",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bc42503f6ab304608c321986a870795e45f5a016/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "bdd5b587fc7fd1b4dda479c4aad15c874b22e8f3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/bdd5b587fc7fd1b4dda479c4aad15c874b22e8f3",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/bdd5b587fc7fd1b4dda479c4aad15c874b22e8f3"
      }
    ],
    "stats": {
      "total": 70,
      "additions": 66,
      "deletions": 4
    },
    "files": [
      {
        "sha": "e76d8c7ef2dc9bce7f68fec06d75725c22dc82c5",
        "filename": "src/coins.cpp",
        "status": "modified",
        "additions": 6,
        "deletions": 2,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bc42503f6ab304608c321986a870795e45f5a016/src/coins.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bc42503f6ab304608c321986a870795e45f5a016/src/coins.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/coins.cpp?ref=bc42503f6ab304608c321986a870795e45f5a016",
        "patch": "@@ -4,6 +4,8 @@\n \n #include \"coins.h\"\n \n+#include \"random.h\"\n+\n #include <assert.h>\n \n // calculate number of bytes for the bitmask, and its number of non-zero bytes\n@@ -69,6 +71,8 @@ void CCoinsViewBacked::SetBackend(CCoinsView &viewIn) { base = &viewIn; }\n bool CCoinsViewBacked::BatchWrite(const CCoinsMap &mapCoins, const uint256 &hashBlock) { return base->BatchWrite(mapCoins, hashBlock); }\n bool CCoinsViewBacked::GetStats(CCoinsStats &stats) { return base->GetStats(stats); }\n \n+CCoinsKeyHasher::CCoinsKeyHasher() : salt(GetRandHash()) {}\n+\n CCoinsViewCache::CCoinsViewCache(CCoinsView &baseIn, bool fDummy) : CCoinsViewBacked(baseIn), hashBlock(0) { }\n \n bool CCoinsViewCache::GetCoins(const uint256 &txid, CCoins &coins) {\n@@ -84,8 +88,8 @@ bool CCoinsViewCache::GetCoins(const uint256 &txid, CCoins &coins) {\n }\n \n CCoinsMap::iterator CCoinsViewCache::FetchCoins(const uint256 &txid) {\n-    CCoinsMap::iterator it = cacheCoins.lower_bound(txid);\n-    if (it != cacheCoins.end() && it->first == txid)\n+    CCoinsMap::iterator it = cacheCoins.find(txid);\n+    if (it != cacheCoins.end())\n         return it;\n     CCoins tmp;\n     if (!base->GetCoins(txid,tmp))"
      },
      {
        "sha": "9f90fe6bd03f549667efdf8d0651e2fa831c308d",
        "filename": "src/coins.h",
        "status": "modified",
        "additions": 14,
        "deletions": 1,
        "changes": 15,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bc42503f6ab304608c321986a870795e45f5a016/src/coins.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bc42503f6ab304608c321986a870795e45f5a016/src/coins.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/coins.h?ref=bc42503f6ab304608c321986a870795e45f5a016",
        "patch": "@@ -13,6 +13,7 @@\n #include <stdint.h>\n \n #include <boost/foreach.hpp>\n+#include <boost/unordered_map.hpp>\n \n /** pruned version of CTransaction: only retains metadata and unspent transaction outputs\n  *\n@@ -239,7 +240,19 @@ class CCoins\n     }\n };\n \n-typedef std::map<uint256,CCoins> CCoinsMap;\n+class CCoinsKeyHasher\n+{\n+private:\n+    uint256 salt;\n+\n+public:\n+    CCoinsKeyHasher();\n+    uint64_t operator()(const uint256& key) const {\n+        return key.GetHash(salt);\n+    }\n+};\n+\n+typedef boost::unordered_map<uint256, CCoins, CCoinsKeyHasher> CCoinsMap;\n \n struct CCoinsStats\n {"
      },
      {
        "sha": "08c05594fd974eca049944ffc44675b1c24bbdba",
        "filename": "src/uint256.cpp",
        "status": "modified",
        "additions": 43,
        "deletions": 0,
        "changes": 43,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bc42503f6ab304608c321986a870795e45f5a016/src/uint256.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bc42503f6ab304608c321986a870795e45f5a016/src/uint256.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/uint256.cpp?ref=bc42503f6ab304608c321986a870795e45f5a016",
        "patch": "@@ -290,3 +290,46 @@ uint32_t uint256::GetCompact(bool fNegative) const\n     nCompact |= (fNegative && (nCompact & 0x007fffff) ? 0x00800000 : 0);\n     return nCompact;\n }\n+\n+static void inline HashMix(uint32_t& a, uint32_t& b, uint32_t& c)\n+{\n+    // Taken from lookup3, by Bob Jenkins.\n+    a -= c; a ^= ((c <<  4) | (c >> 28)); c += b;\n+    b -= a; b ^= ((a <<  6) | (a >> 26)); a += c;\n+    c -= b; c ^= ((b <<  8) | (b >> 24)); b += a;\n+    a -= c; a ^= ((c << 16) | (c >> 16)); c += b;\n+    b -= a; b ^= ((a << 19) | (a >> 13)); a += c;\n+    c -= b; c ^= ((b <<  4) | (b >> 28)); b += a;\n+}\n+\n+static void inline HashFinal(uint32_t& a, uint32_t& b, uint32_t& c)\n+{\n+    // Taken from lookup3, by Bob Jenkins.\n+    c ^= b; c -= ((b << 14) | (b >> 18));\n+    a ^= c; a -= ((c << 11) | (c >> 21));\n+    b ^= a; b -= ((a << 25) | (a >>  7));\n+    c ^= b; c -= ((b << 16) | (b >> 16));\n+    a ^= c; a -= ((c <<  4) | (c >> 28));\n+    b ^= a; b -= ((a << 14) | (a >> 18));\n+    c ^= b; c -= ((b << 24) | (b >>  8));\n+}\n+\n+uint64_t uint256::GetHash(const uint256 &salt) const\n+{\n+    uint32_t a, b, c;\n+    a = b = c = 0xdeadbeef + (WIDTH << 2);\n+\n+    a += pn[0] ^ salt.pn[0];\n+    b += pn[1] ^ salt.pn[1];\n+    c += pn[2] ^ salt.pn[2];\n+    HashMix(a, b, c);\n+    a += pn[3] ^ salt.pn[3];\n+    b += pn[4] ^ salt.pn[4];\n+    c += pn[5] ^ salt.pn[5];\n+    HashMix(a, b, c);\n+    a += pn[6] ^ salt.pn[6];\n+    b += pn[7] ^ salt.pn[7];\n+    HashFinal(a, b, c);\n+\n+    return ((((uint64_t)b) << 32) | c);\n+}"
      },
      {
        "sha": "ad0a56f447d1a51579a5606a0790cc4e08fc600c",
        "filename": "src/uint256.h",
        "status": "modified",
        "additions": 3,
        "deletions": 1,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/bc42503f6ab304608c321986a870795e45f5a016/src/uint256.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/bc42503f6ab304608c321986a870795e45f5a016/src/uint256.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/uint256.h?ref=bc42503f6ab304608c321986a870795e45f5a016",
        "patch": "@@ -21,7 +21,7 @@ class uint_error : public std::runtime_error {\n template<unsigned int BITS>\n class base_uint\n {\n-private:\n+protected:\n     enum { WIDTH=BITS/32 };\n     uint32_t pn[WIDTH];\n public:\n@@ -322,6 +322,8 @@ class uint256 : public base_uint<256> {\n     // implementation accident.\n     uint256& SetCompact(uint32_t nCompact, bool *pfNegative = NULL, bool *pfOverflow = NULL);\n     uint32_t GetCompact(bool fNegative = false) const;\n+\n+    uint64_t GetHash(const uint256& salt) const;\n };\n \n #endif"
      }
    ]
  }
]