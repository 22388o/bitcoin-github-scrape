[
  {
    "sha": "12410b1feb80189061eb4a2b43421e53cbb758a8",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxMjQxMGIxZmViODAxODkwNjFlYjRhMmI0MzQyMWU1M2NiYjc1OGE4",
    "commit": {
      "author": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2020-07-19T06:39:15Z"
      },
      "committer": {
        "name": "Jon Atack",
        "email": "jon@atack.com",
        "date": "2020-07-19T11:37:54Z"
      },
      "message": "test: fix intermittent p2p_ibd_txrelay race, add test_framework.py#wait_until",
      "tree": {
        "sha": "247b5c69a3ee31c777ad9cd9d10a1330ba06f9c2",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/247b5c69a3ee31c777ad9cd9d10a1330ba06f9c2"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/12410b1feb80189061eb4a2b43421e53cbb758a8",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEEd6u7+MhX7zEv6RP5T1chs9Djkh0FAl8UMJgACgkQT1chs9Dj\nkh3h3w//QsZpPVX3RgP9UIubclruXlLBlUSVaN/OgwxWlA9DFEbcOpEAM9EB4uNn\nrSS9D0EKl3zFERfnrTzfEgoihEucX82K1ZviZvyfLrUmc3nd3dspfJGY4vi5O9Vh\n4NUSoisrT4pEDtyqpLcY7AhuqF/NFB4C01MSP69Ebm9MZZhqFIYjXHXBQfYg9jDL\nj0g/bfio9wF7YzqPnNM8KxyGAuqzIgHe2OwgxlUdE7olCbo+SnPGyaUx1T2mYqOX\na3Dk1zTZgEQD3LMSRdkOo0v35c7T9hTvlmONff0670HBIUie83VMyhxAx4+PvGMK\ni/2UvahmD+Hk6vnsYPRLxBlAXUx0ihrZBnFFURLEa6sMSvWC5NjOs2j2Rw1qqwIz\nFOyTfXhIwXeMLTjPjjhLVCiczh/VO+2q1r8KNPjF8EG8QWUQxo9ykKD4Ygrf9ueH\nskYdZOy2RPNRvZ3wuslO3zUDohjYsTf7/g6/TvKmY4DF+ANhvGCXVONcRvaQX4nL\neG66l+TEm7fQOFS4FTEz6MmwMKb4OUqUmGbZlOGmFR4PiLkB8OwzaADYlNoKqPLr\nkttdCgaZCTfbytlFnm05uCVaN1ahxA/yyxVFFnmfj8/44LQgM2uMBwVc8FjiPgvr\nwB6CJZ7ekHOOIH6/q5EVR5Mzxh1M61+SuVm4cCnO1A2ZiRqItiE=\n=lTDs\n-----END PGP SIGNATURE-----\n-----BEGIN OPENTIMESTAMPS GIT TIMESTAMP-----\n\nAQHwIACs2nFOa/cTcevOF35wB3TSRQVFjeXIinz1GTiZRgOtCP/wEED9gpFgnDhz\nPXy1vjDQUcAI8QRfFDCZ8Ajn5X12ZAtcXgCD3+MNLvkMjikoaHR0cHM6Ly9maW5u\nZXkuY2FsZW5kYXIuZXRlcm5pdHl3YWxsLmNvbf/wEFayk7iEa/xuw8RrS7qHIMkI\n8QRfFDCZ8AjngJ2wjk0YhQCD3+MNLvkMji4taHR0cHM6Ly9hbGljZS5idGMuY2Fs\nZW5kYXIub3BlbnRpbWVzdGFtcHMub3Jn//AQz7PM5KKdQrZ16m9sRRSHxgjxBF8U\nMJrwCHh4JQCJpVIWAIPf4w0u+QyOIyJodHRwczovL2J0Yy5jYWxlbmRhci5jYXRh\nbGxheHkuY29t8BDpUxr9g3u212vYoTJ/xFaaCPEEXxQwmfAI1kRgZDpBSbwAg9/j\nDS75DI4sK2h0dHBzOi8vYm9iLmJ0Yy5jYWxlbmRhci5vcGVudGltZXN0YW1wcy5v\ncmc=\n-----END OPENTIMESTAMPS GIT TIMESTAMP-----",
        "payload": "tree 247b5c69a3ee31c777ad9cd9d10a1330ba06f9c2\nparent 090d87716074434bdc6c7656ec44d049197a793a\nauthor Jon Atack <jon@atack.com> 1595140755 +0200\ncommitter Jon Atack <jon@atack.com> 1595158674 +0200\n\ntest: fix intermittent p2p_ibd_txrelay race, add test_framework.py#wait_until\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/12410b1feb80189061eb4a2b43421e53cbb758a8",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/12410b1feb80189061eb4a2b43421e53cbb758a8",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/12410b1feb80189061eb4a2b43421e53cbb758a8/comments",
    "author": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonatack",
      "id": 2415484,
      "node_id": "MDQ6VXNlcjI0MTU0ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2415484?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonatack",
      "html_url": "https://github.com/jonatack",
      "followers_url": "https://api.github.com/users/jonatack/followers",
      "following_url": "https://api.github.com/users/jonatack/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonatack/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonatack/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonatack/subscriptions",
      "organizations_url": "https://api.github.com/users/jonatack/orgs",
      "repos_url": "https://api.github.com/users/jonatack/repos",
      "events_url": "https://api.github.com/users/jonatack/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonatack/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "090d87716074434bdc6c7656ec44d049197a793a",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/090d87716074434bdc6c7656ec44d049197a793a",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/090d87716074434bdc6c7656ec44d049197a793a"
      }
    ],
    "stats": {
      "total": 12,
      "additions": 7,
      "deletions": 5
    },
    "files": [
      {
        "sha": "c3e758b02128177930746360134fbf6669b8b315",
        "filename": "test/functional/p2p_ibd_txrelay.py",
        "status": "modified",
        "additions": 3,
        "deletions": 5,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/12410b1feb80189061eb4a2b43421e53cbb758a8/test/functional/p2p_ibd_txrelay.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/12410b1feb80189061eb4a2b43421e53cbb758a8/test/functional/p2p_ibd_txrelay.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/p2p_ibd_txrelay.py?ref=12410b1feb80189061eb4a2b43421e53cbb758a8",
        "patch": "@@ -8,7 +8,6 @@\n \n from test_framework.messages import COIN\n from test_framework.test_framework import BitcoinTestFramework\n-from test_framework.util import assert_equal\n \n MAX_FEE_FILTER = Decimal(9170997) / COIN\n NORMAL_FEE_FILTER = Decimal(100) / COIN\n@@ -22,12 +21,12 @@ def set_test_params(self):\n             [\"-minrelaytxfee={}\".format(NORMAL_FEE_FILTER)],\n             [\"-minrelaytxfee={}\".format(NORMAL_FEE_FILTER)],\n         ]\n+\n     def run_test(self):\n         self.log.info(\"Check that nodes set minfilter to MAX_MONEY while still in IBD\")\n         for node in self.nodes:\n             assert node.getblockchaininfo()['initialblockdownload']\n-            for conn_info in node.getpeerinfo():\n-                assert_equal(conn_info['minfeefilter'], MAX_FEE_FILTER)\n+            self.wait_until(lambda: all(peer['minfeefilter'] == MAX_FEE_FILTER for peer in node.getpeerinfo()))\n \n         # Come out of IBD by generating a block\n         self.nodes[0].generate(1)\n@@ -36,8 +35,7 @@ def run_test(self):\n         self.log.info(\"Check that nodes reset minfilter after coming out of IBD\")\n         for node in self.nodes:\n             assert not node.getblockchaininfo()['initialblockdownload']\n-            for conn_info in node.getpeerinfo():\n-                assert_equal(conn_info['minfeefilter'], NORMAL_FEE_FILTER)\n+            self.wait_until(lambda: all(peer['minfeefilter'] == NORMAL_FEE_FILTER for peer in node.getpeerinfo()))\n \n \n if __name__ == '__main__':"
      },
      {
        "sha": "8d402d488871b22930f9845422c37d37be035890",
        "filename": "test/functional/test_framework/test_framework.py",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/12410b1feb80189061eb4a2b43421e53cbb758a8/test/functional/test_framework/test_framework.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/12410b1feb80189061eb4a2b43421e53cbb758a8/test/functional/test_framework/test_framework.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/test_framework/test_framework.py?ref=12410b1feb80189061eb4a2b43421e53cbb758a8",
        "patch": "@@ -31,6 +31,7 @@\n     disconnect_nodes,\n     get_datadir_path,\n     initialize_datadir,\n+    wait_until,\n )\n \n \n@@ -602,6 +603,9 @@ def sync_all(self, nodes=None):\n         self.sync_blocks(nodes)\n         self.sync_mempools(nodes)\n \n+    def wait_until(self, test_function, timeout=60, lock=None):\n+        return wait_until(test_function, timeout=timeout, lock=lock, timeout_factor=self.options.timeout_factor)\n+\n     # Private helper methods. These should not be accessed by the subclass test scripts.\n \n     def _start_logging(self):"
      }
    ]
  }
]