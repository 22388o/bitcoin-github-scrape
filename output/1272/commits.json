[
  {
    "sha": "45dcf63a62402248bb5e54d5eb8985dd4d90db1b",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo0NWRjZjYzYTYyNDAyMjQ4YmI1ZTU0ZDVlYjg5ODVkZDRkOTBkYjFi",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-05-12T15:41:58Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-05-12T22:49:12Z"
      },
      "message": "Only check for port# after : in ConnectSocketByName",
      "tree": {
        "sha": "a3bf0a2cdcbe5259b4aaa4e3cef78737d4e1fca8",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/a3bf0a2cdcbe5259b4aaa4e3cef78737d4e1fca8"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/45dcf63a62402248bb5e54d5eb8985dd4d90db1b",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/45dcf63a62402248bb5e54d5eb8985dd4d90db1b",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/45dcf63a62402248bb5e54d5eb8985dd4d90db1b",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/45dcf63a62402248bb5e54d5eb8985dd4d90db1b/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "a6cd0b08f6ef2af86fdff01154fe647e40b95424",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/a6cd0b08f6ef2af86fdff01154fe647e40b95424",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/a6cd0b08f6ef2af86fdff01154fe647e40b95424"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 8,
      "deletions": 6
    },
    "files": [
      {
        "sha": "f09d981c499e81619a64406b416bfd5eddc01265",
        "filename": "src/netbase.cpp",
        "status": "modified",
        "additions": 8,
        "deletions": 6,
        "changes": 14,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/45dcf63a62402248bb5e54d5eb8985dd4d90db1b/src/netbase.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/45dcf63a62402248bb5e54d5eb8985dd4d90db1b/src/netbase.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/netbase.cpp?ref=45dcf63a62402248bb5e54d5eb8985dd4d90db1b",
        "patch": "@@ -464,12 +464,14 @@ bool ConnectSocketByName(CService &addr, SOCKET& hSocketRet, const char *pszDest\n     int port = portDefault;\n \n     size_t colon = strDest.find_last_of(':');\n-    char *endp = NULL;\n-    int n = strtol(pszDest + colon + 1, &endp, 10);\n-    if (endp && *endp == 0 && n >= 0) {\n-        strDest = strDest.substr(0, colon);\n-        if (n > 0 && n < 0x10000)\n-            port = n;\n+    if (colon != strDest.npos) {\n+        char *endp = NULL;\n+        int n = strtol(pszDest + colon + 1, &endp, 10);\n+        if (endp && *endp == 0 && n >= 0) {\n+            strDest = strDest.substr(0, colon);\n+            if (n > 0 && n < 0x10000)\n+                port = n;\n+        }\n     }\n     if (strDest[0] == '[' && strDest[strDest.size()-1] == ']')\n         strDest = strDest.substr(1, strDest.size()-2);"
      }
    ]
  },
  {
    "sha": "89b5616d107294a1f496226f22b9966e4221cf35",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo4OWI1NjE2ZDEwNzI5NGExZjQ5NjIyNmYyMmI5OTY2ZTQyMjFjZjM1",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-05-12T15:44:14Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-05-12T22:49:12Z"
      },
      "message": "Do not signal outbound semaphore if uninitialized",
      "tree": {
        "sha": "b037119fd4bbe79a317490d7510e92c644df450d",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/b037119fd4bbe79a317490d7510e92c644df450d"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/89b5616d107294a1f496226f22b9966e4221cf35",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/89b5616d107294a1f496226f22b9966e4221cf35",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/89b5616d107294a1f496226f22b9966e4221cf35",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/89b5616d107294a1f496226f22b9966e4221cf35/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "45dcf63a62402248bb5e54d5eb8985dd4d90db1b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/45dcf63a62402248bb5e54d5eb8985dd4d90db1b",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/45dcf63a62402248bb5e54d5eb8985dd4d90db1b"
      }
    ],
    "stats": {
      "total": 5,
      "additions": 3,
      "deletions": 2
    },
    "files": [
      {
        "sha": "0e5a89878def71bd6ddefd6b98576bf53c4e5e88",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 3,
        "deletions": 2,
        "changes": 5,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/89b5616d107294a1f496226f22b9966e4221cf35/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/89b5616d107294a1f496226f22b9966e4221cf35/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=89b5616d107294a1f496226f22b9966e4221cf35",
        "patch": "@@ -1887,8 +1887,9 @@ bool StopNode()\n     fShutdown = true;\n     nTransactionsUpdated++;\n     int64 nStart = GetTime();\n-    for (int i=0; i<MAX_OUTBOUND_CONNECTIONS; i++)\n-         semOutbound->post();\n+    if (semOutbound)\n+        for (int i=0; i<MAX_OUTBOUND_CONNECTIONS; i++)\n+            semOutbound->post();\n     do\n     {\n         int nThreadsRunning = 0;"
      }
    ]
  },
  {
    "sha": "139d2f7c294c2489151b0b5df9b5351aaeaffa97",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxMzlkMmY3YzI5NGMyNDg5MTUxYjBiNWRmOWI1MzUxYWFlYWZmYTk3",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-05-12T22:41:24Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-05-12T23:03:05Z"
      },
      "message": "Keep local service information per address\n\nKeep local service information per CNetAddr instead of per CService,\nbut move the port into the information kept on it.",
      "tree": {
        "sha": "8153a7dcbb7c516a4b4c446efd237d6ccdf75300",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/8153a7dcbb7c516a4b4c446efd237d6ccdf75300"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/139d2f7c294c2489151b0b5df9b5351aaeaffa97",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/139d2f7c294c2489151b0b5df9b5351aaeaffa97",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/139d2f7c294c2489151b0b5df9b5351aaeaffa97",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/139d2f7c294c2489151b0b5df9b5351aaeaffa97/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "89b5616d107294a1f496226f22b9966e4221cf35",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/89b5616d107294a1f496226f22b9966e4221cf35",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/89b5616d107294a1f496226f22b9966e4221cf35"
      }
    ],
    "stats": {
      "total": 29,
      "additions": 19,
      "deletions": 10
    },
    "files": [
      {
        "sha": "53b69d276916ec4819964f48c6adfaed3bfa56fb",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 19,
        "deletions": 10,
        "changes": 29,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/139d2f7c294c2489151b0b5df9b5351aaeaffa97/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/139d2f7c294c2489151b0b5df9b5351aaeaffa97/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=139d2f7c294c2489151b0b5df9b5351aaeaffa97",
        "patch": "@@ -38,6 +38,10 @@ void ThreadDNSAddressSeed2(void* parg);\n bool OpenNetworkConnection(const CAddress& addrConnect, CSemaphoreGrant *grantOutbound = NULL, const char *strDest = NULL, bool fOneShot = false);\n \n \n+struct LocalServiceInfo {\n+    int nScore;\n+    int nPort;\n+};\n \n //\n // Global state variables\n@@ -46,7 +50,7 @@ bool fClient = false;\n static bool fUseUPnP = false;\n uint64 nLocalServices = (fClient ? 0 : NODE_NETWORK);\n static CCriticalSection cs_mapLocalHost;\n-static map<CService, int> mapLocalHost;\n+static map<CNetAddr, LocalServiceInfo> mapLocalHost;\n static bool vfReachable[NET_MAX] = {};\n static bool vfLimited[NET_MAX] = {};\n static CNode* pnodeLocalHost = NULL;\n@@ -98,23 +102,23 @@ bool GetLocal(CService& addr, const CNetAddr *paddrPeer)\n     if (fUseProxy || mapArgs.count(\"-connect\") || fNoListen)\n         return false;\n \n-    int nBestCount = -1;\n+    int nBestScore = -1;\n     int nBestReachability = -1;\n     {\n         LOCK(cs_mapLocalHost);\n-        for (map<CService, int>::iterator it = mapLocalHost.begin(); it != mapLocalHost.end(); it++)\n+        for (map<CNetAddr, LocalServiceInfo>::iterator it = mapLocalHost.begin(); it != mapLocalHost.end(); it++)\n         {\n-            int nCount = (*it).second;\n+            int nScore = (*it).second.nScore;\n             int nReachability = (*it).first.GetReachabilityFrom(paddrPeer);\n-            if (nReachability > nBestReachability || (nReachability == nBestReachability && nCount > nBestCount))\n+            if (nReachability > nBestReachability || (nReachability == nBestReachability && nScore > nBestScore))\n             {\n-                addr = (*it).first;\n+                addr = CService((*it).first, (*it).second.nPort);\n                 nBestReachability = nReachability;\n-                nBestCount = nCount;\n+                nBestScore = nScore;\n             }\n         }\n     }\n-    return nBestCount >= 0;\n+    return nBestScore >= 0;\n }\n \n // get best local address for a particular peer as a CAddress\n@@ -211,7 +215,12 @@ bool AddLocal(const CService& addr, int nScore)\n \n     {\n         LOCK(cs_mapLocalHost);\n-        mapLocalHost[addr] = std::max(nScore, mapLocalHost[addr]) + (mapLocalHost.count(addr) ? 1 : 0);\n+        bool fAlready = mapLocalHost.count(addr) > 0;\n+        LocalServiceInfo &info = mapLocalHost[addr];\n+        if (!fAlready || nScore >= info.nScore) {\n+            info.nScore = nScore;\n+            info.nPort = addr.GetPort() + (fAlready ? 1 : 0);\n+        }\n         enum Network net = addr.GetNetwork();\n         vfReachable[net] = true;\n         if (net == NET_IPV6) vfReachable[NET_IPV4] = true;\n@@ -249,7 +258,7 @@ bool SeenLocal(const CService& addr)\n         LOCK(cs_mapLocalHost);\n         if (mapLocalHost.count(addr) == 0)\n             return false;\n-        mapLocalHost[addr]++;\n+        mapLocalHost[addr].nScore++;\n     }\n \n     AdvertizeLocal();"
      }
    ]
  },
  {
    "sha": "5a3cb32e5942adbfb5af90808013c1dde3c03fcf",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1YTNjYjMyZTU5NDJhZGJmYjVhZjkwODA4MDEzYzFkZGUzYzAzZmNm",
    "commit": {
      "author": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-05-12T23:26:14Z"
      },
      "committer": {
        "name": "Pieter Wuille",
        "email": "pieter.wuille@gmail.com",
        "date": "2012-05-12T23:26:14Z"
      },
      "message": "Take -port into account when resolving -bind's",
      "tree": {
        "sha": "91e93cba67ad9a600f18589b2ac25f2b80bc4064",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/91e93cba67ad9a600f18589b2ac25f2b80bc4064"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5a3cb32e5942adbfb5af90808013c1dde3c03fcf",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5a3cb32e5942adbfb5af90808013c1dde3c03fcf",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/5a3cb32e5942adbfb5af90808013c1dde3c03fcf",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5a3cb32e5942adbfb5af90808013c1dde3c03fcf/comments",
    "author": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "139d2f7c294c2489151b0b5df9b5351aaeaffa97",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/139d2f7c294c2489151b0b5df9b5351aaeaffa97",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/139d2f7c294c2489151b0b5df9b5351aaeaffa97"
      }
    ],
    "stats": {
      "total": 17,
      "additions": 8,
      "deletions": 9
    },
    "files": [
      {
        "sha": "d26d5d73e4be6623df871646d0ab96b7f5a7b410",
        "filename": "src/init.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5a3cb32e5942adbfb5af90808013c1dde3c03fcf/src/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5a3cb32e5942adbfb5af90808013c1dde3c03fcf/src/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/init.cpp?ref=5a3cb32e5942adbfb5af90808013c1dde3c03fcf",
        "patch": "@@ -611,14 +611,14 @@ bool AppInit2(int argc, char* argv[])\n         std::string strError;\n         if (mapArgs.count(\"-bind\")) {\n             BOOST_FOREACH(std::string strBind, mapMultiArgs[\"-bind\"]) {\n-                fBound |= Bind(CService(strBind, GetDefaultPort(), false));\n+                fBound |= Bind(CService(strBind, GetListenPort(), false));\n             }\n         } else {\n             struct in_addr inaddr_any;\n             inaddr_any.s_addr = INADDR_ANY;\n-            fBound |= Bind(CService(inaddr_any, GetDefaultPort()));\n+            fBound |= Bind(CService(inaddr_any, GetListenPort()));\n #ifdef USE_IPV6\n-            fBound |= Bind(CService(in6addr_any, GetDefaultPort()));\n+            fBound |= Bind(CService(in6addr_any, GetListenPort()));\n #endif\n         }\n         if (!fBound)\n@@ -628,7 +628,7 @@ bool AppInit2(int argc, char* argv[])\n     if (mapArgs.count(\"-externalip\"))\n     {\n         BOOST_FOREACH(string strAddr, mapMultiArgs[\"-externalip\"])\n-            AddLocal(CNetAddr(strAddr, fNameLookup), LOCAL_MANUAL);\n+            AddLocal(CService(strAddr, GetListenPort(), fNameLookup), LOCAL_MANUAL);\n     }\n \n     if (mapArgs.count(\"-paytxfee\"))"
      },
      {
        "sha": "951595e68019265c747c5b21990143d3fffaf311",
        "filename": "src/net.cpp",
        "status": "modified",
        "additions": 2,
        "deletions": 4,
        "changes": 6,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5a3cb32e5942adbfb5af90808013c1dde3c03fcf/src/net.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5a3cb32e5942adbfb5af90808013c1dde3c03fcf/src/net.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.cpp?ref=5a3cb32e5942adbfb5af90808013c1dde3c03fcf",
        "patch": "@@ -231,11 +231,9 @@ bool AddLocal(const CService& addr, int nScore)\n     return true;\n }\n \n-bool AddLocal(const CNetAddr& addr, int nScore, int port)\n+bool AddLocal(const CNetAddr &addr, int nScore)\n {\n-    if (port == -1)\n-        port = GetListenPort();\n-    return AddLocal(CService(addr, port), nScore);\n+    return AddLocal(CService(addr, GetListenPort()), nScore);\n }\n \n /** Make a particular network entirely off-limits (no automatic connects to it) */"
      },
      {
        "sha": "3755c765d37080a1df38bd76819dfbc188a7a466",
        "filename": "src/net.h",
        "status": "modified",
        "additions": 2,
        "deletions": 1,
        "changes": 3,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5a3cb32e5942adbfb5af90808013c1dde3c03fcf/src/net.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5a3cb32e5942adbfb5af90808013c1dde3c03fcf/src/net.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/net.h?ref=5a3cb32e5942adbfb5af90808013c1dde3c03fcf",
        "patch": "@@ -38,6 +38,7 @@ CNode* FindNode(const CNetAddr& ip);\n CNode* FindNode(const CService& ip);\n CNode* ConnectNode(CAddress addrConnect, const char *strDest = NULL, int64 nTimeout=0);\n void MapPort(bool fMapPort);\n+unsigned short GetListenPort();\n bool BindListenPort(const CService &bindAddr, std::string& strError=REF(std::string()));\n void StartNode(void* parg);\n bool StopNode();\n@@ -58,7 +59,7 @@ enum\n void SetLimited(enum Network net, bool fLimited = true);\n bool IsLimited(const CNetAddr& addr);\n bool AddLocal(const CService& addr, int nScore = LOCAL_NONE);\n-bool AddLocal(const CNetAddr& addr, int nScore = LOCAL_NONE, int port = -1);\n+bool AddLocal(const CNetAddr& addr, int nScore = LOCAL_NONE);\n bool SeenLocal(const CService& addr);\n bool IsLocal(const CService& addr);\n bool GetLocal(CService &addr, const CNetAddr *paddrPeer = NULL);"
      }
    ]
  }
]