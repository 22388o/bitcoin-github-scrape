[
  {
    "sha": "3476e3c48b34034cefb7058b3f8ea9d13296f5f0",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzozNDc2ZTNjNDhiMzQwMzRjZWZiNzA1OGIzZjhlYTlkMTMyOTZmNWYw",
    "commit": {
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2018-04-19T15:07:54Z"
      },
      "committer": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2018-04-19T15:07:54Z"
      },
      "message": "[wallet] Fix zapwallettxes/multiwallet interaction.\n\n-zapwallettxes should be disallowed when starting bitcoin in multiwallet\nmode.",
      "tree": {
        "sha": "7d389dc5c74058f3d389ec50304347dfcbc2f706",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/7d389dc5c74058f3d389ec50304347dfcbc2f706"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/3476e3c48b34034cefb7058b3f8ea9d13296f5f0",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3476e3c48b34034cefb7058b3f8ea9d13296f5f0",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/3476e3c48b34034cefb7058b3f8ea9d13296f5f0",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3476e3c48b34034cefb7058b3f8ea9d13296f5f0/comments",
    "author": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "c19986940869034cb15e684f014f48fe00e75778",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/c19986940869034cb15e684f014f48fe00e75778",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/c19986940869034cb15e684f014f48fe00e75778"
      }
    ],
    "stats": {
      "total": 10,
      "additions": 5,
      "deletions": 5
    },
    "files": [
      {
        "sha": "accfd6e14965fdb8f41ed742c10a11541634e6b1",
        "filename": "src/wallet/init.cpp",
        "status": "modified",
        "additions": 5,
        "deletions": 5,
        "changes": 10,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/3476e3c48b34034cefb7058b3f8ea9d13296f5f0/src/wallet/init.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/3476e3c48b34034cefb7058b3f8ea9d13296f5f0/src/wallet/init.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/init.cpp?ref=3476e3c48b34034cefb7058b3f8ea9d13296f5f0",
        "patch": "@@ -118,19 +118,19 @@ bool WalletInit::ParameterInteraction() const\n         }\n     }\n \n-    int zapwallettxes = gArgs.GetArg(\"-zapwallettxes\", 0);\n+    bool zapwallettxes = gArgs.GetBoolArg(\"-zapwallettxes\", false);\n     // -zapwallettxes implies dropping the mempool on startup\n-    if (zapwallettxes != 0 && gArgs.SoftSetBoolArg(\"-persistmempool\", false)) {\n-        LogPrintf(\"%s: parameter interaction: -zapwallettxes=%s -> setting -persistmempool=0\\n\", __func__, zapwallettxes);\n+    if (zapwallettxes && gArgs.SoftSetBoolArg(\"-persistmempool\", false)) {\n+        LogPrintf(\"%s: parameter interaction: -zapwallettxes enabled -> setting -persistmempool=0\\n\", __func__);\n     }\n \n     // -zapwallettxes implies a rescan\n-    if (zapwallettxes != 0) {\n+    if (zapwallettxes) {\n         if (is_multiwallet) {\n             return InitError(strprintf(\"%s is only allowed with a single wallet file\", \"-zapwallettxes\"));\n         }\n         if (gArgs.SoftSetBoolArg(\"-rescan\", true)) {\n-            LogPrintf(\"%s: parameter interaction: -zapwallettxes=%s -> setting -rescan=1\\n\", __func__, zapwallettxes);\n+            LogPrintf(\"%s: parameter interaction: -zapwallettxes enabled -> setting -rescan=1\\n\", __func__);\n         }\n     }\n "
      }
    ]
  },
  {
    "sha": "1f838394bfd87cc9b28229824568b1d767e8ed6f",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoxZjgzODM5NGJmZDg3Y2M5YjI4MjI5ODI0NTY4YjFkNzY3ZThlZDZm",
    "commit": {
      "author": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2018-04-19T15:13:47Z"
      },
      "committer": {
        "name": "John Newbery",
        "email": "john@johnnewbery.com",
        "date": "2018-04-19T15:13:47Z"
      },
      "message": "[wallet] [tests] Test disallowed multiwallet params\n\nAdd a test to check that bitcoind fails to start when specifying\n-zapwallettxes, -salvagewallet and -upgradewallet when running in\nmultiwallet mode.",
      "tree": {
        "sha": "84c53b52f6a72a5de8f726b7f27439ae122d7c33",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/84c53b52f6a72a5de8f726b7f27439ae122d7c33"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/1f838394bfd87cc9b28229824568b1d767e8ed6f",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1f838394bfd87cc9b28229824568b1d767e8ed6f",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/1f838394bfd87cc9b28229824568b1d767e8ed6f",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/1f838394bfd87cc9b28229824568b1d767e8ed6f/comments",
    "author": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jnewbery",
      "id": 1063656,
      "node_id": "MDQ6VXNlcjEwNjM2NTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1063656?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jnewbery",
      "html_url": "https://github.com/jnewbery",
      "followers_url": "https://api.github.com/users/jnewbery/followers",
      "following_url": "https://api.github.com/users/jnewbery/following{/other_user}",
      "gists_url": "https://api.github.com/users/jnewbery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jnewbery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jnewbery/subscriptions",
      "organizations_url": "https://api.github.com/users/jnewbery/orgs",
      "repos_url": "https://api.github.com/users/jnewbery/repos",
      "events_url": "https://api.github.com/users/jnewbery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jnewbery/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "3476e3c48b34034cefb7058b3f8ea9d13296f5f0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/3476e3c48b34034cefb7058b3f8ea9d13296f5f0",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/3476e3c48b34034cefb7058b3f8ea9d13296f5f0"
      }
    ],
    "stats": {
      "total": 13,
      "additions": 13,
      "deletions": 0
    },
    "files": [
      {
        "sha": "60bf2e7e13d84ffc3bc69098f87f8d6391df8958",
        "filename": "test/functional/wallet_multiwallet.py",
        "status": "modified",
        "additions": 13,
        "deletions": 0,
        "changes": 13,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/1f838394bfd87cc9b28229824568b1d767e8ed6f/test/functional/wallet_multiwallet.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/1f838394bfd87cc9b28229824568b1d767e8ed6f/test/functional/wallet_multiwallet.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/wallet_multiwallet.py?ref=1f838394bfd87cc9b28229824568b1d767e8ed6f",
        "patch": "@@ -91,6 +91,19 @@ def run_test(self):\n         open(not_a_dir, 'a').close()\n         self.nodes[0].assert_start_raises_init_error(['-walletdir=' + not_a_dir], 'Error: Specified -walletdir \"' + not_a_dir + '\" is not a directory')\n \n+        self.log.info(\"Do not allow -zapwallettxes with multiwallet\")\n+        self.nodes[0].assert_start_raises_init_error(['-zapwallettxes', '-wallet=w1', '-wallet=w2'], \"Error: -zapwallettxes is only allowed with a single wallet file\")\n+        self.nodes[0].assert_start_raises_init_error(['-zapwallettxes=1', '-wallet=w1', '-wallet=w2'], \"Error: -zapwallettxes is only allowed with a single wallet file\")\n+        self.nodes[0].assert_start_raises_init_error(['-zapwallettxes=2', '-wallet=w1', '-wallet=w2'], \"Error: -zapwallettxes is only allowed with a single wallet file\")\n+\n+        self.log.info(\"Do not allow -salvagewallet with multiwallet\")\n+        self.nodes[0].assert_start_raises_init_error(['-salvagewallet', '-wallet=w1', '-wallet=w2'], \"Error: -salvagewallet is only allowed with a single wallet file\")\n+        self.nodes[0].assert_start_raises_init_error(['-salvagewallet=1', '-wallet=w1', '-wallet=w2'], \"Error: -salvagewallet is only allowed with a single wallet file\")\n+\n+        self.log.info(\"Do not allow -upgradewallet with multiwallet\")\n+        self.nodes[0].assert_start_raises_init_error(['-upgradewallet', '-wallet=w1', '-wallet=w2'], \"Error: -upgradewallet is only allowed with a single wallet file\")\n+        self.nodes[0].assert_start_raises_init_error(['-upgradewallet=1', '-wallet=w1', '-wallet=w2'], \"Error: -upgradewallet is only allowed with a single wallet file\")\n+\n         # if wallets/ doesn't exist, datadir should be the default wallet dir\n         wallet_dir2 = data_dir('walletdir')\n         os.rename(wallet_dir(), wallet_dir2)"
      }
    ]
  }
]