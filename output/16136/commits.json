[
  {
    "sha": "674f9d59ba4c1a1d4662e79467cc417a2988cf15",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo2NzRmOWQ1OWJhNGMxYTFkNDY2MmU3OTQ2N2NjNDE3YTI5ODhjZjE1",
    "commit": {
      "author": {
        "name": "practicalswift",
        "email": "practicalswift@users.noreply.github.com",
        "date": "2019-06-13T19:42:28Z"
      },
      "committer": {
        "name": "practicalswift",
        "email": "practicalswift@users.noreply.github.com",
        "date": "2019-10-29T18:01:07Z"
      },
      "message": "Add ASSUME(expr). Set -ABORT_ON_ASSUME_FAIL when configured with --enable-debug or --enable-fuzz.",
      "tree": {
        "sha": "debf10e9a01553228d18687450ea8075209069c0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/debf10e9a01553228d18687450ea8075209069c0"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/674f9d59ba4c1a1d4662e79467cc417a2988cf15",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/674f9d59ba4c1a1d4662e79467cc417a2988cf15",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/674f9d59ba4c1a1d4662e79467cc417a2988cf15",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/674f9d59ba4c1a1d4662e79467cc417a2988cf15/comments",
    "author": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "practicalswift",
      "id": 7826565,
      "node_id": "MDQ6VXNlcjc4MjY1NjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7826565?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/practicalswift",
      "html_url": "https://github.com/practicalswift",
      "followers_url": "https://api.github.com/users/practicalswift/followers",
      "following_url": "https://api.github.com/users/practicalswift/following{/other_user}",
      "gists_url": "https://api.github.com/users/practicalswift/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/practicalswift/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/practicalswift/subscriptions",
      "organizations_url": "https://api.github.com/users/practicalswift/orgs",
      "repos_url": "https://api.github.com/users/practicalswift/repos",
      "events_url": "https://api.github.com/users/practicalswift/events{/privacy}",
      "received_events_url": "https://api.github.com/users/practicalswift/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "6a97e8a060f7632bbaee27d3de8035dc6ebe3895",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/6a97e8a060f7632bbaee27d3de8035dc6ebe3895",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/6a97e8a060f7632bbaee27d3de8035dc6ebe3895"
      }
    ],
    "stats": {
      "total": 55,
      "additions": 55,
      "deletions": 0
    },
    "files": [
      {
        "sha": "5b57613399968929e16294eff503c8b63eab1261",
        "filename": "configure.ac",
        "status": "modified",
        "additions": 2,
        "deletions": 0,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/674f9d59ba4c1a1d4662e79467cc417a2988cf15/configure.ac",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/674f9d59ba4c1a1d4662e79467cc417a2988cf15/configure.ac",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/configure.ac?ref=674f9d59ba4c1a1d4662e79467cc417a2988cf15",
        "patch": "@@ -291,6 +291,7 @@ if test \"x$enable_debug\" = xyes; then\n \n   AX_CHECK_PREPROC_FLAG([-DDEBUG],[[DEBUG_CPPFLAGS=\"$DEBUG_CPPFLAGS -DDEBUG\"]],,[[$CXXFLAG_WERROR]])\n   AX_CHECK_PREPROC_FLAG([-DDEBUG_LOCKORDER],[[DEBUG_CPPFLAGS=\"$DEBUG_CPPFLAGS -DDEBUG_LOCKORDER\"]],,[[$CXXFLAG_WERROR]])\n+  AX_CHECK_PREPROC_FLAG([-DABORT_ON_FAILED_ASSUME],[[DEBUG_CPPFLAGS=\"$DEBUG_CPPFLAGS -DABORT_ON_FAILED_ASSUME\"]],,[[$CXXFLAG_WERROR]])\n   AX_CHECK_COMPILE_FLAG([-ftrapv],[DEBUG_CXXFLAGS=\"$DEBUG_CXXFLAGS -ftrapv\"],,[[$CXXFLAG_WERROR]])\n fi\n \n@@ -1017,6 +1018,7 @@ if test \"x$enable_fuzz\" = \"xyes\"; then\n   use_bench=no\n   use_upnp=no\n   use_zmq=no\n+  AX_CHECK_PREPROC_FLAG([-DABORT_ON_FAILED_ASSUME],[[DEBUG_CPPFLAGS=\"$DEBUG_CPPFLAGS -DABORT_ON_FAILED_ASSUME\"]],,[[$CXXFLAG_WERROR]])\n else\n   BITCOIN_QT_INIT\n "
      },
      {
        "sha": "479b048e67c2ccc84d183372fe89cb5028d753d5",
        "filename": "src/util/check.h",
        "status": "modified",
        "additions": 53,
        "deletions": 0,
        "changes": 53,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/674f9d59ba4c1a1d4662e79467cc417a2988cf15/src/util/check.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/674f9d59ba4c1a1d4662e79467cc417a2988cf15/src/util/check.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/util/check.h?ref=674f9d59ba4c1a1d4662e79467cc417a2988cf15",
        "patch": "@@ -5,6 +5,7 @@\n #ifndef BITCOIN_UTIL_CHECK_H\n #define BITCOIN_UTIL_CHECK_H\n \n+#include <config/bitcoin-config.h>\n #include <tinyformat.h>\n \n #include <stdexcept>\n@@ -38,4 +39,56 @@ class NonFatalCheckError : public std::runtime_error\n         }                                                         \\\n     } while (false)\n \n+/**\n+ * ASSUME(expression)\n+ *\n+ * ASSUME(...) is used to document assumptions.\n+ *\n+ * Bitcoin Core is always compiled with assertions enabled. assert(...)\n+ * is thus only appropriate for documenting critical assumptions\n+ * where a failed assumption should lead to immediate abortion also\n+ * in production environments.\n+ *\n+ * ASSUME(...) works like assert(...) if -DABORT_ON_FAILED_ASSUME\n+ * and is side-effect safe.\n+ *\n+ * More specifically:\n+ *\n+ * * If compiled with -DABORT_ON_FAILED_ASSUME (set by --enable-debug\n+ *   and --enable-fuzz): Evaluate expression and abort if expression is\n+ *   false.\n+ *\n+ * * Otherwise:\n+ *   Evaluate expression and continue execution.\n+ *\n+ * ABORT_ON_FAILED_ASSUME should not be set in production environments.\n+ *\n+ * Example\n+ * =======\n+ * int main(void) {\n+ *     ASSUME(IsFoo());\n+ *     ...\n+ * }\n+ *\n+ * If !IsFoo() and -DABORT_ON_FAILED_ASSUME, then:\n+ *     filename.cpp:123: main: ASSUME(IsFoo()) failed.\n+ *     Aborted\n+ * Otherwise the execution continues.\n+ */\n+\n+#ifdef ABORT_ON_FAILED_ASSUME\n+#define ACTION_ON_FAILED_ASSUME std::abort();\n+#else\n+#define ACTION_ON_FAILED_ASSUME\n+#endif\n+\n+#define ASSUME(expression)                                                                               \\\n+    do {                                                                                                 \\\n+        if (!(expression)) {                                                                             \\\n+            tfm::format(std::cerr, \"%s:%d: %s: ASSUME(%s) failed. You may report this issue here: %s\\n\", \\\n+                __FILE__, __LINE__, __func__, #expression, PACKAGE_BUGREPORT);                           \\\n+            ACTION_ON_FAILED_ASSUME                                                                      \\\n+        }                                                                                                \\\n+    } while (false)\n+\n #endif // BITCOIN_UTIL_CHECK_H"
      }
    ]
  }
]