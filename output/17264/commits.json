[
  {
    "sha": "29a21c90610aed88b796a7a5900e42e9048b990e",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzoyOWEyMWM5MDYxMGFlZDg4Yjc5NmE3YTU5MDBlNDJlOTA0OGI5OTBl",
    "commit": {
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2019-10-26T10:03:38Z"
      },
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2019-10-26T10:03:38Z"
      },
      "message": "[rpc] set default bip32derivs to true for psbt methods",
      "tree": {
        "sha": "6b1abacd5c13f0f39a7144369a9d7a9361275938",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/6b1abacd5c13f0f39a7144369a9d7a9361275938"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/29a21c90610aed88b796a7a5900e42e9048b990e",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAl20GfoACgkQV/+b28ww\nEAmyAA//UyE79dr6/A1jSQupwlMbYZ+dVPUI6tVCYkuXVR8DjeZSXvtuWFTjOzZA\ntwRnntrftLmVb9NMWxWGrxvWZXOVaqDCWaDjGaDOjmjmSXOlkfKemykltFf532qM\nbAAVfD4+nccDfAVPrIDO9z1zwGNfXWzi8rZbSpQ3yl7I8ZjzrHW6gZNhvdjYijYt\nzPWavDzUxPEItK4KbUUSFDsrSDiFepFfo6YFZWBVLTz85HXwfTMVxhOLQ3nFdMz0\nfsyQKEy8lSrAGVuZsgZ5wcWjjQwOvA0PJB9UgCMXqjdkRFR7ekW9wjzBzM8Uyai4\nqx6tN+3aa/USb8gwdrDenWIMFHgyIPxQ9YE1lCDHZhTo5Ep2Xz51Lb2SivHGjfOh\nGWEZVYiJsvJxT4D3HosiI+2szqN04ykA7HR7SnhRbliJOrP+c5XPfYDcDWRdDp59\nzcchplAX8o+4ZGlw5aQdexm8BeHlOg8r5p60tludwZuvGtVMNAVhXRyqh7eUIn+c\nhenUeJDYcDCI9a32oCchkMYaxlTGt+yjodhZuK8r9CNWurSkbWR6SWwj/ZQUd4Ez\n4LYM9DbQW8CpRaNxGWf8P4704w6SJ0cNg7NXGn0fplukEOgoa8FrWZZrx7cGQ+QH\nzgr8iTetII6tj6lBWdW7jYBEyZTOLHRD8vaIwGCotGuWK4Kx6/k=\n=7Z+Z\n-----END PGP SIGNATURE-----",
        "payload": "tree 6b1abacd5c13f0f39a7144369a9d7a9361275938\nparent e9f73b839ad9732d7c8f2f4fcbf6ef8eaa267fa3\nauthor Sjors Provoost <sjors@sprovoost.nl> 1572084218 +0200\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1572084218 +0200\n\n[rpc] set default bip32derivs to true for psbt methods\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/29a21c90610aed88b796a7a5900e42e9048b990e",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/29a21c90610aed88b796a7a5900e42e9048b990e",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/29a21c90610aed88b796a7a5900e42e9048b990e/comments",
    "author": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "e9f73b839ad9732d7c8f2f4fcbf6ef8eaa267fa3",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/e9f73b839ad9732d7c8f2f4fcbf6ef8eaa267fa3",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/e9f73b839ad9732d7c8f2f4fcbf6ef8eaa267fa3"
      }
    ],
    "stats": {
      "total": 14,
      "additions": 9,
      "deletions": 5
    },
    "files": [
      {
        "sha": "f6e0979596b98ba4cb1ddde4abb18dfa7b474d49",
        "filename": "doc/release-notes-17264.md",
        "status": "added",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/29a21c90610aed88b796a7a5900e42e9048b990e/doc/release-notes-17264.md",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/29a21c90610aed88b796a7a5900e42e9048b990e/doc/release-notes-17264.md",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/doc/release-notes-17264.md?ref=29a21c90610aed88b796a7a5900e42e9048b990e",
        "patch": "@@ -0,0 +1,4 @@\n+Updated RPCs\n+------------\n+\n+- `walletprocesspsbt` and `walletcreatefundedpsbt` now include BIP 32 derivation paths by default for public keys if we know them. This can be disabled by setting `bip32derivs` to `false`."
      },
      {
        "sha": "ec79284e6cdaea7651a95b31ed409b14958e777a",
        "filename": "src/wallet/psbtwallet.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/29a21c90610aed88b796a7a5900e42e9048b990e/src/wallet/psbtwallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/29a21c90610aed88b796a7a5900e42e9048b990e/src/wallet/psbtwallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/psbtwallet.h?ref=29a21c90610aed88b796a7a5900e42e9048b990e",
        "patch": "@@ -27,6 +27,6 @@ NODISCARD TransactionError FillPSBT(const CWallet* pwallet,\n               bool& complete,\n               int sighash_type = 1 /* SIGHASH_ALL */,\n               bool sign = true,\n-              bool bip32derivs = false);\n+              bool bip32derivs = true);\n \n #endif // BITCOIN_WALLET_PSBTWALLET_H"
      },
      {
        "sha": "af5101228ca32fd1f1b0f3463e0f05eccc452be8",
        "filename": "src/wallet/rpcwallet.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/29a21c90610aed88b796a7a5900e42e9048b990e/src/wallet/rpcwallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/29a21c90610aed88b796a7a5900e42e9048b990e/src/wallet/rpcwallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/rpcwallet.cpp?ref=29a21c90610aed88b796a7a5900e42e9048b990e",
        "patch": "@@ -3984,7 +3984,7 @@ UniValue walletprocesspsbt(const JSONRPCRequest& request)\n             \"       \\\"ALL|ANYONECANPAY\\\"\\n\"\n             \"       \\\"NONE|ANYONECANPAY\\\"\\n\"\n             \"       \\\"SINGLE|ANYONECANPAY\\\"\"},\n-                    {\"bip32derivs\", RPCArg::Type::BOOL, /* default */ \"false\", \"If true, includes the BIP 32 derivation paths for public keys if we know them\"},\n+                    {\"bip32derivs\", RPCArg::Type::BOOL, /* default */ \"true\", \"Include BIP 32 derivation paths for public keys if we know them\"},\n                 },\n                 RPCResult{\n             \"{\\n\"\n@@ -4012,7 +4012,7 @@ UniValue walletprocesspsbt(const JSONRPCRequest& request)\n \n     // Fill transaction with our data and also sign\n     bool sign = request.params[1].isNull() ? true : request.params[1].get_bool();\n-    bool bip32derivs = request.params[3].isNull() ? false : request.params[3].get_bool();\n+    bool bip32derivs = request.params[3].isNull() ? true : request.params[3].get_bool();\n     bool complete = true;\n     const TransactionError err = FillPSBT(pwallet, psbtx, complete, nHashType, sign, bip32derivs);\n     if (err != TransactionError::OK) {\n@@ -4095,7 +4095,7 @@ UniValue walletcreatefundedpsbt(const JSONRPCRequest& request)\n                             \"         \\\"CONSERVATIVE\\\"\"},\n                         },\n                         \"options\"},\n-                    {\"bip32derivs\", RPCArg::Type::BOOL, /* default */ \"false\", \"If true, includes the BIP 32 derivation paths for public keys if we know them\"},\n+                    {\"bip32derivs\", RPCArg::Type::BOOL, /* default */ \"true\", \"Include BIP 32 derivation paths for public keys if we know them\"},\n                 },\n                 RPCResult{\n                             \"{\\n\"\n@@ -4134,7 +4134,7 @@ UniValue walletcreatefundedpsbt(const JSONRPCRequest& request)\n     PartiallySignedTransaction psbtx(rawTx);\n \n     // Fill transaction with out data but don't sign\n-    bool bip32derivs = request.params[4].isNull() ? false : request.params[4].get_bool();\n+    bool bip32derivs = request.params[4].isNull() ? true : request.params[4].get_bool();\n     bool complete = true;\n     const TransactionError err = FillPSBT(pwallet, psbtx, complete, 1, false, bip32derivs);\n     if (err != TransactionError::OK) {"
      }
    ]
  },
  {
    "sha": "5bad7921d0b33b62c0a59a478c2e8c869fc5e3b5",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo1YmFkNzkyMWQwYjMzYjYyYzBhNTlhNDc4YzJlOGM4NjlmYzVlM2I1",
    "commit": {
      "author": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2020-01-31T09:37:41Z"
      },
      "committer": {
        "name": "Sjors Provoost",
        "email": "sjors@sprovoost.nl",
        "date": "2020-01-31T09:38:04Z"
      },
      "message": "[test] PSBT RPC: check that bip32_derivs are present by default",
      "tree": {
        "sha": "049d3cc5634a80bed4b058da897fd4cd70ff723e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/049d3cc5634a80bed4b058da897fd4cd70ff723e"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/5bad7921d0b33b62c0a59a478c2e8c869fc5e3b5",
      "comment_count": 0,
      "verification": {
        "verified": true,
        "reason": "valid",
        "signature": "-----BEGIN PGP SIGNATURE-----\n\niQIzBAABCAAdFiEE7ZvfetalXiMuhFJCV/+b28wwEAkFAl4z9XwACgkQV/+b28ww\nEAnfnQ//f30+A0L4Oji/RCsKUv++VF9YSpMI2uk9XIsTsoAQWy3NjTb/nxFBnueF\ncsbMf9ZW3qHYMyp71i0RoeNhhXAND+oBVu3CzcFgjC2zFataptzVhfTmyC62w/WD\n60kKHUOyENVN94Zerz0Pt9tdPiKij/RicbylI/6/AQB0nPIzHiWs+1vI00Vh7vyJ\nFKoxzH/8xgkiVlA0KJN0PEH9k0MyxDZxAiqPY3pW0Xst3s5SlWZe/zlUboXRfK1a\nO1S2xbjjfJvriHPYROz9AzNIGqhs+Nb6moxl2VW5qOdomheLTS7pbF7vl2vdHVPz\n0F4lhfCXmCmcHIQ9T9VtPjV4APK2ayQJa4tyb3HCectdO7ztRuYyO6WB8DhonXlt\nrwakcVh3WgXd+5iNBW6H66iLZMTToecE/CNeM+cTO9VfAitrzWdiCYyJ8gmX/AeY\nofUB1V8nGOVg8PGI9kBP98xevsxldGe8Vflpb8dzL7kQDO9k/8JKT+6KP6OHZY9t\nJQIN16s6rrX29KUhxCKmbEcOkhvGgrGinlDL3PDV7FAAmXNokQWuPTRe/QlInjot\nlErpblLdJSXhWp0C2N/GO06JiPfrABu76n6vq/aE6wTTjb3vx0BaeyNUUhUdBs2B\nub7ABcRtJg1jk4qknGexGSz10m05/KMnPHJN8azc2QWl3+2t3jY=\n=NlZr\n-----END PGP SIGNATURE-----",
        "payload": "tree 049d3cc5634a80bed4b058da897fd4cd70ff723e\nparent 29a21c90610aed88b796a7a5900e42e9048b990e\nauthor Sjors Provoost <sjors@sprovoost.nl> 1580463461 +0100\ncommitter Sjors Provoost <sjors@sprovoost.nl> 1580463484 +0100\n\n[test] PSBT RPC: check that bip32_derivs are present by default\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5bad7921d0b33b62c0a59a478c2e8c869fc5e3b5",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/5bad7921d0b33b62c0a59a478c2e8c869fc5e3b5",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5bad7921d0b33b62c0a59a478c2e8c869fc5e3b5/comments",
    "author": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "Sjors",
      "id": 10217,
      "node_id": "MDQ6VXNlcjEwMjE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10217?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sjors",
      "html_url": "https://github.com/Sjors",
      "followers_url": "https://api.github.com/users/Sjors/followers",
      "following_url": "https://api.github.com/users/Sjors/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sjors/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sjors/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sjors/subscriptions",
      "organizations_url": "https://api.github.com/users/Sjors/orgs",
      "repos_url": "https://api.github.com/users/Sjors/repos",
      "events_url": "https://api.github.com/users/Sjors/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sjors/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "29a21c90610aed88b796a7a5900e42e9048b990e",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/29a21c90610aed88b796a7a5900e42e9048b990e",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/29a21c90610aed88b796a7a5900e42e9048b990e"
      }
    ],
    "stats": {
      "total": 18,
      "additions": 14,
      "deletions": 4
    },
    "files": [
      {
        "sha": "6150d42f7699bfb2b776250e67f9cf32364b72c8",
        "filename": "test/functional/rpc_psbt.py",
        "status": "modified",
        "additions": 14,
        "deletions": 4,
        "changes": 18,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/5bad7921d0b33b62c0a59a478c2e8c869fc5e3b5/test/functional/rpc_psbt.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/5bad7921d0b33b62c0a59a478c2e8c869fc5e3b5/test/functional/rpc_psbt.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/test/functional/rpc_psbt.py?ref=5bad7921d0b33b62c0a59a478c2e8c869fc5e3b5",
        "patch": "@@ -192,12 +192,20 @@ def run_test(self):\n         psbt_orig = self.nodes[0].createpsbt([{\"txid\":txid1,  \"vout\":vout1}, {\"txid\":txid2, \"vout\":vout2}], {self.nodes[0].getnewaddress():25.999})\n \n         # Update psbts, should only have data for one input and not the other\n-        psbt1 = self.nodes[1].walletprocesspsbt(psbt_orig)['psbt']\n+        psbt1 = self.nodes[1].walletprocesspsbt(psbt_orig, False, \"ALL\")['psbt']\n         psbt1_decoded = self.nodes[0].decodepsbt(psbt1)\n         assert psbt1_decoded['inputs'][0] and not psbt1_decoded['inputs'][1]\n-        psbt2 = self.nodes[2].walletprocesspsbt(psbt_orig)['psbt']\n+        # Check that BIP32 path was added\n+        assert \"bip32_derivs\" in psbt1_decoded['inputs'][0]\n+        psbt2 = self.nodes[2].walletprocesspsbt(psbt_orig, False, \"ALL\", False)['psbt']\n         psbt2_decoded = self.nodes[0].decodepsbt(psbt2)\n         assert not psbt2_decoded['inputs'][0] and psbt2_decoded['inputs'][1]\n+        # Check that BIP32 paths were not added\n+        assert \"bip32_derivs\" not in psbt2_decoded['inputs'][1]\n+\n+        # Sign PSBTs (workaround issue #18039)\n+        psbt1 = self.nodes[1].walletprocesspsbt(psbt_orig)['psbt']\n+        psbt2 = self.nodes[2].walletprocesspsbt(psbt_orig)['psbt']\n \n         # Combine, finalize, and send the psbts\n         combined = self.nodes[0].combinepsbt([psbt1, psbt2])\n@@ -230,16 +238,18 @@ def run_test(self):\n         # Same construction without optional arguments\n         psbtx_info = self.nodes[0].walletcreatefundedpsbt([{\"txid\":unspent[\"txid\"], \"vout\":unspent[\"vout\"]}], [{self.nodes[2].getnewaddress():unspent[\"amount\"]+1}])\n         decoded_psbt = self.nodes[0].decodepsbt(psbtx_info[\"psbt\"])\n-        for tx_in in decoded_psbt[\"tx\"][\"vin\"]:\n+        for tx_in, psbt_in in zip(decoded_psbt[\"tx\"][\"vin\"], decoded_psbt[\"inputs\"]):\n             assert_equal(tx_in[\"sequence\"], MAX_BIP125_RBF_SEQUENCE)\n+            assert \"bip32_derivs\" in psbt_in\n         assert_equal(decoded_psbt[\"tx\"][\"locktime\"], 0)\n \n         # Same construction without optional arguments, for a node with -walletrbf=0\n         unspent1 = self.nodes[1].listunspent()[0]\n         psbtx_info = self.nodes[1].walletcreatefundedpsbt([{\"txid\":unspent1[\"txid\"], \"vout\":unspent1[\"vout\"]}], [{self.nodes[2].getnewaddress():unspent1[\"amount\"]+1}], block_height)\n         decoded_psbt = self.nodes[1].decodepsbt(psbtx_info[\"psbt\"])\n-        for tx_in in decoded_psbt[\"tx\"][\"vin\"]:\n+        for tx_in, psbt_in in zip(decoded_psbt[\"tx\"][\"vin\"], decoded_psbt[\"inputs\"]):\n             assert_greater_than(tx_in[\"sequence\"], MAX_BIP125_RBF_SEQUENCE)\n+            assert \"bip32_derivs\" in psbt_in\n \n         # Make sure change address wallet does not have P2SH innerscript access to results in success\n         # when attempting BnB coin selection"
      }
    ]
  }
]