DrahtBot,2019-05-09 17:52:09,<!--e57a25ab6845829454e8d69fc972939a-->\n\nThe following sections might be updated with supplementary metadata relevant to reviewers and maintainers.\n\n<!--174a7506f384e20aa4161008e828411d-->\n### Conflicts\nNo conflicts as of last run.,https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-491002493,491002493,
laanwj,2019-05-09 19:35:33,"Concept ACK, we definitely don't want to support miniUPnPc versions that are insecure",https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-491037083,491037083,
hebasto,2019-05-11 01:05:46,"@MarcoFalke\nThank you for your review. Your comments have been addressed.\nPR title and description are updated.",https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-491466863,491466863,
practicalswift,2019-05-12 19:44:11,"Concept ACK\n\nWe should now allow dependencies with known flaws.",https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-491623392,491623392,
MarcoFalke,2019-05-13 16:36:50,"utACK fe94f276faa6f5905132d9062469432347bce747\n\nOnly checked that this is removing code and adding the static assert\nDidn't compile to see if the PACKAGE_NAME makes it through\n\n<details><summary>Show signature and timestamp</summary>\n\nSignature:\n\n```\n-----BEGIN PGP SIGNED MESSAGE-----\nHash: SHA512\n\nutACK fe94f276faa6f5905132d9062469432347bce747\n\nOnly checked that this",https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-491896441,491896441,
practicalswift,2019-05-13 16:50:26,utACK fe94f276faa6f5905132d9062469432347bce747,https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-491901052,491901052,
gmaxwell,2019-05-14 22:32:28,"If this requires >= 16 it eliminates miniupnp versions that debian is still using (but with fixes), no?",https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-492435127,492435127,
laanwj,2019-05-16 14:21:27,"> If this requires >= 16 it eliminates miniupnp versions that debian is still using (but with fixes), no?\n\nyes\n```\nstretch (stable) (net): UPnP IGD client lightweight library client\n1.9.20140610-4: amd64 arm64 armel armhf i386 mips mips64el mipsel ppc64el s390x \n```\nwhich defines:\n```\n./miniupnpc.h:#define MINIUPNPC_API_VERSION	10\n```",https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-493088174,493088174,
gmaxwell,2019-05-17 01:00:08,"This should be changed to 10 then, the (bulk of the?) API changes are compatible with 10-- and there are patched systems that return 10.    I don't think we have any strong reason to gratuitously break compatibility beyond that.",https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-493281126,493281126,
hebasto,2019-05-17 18:25:42,"This PR is becoming a bit controversial:\n\nhttps://github.com/bitcoin/bitcoin/pull/15993#discussion_r282963185, https://github.com/bitcoin/bitcoin/pull/15993#discussion_r283022887 by @MarcoFalke:\n> Why 10?\n> Everything below (and including 14) is broken: #6789\n> `MINIUPNPC_API_VERSION >= 16` should be fine. The code might be removed soon anyway\n\nhttps://github.com/bitcoin/bitcoin/pull",https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-493552682,493552682,
MarcoFalke,2019-05-17 18:42:18,"Yeah, isn't this superseded by  Changes to support NAT-PMP #15717 ",https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-493557793,493557793,
laanwj,2019-05-20 15:42:20,">  Can we reach the consensus? Or should this PR be closed for now?\n\nJust change it to 10 and it's OK imo. Dropping support for other versions can be done later but only when it's gone from debian stable.",https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-494041839,494041839,
hebasto,2019-05-21 05:12:46,"@gmaxwell \n> This should be changed to 10 then, the (bulk of the?) API changes are compatible with 10-- and there are patched systems that return 10. I don't think we have any strong reason to gratuitously break compatibility beyond that.\n\n@laanwj \n> Just change it to 10 and it's OK imo. Dropping support for other versions can be done later but only when it's gone from debian stable.\n\n",https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-494242151,494242151,
laanwj,2019-05-21 09:44:26,"LGTM now, utACK 12a0de5931fcbbad388e56447e297e38ff54bfcf",https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-494320063,494320063,
hebasto,2019-05-21 16:16:14,Release notes have been added.,https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-494458847,494458847,
hebasto,2019-05-22 16:31:17,Release notes have been updated; see: https://github.com/bitcoin/bitcoin/pull/15993#discussion_r286580763.,https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-494877950,494877950,
gmaxwell,2019-05-24 01:59:40,Looking good to me.,https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-495445394,495445394,
laanwj,2019-06-05 14:23:47,Removed 'needs release note' label as it includes a release note.,https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-499105143,499105143,
laanwj,2019-06-06 10:40:03,"> Concept ACK, but this needs to update configure to reject incompatible versions. (Ideally rejecting vulnerable versions even if they are API-compatible with the code.)\n\nAre you going to do that here @hebasto ?",https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-499443395,499443395,
luke-jr,2019-06-06 18:33:12,"Builds should never fail after configure succeeds. That indicates a bug in our dependency checks. Especially when the feature can be turned off, I don't think fixing this is merely a ""minor usability improvement"".",https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-499614543,499614543,
hebasto,2019-06-06 20:43:50,"@luke-jr @laanwj\n> > Concept ACK, but this needs to update configure to reject incompatible versions. (Ideally rejecting vulnerable versions even if they are API-compatible with the code.)\n> \n> Are you going to do that here @hebasto ?\n\nDone.",https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-499660240,499660240,
hebasto,2019-06-07 07:55:46,"@luke-jr\nThank you for your review. All your comments have been addressed.",https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-499793527,499793527,
laanwj,2019-06-13 11:14:31,"I think this is dragging on way too long, and maybe getting out of hand, getting round after round of nits for essentially removing a few `#ifdef`ed lines that were probably never getting compiled in the first place.\n\nPlease, let's try to move forward and merge this to have this off our radar.",https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-501659558,501659558,
hebasto,2019-06-13 20:55:39,"""vulnerable"" replaced with ""unsupported"" as @luke-jr [suggested](https://github.com/bitcoin/bitcoin/pull/15993/commits/ded2de5d6e8ced149dd7a8de27c8a7269a675cc3#r291744667).",https://github.com/bitcoin/bitcoin/pull/15993#issuecomment-501875404,501875404,
MarcoFalke,2019-05-09 19:42:06,"Depends is off, so is this needed?",https://github.com/bitcoin/bitcoin/pull/15993#discussion_r282635811,282635811,.travis.yml
hebasto,2019-05-10 14:37:56,"@MarcoFalke \nFixed. Using `--with-miniupnpc=no` to make things explicit.",https://github.com/bitcoin/bitcoin/pull/15993#discussion_r282911929,282911929,.travis.yml
MarcoFalke,2019-05-10 16:58:27,"Why 10?\n\nEverything below (and including 14) is broken: #6789",https://github.com/bitcoin/bitcoin/pull/15993#discussion_r282963185,282963185,src/net.cpp
hebasto,2019-05-10 17:26:40,"> Why 10?\n\nThis is API version for xenial and jessy `libminiupnpc-dev`.\n\n> Everything below (and including 14) is broken: #6789\n\nYou are right. This PR is a kind of trade-off. Otherwise, a user should be forced to build `libminiupnpc-dev` by himself.\n\nAnyway, I'll appreciate any smart solution for this security issue. ",https://github.com/bitcoin/bitcoin/pull/15993#discussion_r282972825,282972825,src/net.cpp
MarcoFalke,2019-05-10 17:52:30,"I don't think we should support building against known broken versions. If  someone really needs to build against such an old version, they could update the code themselves (remove the assert) or build a newer version of miniupnpc (which conveniently is shipped in our `./depends`)",https://github.com/bitcoin/bitcoin/pull/15993#discussion_r282981881,282981881,src/net.cpp
hebasto,2019-05-10 18:57:35,"I cannot find a suitable assertion to let only build with CVE-2017-8798 fix [commit](https://github.com/miniupnp/miniupnp/commit/f0f1f4b22d6a98536377a1bb07e7c20e4703d229) (see: #10414):\n- `MINIUPNPC_API_VERSION >= 17` is too narrow (see: [miniupnpc-2.1 changelog](http://miniupnp.free.fr/files/changelog.php?file=miniupnpc-2.1.tar.gz))\n- `MINIUPNPC_API_VERSION >= 16` is too wide: versions before",https://github.com/bitcoin/bitcoin/pull/15993#discussion_r283005698,283005698,src/net.cpp
MarcoFalke,2019-05-10 19:55:46,`MINIUPNPC_API_VERSION >= 16` should be fine. The code might be removed soon anyway ,https://github.com/bitcoin/bitcoin/pull/15993#discussion_r283022887,283022887,src/net.cpp
MarcoFalke,2019-05-21 17:21:46,"Aren't they patched? Otherwise we would set the API version higher, no?",https://github.com/bitcoin/bitcoin/pull/15993#discussion_r286136807,286136807,doc/release-notes-15993.md
hebasto,2019-05-22 16:29:54,"> Aren't they patched?\n\nThe `libminiupnpc10` package has been patched on Ubuntu only:\n- [CVE-2017-8798](https://usn.ubuntu.com/3298-1/)\n- [CVE-2017-1000494](https://usn.ubuntu.com/3562-1/)\n\nOn Debian:\n- in jessy `miniupnpc` package is still vulnerable for [CVE-2017-8798](https://security-tracker.debian.org/tracker/CVE-2017-8798) and [CVE-2017-1000494](https://security-tracker.debian.",https://github.com/bitcoin/bitcoin/pull/15993#discussion_r286580763,286580763,doc/release-notes-15993.md
ryanofsky,2019-06-06 12:16:57,There should be a code comment explaining this version requirement so we can remember the reasoning behind it in the future. You could copy and paste the text from the release-notes here.,https://github.com/bitcoin/bitcoin/pull/15993#discussion_r291154023,291154023,src/net.cpp
hebasto,2019-06-06 20:42:16,Done.,https://github.com/bitcoin/bitcoin/pull/15993#discussion_r291363021,291363021,src/net.cpp
luke-jr,2019-06-07 03:09:15,I don't recommend referring to GitHub issues. I think we're supposed to have a self-contained [set of] git repo(s)?,https://github.com/bitcoin/bitcoin/pull/15993#discussion_r291440260,291440260,configure.ac
luke-jr,2019-06-07 03:11:19,"--with-miniupnpc=auto (ie, the default) won't work with this check.\n\nJust set `have_miniupnpc=no` here instead (and change this to AC_MSG_WARNING).",https://github.com/bitcoin/bitcoin/pull/15993#discussion_r291440468,291440468,configure.ac
luke-jr,2019-06-07 03:12:46,jessie*,https://github.com/bitcoin/bitcoin/pull/15993#discussion_r291440646,291440646,doc/release-notes-15993.md
luke-jr,2019-06-07 20:33:04,"Some API v10 is also vulnerable, right? I think we just want to say ""unsupported"" here.",https://github.com/bitcoin/bitcoin/pull/15993#discussion_r291744667,291744667,configure.ac
luke-jr,2019-06-07 20:34:42,Why remove the version comments?,https://github.com/bitcoin/bitcoin/pull/15993#discussion_r291745170,291745170,src/net.cpp
luke-jr,2019-06-07 20:36:57,I agree we should ideally drop support for all vulnerable versions.,https://github.com/bitcoin/bitcoin/pull/15993#discussion_r291745838,291745838,src/net.cpp
hebasto,2019-06-13 20:55:56,Done.,https://github.com/bitcoin/bitcoin/pull/15993#discussion_r293572860,293572860,configure.ac
hebasto,2019-06-13 20:59:41,They are irrelevant now. See: [miniupnpc/apiversions.txt](https://github.com/miniupnp/miniupnp/blob/master/miniupnpc/apiversions.txt),https://github.com/bitcoin/bitcoin/pull/15993#discussion_r293574285,293574285,src/net.cpp
luke-jr,2019-06-14 02:52:38,I don't see how they are irrelevant...,https://github.com/bitcoin/bitcoin/pull/15993#discussion_r293644216,293644216,src/net.cpp
hebasto,2019-06-14 05:49:04,"Prior to version 1.7, there was no `MINIUPNPC API_VERSION` macro. Therefore, different ways were used to distinguish between different versions. Comments were needed to make those ""hacks"" obvious.\nNowadays, the difference in the `upnpDiscover()` function signature is clear stated in different API versions.\n\nParticularly,\n```\nAPI version 14\nminiupnpc.h\n  add ttl argument to upnpDiscov",https://github.com/bitcoin/bitcoin/pull/15993#discussion_r293666271,293666271,src/net.cpp
