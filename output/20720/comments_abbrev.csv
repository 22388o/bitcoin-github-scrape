hebasto,2020-12-19 09:20:23,"Concept ACK, the issue is known in other open-source projects: https://github.com/gdnsd/gdnsd/commit/582004ebfee2e0d341e391e96f0ca116f443c413",https://github.com/bitcoin/bitcoin/pull/20720#issuecomment-748447354,748447354,
practicalswift,2020-12-19 09:28:57,cr ACK 01ca4bdadd250d24912cc08149a130a538e76a4f: patch looks correct,https://github.com/bitcoin/bitcoin/pull/20720#issuecomment-748448292,748448292,
laanwj,2020-12-19 10:45:36,"This makes sense. For me it brings up the question ""why aren't we doing this for all hardening flags""?\n",https://github.com/bitcoin/bitcoin/pull/20720#issuecomment-748456438,748456438,
fanquake,2020-12-20 08:12:00,"Thanks for testing @hebasto. However the previous patch wasn't working correctly. The flag would actually **NEVER** be applied (even where it would work correctly), because the source being compiled wasn't valid ðŸ¤¦ . I've fixed that now.\n\n> For me it brings up the question ""why aren't we doing this for all hardening flags""?\n\nI'm currently reviewing all of our flags for any other subtle brea",https://github.com/bitcoin/bitcoin/pull/20720#issuecomment-748576983,748576983,
hebasto,2020-12-20 09:42:49,"> ... because the source being compiled wasn't valid\n\nIndeed. I confused `AC_LANG_SOURCE` and `AC_LANG_PROGRAM` macros :man_facepalming: (btw, the latter seems more concise for this change).",https://github.com/bitcoin/bitcoin/pull/20720#issuecomment-748585217,748585217,
laanwj,2020-12-20 12:08:32,"> I'm currently reviewing all of our flags for any other subtle breakages. It very well might make sense to do this for all flags going forward.\n\nThinking about it, it *is* a bit of a compromise. We wouldn't want to increase the opportunity to silently lose hardening flags. Of course the security checks are the best place to verify this, but we don't have checks for all of the hardening mechan",https://github.com/bitcoin/bitcoin/pull/20720#issuecomment-748599376,748599376,
fanquake,2020-12-20 14:00:37,"I've changed the approach here to check for link errors, as even when the error is emitted, compilation succeeds, and the binaries produced will run. This means we can't just check if the compiler accepts the flag, or if compilation succeeds (without or without `-Werror`, and/or passing `-Wl,--fatal-warnings`, which may not be passed through to the linker).\n\nInstead we can do a link check, wit",https://github.com/bitcoin/bitcoin/pull/20720#issuecomment-748611623,748611623,
pstratem,2020-12-20 21:26:56,"Unfortunately still broken on Debian 10.7.\n\n[build.log](https://github.com/bitcoin/bitcoin/files/5721546/build.log)\n",https://github.com/bitcoin/bitcoin/pull/20720#issuecomment-748673073,748673073,
fanquake,2020-12-20 22:53:47,"> Unfortunately still broken on Debian 10.7.\n\nLooking at the build.log, the change here is working as expected and isn't adding `-fcf-protection` to the hardened flags when the linker emits an error:\n```bash\nchecking whether the linker accepts -fcf-protection=full... no\n....\nconfigure:20769: checking whether the linker accepts -fcf-protection=full\nconfigure:20788: clang++ -std=c++17 ",https://github.com/bitcoin/bitcoin/pull/20720#issuecomment-748682651,748682651,
pstratem,2020-12-20 23:14:47,"I was wrong, you're right, this is another failure described here https://github.com/bitcoin/bitcoin/pull/20560#issuecomment-748339644\n\n",https://github.com/bitcoin/bitcoin/pull/20720#issuecomment-748685118,748685118,
pstratem,2020-12-20 23:28:50,tested ACK e9189a750b237eba1befc6b16c12c2cee3e0176c,https://github.com/bitcoin/bitcoin/pull/20720#issuecomment-748686751,748686751,
MarcoFalke,2020-12-21 07:31:41,"not an ACK e9189a750b237eba1befc6b16c12c2cee3e0176c , I only tested configure on my system (gcc-10, clang-11):\n\n```diff\ndiff --git a/tmp/a_gcc b/tmp/b_gcc\nindex c0ef19c9a8..d7e3ac31c2 100644\n--- a/tmp/a_gcc\n+++ b/tmp/b_gcc\n@@ -174,7 +174,7 @@ checking whether C++ compiler accepts -fPIC... yes\n checking whether C++ compiler accepts -fstack-reuse=none... yes\n checking whether C++ c",https://github.com/bitcoin/bitcoin/pull/20720#issuecomment-748815722,748815722,
hebasto,2021-01-04 11:00:42,"style nit: the readability could be improved\n```suggestion\n  AX_CHECK_LINK_FLAG([-fcf-protection=full], [HARDENED_CXXFLAGS=""$HARDENED_CXXFLAGS -fcf-protection=full""], [], [$LDFLAG_WERROR])\n```",https://github.com/bitcoin/bitcoin/pull/20720#discussion_r551249268,551249268,configure.ac
