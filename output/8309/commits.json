[
  {
    "sha": "fa9976b853dbd04334cd0b5a058b99aa0014e649",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYTk5NzZiODUzZGJkMDQzMzRjZDBiNWEwNThiOTlhYTAwMTRlNjQ5",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2016-07-06T18:46:22Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2016-07-07T08:28:42Z"
      },
      "message": "[qa] test_framework: Add wrapper for stop_node",
      "tree": {
        "sha": "63cd4e4335538c17ff4cc837657d8b4f67fc8bff",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/63cd4e4335538c17ff4cc837657d8b4f67fc8bff"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fa9976b853dbd04334cd0b5a058b99aa0014e649",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa9976b853dbd04334cd0b5a058b99aa0014e649",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fa9976b853dbd04334cd0b5a058b99aa0014e649",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa9976b853dbd04334cd0b5a058b99aa0014e649/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "da50997a3ee7d3b73180c71cd454580af49c2244",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/da50997a3ee7d3b73180c71cd454580af49c2244",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/da50997a3ee7d3b73180c71cd454580af49c2244"
      }
    ],
    "stats": {
      "total": 4,
      "additions": 4,
      "deletions": 0
    },
    "files": [
      {
        "sha": "0dfece6b2779a5490e8fc5d4c2864d90aa4a6e04",
        "filename": "qa/rpc-tests/test_framework/test_framework.py",
        "status": "modified",
        "additions": 4,
        "deletions": 0,
        "changes": 4,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fa9976b853dbd04334cd0b5a058b99aa0014e649/qa/rpc-tests/test_framework/test_framework.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fa9976b853dbd04334cd0b5a058b99aa0014e649/qa/rpc-tests/test_framework/test_framework.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/test_framework/test_framework.py?ref=fa9976b853dbd04334cd0b5a058b99aa0014e649",
        "patch": "@@ -20,6 +20,7 @@\n     sync_blocks,\n     sync_mempools,\n     stop_nodes,\n+    stop_node,\n     wait_bitcoinds,\n     enable_coverage,\n     check_json_precision,\n@@ -49,6 +50,9 @@ def setup_chain(self):\n         else:\n             initialize_chain(self.options.tmpdir, self.num_nodes)\n \n+    def stop_node(self, num_node):\n+        stop_node(self.nodes[num_node], num_node)\n+\n     def setup_nodes(self):\n         return start_nodes(self.num_nodes, self.options.tmpdir)\n "
      }
    ]
  },
  {
    "sha": "fade505e8b0fa37e2d99bf94259250271a9604d4",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzpmYWRlNTA1ZThiMGZhMzdlMmQ5OWJmOTQyNTkyNTAyNzFhOTYwNGQ0",
    "commit": {
      "author": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2016-07-06T08:36:46Z"
      },
      "committer": {
        "name": "MarcoFalke",
        "email": "falke.marco@gmail.com",
        "date": "2016-07-07T20:19:35Z"
      },
      "message": "[qa] Add wallet-hd test",
      "tree": {
        "sha": "55af44014767755276287304aa145e45917ca19b",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/55af44014767755276287304aa145e45917ca19b"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/fade505e8b0fa37e2d99bf94259250271a9604d4",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "unsigned",
        "signature": null,
        "payload": null
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fade505e8b0fa37e2d99bf94259250271a9604d4",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/fade505e8b0fa37e2d99bf94259250271a9604d4",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fade505e8b0fa37e2d99bf94259250271a9604d4/comments",
    "author": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "MarcoFalke",
      "id": 6399679,
      "node_id": "MDQ6VXNlcjYzOTk2Nzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6399679?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MarcoFalke",
      "html_url": "https://github.com/MarcoFalke",
      "followers_url": "https://api.github.com/users/MarcoFalke/followers",
      "following_url": "https://api.github.com/users/MarcoFalke/following{/other_user}",
      "gists_url": "https://api.github.com/users/MarcoFalke/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MarcoFalke/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MarcoFalke/subscriptions",
      "organizations_url": "https://api.github.com/users/MarcoFalke/orgs",
      "repos_url": "https://api.github.com/users/MarcoFalke/repos",
      "events_url": "https://api.github.com/users/MarcoFalke/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MarcoFalke/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "fa9976b853dbd04334cd0b5a058b99aa0014e649",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/fa9976b853dbd04334cd0b5a058b99aa0014e649",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/fa9976b853dbd04334cd0b5a058b99aa0014e649"
      }
    ],
    "stats": {
      "total": 78,
      "additions": 78,
      "deletions": 0
    },
    "files": [
      {
        "sha": "11b83bac1468d7dea2ea9a38de6eb47b63baf21f",
        "filename": "qa/pull-tester/rpc-tests.py",
        "status": "modified",
        "additions": 1,
        "deletions": 0,
        "changes": 1,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fade505e8b0fa37e2d99bf94259250271a9604d4/qa/pull-tester/rpc-tests.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fade505e8b0fa37e2d99bf94259250271a9604d4/qa/pull-tester/rpc-tests.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/pull-tester/rpc-tests.py?ref=fade505e8b0fa37e2d99bf94259250271a9604d4",
        "patch": "@@ -106,6 +106,7 @@\n     'walletbackup.py',\n     'bip68-112-113-p2p.py',\n     'wallet.py',\n+    'wallet-hd.py',\n     'listtransactions.py',\n     'receivedby.py',\n     'mempool_resurrect_test.py',"
      },
      {
        "sha": "845eec027bde284bec34201ee4c32587d428a1e3",
        "filename": "qa/rpc-tests/wallet-hd.py",
        "status": "added",
        "additions": 77,
        "deletions": 0,
        "changes": 77,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/fade505e8b0fa37e2d99bf94259250271a9604d4/qa/rpc-tests/wallet-hd.py",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/fade505e8b0fa37e2d99bf94259250271a9604d4/qa/rpc-tests/wallet-hd.py",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/qa/rpc-tests/wallet-hd.py?ref=fade505e8b0fa37e2d99bf94259250271a9604d4",
        "patch": "@@ -0,0 +1,77 @@\n+#!/usr/bin/env python3\n+# Copyright (c) 2016 The Bitcoin Core developers\n+# Distributed under the MIT software license, see the accompanying\n+# file COPYING or http://www.opensource.org/licenses/mit-license.php.\n+\n+from test_framework.test_framework import BitcoinTestFramework\n+from test_framework.util import (\n+    start_nodes,\n+    start_node,\n+    assert_equal,\n+    connect_nodes_bi,\n+)\n+import os\n+import shutil\n+\n+\n+class WalletHDTest(BitcoinTestFramework):\n+\n+    def __init__(self):\n+        super().__init__()\n+        self.setup_clean_chain = True\n+        self.num_nodes = 2\n+        self.node_args = [['-usehd=0'], ['-usehd=1', '-keypool=0']]\n+\n+    def setup_network(self):\n+        self.nodes = start_nodes(self.num_nodes, self.options.tmpdir, self.node_args)\n+        self.is_network_split = False\n+        connect_nodes_bi(self.nodes, 0, 1)\n+\n+    def run_test (self):\n+        tmpdir = self.options.tmpdir\n+\n+        # Import a non-HD private key in the HD wallet\n+        non_hd_add = self.nodes[0].getnewaddress()\n+        self.nodes[1].importprivkey(self.nodes[0].dumpprivkey(non_hd_add))\n+\n+        # This should be enough to keep the master key and the non-HD key \n+        self.nodes[1].backupwallet(tmpdir + \"hd.bak\")\n+        #self.nodes[1].dumpwallet(tmpdir + \"hd.dump\")\n+\n+        # Derive some HD addresses and remember the last\n+        # Also send funds to each add\n+        self.nodes[0].generate(101)\n+        hd_add = None\n+        num_hd_adds = 300\n+        for _ in range(num_hd_adds):\n+            hd_add = self.nodes[1].getnewaddress()\n+            self.nodes[0].sendtoaddress(hd_add, 1)\n+            self.nodes[0].generate(1)\n+        self.nodes[0].sendtoaddress(non_hd_add, 1)\n+        self.nodes[0].generate(1)\n+\n+        self.sync_all()\n+        assert_equal(self.nodes[1].getbalance(), num_hd_adds + 1)\n+\n+        print(\"Restore backup ...\")\n+        self.stop_node(1)\n+        os.remove(self.options.tmpdir + \"/node1/regtest/wallet.dat\")\n+        shutil.copyfile(tmpdir + \"hd.bak\", tmpdir + \"/node1/regtest/wallet.dat\")\n+        self.nodes[1] = start_node(1, self.options.tmpdir, self.node_args[1])\n+        #connect_nodes_bi(self.nodes, 0, 1)\n+\n+        # Assert that derivation is deterministic\n+        hd_add_2 = None\n+        for _ in range(num_hd_adds):\n+            hd_add_2 = self.nodes[1].getnewaddress()\n+        assert_equal(hd_add, hd_add_2)\n+\n+        # Needs rescan\n+        self.stop_node(1)\n+        self.nodes[1] = start_node(1, self.options.tmpdir, self.node_args[1] + ['-rescan'])\n+        #connect_nodes_bi(self.nodes, 0, 1)\n+        assert_equal(self.nodes[1].getbalance(), num_hd_adds + 1)\n+\n+\n+if __name__ == '__main__':\n+    WalletHDTest().main ()"
      }
    ]
  }
]