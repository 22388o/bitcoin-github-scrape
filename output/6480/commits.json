[
  {
    "sha": "7d0bf0bb4652fad052d5bf3ca3bf883754b46ead",
    "node_id": "MDY6Q29tbWl0MTE4MTkyNzo3ZDBiZjBiYjQ2NTJmYWQwNTJkNWJmM2NhM2JmODgzNzU0YjQ2ZWFk",
    "commit": {
      "author": {
        "name": "Jonas Schnelli",
        "email": "jonas.schnelli@include7.ch",
        "date": "2015-07-27T13:33:03Z"
      },
      "committer": {
        "name": "Jonas Schnelli",
        "email": "dev@jonasschnelli.ch",
        "date": "2015-12-04T08:18:53Z"
      },
      "message": "include the chaintip *blockIndex in the SyncTransaction signal\n\n- allows reducing of calls to main.cpp for getting the chaintip during transaction syncing\n- potentially allows reducing of cs_main locks",
      "tree": {
        "sha": "21f66c55be4e532bf52ce39373a7e5a92c45fbcb",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/git/trees/21f66c55be4e532bf52ce39373a7e5a92c45fbcb"
      },
      "url": "https://api.github.com/repos/bitcoin/bitcoin/git/commits/7d0bf0bb4652fad052d5bf3ca3bf883754b46ead",
      "comment_count": 0,
      "verification": {
        "verified": false,
        "reason": "expired_key",
        "signature": "-----BEGIN PGP SIGNATURE-----\nVersion: GnuPG v1\n\niQIcBAABAgAGBQJWYUxxAAoJECnUvLZBb1PsV38QAK/L8kDAWZUlV1jurqDUCsHs\nZK8cMpcfjo4+Mbnea8KZa++7upyZtQWAM4qeTVa8DoLmN6V4ffjDjNbJdFiJ8uDP\n3tqfAxcF1/VpcTQZW+KMxfPdsiiI5khkonDO/oVR+01bapll8ImHm9zPCH1JYt/M\nTJpbA2pIwXwXdfAJ1yeIU9/JK0LspyeytMqdJL+EnWHiy41H1QSFcPwd7BpXMZgR\nJYAJsEtXVK9urcECcEEMhUIgSRzpDcnaqSgAtEsDQxMa8jVuEOKehGIZv0Cns3OH\nrCvtzAP74H+ESQWbrFqGJ5zJNZyYbxBg28pR0Y04XpQUTajIwFzx8oDRgmTLc1nH\nq/u8kMXoDqh1+yzXy8EGAmo1/BcjEYWJTsYWP97m0Rjde/eqd/eA0C9hYgyTg2FU\nBsMSlToH4QAh0VGkGdz33NjFfKItIEqsgmo/AVxe3ZohBPdo4awwyJ9BbwuRX4CJ\ny5ZQqKCnsVVvQMwhCj4ge3EHsK/myJuObJ1d2VURj7VckhIqztg3uLD3gDLoL/o5\nG2UY0oQi1QK1bdq6dM4DXOf1jRtjRsbaJeWE9DNpQa3veBrWJZbLYLqUzZPtlRIT\nGK5A9zs4CCG9slTnnS4g9jL6aXSzrIa0iHlBvcTXkpXCpeQOl2WjaEo8FanQmajm\nw8JdvCdD5R9zzAukG1O9\n=ivN9\n-----END PGP SIGNATURE-----",
        "payload": "tree 21f66c55be4e532bf52ce39373a7e5a92c45fbcb\nparent 5548d9cb11c8e66fa4913aba5e7d28acc2c5a9d0\nauthor Jonas Schnelli <jonas.schnelli@include7.ch> 1438003983 +0200\ncommitter Jonas Schnelli <dev@jonasschnelli.ch> 1449217133 +0100\n\ninclude the chaintip *blockIndex in the SyncTransaction signal\n\n- allows reducing of calls to main.cpp for getting the chaintip during transaction syncing\n- potentially allows reducing of cs_main locks\n"
      }
    },
    "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7d0bf0bb4652fad052d5bf3ca3bf883754b46ead",
    "html_url": "https://github.com/bitcoin/bitcoin/commit/7d0bf0bb4652fad052d5bf3ca3bf883754b46ead",
    "comments_url": "https://api.github.com/repos/bitcoin/bitcoin/commits/7d0bf0bb4652fad052d5bf3ca3bf883754b46ead/comments",
    "author": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "committer": {
      "login": "jonasschnelli",
      "id": 178464,
      "node_id": "MDQ6VXNlcjE3ODQ2NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/178464?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jonasschnelli",
      "html_url": "https://github.com/jonasschnelli",
      "followers_url": "https://api.github.com/users/jonasschnelli/followers",
      "following_url": "https://api.github.com/users/jonasschnelli/following{/other_user}",
      "gists_url": "https://api.github.com/users/jonasschnelli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jonasschnelli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jonasschnelli/subscriptions",
      "organizations_url": "https://api.github.com/users/jonasschnelli/orgs",
      "repos_url": "https://api.github.com/users/jonasschnelli/repos",
      "events_url": "https://api.github.com/users/jonasschnelli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jonasschnelli/received_events",
      "type": "User",
      "site_admin": false
    },
    "parents": [
      {
        "sha": "5548d9cb11c8e66fa4913aba5e7d28acc2c5a9d0",
        "url": "https://api.github.com/repos/bitcoin/bitcoin/commits/5548d9cb11c8e66fa4913aba5e7d28acc2c5a9d0",
        "html_url": "https://github.com/bitcoin/bitcoin/commit/5548d9cb11c8e66fa4913aba5e7d28acc2c5a9d0"
      }
    ],
    "stats": {
      "total": 31,
      "additions": 16,
      "deletions": 15
    },
    "files": [
      {
        "sha": "be14dec1cfba2d0491933c48b0926245e1664b76",
        "filename": "src/main.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d0bf0bb4652fad052d5bf3ca3bf883754b46ead/src/main.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d0bf0bb4652fad052d5bf3ca3bf883754b46ead/src/main.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/main.cpp?ref=7d0bf0bb4652fad052d5bf3ca3bf883754b46ead",
        "patch": "@@ -1234,7 +1234,7 @@ bool AcceptToMemoryPoolWorker(CTxMemPool& pool, CValidationState &state, const C\n         }\n     }\n \n-    SyncWithWallets(tx, NULL);\n+    SyncWithWallets(tx, NULL, NULL);\n \n     return true;\n }\n@@ -2391,7 +2391,7 @@ bool static DisconnectTip(CValidationState& state, const Consensus::Params& cons\n     // Let wallets know transactions went from 1-confirmed to\n     // 0-confirmed or conflicted:\n     BOOST_FOREACH(const CTransaction &tx, block.vtx) {\n-        SyncWithWallets(tx, NULL);\n+        SyncWithWallets(tx, pindexDelete->pprev, NULL);\n     }\n     return true;\n }\n@@ -2450,11 +2450,11 @@ bool static ConnectTip(CValidationState& state, const CChainParams& chainparams,\n     // Tell wallet about transactions that went from mempool\n     // to conflicted:\n     BOOST_FOREACH(const CTransaction &tx, txConflicted) {\n-        SyncWithWallets(tx, NULL);\n+        SyncWithWallets(tx, pindexNew, NULL);\n     }\n     // ... and about transactions that got confirmed:\n     BOOST_FOREACH(const CTransaction &tx, pblock->vtx) {\n-        SyncWithWallets(tx, pblock);\n+        SyncWithWallets(tx, pindexNew, pblock);\n     }\n \n     int64_t nTime6 = GetTimeMicros(); nTimePostConnect += nTime6 - nTime5; nTimeTotal += nTime6 - nTime1;"
      },
      {
        "sha": "8da0c72858d854b003c420a9be5bff12b428ef87",
        "filename": "src/validationinterface.cpp",
        "status": "modified",
        "additions": 4,
        "deletions": 4,
        "changes": 8,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d0bf0bb4652fad052d5bf3ca3bf883754b46ead/src/validationinterface.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d0bf0bb4652fad052d5bf3ca3bf883754b46ead/src/validationinterface.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/validationinterface.cpp?ref=7d0bf0bb4652fad052d5bf3ca3bf883754b46ead",
        "patch": "@@ -14,7 +14,7 @@ CMainSignals& GetMainSignals()\n \n void RegisterValidationInterface(CValidationInterface* pwalletIn) {\n     g_signals.UpdatedBlockTip.connect(boost::bind(&CValidationInterface::UpdatedBlockTip, pwalletIn, _1));\n-    g_signals.SyncTransaction.connect(boost::bind(&CValidationInterface::SyncTransaction, pwalletIn, _1, _2));\n+    g_signals.SyncTransaction.connect(boost::bind(&CValidationInterface::SyncTransaction, pwalletIn, _1, _2, _3));\n     g_signals.UpdatedTransaction.connect(boost::bind(&CValidationInterface::UpdatedTransaction, pwalletIn, _1));\n     g_signals.SetBestChain.connect(boost::bind(&CValidationInterface::SetBestChain, pwalletIn, _1));\n     g_signals.Inventory.connect(boost::bind(&CValidationInterface::Inventory, pwalletIn, _1));\n@@ -32,7 +32,7 @@ void UnregisterValidationInterface(CValidationInterface* pwalletIn) {\n     g_signals.Inventory.disconnect(boost::bind(&CValidationInterface::Inventory, pwalletIn, _1));\n     g_signals.SetBestChain.disconnect(boost::bind(&CValidationInterface::SetBestChain, pwalletIn, _1));\n     g_signals.UpdatedTransaction.disconnect(boost::bind(&CValidationInterface::UpdatedTransaction, pwalletIn, _1));\n-    g_signals.SyncTransaction.disconnect(boost::bind(&CValidationInterface::SyncTransaction, pwalletIn, _1, _2));\n+    g_signals.SyncTransaction.disconnect(boost::bind(&CValidationInterface::SyncTransaction, pwalletIn, _1, _2, _3));\n     g_signals.UpdatedBlockTip.disconnect(boost::bind(&CValidationInterface::UpdatedBlockTip, pwalletIn, _1));\n }\n \n@@ -48,6 +48,6 @@ void UnregisterAllValidationInterfaces() {\n     g_signals.UpdatedBlockTip.disconnect_all_slots();\n }\n \n-void SyncWithWallets(const CTransaction &tx, const CBlock *pblock) {\n-    g_signals.SyncTransaction(tx, pblock);\n+void SyncWithWallets(const CTransaction &tx, const CBlockIndex *pindex, const CBlock *pblock) {\n+    g_signals.SyncTransaction(tx, pindex, pblock);\n }"
      },
      {
        "sha": "b2d570df395c8c467d26c647665391ef2064a4f0",
        "filename": "src/validationinterface.h",
        "status": "modified",
        "additions": 4,
        "deletions": 3,
        "changes": 7,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d0bf0bb4652fad052d5bf3ca3bf883754b46ead/src/validationinterface.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d0bf0bb4652fad052d5bf3ca3bf883754b46ead/src/validationinterface.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/validationinterface.h?ref=7d0bf0bb4652fad052d5bf3ca3bf883754b46ead",
        "patch": "@@ -10,6 +10,7 @@\n #include <boost/shared_ptr.hpp>\n \n class CBlock;\n+class CBlockIndex;\n struct CBlockLocator;\n class CBlockIndex;\n class CReserveScript;\n@@ -27,12 +28,12 @@ void UnregisterValidationInterface(CValidationInterface* pwalletIn);\n /** Unregister all wallets from core */\n void UnregisterAllValidationInterfaces();\n /** Push an updated transaction to all registered wallets */\n-void SyncWithWallets(const CTransaction& tx, const CBlock* pblock = NULL);\n+void SyncWithWallets(const CTransaction& tx, const CBlockIndex *pindex, const CBlock* pblock = NULL);\n \n class CValidationInterface {\n protected:\n     virtual void UpdatedBlockTip(const CBlockIndex *pindex) {}\n-    virtual void SyncTransaction(const CTransaction &tx, const CBlock *pblock) {}\n+    virtual void SyncTransaction(const CTransaction &tx, const CBlockIndex *pindex, const CBlock *pblock) {}\n     virtual void SetBestChain(const CBlockLocator &locator) {}\n     virtual void UpdatedTransaction(const uint256 &hash) {}\n     virtual void Inventory(const uint256 &hash) {}\n@@ -49,7 +50,7 @@ struct CMainSignals {\n     /** Notifies listeners of updated block chain tip */\n     boost::signals2::signal<void (const CBlockIndex *)> UpdatedBlockTip;\n     /** Notifies listeners of updated transaction data (transaction, and optionally the block it is found in. */\n-    boost::signals2::signal<void (const CTransaction &, const CBlock *)> SyncTransaction;\n+    boost::signals2::signal<void (const CTransaction &, const CBlockIndex *pindex, const CBlock *)> SyncTransaction;\n     /** Notifies listeners of an updated transaction without new data (for now: a coinbase potentially becoming visible). */\n     boost::signals2::signal<void (const uint256 &)> UpdatedTransaction;\n     /** Notifies listeners of a new active block chain. */"
      },
      {
        "sha": "701eac6e3cb5d2c261fbfdf0efa74a4cd90730e8",
        "filename": "src/wallet/wallet.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d0bf0bb4652fad052d5bf3ca3bf883754b46ead/src/wallet/wallet.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d0bf0bb4652fad052d5bf3ca3bf883754b46ead/src/wallet/wallet.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.cpp?ref=7d0bf0bb4652fad052d5bf3ca3bf883754b46ead",
        "patch": "@@ -815,7 +815,7 @@ void CWallet::MarkConflicted(const uint256& hashBlock, const uint256& hashTx)\n     }\n }\n \n-void CWallet::SyncTransaction(const CTransaction& tx, const CBlock* pblock)\n+void CWallet::SyncTransaction(const CTransaction& tx, const CBlockIndex *pindex, const CBlock* pblock)\n {\n     LOCK2(cs_main, cs_wallet);\n "
      },
      {
        "sha": "ade825787e15bd8dfd492188471cde246858ed03",
        "filename": "src/wallet/wallet.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d0bf0bb4652fad052d5bf3ca3bf883754b46ead/src/wallet/wallet.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d0bf0bb4652fad052d5bf3ca3bf883754b46ead/src/wallet/wallet.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/wallet/wallet.h?ref=7d0bf0bb4652fad052d5bf3ca3bf883754b46ead",
        "patch": "@@ -635,7 +635,7 @@ class CWallet : public CCryptoKeyStore, public CValidationInterface\n \n     void MarkDirty();\n     bool AddToWallet(const CWalletTx& wtxIn, bool fFromLoadWallet, CWalletDB* pwalletdb);\n-    void SyncTransaction(const CTransaction& tx, const CBlock* pblock);\n+    void SyncTransaction(const CTransaction& tx, const CBlockIndex *pindex, const CBlock* pblock);\n     bool AddToWalletIfInvolvingMe(const CTransaction& tx, const CBlock* pblock, bool fUpdate);\n     int ScanForWalletTransactions(CBlockIndex* pindexStart, bool fUpdate = false);\n     void ReacceptWalletTransactions();"
      },
      {
        "sha": "c8adcf8462b73301950bd0ff1878354b636d70d5",
        "filename": "src/zmq/zmqnotificationinterface.cpp",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d0bf0bb4652fad052d5bf3ca3bf883754b46ead/src/zmq/zmqnotificationinterface.cpp",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d0bf0bb4652fad052d5bf3ca3bf883754b46ead/src/zmq/zmqnotificationinterface.cpp",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/zmq/zmqnotificationinterface.cpp?ref=7d0bf0bb4652fad052d5bf3ca3bf883754b46ead",
        "patch": "@@ -142,7 +142,7 @@ void CZMQNotificationInterface::UpdatedBlockTip(const CBlockIndex *pindex)\n     }\n }\n \n-void CZMQNotificationInterface::SyncTransaction(const CTransaction &tx, const CBlock *pblock)\n+void CZMQNotificationInterface::SyncTransaction(const CTransaction& tx, const CBlockIndex* pindex, const CBlock* pblock)\n {\n     for (std::list<CZMQAbstractNotifier*>::iterator i = notifiers.begin(); i!=notifiers.end(); )\n     {"
      },
      {
        "sha": "7b52e7775bc53ee5e0a1947aee0393ee7e31cd16",
        "filename": "src/zmq/zmqnotificationinterface.h",
        "status": "modified",
        "additions": 1,
        "deletions": 1,
        "changes": 2,
        "blob_url": "https://github.com/bitcoin/bitcoin/blob/7d0bf0bb4652fad052d5bf3ca3bf883754b46ead/src/zmq/zmqnotificationinterface.h",
        "raw_url": "https://github.com/bitcoin/bitcoin/raw/7d0bf0bb4652fad052d5bf3ca3bf883754b46ead/src/zmq/zmqnotificationinterface.h",
        "contents_url": "https://api.github.com/repos/bitcoin/bitcoin/contents/src/zmq/zmqnotificationinterface.h?ref=7d0bf0bb4652fad052d5bf3ca3bf883754b46ead",
        "patch": "@@ -24,7 +24,7 @@ class CZMQNotificationInterface : public CValidationInterface\n     void Shutdown();\n \n     // CValidationInterface\n-    void SyncTransaction(const CTransaction &tx, const CBlock *pblock);\n+    void SyncTransaction(const CTransaction& tx, const CBlockIndex *pindex, const CBlock* pblock);\n     void UpdatedBlockTip(const CBlockIndex *pindex);\n \n private:"
      }
    ]
  }
]