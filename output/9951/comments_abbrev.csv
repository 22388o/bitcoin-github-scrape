jonasschnelli,2017-03-09T08:02:52Z,"Great!\nConcept ACK.\nNeeds rebase.",https://github.com/bitcoin/bitcoin/pull/9951#issuecomment-285281844,285281844,
laanwj,2017-03-09T08:18:53Z,Yep needed trivial rebase for #9643.,https://github.com/bitcoin/bitcoin/pull/9951#issuecomment-285284819,285284819,
laanwj,2017-03-09T16:46:53Z,Fixed @benma's nits.,https://github.com/bitcoin/bitcoin/pull/9951#issuecomment-285408213,285408213,
benma,2017-03-09T18:06:13Z,"For my understanding: the refactor to support a different db backend than BerkeleyDB is not finished with this PR, right? It is a bit hard to see through `CDBEnv`, `CDB` and `CWalletDBWrapper`, but `CDB` looks half-finished: it still refers to the walletFile string in most functions instead of going through `CWalletDBWrapper`.\n\nAlso, berkeley-specific fields are in `CWalletDBWrapper`. If you w",https://github.com/bitcoin/bitcoin/pull/9951#issuecomment-285431311,285431311,
laanwj,2017-03-09T20:15:16Z,"> For my understanding: the refactor to support a different db backend than BerkeleyDB is not finished with this PR, right? It is a bit hard to see through CDBEnv, CDB and CWalletDBWrapper, but CDB looks half-finished: it still refers to the walletFile string in most functions instead of going through CWalletDBWrapper.\n\nTo be clear: CDB and CWalletDBWrapper and CDBEnv are database specific. Yo",https://github.com/bitcoin/bitcoin/pull/9951#issuecomment-285468120,285468120,
laanwj,2017-03-10T06:46:56Z,"@benma FYI not for review but if you're interested  https://github.com/laanwj/bitcoin/tree/20170310_experiment_leveldb_wallet is a leveldb wallet on top of this (edit: rebased, is on top of this version now). It passes the unit and QA tests apart from `backupwallet` which isn't implemented.",https://github.com/bitcoin/bitcoin/pull/9951#issuecomment-285591688,285591688,
sipa,2017-03-12T06:35:47Z,Concept ACK,https://github.com/bitcoin/bitcoin/pull/9951#issuecomment-285925761,285925761,
jonasschnelli,2017-03-27T13:39:40Z,"Tested ACK e3e51fdd3a9491ab4a07baed0a0f52b47ef70140\n(https://bitcoin.jonasschnelli.ch/build/PR/9951)\n\nThough needs a ""trivial"" rebase.",https://github.com/bitcoin/bitcoin/pull/9951#issuecomment-289456020,289456020,
jonasschnelli,2017-04-19T10:23:18Z,Needs rebase (Imo this is ready for merge).,https://github.com/bitcoin/bitcoin/pull/9951#issuecomment-295205370,295205370,
laanwj,2017-04-19T10:44:22Z,"Yes, will rebase this soon(TM) and fix the nits.",https://github.com/bitcoin/bitcoin/pull/9951#issuecomment-295212770,295212770,
laanwj,2017-03-09T09:35:17Z,"This unique_ptr here bothers me. The interface shouldn't care what kind of pointer is used. I think I'm going to change this to take a `CWalletDBWrapper&`, then replace the call sites with `CWalletDB(*dbw)`. That's better than `CWalletDB(dbw.get())` at least.\nEdit: done",https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105120742,105120742,src/wallet/walletdb.h
benma,2017-03-09T15:32:39Z,"Better to use `const std::string& strFileName`, no copying and it's clear it won't be modified.",https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105191282,105191282,src/wallet/db.cpp
benma,2017-03-09T15:32:47Z,same,https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105191328,105191328,src/wallet/db.cpp
benma,2017-03-09T15:32:58Z,same,https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105191387,105191387,src/wallet/db.cpp
benma,2017-03-09T15:34:08Z,"Better to move the check to the top, above `bool ret`.",https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105191688,105191688,src/wallet/db.cpp
benma,2017-03-09T15:35:16Z,"Inconsistent style with using/skipping braces (above, you used braces, here, you don't). I'd add them.",https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105191969,105191969,src/wallet/db.cpp
benma,2017-03-09T15:37:01Z,const std::string,https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105192424,105192424,src/wallet/db.h
benma,2017-03-09T15:38:31Z,"`std::string GetName() const`\n\nYou have this function, and the public `strWalletFile`, which you access directly in other places. Maybe `strWalletFile` should be made private, or alternatively, this function removed.",https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105192897,105192897,src/wallet/db.h
benma,2017-03-09T15:40:52Z,`GetName() const`,https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105193519,105193519,src/wallet/wallet.h
benma,2017-03-09T15:41:48Z,"Maybe it is a matter of personal preference, but I always find it odd to put an `else` when the `if` returns.",https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105193794,105193794,src/wallet/wallet.h
laanwj,2017-03-09T16:04:32Z,"They are subtly different, only happen to be the same for BerkeleyDB: \n\n- `GetName` is an an abstract name to refer to the database object for logging or troubleshooting. It should exist for any version of CDBWrapper.\n- `strWalletFile` is an implementation detail that only exists for BerkeleyDB. Other databases may have completely different connection descriptions, which do not involve simpl",https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105200324,105200324,src/wallet/db.h
laanwj,2017-03-09T16:06:30Z,"I prefer to keep it this way. We have no guideline on this in `doc/developer-notes.md`, and I personally find it easier to follow the control flow this way.",https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105200892,105200892,src/wallet/wallet.h
laanwj,2017-03-09T16:07:43Z,"Could make this clearer using ""friend"" I guess.",https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105201207,105201207,src/wallet/db.h
laanwj,2017-03-09T16:09:01Z,Agreed.,https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105201563,105201563,src/wallet/db.cpp
laanwj,2017-03-09T16:10:20Z,Yes the brace should be after,https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105201911,105201911,src/wallet/db.cpp
laanwj,2017-03-09T16:11:29Z,Yes good catch.,https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105202223,105202223,src/wallet/wallet.h
benma,2017-03-09T17:20:47Z,`const std::string strFile;` ?,https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105220521,105220521,src/wallet/db.h
TheBlueMatt,2017-03-10T20:16:45Z,"Can you go ahead and =delete these, since we have C++11?",https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105480243,105480243,src/wallet/db.h
laanwj,2017-03-12T07:04:07Z,Good idea,https://github.com/bitcoin/bitcoin/pull/9951#discussion_r105550526,105550526,src/wallet/db.h
JeremyRubin,2017-04-05T16:51:57Z,"I think there's a small benefit to not making a CWalletDBWrapper the default constructor. Maybe delete the default, and have `struct MockTag{}; CWalletDBWrapper(MockTag);` to make a dummy explicitly constructed.",https://github.com/bitcoin/bitcoin/pull/9951#discussion_r109969545,109969545,src/wallet/db.h
JeremyRubin,2017-04-05T18:53:23Z,"Previously, an empty strFilename would return immediately. Also, given that we initialize strFile to copy strFileName, we may as well just toss this into the constructor's initialize list. If it's empty, it's free. If it's not empty, we were going to copy it anyways.",https://github.com/bitcoin/bitcoin/pull/9951#discussion_r109999052,109999052,src/wallet/db.cpp
JeremyRubin,2017-04-05T19:10:31Z,"I'm a little confused on the API here.\n\nI feel like the unwrapped version of CDB shouldn't be compatible with the wrapped version of CWalletDB?",https://github.com/bitcoin/bitcoin/pull/9951#discussion_r110002885,110002885,src/wallet/db.cpp
JeremyRubin,2017-04-05T19:14:32Z,"If it's only to be used by low level stuff, maybe friend the function specifically to those classes...",https://github.com/bitcoin/bitcoin/pull/9951#discussion_r110003734,110003734,src/wallet/db.h
JeremyRubin,2017-04-05T19:20:46Z,missing std::,https://github.com/bitcoin/bitcoin/pull/9951#discussion_r110004989,110004989,src/wallet/walletdb.cpp
laanwj,2017-04-20T15:06:32Z,"CWalletDBWrapper is not a wrapper around CWalletDB. We kind of have a naming problem with the wallet:\n- `CDBEnv` is an environment in which the database exists (has no analog in `dbwrapper.h`)\n- `CWalletDBWrapper` represents a wallet database (similar to `CDBWrapper` in `dbwrapper.h`)\n- `CDB` is a low-level database transaction (similar to `CDBBatch` in `dbwrapper.h`)\n- `CWalletDB` is a mo",https://github.com/bitcoin/bitcoin/pull/9951#discussion_r112477989,112477989,src/wallet/db.cpp
laanwj,2017-04-20T15:47:26Z,"Yes, good point. CDB is already a friend and should be the only user of this, moving it to private.",https://github.com/bitcoin/bitcoin/pull/9951#discussion_r112489193,112489193,src/wallet/db.h
laanwj,2017-04-20T15:52:12Z,"I don't understand why this doesn't cause a compile error. We've removed all the ""using namespace std"".",https://github.com/bitcoin/bitcoin/pull/9951#discussion_r112490394,112490394,src/wallet/walletdb.cpp
laanwj,2017-04-21T14:05:04Z,"I added a commit that adds this as a comment, as it will be something that confuses everyone reading this code.",https://github.com/bitcoin/bitcoin/pull/9951#discussion_r112694482,112694482,src/wallet/db.cpp
