[
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/52420639",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/4683#issuecomment-52420639",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/4683",
    "id": 52420639,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNDIwNjM5",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-08-17T12:30:41Z",
    "updated_at": "2014-08-17T12:30:41Z",
    "author_association": "MEMBER",
    "body": "@laanwj How do you feel about this and its conflicting with #4700?\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/52420639/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/52472513",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/4683#issuecomment-52472513",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/4683",
    "id": 52472513,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNDcyNTEz",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?u=13b19d1ff2f5f914e180c41418f451a4ba6f8bd1&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-08-18T09:59:47Z",
    "updated_at": "2014-08-18T09:59:47Z",
    "author_association": "MEMBER",
    "body": "The only serious conflict with #4700 is caused by CCoinsViewCache::BatchWrite now taking a mutable CCoinsView.\n\nBut I'm not sure about the #4700 yet. In my experiments since, I've noticed that tweaking with the cache doesn't seem to have noticable influence on performance at all in syncing/reindexing. The cache mostly acts as a 'write buffer'. The read cache component is less important. Even though it gets lots of hits it doesn't figure into what actually consumes time.\n\nSo - reducing memory usage while keeping the current functionality seems fine to me. ACK.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/52472513/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/52537998",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/4683#issuecomment-52537998",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/4683",
    "id": 52537998,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNTM3OTk4",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-08-18T18:55:44Z",
    "updated_at": "2014-08-18T18:55:54Z",
    "author_association": "MEMBER",
    "body": "Benchmarked: did a full testnet reindex using:\n\n```\n$ /usr/bin/time -f \"user:%U elapsed:%E maxmem:%M\" ./bitcoind -testnet -reindex -nodaemon -stopafterblockimport -debug=benchmark -dbcache=3000\n```\n\nResulting peak memory usage: 1041 MiB without this patch, 922 MiB with. No difference in speed.\n\nNote that this peak is during the final batch write to LevelDB.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/52537998/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53171233",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/4683#issuecomment-53171233",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/4683",
    "id": 53171233,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMTcxMjMz",
    "user": {
      "login": "gmaxwell",
      "id": 858454,
      "node_id": "MDQ6VXNlcjg1ODQ1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/858454?u=63e5c438c242094837a9deeda775d77988b508bf&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gmaxwell",
      "html_url": "https://github.com/gmaxwell",
      "followers_url": "https://api.github.com/users/gmaxwell/followers",
      "following_url": "https://api.github.com/users/gmaxwell/following{/other_user}",
      "gists_url": "https://api.github.com/users/gmaxwell/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gmaxwell/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gmaxwell/subscriptions",
      "organizations_url": "https://api.github.com/users/gmaxwell/orgs",
      "repos_url": "https://api.github.com/users/gmaxwell/repos",
      "events_url": "https://api.github.com/users/gmaxwell/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gmaxwell/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-08-23T23:59:23Z",
    "updated_at": "2014-08-23T23:59:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "Looks reasonable to me, I hadn't commented because I'd moved most of my testing to 0.9.3rc1.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53171233/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53171382",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/4683#issuecomment-53171382",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/4683",
    "id": 53171382,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMTcxMzgy",
    "user": {
      "login": "jgarzik",
      "id": 494411,
      "node_id": "MDQ6VXNlcjQ5NDQxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/494411?u=0b02049ec38b6bb7d55c5c66d9bbeb0d4b822129&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jgarzik",
      "html_url": "https://github.com/jgarzik",
      "followers_url": "https://api.github.com/users/jgarzik/followers",
      "following_url": "https://api.github.com/users/jgarzik/following{/other_user}",
      "gists_url": "https://api.github.com/users/jgarzik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jgarzik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jgarzik/subscriptions",
      "organizations_url": "https://api.github.com/users/jgarzik/orgs",
      "repos_url": "https://api.github.com/users/jgarzik/repos",
      "events_url": "https://api.github.com/users/jgarzik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jgarzik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-08-24T00:04:34Z",
    "updated_at": "2014-08-24T00:04:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "ut ACK, though I would have preferred that the script change be in a separate commit.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53171382/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53171495",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/4683#issuecomment-53171495",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/4683",
    "id": 53171495,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMTcxNDk1",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?u=7999a16349f0df0fb273fffa18e5a955c9d3f11c&v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-08-24T00:08:49Z",
    "updated_at": "2014-08-24T00:08:49Z",
    "author_association": "MEMBER",
    "body": "@jgarzik Done.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53171495/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53173473",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/4683#issuecomment-53173473",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/4683",
    "id": 53173473,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMTczNDcz",
    "user": {
      "login": "BitcoinPullTester",
      "id": 2110907,
      "node_id": "MDQ6VXNlcjIxMTA5MDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2110907?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/BitcoinPullTester",
      "html_url": "https://github.com/BitcoinPullTester",
      "followers_url": "https://api.github.com/users/BitcoinPullTester/followers",
      "following_url": "https://api.github.com/users/BitcoinPullTester/following{/other_user}",
      "gists_url": "https://api.github.com/users/BitcoinPullTester/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/BitcoinPullTester/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/BitcoinPullTester/subscriptions",
      "organizations_url": "https://api.github.com/users/BitcoinPullTester/orgs",
      "repos_url": "https://api.github.com/users/BitcoinPullTester/repos",
      "events_url": "https://api.github.com/users/BitcoinPullTester/events{/privacy}",
      "received_events_url": "https://api.github.com/users/BitcoinPullTester/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-08-24T01:25:44Z",
    "updated_at": "2014-08-24T01:25:44Z",
    "author_association": "NONE",
    "body": "Automatic sanity-testing: PASSED, see http://jenkins.bluematt.me/pull-tester/p4683_fff7455deda80bf483422dd7d7c2446e93522f2d/ for binaries and test log.\nThis test script verifies pulls every time they are updated. It, however, dies sometimes and fails to test properly.  If you are waiting on a test, please check timestamps to verify that the test.log is moving at http://jenkins.bluematt.me/pull-tester/current/\nContact BlueMatt on freenode if something looks broken.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53173473/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53184203",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/4683#issuecomment-53184203",
    "issue_url": "https://api.github.com/repos/bitcoin/bitcoin/issues/4683",
    "id": 53184203,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMTg0MjAz",
    "user": {
      "login": "TheBlueMatt",
      "id": 649246,
      "node_id": "MDQ6VXNlcjY0OTI0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/649246?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/TheBlueMatt",
      "html_url": "https://github.com/TheBlueMatt",
      "followers_url": "https://api.github.com/users/TheBlueMatt/followers",
      "following_url": "https://api.github.com/users/TheBlueMatt/following{/other_user}",
      "gists_url": "https://api.github.com/users/TheBlueMatt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/TheBlueMatt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/TheBlueMatt/subscriptions",
      "organizations_url": "https://api.github.com/users/TheBlueMatt/orgs",
      "repos_url": "https://api.github.com/users/TheBlueMatt/repos",
      "events_url": "https://api.github.com/users/TheBlueMatt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/TheBlueMatt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2014-08-24T08:41:16Z",
    "updated_at": "2014-08-24T08:41:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "I didnt do a full reindex, but it does continue to sync,\nACK.\n",
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/issues/comments/53184203/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16108919",
    "pull_request_review_id": null,
    "id": 16108919,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MTA4OTE5",
    "diff_hunk": "@@ -130,17 +130,19 @@ bool CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n     return true;\n }\n \n-bool CCoinsViewCache::BatchWrite(const CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n-    for (CCoinsMap::const_iterator it = mapCoins.begin(); it != mapCoins.end(); it++)\n-        cacheCoins[it->first] = it->second;\n+bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n+    for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end();) {\n+        cacheCoins[it->first].swap(it->second);\n+        CCoinsMap::iterator itOld = it++;\n+        mapCoins.erase(itOld);",
    "path": "src/coins.cpp",
    "position": 29,
    "original_position": 29,
    "commit_id": "fff7455deda80bf483422dd7d7c2446e93522f2d",
    "original_commit_id": "b8763384b47428e3195ab2d25f848853d37f14fa",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "As this iterates over the full `mapCoins`, a clear() at the end may be faster than erasing the entries one by one.\n",
    "created_at": "2014-08-12T12:08:52Z",
    "updated_at": "2014-08-24T00:08:44Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16108919",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16108919"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16108919"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16108919/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 137,
    "original_line": 137,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16109270",
    "pull_request_review_id": null,
    "id": 16109270,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MTA5Mjcw",
    "diff_hunk": "@@ -130,17 +130,19 @@ bool CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n     return true;\n }\n \n-bool CCoinsViewCache::BatchWrite(const CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n-    for (CCoinsMap::const_iterator it = mapCoins.begin(); it != mapCoins.end(); it++)\n-        cacheCoins[it->first] = it->second;\n+bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n+    for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end();) {\n+        cacheCoins[it->first].swap(it->second);\n+        CCoinsMap::iterator itOld = it++;\n+        mapCoins.erase(itOld);",
    "path": "src/coins.cpp",
    "position": 29,
    "original_position": 29,
    "commit_id": "fff7455deda80bf483422dd7d7c2446e93522f2d",
    "original_commit_id": "b8763384b47428e3195ab2d25f848853d37f14fa",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "map.clear() still has to iterate over all entries, while they're already in the CPU cache when we're doing this. Also, it means more memory being freed early while increasing memory in the destination, in theory reducing peak usage.\n",
    "created_at": "2014-08-12T12:18:48Z",
    "updated_at": "2014-08-24T00:08:44Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16109270",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16109270"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16109270"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16109270/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 137,
    "original_line": 137,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16109814",
    "pull_request_review_id": null,
    "id": 16109814,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MTA5ODE0",
    "diff_hunk": "@@ -130,17 +130,19 @@ bool CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n     return true;\n }\n \n-bool CCoinsViewCache::BatchWrite(const CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n-    for (CCoinsMap::const_iterator it = mapCoins.begin(); it != mapCoins.end(); it++)\n-        cacheCoins[it->first] = it->second;\n+bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n+    for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end();) {\n+        cacheCoins[it->first].swap(it->second);\n+        CCoinsMap::iterator itOld = it++;\n+        mapCoins.erase(itOld);",
    "path": "src/coins.cpp",
    "position": 29,
    "original_position": 29,
    "commit_id": "fff7455deda80bf483422dd7d7c2446e93522f2d",
    "original_commit_id": "b8763384b47428e3195ab2d25f848853d37f14fa",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "That's true.\n",
    "created_at": "2014-08-12T12:33:47Z",
    "updated_at": "2014-08-24T00:08:44Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16109814",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16109814"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16109814"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16109814/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 137,
    "original_line": 137,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16109927",
    "pull_request_review_id": null,
    "id": 16109927,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MTA5OTI3",
    "diff_hunk": "@@ -130,17 +130,19 @@ bool CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n     return true;\n }\n \n-bool CCoinsViewCache::BatchWrite(const CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n-    for (CCoinsMap::const_iterator it = mapCoins.begin(); it != mapCoins.end(); it++)\n-        cacheCoins[it->first] = it->second;\n+bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n+    for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end();) {\n+        cacheCoins[it->first].swap(it->second);\n+        CCoinsMap::iterator itOld = it++;\n+        mapCoins.erase(itOld);",
    "path": "src/coins.cpp",
    "position": 29,
    "original_position": 29,
    "commit_id": "fff7455deda80bf483422dd7d7c2446e93522f2d",
    "original_commit_id": "b8763384b47428e3195ab2d25f848853d37f14fa",
    "user": {
      "login": "sipa",
      "id": 548488,
      "node_id": "MDQ6VXNlcjU0ODQ4OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/548488?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sipa",
      "html_url": "https://github.com/sipa",
      "followers_url": "https://api.github.com/users/sipa/followers",
      "following_url": "https://api.github.com/users/sipa/following{/other_user}",
      "gists_url": "https://api.github.com/users/sipa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sipa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sipa/subscriptions",
      "organizations_url": "https://api.github.com/users/sipa/orgs",
      "repos_url": "https://api.github.com/users/sipa/repos",
      "events_url": "https://api.github.com/users/sipa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sipa/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "Hmm, I was reasoning in terms of a treemap, but it's a hashmap now. Just erasing all entries will not cause its hash table to be freed, and clear() afterwards will still iterate over all entries (to potentially erase them), so I'm not sure whether this weighs up against the slightly better peak memory usage.\n",
    "created_at": "2014-08-12T12:37:05Z",
    "updated_at": "2014-08-24T00:08:44Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16109927",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16109927"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16109927"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16109927/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 137,
    "original_line": 137,
    "side": "RIGHT"
  },
  {
    "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16110429",
    "pull_request_review_id": null,
    "id": 16110429,
    "node_id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDE2MTEwNDI5",
    "diff_hunk": "@@ -130,17 +130,19 @@ bool CCoinsViewCache::SetBestBlock(const uint256 &hashBlockIn) {\n     return true;\n }\n \n-bool CCoinsViewCache::BatchWrite(const CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n-    for (CCoinsMap::const_iterator it = mapCoins.begin(); it != mapCoins.end(); it++)\n-        cacheCoins[it->first] = it->second;\n+bool CCoinsViewCache::BatchWrite(CCoinsMap &mapCoins, const uint256 &hashBlockIn) {\n+    for (CCoinsMap::iterator it = mapCoins.begin(); it != mapCoins.end();) {\n+        cacheCoins[it->first].swap(it->second);\n+        CCoinsMap::iterator itOld = it++;\n+        mapCoins.erase(itOld);",
    "path": "src/coins.cpp",
    "position": 29,
    "original_position": 29,
    "commit_id": "fff7455deda80bf483422dd7d7c2446e93522f2d",
    "original_commit_id": "b8763384b47428e3195ab2d25f848853d37f14fa",
    "user": {
      "login": "laanwj",
      "id": 126646,
      "node_id": "MDQ6VXNlcjEyNjY0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/126646?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/laanwj",
      "html_url": "https://github.com/laanwj",
      "followers_url": "https://api.github.com/users/laanwj/followers",
      "following_url": "https://api.github.com/users/laanwj/following{/other_user}",
      "gists_url": "https://api.github.com/users/laanwj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/laanwj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/laanwj/subscriptions",
      "organizations_url": "https://api.github.com/users/laanwj/orgs",
      "repos_url": "https://api.github.com/users/laanwj/repos",
      "events_url": "https://api.github.com/users/laanwj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/laanwj/received_events",
      "type": "User",
      "site_admin": false
    },
    "body": "It probably makes a minimal difference, if at all - let's prioritize the peak memory usage and keep it like this.\n",
    "created_at": "2014-08-12T12:50:48Z",
    "updated_at": "2014-08-24T00:08:44Z",
    "html_url": "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16110429",
    "pull_request_url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683",
    "author_association": "MEMBER",
    "_links": {
      "self": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16110429"
      },
      "html": {
        "href": "https://github.com/bitcoin/bitcoin/pull/4683#discussion_r16110429"
      },
      "pull_request": {
        "href": "https://api.github.com/repos/bitcoin/bitcoin/pulls/4683"
      }
    },
    "reactions": {
      "url": "https://api.github.com/repos/bitcoin/bitcoin/pulls/comments/16110429/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "start_line": null,
    "original_start_line": null,
    "start_side": null,
    "line": 137,
    "original_line": 137,
    "side": "RIGHT"
  }
]